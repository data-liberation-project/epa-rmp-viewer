var app=function(){"use strict";function e(){}const t=e=>e;function i(e){return e()}function n(){return Object.create(null)}function r(e){e.forEach(i)}function o(e){return"function"==typeof e}function a(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function s(t,i,n){t.$$.on_destroy.push(function(t,...i){if(null==t)return e;const n=t.subscribe(...i);return n.unsubscribe?()=>n.unsubscribe():n}(i,n))}function l(e,t,i,n){if(e){const r=c(e,t,i,n);return e[0](r)}}function c(e,t,i,n){return e[1]&&n?function(e,t){for(const i in t)e[i]=t[i];return e}(i.ctx.slice(),e[1](n(t))):i.ctx}function u(e,t,i,n){if(e[2]&&n){const r=e[2](n(i));if(void 0===t.dirty)return r;if("object"==typeof r){const e=[],i=Math.max(t.dirty.length,r.length);for(let n=0;n<i;n+=1)e[n]=t.dirty[n]|r[n];return e}return t.dirty|r}return t.dirty}function h(e,t,i,n,r,o){if(r){const a=c(t,i,n,o);e.p(a,r)}}function d(e){if(e.ctx.length>32){const t=[],i=e.ctx.length/32;for(let e=0;e<i;e++)t[e]=-1;return t}return-1}const p="undefined"!=typeof window;let f=p?()=>window.performance.now():()=>Date.now(),m=p?e=>requestAnimationFrame(e):e;const g=new Set;function _(e){g.forEach((t=>{t.c(e)||(g.delete(t),t.f())})),0!==g.size&&m(_)}function y(e,t){e.appendChild(t)}function x(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function v(e){const t=T("style");return function(e,t){y(e.head||e,t),t.sheet}(x(e),t),t.sheet}function b(e,t,i){e.insertBefore(t,i||null)}function w(e){e.parentNode&&e.parentNode.removeChild(e)}function M(e,t){for(let i=0;i<e.length;i+=1)e[i]&&e[i].d(t)}function T(e){return document.createElement(e)}function S(e){return document.createTextNode(e)}function E(){return S(" ")}function C(){return S("")}function A(e,t,i,n){return e.addEventListener(t,i,n),()=>e.removeEventListener(t,i,n)}function P(e,t,i){null==i?e.removeAttribute(t):e.getAttribute(t)!==i&&e.setAttribute(t,i)}function I(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function k(e,t,i,n){null===i?e.style.removeProperty(t):e.style.setProperty(t,i,n?"important":"")}function z(e,t,i){e.classList[i?"add":"remove"](t)}class D{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,i=null){var n;this.e||(this.is_svg?this.e=(n=t.nodeName,document.createElementNS("http://www.w3.org/2000/svg",n)):this.e=T(t.nodeName),this.t=t,this.c(e)),this.i(i)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)b(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(w)}}function L(e,t){return new e(t)}const R=new Map;let O,B=0;function F(e,t,i,n,r,o,a,s=0){const l=16.666/n;let c="{\n";for(let e=0;e<=1;e+=l){const n=t+(i-t)*o(e);c+=100*e+`%{${a(n,1-n)}}\n`}const u=c+`100% {${a(i,1-i)}}\n}`,h=`__svelte_${function(e){let t=5381,i=e.length;for(;i--;)t=(t<<5)-t^e.charCodeAt(i);return t>>>0}(u)}_${s}`,d=x(e),{stylesheet:p,rules:f}=R.get(d)||function(e,t){const i={stylesheet:v(t),rules:{}};return R.set(e,i),i}(d,e);f[h]||(f[h]=!0,p.insertRule(`@keyframes ${h} ${u}`,p.cssRules.length));const m=e.style.animation||"";return e.style.animation=`${m?`${m}, `:""}${h} ${n}ms linear ${r}ms 1 both`,B+=1,h}function N(e,t){const i=(e.style.animation||"").split(", "),n=i.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),r=i.length-n.length;r&&(e.style.animation=n.join(", "),B-=r,B||m((()=>{B||(R.forEach((e=>{const{ownerNode:t}=e.stylesheet;t&&w(t)})),R.clear())})))}function U(e){O=e}function V(){if(!O)throw new Error("Function called outside component initialization");return O}const G=[],j=[],W=[],$=[],q=Promise.resolve();let Z=!1;function H(e){W.push(e)}const X=new Set;let Y,J=0;function K(){if(0!==J)return;const e=O;do{try{for(;J<G.length;){const e=G[J];J++,U(e),Q(e.$$)}}catch(e){throw G.length=0,J=0,e}for(U(null),G.length=0,J=0;j.length;)j.pop()();for(let e=0;e<W.length;e+=1){const t=W[e];X.has(t)||(X.add(t),t())}W.length=0}while(G.length);for(;$.length;)$.pop()();Z=!1,X.clear(),U(e)}function Q(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(H)}}function ee(e,t,i){e.dispatchEvent(function(e,t,{bubbles:i=!1,cancelable:n=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(e,i,n,t),r}(`${t?"intro":"outro"}${i}`))}const te=new Set;let ie;function ne(){ie={r:0,c:[],p:ie}}function re(){ie.r||r(ie.c),ie=ie.p}function oe(e,t){e&&e.i&&(te.delete(e),e.i(t))}function ae(e,t,i,n){if(e&&e.o){if(te.has(e))return;te.add(e),ie.c.push((()=>{te.delete(e),n&&(i&&e.d(1),n())})),e.o(t)}else n&&n()}const se={duration:0};function le(i,n,a,s){const l={direction:"both"};let c=n(i,a,l),u=s?0:1,h=null,d=null,p=null;function y(){p&&N(i,p)}function x(e,t){const i=e.b-u;return t*=Math.abs(i),{a:u,b:e.b,d:i,duration:t,start:e.start,end:e.start+t,group:e.group}}function v(n){const{delay:o=0,duration:a=300,easing:s=t,tick:l=e,css:v}=c||se,b={start:f()+o,b:n};n||(b.group=ie,ie.r+=1),h||d?d=b:(v&&(y(),p=F(i,u,n,a,o,s,v)),n&&l(0,1),h=x(b,a),H((()=>ee(i,n,"start"))),function(e){let t;0===g.size&&m(_),new Promise((i=>{g.add(t={c:e,f:i})}))}((e=>{if(d&&e>d.start&&(h=x(d,a),d=null,ee(i,h.b,"start"),v&&(y(),p=F(i,u,h.b,h.duration,0,s,c.css))),h)if(e>=h.end)l(u=h.b,1-u),ee(i,h.b,"end"),d||(h.b?y():--h.group.r||r(h.group.c)),h=null;else if(e>=h.start){const t=e-h.start;u=h.a+h.d*s(t/h.duration),l(u,1-u)}return!(!h&&!d)})))}return{run(e){o(c)?(Y||(Y=Promise.resolve(),Y.then((()=>{Y=null}))),Y).then((()=>{c=c(l),v(e)})):v(e)},end(){y(),h=d=null}}}function ce(e){e&&e.c()}function ue(e,t,n,a){const{fragment:s,after_update:l}=e.$$;s&&s.m(t,n),a||H((()=>{const t=e.$$.on_mount.map(i).filter(o);e.$$.on_destroy?e.$$.on_destroy.push(...t):r(t),e.$$.on_mount=[]})),l.forEach(H)}function he(e,t){const i=e.$$;null!==i.fragment&&(r(i.on_destroy),i.fragment&&i.fragment.d(t),i.on_destroy=i.fragment=null,i.ctx=[])}function de(e,t){-1===e.$$.dirty[0]&&(G.push(e),Z||(Z=!0,q.then(K)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function pe(t,i,o,a,s,l,c,u=[-1]){const h=O;U(t);const d=t.$$={fragment:null,ctx:[],props:l,update:e,not_equal:s,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(h?h.$$.context:[])),callbacks:n(),dirty:u,skip_bound:!1,root:i.target||h.$$.root};c&&c(d.root);let p=!1;if(d.ctx=o?o(t,i.props||{},((e,i,...n)=>{const r=n.length?n[0]:i;return d.ctx&&s(d.ctx[e],d.ctx[e]=r)&&(!d.skip_bound&&d.bound[e]&&d.bound[e](r),p&&de(t,e)),i})):[],d.update(),p=!0,r(d.before_update),d.fragment=!!a&&a(d.ctx),i.target){if(i.hydrate){const e=function(e){return Array.from(e.childNodes)}(i.target);d.fragment&&d.fragment.l(e),e.forEach(w)}else d.fragment&&d.fragment.c();i.intro&&oe(t.$$.fragment),ue(t,i.target,i.anchor,i.customElement),K()}U(h)}class fe{$destroy(){he(this,1),this.$destroy=e}$on(t,i){if(!o(i))return e;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(i),()=>{const e=n.indexOf(i);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const me=[];function ge(e){let t;const i=e[4].default,n=l(i,e,e[3],null);return{c(){n&&n.c()},m(e,i){n&&n.m(e,i),t=!0},p(e,[r]){n&&n.p&&(!t||8&r)&&h(n,i,e,e[3],t?u(i,e[3],r,null):d(e[3]),null)},i(e){t||(oe(n,e),t=!0)},o(e){ae(n,e),t=!1},d(e){n&&n.d(e)}}}const _e={},ye=()=>function(e){return V().$$.context.get(e)}(_e),xe=t=>{const i=function(t,i=e){let n;const r=new Set;function o(e){if(a(t,e)&&(t=e,n)){const e=!me.length;for(const e of r)e[1](),me.push(e,t);if(e){for(let e=0;e<me.length;e+=2)me[e][0](me[e+1]);me.length=0}}}return{set:o,update:function(e){o(e(t))},subscribe:function(a,s=e){const l=[a,s];return r.add(l),1===r.size&&(n=i(o)||e),a(t),()=>{r.delete(l),0===r.size&&(n(),n=null)}}}}(t),n={current:i};return function(e,t){V().$$.context.set(e,t)}(_e,n),n};function ve(e,t,i){let n,{$$slots:r={},$$scope:o}=t,{current:a=null}=t;const{current:l}=xe(a);return s(e,l,(e=>i(2,n=e))),e.$$set=e=>{"current"in e&&i(1,a=e.current),"$$scope"in e&&i(3,o=e.$$scope)},e.$$.update=()=>{4&e.$$.dirty&&i(1,a=n),2&e.$$.dirty&&l.set(a)},[l,a,n,o,r]}class be extends fe{constructor(e){super(),pe(this,e,ve,ge,a,{current:1})}}function we(e){const t=e-1;return t*t*t+1}function Me(e){return(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1)}function Te(e,{delay:t=0,duration:i=400,easing:n=we}={}){const r=getComputedStyle(e),o=+r.opacity,a=parseFloat(r.height),s=parseFloat(r.paddingTop),l=parseFloat(r.paddingBottom),c=parseFloat(r.marginTop),u=parseFloat(r.marginBottom),h=parseFloat(r.borderTopWidth),d=parseFloat(r.borderBottomWidth);return{delay:t,duration:i,easing:n,css:e=>`overflow: hidden;opacity: ${Math.min(20*e,1)*o};height: ${e*a}px;padding-top: ${e*s}px;padding-bottom: ${e*l}px;margin-top: ${e*c}px;margin-bottom: ${e*u}px;border-top-width: ${e*h}px;border-bottom-width: ${e*d}px;`}}const Se=e=>({id:2&e}),Ee=e=>({id:"id-"+e[1]}),Ce=e=>({id:2&e}),Ae=e=>({id:"id-"+e[1]});function Pe(e){let t,i,n;const r=e[7].details,o=l(r,e,e[6],Ee);return{c(){t=T("div"),o&&o.c(),P(t,"class","details svelte-5tjdio")},m(e,i){b(e,t,i),o&&o.m(t,null),n=!0},p(t,i){e=t,o&&o.p&&(!n||66&i)&&h(o,r,e,e[6],n?u(r,e[6],i,Se):d(e[6]),Ee)},i(e){n||(oe(o,e),H((()=>{i||(i=le(t,Te,{duration:150,easing:Me},!0)),i.run(1)})),n=!0)},o(e){ae(o,e),i||(i=le(t,Te,{duration:150,easing:Me},!1)),i.run(0),n=!1},d(e){e&&w(t),o&&o.d(e),e&&i&&i.end()}}}function Ie(e){let t,i,n,r,o,a,s;const c=e[7].head,p=l(c,e,e[6],Ae);let f=e[0]&&Pe(e);return{c(){t=T("div"),i=T("button"),n=T("div"),p&&p.c(),r=E(),f&&f.c(),P(n,"class","text svelte-5tjdio"),P(i,"class","header svelte-5tjdio"),P(t,"class","accordion-item svelte-5tjdio"),P(t,"id",e[1])},m(l,c){b(l,t,c),y(t,i),y(i,n),p&&p.m(n,null),y(t,r),f&&f.m(t,null),o=!0,a||(s=A(i,"click",e[3]),a=!0)},p(e,[i]){p&&p.p&&(!o||66&i)&&h(p,c,e,e[6],o?u(c,e[6],i,Ce):d(e[6]),Ae),e[0]?f?(f.p(e,i),1&i&&oe(f,1)):(f=Pe(e),f.c(),oe(f,1),f.m(t,null)):f&&(ne(),ae(f,1,1,(()=>{f=null})),re()),(!o||2&i)&&P(t,"id",e[1])},i(e){o||(oe(p,e),oe(f),o=!0)},o(e){ae(p,e),ae(f),o=!1},d(e){e&&w(t),p&&p.d(e),f&&f.d(),a=!1,s()}}}function ke(e,t,i){let n,{$$slots:r={},$$scope:o}=t,{open:a=!1}=t,{key:l={}}=t,{id:c}=t;const{current:u}=ye();return s(e,u,(e=>i(5,n=e))),e.$$set=e=>{"open"in e&&i(0,a=e.open),"key"in e&&i(4,l=e.key),"id"in e&&i(1,c=e.id),"$$scope"in e&&i(6,o=e.$$scope)},e.$$.update=()=>{48&e.$$.dirty&&i(0,a=n==l)},[a,c,u,function(){var e;n=a?null:l,e=n,u.set(e)},l,n,o,r]}class ze extends fe{constructor(e){super(),pe(this,e,ke,Ie,a,{open:0,key:4,id:1})}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var De,Le,Re=(De=function(e,t){e.exports=function(){var e,t,i;function n(n,r){if(e)if(t){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",a={};e(a),i=r(a),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(i.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else t=r;else e=r}return n(["exports"],(function(e){var t="undefined"!=typeof self?self:{},i="2.13.0";let n;const r={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==n){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{n=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):e}catch(t){n=e}}return n},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},o={supported:!1,testSupport:function(e){!l&&s&&(c?u(e):a=e)}};let a,s,l=!1,c=!1;function u(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,s),e.isContextLost())return;o.supported=!0}catch(e){}e.deleteTexture(t),l=!0}t.document&&(s=t.document.createElement("img"),s.onload=function(){a&&u(a),a=null,c=!0},s.onerror=function(){l=!0,a=null},s.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const h="01";var d=p;function p(e,t,i,n){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=n}p.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,n=0;n<8;n++){var r=this.sampleCurveX(i)-e;if(Math.abs(r)<t)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=r/o}var a=0,s=1;for(i=e,n=0;n<20&&(r=this.sampleCurveX(i),!(Math.abs(r-e)<t));n++)e>r?a=i:s=i,i=.5*(s-a)+a;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var f=m;function m(e,t){this.x=e,this.y=t}m.prototype={clone:function(){return new m(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),n=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=n,this},_rotateAround:function(e,t){var i=Math.cos(e),n=Math.sin(e),r=t.y+n*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-n*(this.y-t.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},m.convert=function(e){return e instanceof m?e:Array.isArray(e)?new m(e[0],e[1]):e};const g=Math.PI/180,_=180/Math.PI;function y(e){return e*g}function x(e){return e*_}const v=[[0,0],[1,0],[1,1],[0,1]];function b(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function w(e,t,i,n){const r=new d(e,t,i,n);return function(e){return r.solve(e)}}const M=w(.25,.1,.25,1);function T(e,t,i){return Math.min(i,Math.max(t,e))}function S(e,t,i){return(i=T((i-e)/(t-e),0,1))*i*(3-2*i)}function E(e,t,i){const n=i-t,r=((e-t)%n+n)%n+t;return r===t?i:r}function C(e,t,i){if(!e.length)return i(null,[]);let n=e.length;const r=new Array(e.length);let o=null;e.forEach(((e,a)=>{t(e,((e,t)=>{e&&(o=e),r[a]=t,0==--n&&i(o,r)}))}))}function A(e){const t=[];for(const i in e)t.push(e[i]);return t}function P(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}let I=1;function k(){return I++}function z(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function D(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function L(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function R(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t))}))}function O(e,t){return-1!==e.indexOf(t,e.length-t.length)}function B(e,t,i){const n={};for(const r in e)n[r]=t.call(i||this,e[r],r,e);return n}function F(e,t,i){const n={};for(const r in e)t.call(i||this,e[r],r,e)&&(n[r]=e[r]);return n}function N(e){return Array.isArray(e)?e.map(N):"object"==typeof e&&e?B(e,N):e}const U={};function V(e){U[e]||("undefined"!=typeof console&&console.warn(e),U[e]=!0)}function G(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function j(e){let t=0;for(let i,n,r=0,o=e.length,a=o-1;r<o;a=r++)i=e[r],n=e[a],t+=(n.x-i.x)*(i.y+n.y);return t}function W(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function $(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,i,n,r)=>{const o=n||r;return t[i]=!o||o.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let q=null;function Z(e){if(null==q){const t=e.navigator?e.navigator.userAgent:null;q=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return q}function H(e){try{const i=t[e];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch(e){return!1}}function X(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}const Y="mapbox-tiles";let J,K,Q=500,ee=50;function te(){try{return t.caches}catch(e){}}function ie(){te()&&!J&&(J=t.caches.open(Y))}function ne(e){const t=e.indexOf("?");if(t<0)return e;const i=function(e){const t=e.indexOf("?");return t>0?e.slice(t+1).split("&"):[]}(e),n=i.filter((e=>{const t=e.split("=");return"language"===t[0]||"worldview"===t[0]}));return n.length?`${e.slice(0,t)}?${n.join("&")}`:e.slice(0,t)}let re=1/0;const oe={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(oe);class ae extends Error{constructor(e,t,i){401===t&&_e(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const se=W()?()=>self.worker&&self.worker.referrer:()=>("blob:"===t.location.protocol?t.parent:t).location.href,le=function(e,i){if(!(/^file:/.test(n=e.url)||/^file:/.test(se())&&!/^\w+:/.test(n))){if(t.fetch&&t.Request&&t.AbortController&&t.Request.prototype.hasOwnProperty("signal"))return function(e,i){const n=new t.AbortController,r=new t.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:se(),signal:n.signal});let o=!1,a=!1;const s=(l=r.url).indexOf("sku=")>0&&_e(l);var l;"json"===e.type&&r.headers.set("Accept","application/json");const c=(n,o,l)=>{if(a)return;if(n&&"SecurityError"!==n.message&&V(n),o&&l)return u(o);const c=Date.now();t.fetch(r).then((t=>{if(t.ok){const e=s?t.clone():null;return u(t,e,c)}return i(new ae(t.statusText,t.status,e.url))})).catch((t=>{"AbortError"!==t.name&&i(new Error(`${t.message} ${e.url}`))}))},u=(n,s,l)=>{("arrayBuffer"===e.type?n.arrayBuffer():"json"===e.type?n.json():n.text()).then((e=>{a||(s&&l&&function(e,i,n){if(ie(),!J)return;const r={status:i.status,statusText:i.statusText,headers:new t.Headers};i.headers.forEach(((e,t)=>r.headers.set(t,e)));const o=$(i.headers.get("Cache-Control")||"");if(o["no-store"])return;o["max-age"]&&r.headers.set("Expires",new Date(n+1e3*o["max-age"]).toUTCString());const a=r.headers.get("Expires");a&&(new Date(a).getTime()-n<42e4||function(e,t){if(void 0===K)try{new Response(new ReadableStream),K=!0}catch(e){K=!1}K?t(e.body):e.blob().then(t)}(i,(i=>{const n=new t.Response(i,r);ie(),J&&J.then((t=>t.put(ne(e.url),n))).catch((e=>V(e.message)))})))}(r,s,l),o=!0,i(null,e,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((e=>{a||i(new Error(e.message))}))};return s?function(e,t){if(ie(),!J)return t(null);const i=ne(e.url);J.then((e=>{e.match(i).then((n=>{const r=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),i=$(e.headers.get("Cache-Control")||"");return t>Date.now()&&!i["no-cache"]}(n);e.delete(i),r&&e.put(i,n.clone()),t(null,n,r)})).catch(t)})).catch(t)}(r,c):c(null,null),{cancel:()=>{a=!0,o||n.abort()}}}(e,i);if(W()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,i,void 0,!0)}var n;return function(e,i){const n=new t.XMLHttpRequest;n.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer");for(const t in e.headers)n.setRequestHeader(t,e.headers[t]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=()=>{i(new Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let t=n.response;if("json"===e.type)try{t=JSON.parse(n.response)}catch(e){return i(e)}i(null,t,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else i(new ae(n.statusText,n.status,e.url))},n.send(e.body),{cancel:()=>n.abort()}}(e,i)},ce=function(e,t){return le(P(e,{type:"arrayBuffer"}),t)};function ue(e){const i=t.document.createElement("a");return i.href=e,i.protocol===t.document.location.protocol&&i.host===t.document.location.host}const he="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let de,pe;de=[],pe=0;const fe=function(e,i){if(o.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),pe>=r.MAX_PARALLEL_IMAGE_REQUESTS){const t={requestParameters:e,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return de.push(t),t}pe++;let n=!1;const a=()=>{if(!n)for(n=!0,pe--;de.length&&pe<r.MAX_PARALLEL_IMAGE_REQUESTS;){const e=de.shift(),{requestParameters:t,callback:i,cancelled:n}=e;n||(e.cancel=fe(t,i).cancel)}},s=ce(e,((e,n,r,o)=>{a(),e?i(e):n&&(t.createImageBitmap?function(e,i){const n=new t.Blob([new Uint8Array(e)],{type:"image/png"});t.createImageBitmap(n).then((e=>{i(null,e)})).catch((e=>{i(new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(n,((e,t)=>i(e,t,r,o))):function(e,i){const n=new t.Image,r=t.URL;n.onload=()=>{i(null,n),r.revokeObjectURL(n.src),n.onload=null,t.requestAnimationFrame((()=>{n.src=he}))},n.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const o=new t.Blob([new Uint8Array(e)],{type:"image/png"});n.src=e.byteLength?r.createObjectURL(o):he}(n,((e,t)=>i(e,t,r,o))))}));return{cancel:()=>{s.cancel(),a()}}},me="NO_ACCESS_TOKEN";function ge(e){return 0===e.indexOf("mapbox:")}function _e(e){return r.API_URL_REGEX.test(e)}function ye(e){return r.API_CDN_URL_REGEX.test(e)}function xe(e){return r.API_STYLE_REGEX.test(e)&&!ve(e)}function ve(e){return r.API_SPRITE_REGEX.test(e)}const be=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function we(e){const t=e.match(be);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Me(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}function Te(e){if(!e)return null;const i=e.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(t.atob(i[1]).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(e){return null}}class Se{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=Te(r.ACCESS_TOKEN);let n="";return n=i&&i.u?t.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(Number("0x"+t))))):r.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const e=H("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const e=t.localStorage.getItem(i);e&&(this.eventData=JSON.parse(e));const r=t.localStorage.getItem(n);r&&(this.anonId=r)}catch(e){V("Unable to read from LocalStorage")}}saveEventData(){const e=H("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{t.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&t.localStorage.setItem(i,JSON.stringify(this.eventData))}catch(e){V("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,i,n){if(!r.EVENTS_URL)return;const o=we(r.EVENTS_URL);o.params.push(`access_token=${n||r.ACCESS_TOKEN||""}`);const a={event:this.type,created:new Date(e).toISOString()},s=t?P(a,t):a,l={url:Me(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=function(e,t){return le(P(e,{method:"POST"}),t)}(l,(e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(n)}))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const Ee=new class extends Se{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){r.EVENTS_URL&&r.ACCESS_TOKEN&&Array.isArray(e)&&e.some((e=>ge(e)||_e(e)))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Te(r.ACCESS_TOKEN),n=t?t.u:r.ACCESS_TOKEN;let o=n!==this.eventData.tokenU;L(this.anonId)||(this.anonId=z(),o=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(a),i=(a-this.eventData.lastSuccess)/864e5;o=o||i>=1||i<-1||e.getDate()!==t.getDate()}else o=!0;o?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:i,skuId:h,"enabled.telemetry":!1,userId:this.anonId},(e=>{e||(this.eventData.lastSuccess=a,this.eventData.tokenU=n)}),e):this.processRequests()}},Ce=Ee.postTurnstileEvent.bind(Ee),Ae=new class extends Se{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,i,n){this.skuToken=t,this.errorCb=n,r.EVENTS_URL&&(i||r.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(me)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),L(this.anonId)||(this.anonId=z()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:i,skuId:h,skuToken:this.skuToken,userId:this.anonId},(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e))}},Pe=Ae.postMapLoadEvent.bind(Ae),Ie=new class extends Se{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){r.EVENTS_URL&&(e||r.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:n,performanceData:r}=this.queue.shift(),o=function(e){const n=t.performance.getEntriesByType("resource"),r=t.performance.getEntriesByType("mark"),o=function(e){const t={};if(e)for(const i in e)if("other"!==i)for(const n of e[i]){const e=`${i}ResolveRangeMin`,r=`${i}ResolveRangeMax`,o=`${i}RequestCount`,a=`${i}RequestCachedCount`;t[e]=Math.min(t[e]||1/0,n.startTime),t[r]=Math.max(t[r]||-1/0,n.responseEnd);const s=e=>{void 0===t[e]&&(t[e]=0),++t[e]};void 0!==n.transferSize&&0===n.transferSize&&s(a),s(o)}return t}(function(e,t){const i={};if(e)for(const n of e){const e=t(n);void 0===i[e]&&(i[e]=[]),i[e].push(n)}return i}(n,Be)),a=t.devicePixelRatio,s=t.navigator.connection||t.navigator.mozConnection||t.navigator.webkitConnection,l={counters:[],metadata:[],attributes:[]},c=(e,t,i)=>{null!=i&&e.push({name:t,value:i.toString()})};for(const e in o)c(l.counters,e,o[e]);if(e.interactionRange[0]!==1/0&&e.interactionRange[1]!==-1/0&&(c(l.counters,"interactionRangeMin",e.interactionRange[0]),c(l.counters,"interactionRangeMax",e.interactionRange[1])),r)for(const e of Object.keys(Re)){const t=Re[e],i=r.find((e=>e.name===t));i&&c(l.counters,t,i.startTime)}return c(l.counters,"visibilityHidden",e.visibilityHidden),c(l.attributes,"style",function(e){if(e)for(const t of e){const e=t.name.split("?")[0];if(xe(e)){const t=e.split("/").slice(-2);if(2===t.length)return`mapbox://styles/${t[0]}/${t[1]}`}}}(n)),c(l.attributes,"terrainEnabled",e.terrainEnabled?"true":"false"),c(l.attributes,"fogEnabled",e.fogEnabled?"true":"false"),c(l.attributes,"projection",e.projection),c(l.attributes,"zoom",e.zoom),c(l.metadata,"devicePixelRatio",a),c(l.metadata,"connectionEffectiveType",s?s.effectiveType:void 0),c(l.metadata,"navigatorUserAgent",t.navigator.userAgent),c(l.metadata,"screenWidth",t.screen.width),c(l.metadata,"screenHeight",t.screen.height),c(l.metadata,"windowWidth",t.innerWidth),c(l.metadata,"windowHeight",t.innerHeight),c(l.metadata,"mapWidth",e.width/a),c(l.metadata,"mapHeight",e.height/a),c(l.metadata,"webglRenderer",e.renderer),c(l.metadata,"webglVendor",e.vendor),c(l.metadata,"sdkVersion",i),c(l.metadata,"sdkIdentifier","mapbox-gl-js"),l}(r);for(const e of o.metadata);for(const e of o.counters);for(const e of o.attributes);this.postEvent(n,o,(()=>{}),e)}},ke=Ie.postPerformanceEvent.bind(Ie),ze=new class extends Se{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,i,n){if(!r.API_URL||!r.SESSION_PATH)return;const o=we(r.API_URL+r.SESSION_PATH);o.params.push(`sku=${t||""}`),o.params.push(`access_token=${n||r.ACCESS_TOKEN||""}`);const a={url:Me(o),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(e,t){return le(P(e,{method:"GET"}),t)}(a,(e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(n)}))}getSessionAPI(e,t,i,n){this.skuToken=t,this.errorCb=n,r.SESSION_PATH&&r.API_URL&&(i||r.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(me)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e)}},De=ze.getSessionAPI.bind(ze),Le=new Set,Re={create:"create",load:"load",fullLoad:"fullLoad"},Oe={mark(e){t.performance.mark(e)},measure(e,i,n){t.performance.measure(e,i,n)}};function Be(e){const t=e.name.split("?")[0];return ye(t)&&t.includes("mapbox-gl.js")?"javascript":ye(t)&&t.includes("mapbox-gl.css")?"css":function(e){return r.API_FONTS_REGEX.test(e)}(t)?"fontRange":ve(t)?"sprite":xe(t)?"style":function(e){return r.API_TILEJSON_REGEX.test(e)}(t)?"tilejson":"other"}const Fe=t.performance;function Ne(e){const t=e?e.url.toString():void 0;return Fe.getEntriesByName(t)}let Ue,Ve,Ge,je;const We={now:()=>void 0!==Ge?Ge:t.performance.now(),setNow(e){Ge=e},restoreNow(){Ge=void 0},frame(e){const i=t.requestAnimationFrame(e);return{cancel:()=>t.cancelAnimationFrame(i)}},getImageData(e,i=0){const{width:n,height:r}=e;je||(je=t.document.createElement("canvas"));const o=je.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return(n>je.width||r>je.height)&&(je.width=n,je.height=r),o.clearRect(-i,-i,n+2*i,r+2*i),o.drawImage(e,0,0,n,r),o.getImageData(-i,-i,n+2*i,r+2*i)},resolveURL:e=>(Ue||(Ue=t.document.createElement("a")),Ue.href=e,Ue.href),get devicePixelRatio(){return t.devicePixelRatio},get prefersReducedMotion(){return!!t.matchMedia&&(null==Ve&&(Ve=t.matchMedia("(prefers-reduced-motion: reduce)")),Ve.matches)}};function $e(e,t,i){i[e]&&-1!==i[e].indexOf(t)||(i[e]=i[e]||[],i[e].push(t))}function qe(e,t,i){if(i&&i[e]){const n=i[e].indexOf(t);-1!==n&&i[e].splice(n,1)}}class Ze{constructor(e,t={}){P(this,t),this.type=e}}class He extends Ze{constructor(e,t={}){super("error",P({error:e},t))}}class Xe{on(e,t){return this._listeners=this._listeners||{},$e(e,t,this._listeners),this}off(e,t){return qe(e,t,this._listeners),qe(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},$e(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new Ze(e,t||{}));const i=e.type;if(this.listens(i)){e.target=this;const t=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of t)i.call(this,e);const n=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const t of n)qe(i,t,this._oneTimeListeners),t.call(this,e);const r=this._eventedParent;r&&(P(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(e))}else e instanceof He&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var Ye=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Je(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}function Ke(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Qe(e){if(Array.isArray(e))return e.map(Qe);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=Qe(e[i]);return t}return Ke(e)}class et extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var tt=et;class it{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,i]of t)this.bindings[e]=i}concat(e){return new it(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var nt=it;const rt={kind:"null"},ot={kind:"number"},at={kind:"string"},st={kind:"boolean"},lt={kind:"color"},ct={kind:"object"},ut={kind:"value"},ht={kind:"collator"},dt={kind:"formatted"},pt={kind:"resolvedImage"};function ft(e,t){return{kind:"array",itemType:e,N:t}}function mt(e){if("array"===e.kind){const t=mt(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const gt=[rt,ot,at,st,lt,dt,ct,ft(ut),pt];function _t(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!_t(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of gt)if(!_t(e,t))return null}return`Expected ${mt(e)} but found ${mt(t)} instead.`}function yt(e,t){return t.some((t=>t.kind===e.kind))}function xt(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}var vt,bt={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function wt(e){return(e=Math.round(e))<0?0:e>255?255:e}function Mt(e){return wt("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function Tt(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function St(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{vt={}.parseCSSColor=function(e){var t,i=e.replace(/ /g,"").toLowerCase();if(i in bt)return bt[i].slice();if("#"===i[0])return 4===i.length?(t=parseInt(i.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===i.length&&(t=parseInt(i.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var n=i.indexOf("("),r=i.indexOf(")");if(-1!==n&&r+1===i.length){var o=i.substr(0,n),a=i.substr(n+1,r-(n+1)).split(","),s=1;switch(o){case"rgba":if(4!==a.length)return null;s=Tt(a.pop());case"rgb":return 3!==a.length?null:[Mt(a[0]),Mt(a[1]),Mt(a[2]),s];case"hsla":if(4!==a.length)return null;s=Tt(a.pop());case"hsl":if(3!==a.length)return null;var l=(parseFloat(a[0])%360+360)%360/360,c=Tt(a[1]),u=Tt(a[2]),h=u<=.5?u*(c+1):u+c-u*c,d=2*u-h;return[wt(255*St(d,h,l+1/3)),wt(255*St(d,h,l)),wt(255*St(d,h,l-1/3)),s];default:return null}}return null}}catch(e){}class Et{constructor(e,t,i,n=1){this.r=e,this.g=t,this.b=i,this.a=n}static parse(e){if(!e)return;if(e instanceof Et)return e;if("string"!=typeof e)return;const t=vt(e);return t?new Et(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,i,n]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(i)},${n})`}toArray(){const{r:e,g:t,b:i,a:n}=this;return 0===n?[0,0,0,0]:[255*e/n,255*t/n,255*i/n,n]}toArray01(){const{r:e,g:t,b:i,a:n}=this;return 0===n?[0,0,0,0]:[e/n,t/n,i/n,n]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:i,a:n}=this;return[e,t,i,n]}}Et.black=new Et(0,0,0,1),Et.white=new Et(1,1,1,1),Et.transparent=new Et(0,0,0,0),Et.red=new Et(1,0,0,1),Et.blue=new Et(0,0,1,1);var Ct=Et;class At{constructor(e,t,i){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Pt{constructor(e,t,i,n,r){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=i,this.fontStack=n,this.textColor=r}}class It{constructor(e){this.sections=e}static fromString(e){return new It([new Pt(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof It?e:It.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const i={};t.fontStack&&(i["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(i["font-scale"]=t.scale),t.textColor&&(i["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(i)}return e}}class kt{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new kt({name:e,available:!1}):null}serialize(){return["image",this.name]}}function zt(e,t,i,n){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[e,t,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[e,t,i,n]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Dt(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof Ct)return!0;if(e instanceof At)return!0;if(e instanceof It)return!0;if(e instanceof kt)return!0;if(Array.isArray(e)){for(const t of e)if(!Dt(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Dt(e[t]))return!1;return!0}return!1}function Lt(e){if(null===e)return rt;if("string"==typeof e)return at;if("boolean"==typeof e)return st;if("number"==typeof e)return ot;if(e instanceof Ct)return lt;if(e instanceof At)return ht;if(e instanceof It)return dt;if(e instanceof kt)return pt;if(Array.isArray(e)){const t=e.length;let i;for(const t of e){const e=Lt(t);if(i){if(i===e)continue;i=ut;break}i=e}return ft(i||ut,t)}return ct}function Rt(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Ct||e instanceof It||e instanceof kt?e.toString():JSON.stringify(e)}class Ot{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Dt(e[1]))return t.error("invalid value");const i=e[1];let n=Lt(i);const r=t.expectedType;return"array"!==n.kind||0!==n.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(n=r),new Ot(n,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Ct?["rgba"].concat(this.value.toArray()):this.value instanceof It?this.value.serialize():this.value}}var Bt=Ot,Ft=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const Nt={string:at,number:ot,boolean:st,object:ct};class Ut{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i,n=1;const r=e[0];if("array"===r){let r,o;if(e.length>2){const i=e[1];if("string"!=typeof i||!(i in Nt)||"object"===i)return t.error('The item type argument of "array" must be one of string, number, boolean',1);r=Nt[i],n++}else r=ut;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],n++}i=ft(r,o)}else i=Nt[r];const o=[];for(;n<e.length;n++){const i=t.parse(e[n],n,ut);if(!i)return null;o.push(i)}return new Ut(i,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const i=this.args[t].evaluate(e);if(!_t(this.type,Lt(i)))return i;if(t===this.args.length-1)throw new Ft(`Expected value to be of type ${mt(this.type)}, but found ${mt(Lt(i))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const i=e.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){t.push(i.kind);const n=e.N;("number"==typeof n||this.args.length>1)&&t.push(n)}}return t.concat(this.args.map((e=>e.serialize())))}}var Vt=Ut;class Gt{constructor(e){this.type=dt,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return t.error("First argument must be an image or text section.");const n=[];let r=!1;for(let i=1;i<=e.length-1;++i){const o=e[i];if(r&&"object"==typeof o&&!Array.isArray(o)){r=!1;let e=null;if(o["font-scale"]&&(e=t.parse(o["font-scale"],1,ot),!e))return null;let i=null;if(o["text-font"]&&(i=t.parse(o["text-font"],1,ft(at)),!i))return null;let a=null;if(o["text-color"]&&(a=t.parse(o["text-color"],1,lt),!a))return null;const s=n[n.length-1];s.scale=e,s.font=i,s.textColor=a}else{const o=t.parse(e[i],1,ut);if(!o)return null;const a=o.type.kind;if("string"!==a&&"value"!==a&&"null"!==a&&"resolvedImage"!==a)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,n.push({content:o,scale:null,font:null,textColor:null})}}return new Gt(n)}evaluate(e){return new It(this.sections.map((t=>{const i=t.content.evaluate(e);return Lt(i)===pt?new Pt("",i,null,null,null):new Pt(Rt(i),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const i={};t.scale&&(i["font-scale"]=t.scale.serialize()),t.font&&(i["text-font"]=t.font.serialize()),t.textColor&&(i["text-color"]=t.textColor.serialize()),e.push(i)}return e}}class jt{constructor(e){this.type=pt,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,at);return i?new jt(i):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),i=kt.fromString(t);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(t)>-1),i}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Wt={"to-boolean":st,"to-color":lt,"to-number":ot,"to-string":at};class $t{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[0];if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return t.error("Expected one argument.");const n=Wt[i],r=[];for(let i=1;i<e.length;i++){const n=t.parse(e[i],i,ut);if(!n)return null;r.push(n)}return new $t(n,r)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,i;for(const n of this.args){if(t=n.evaluate(e),i=null,t instanceof Ct)return t;if("string"==typeof t){const i=e.parseColor(t);if(i)return i}else if(Array.isArray(t)&&(i=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:zt(t[0],t[1],t[2],t[3]),!i))return new Ct(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Ft(i||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const i of this.args){if(t=i.evaluate(e),null===t)return 0;const n=Number(t);if(!isNaN(n))return n}throw new Ft(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?It.fromString(Rt(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?kt.fromString(Rt(this.args[0].evaluate(e))):Rt(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new Gt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new jt(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize())})),e}}var qt=$t;const Zt=["Unknown","Point","LineString","Polygon"];var Ht=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Zt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-e[0])+this.featureDistanceData.bearing[1]*(n*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Ct.parse(e)),t}};class Xt{constructor(e,t,i,n){this.name=e,this.type=t,this._evaluate=i,this.args=n}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const i=e[0],n=Xt.definitions[i];if(!n)return t.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,a=o.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let s=null;for(const[n,o]of a){s=new wi(t.registry,t.path,null,t.scope);const a=[];let l=!1;for(let t=1;t<e.length;t++){const i=e[t],r=Array.isArray(n)?n[t-1]:n.type,o=s.parse(i,1+a.length,r);if(!o){l=!0;break}a.push(o)}if(!l)if(Array.isArray(n)&&n.length!==a.length)s.error(`Expected ${n.length} arguments, but found ${a.length} instead.`);else{for(let e=0;e<a.length;e++){const t=Array.isArray(n)?n[e]:n.type,i=a[e];s.concat(e+1).checkSubtype(t,i.type)}if(0===s.errors.length)return new Xt(i,r,o,a)}}if(1===a.length)t.errors.push(...s.errors);else{const i=(a.length?a:o).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(mt).join(", ")})`:`(${mt(t.type)}...)`;var t})).join(" | "),n=[];for(let i=1;i<e.length;i++){const r=t.parse(e[i],1+n.length);if(!r)return null;n.push(mt(r.type))}t.error(`Expected arguments of type ${i}, but found (${n.join(", ")}) instead.`)}return null}static register(e,t){Xt.definitions=t;for(const i in t)e[i]=Xt}}var Yt=Xt;class Jt{constructor(e,t,i){this.type=ht,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return t.error("Collator options argument must be an object.");const n=t.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,st);if(!n)return null;const r=t.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,st);if(!r)return null;let o=null;return i.locale&&(o=t.parse(i.locale,1,at),!o)?null:new Jt(n,r,o)}evaluate(e){return new At(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Kt=8192;function Qt(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function ei(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function ti(e,t){const i=(180+e[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,r=Math.pow(2,t.z);return[Math.round(i*r*Kt),Math.round(n*r*Kt)]}function ii(e,t,i){const n=e[0]-t[0],r=e[1]-t[1],o=e[0]-i[0],a=e[1]-i[1];return n*a-o*r==0&&n*o<=0&&r*a<=0}function ni(e,t){let i=!1;for(let a=0,s=t.length;a<s;a++){const s=t[a];for(let t=0,a=s.length;t<a-1;t++){if(ii(e,s[t],s[t+1]))return!1;(r=s[t])[1]>(n=e)[1]!=(o=s[t+1])[1]>n[1]&&n[0]<(o[0]-r[0])*(n[1]-r[1])/(o[1]-r[1])+r[0]&&(i=!i)}}var n,r,o;return i}function ri(e,t){for(let i=0;i<t.length;i++)if(ni(e,t[i]))return!0;return!1}function oi(e,t,i,n){const r=n[0]-i[0],o=n[1]-i[1],a=(e[0]-i[0])*o-r*(e[1]-i[1]),s=(t[0]-i[0])*o-r*(t[1]-i[1]);return a>0&&s<0||a<0&&s>0}function ai(e,t,i){for(const c of i)for(let i=0;i<c.length-1;++i)if(0!=(s=[(a=c[i+1])[0]-(o=c[i])[0],a[1]-o[1]])[0]*(l=[(r=t)[0]-(n=e)[0],r[1]-n[1]])[1]-s[1]*l[0]&&oi(n,r,o,a)&&oi(o,a,n,r))return!0;var n,r,o,a,s,l;return!1}function si(e,t){for(let i=0;i<e.length;++i)if(!ni(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(ai(e[i],e[i+1],t))return!1;return!0}function li(e,t){for(let i=0;i<t.length;i++)if(si(e,t[i]))return!0;return!1}function ci(e,t,i){const n=[];for(let r=0;r<e.length;r++){const o=[];for(let n=0;n<e[r].length;n++){const a=ti(e[r][n],i);Qt(t,a),o.push(a)}n.push(o)}return n}function ui(e,t,i){const n=[];for(let r=0;r<e.length;r++){const o=ci(e[r],t,i);n.push(o)}return n}function hi(e,t,i,n){if(e[0]<i[0]||e[0]>i[2]){const t=.5*n;let r=e[0]-i[0]>t?-n:i[0]-e[0]>t?n:0;0===r&&(r=e[0]-i[2]>t?-n:i[2]-e[0]>t?n:0),e[0]+=r}Qt(t,e)}function di(e,t,i,n){const r=Math.pow(2,n.z)*Kt,o=[n.x*Kt,n.y*Kt],a=[];if(!e)return a;for(const n of e)for(const e of n){const n=[e.x+o[0],e.y+o[1]];hi(n,t,i,r),a.push(n)}return a}function pi(e,t,i,n){const r=Math.pow(2,n.z)*Kt,o=[n.x*Kt,n.y*Kt],a=[];if(!e)return a;for(const i of e){const e=[];for(const n of i){const i=[n.x+o[0],n.y+o[1]];Qt(t,i),e.push(i)}a.push(e)}if(t[2]-t[0]<=r/2){(s=t)[0]=s[1]=1/0,s[2]=s[3]=-1/0;for(const e of a)for(const n of e)hi(n,t,i,r)}var s;return a}class fi{constructor(e,t){this.type=st,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Dt(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const i=t.features[e].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new fi(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new fi(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new fi(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){const o=ci(t.coordinates,n,r),a=di(e.geometry(),i,n,r);if(!ei(i,n))return!1;for(const e of a)if(!ni(e,o))return!1}if("MultiPolygon"===t.type){const o=ui(t.coordinates,n,r),a=di(e.geometry(),i,n,r);if(!ei(i,n))return!1;for(const e of a)if(!ri(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){const o=ci(t.coordinates,n,r),a=pi(e.geometry(),i,n,r);if(!ei(i,n))return!1;for(const e of a)if(!si(e,o))return!1}if("MultiPolygon"===t.type){const o=ui(t.coordinates,n,r),a=pi(e.geometry(),i,n,r);if(!ei(i,n))return!1;for(const e of a)if(!li(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var mi=fi;function gi(e){if(e instanceof Yt){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof mi)return!1;let t=!0;return e.eachChild((e=>{t&&!gi(e)&&(t=!1)})),t}function _i(e){if(e instanceof Yt&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!_i(e)&&(t=!1)})),t}function yi(e,t){if(e instanceof Yt&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild((e=>{i&&!yi(e,t)&&(i=!1)})),i}class xi{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const i=e[1];return t.scope.has(i)?new xi(i,t.scope.get(i)):t.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var vi=xi;class bi{constructor(e,t=[],i,n=new nt,r=[]){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=n,this.errors=r,this.expectedType=i}parse(e,t,i,n,r={}){return t?this.concat(t,i,n)._parse(e,r):this._parse(e,r)}_parse(e,t){function i(e,t,i){return"assert"===i?new Vt(t,[e]):"coerce"===i?new qt(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n=e[0];if("string"!=typeof n)return this.error(`Expression name must be a string, but found ${typeof n} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[n];if(r){let n=r.parse(e,this);if(!n)return null;if(this.expectedType){const e=this.expectedType,r=n.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==r.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(e,r))return null}else n=i(n,e,t.typeAnnotation||"coerce");else n=i(n,e,t.typeAnnotation||"assert")}if(!(n instanceof Bt)&&"resolvedImage"!==n.type.kind&&Mi(n)){const t=new Ht;try{n=new Bt(n.type,n.evaluate(t))}catch(e){return this.error(e.message),null}}return n}return this.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,i){const n="number"==typeof e?this.path.concat(e):this.path,r=i?this.scope.concat(i):this.scope;return new bi(this.registry,n,t||null,r,this.errors)}error(e,...t){const i=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new tt(i,e))}checkSubtype(e,t){const i=_t(e,t);return i&&this.error(i),i}}var wi=bi;function Mi(e){if(e instanceof vi)return Mi(e.boundExpression);if(e instanceof Yt&&"error"===e.name)return!1;if(e instanceof Jt)return!1;if(e instanceof mi)return!1;const t=e instanceof qt||e instanceof Vt;let i=!0;return e.eachChild((e=>{i=t?i&&Mi(e):i&&e instanceof Bt})),!!i&&gi(e)&&yi(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ti(e,t){const i=e.length-1;let n,r,o=0,a=i,s=0;for(;o<=a;)if(s=Math.floor((o+a)/2),n=e[s],r=e[s+1],n<=t){if(s===i||t<r)return s;o=s+1}else{if(!(n>t))throw new Ft("Input is not a number.");a=s-1}return 0}class Si{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const i=t.parse(e[1],1,ot);if(!i)return null;const n=[];let r=null;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);for(let i=1;i<e.length;i+=2){const o=1===i?-1/0:e[i],a=e[i+1],s=i,l=i+1;if("number"!=typeof o)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(n.length&&n[n.length-1][0]>=o)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const c=t.parse(a,l,r);if(!c)return null;r=r||c.type,n.push([o,c])}return new Si(r,i,n)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return i[0].evaluate(e);const r=t.length;return n>=t[r-1]?i[r-1].evaluate(e):i[Ti(t,n)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var Ei=Si;function Ci(e,t,i){return e*(1-i)+t*i}var Ai=Object.freeze({__proto__:null,number:Ci,color:function(e,t,i){return new Ct(Ci(e.r,t.r,i),Ci(e.g,t.g,i),Ci(e.b,t.b,i),Ci(e.a,t.a,i))},array:function(e,t,i){return e.map(((e,n)=>Ci(e,t[n],i)))}});const Pi=.95047,Ii=1.08883,ki=4/29,zi=6/29,Di=3*zi*zi,Li=Math.PI/180,Ri=180/Math.PI;function Oi(e){return e>.008856451679035631?Math.pow(e,1/3):e/Di+ki}function Bi(e){return e>zi?e*e*e:Di*(e-ki)}function Fi(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Ni(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Ui(e){const t=Ni(e.r),i=Ni(e.g),n=Ni(e.b),r=Oi((.4124564*t+.3575761*i+.1804375*n)/Pi),o=Oi((.2126729*t+.7151522*i+.072175*n)/1);return{l:116*o-16,a:500*(r-o),b:200*(o-Oi((.0193339*t+.119192*i+.9503041*n)/Ii)),alpha:e.a}}function Vi(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,n=isNaN(e.b)?t:t-e.b/200;return t=1*Bi(t),i=Pi*Bi(i),n=Ii*Bi(n),new Ct(Fi(3.2404542*i-1.5371385*t-.4985314*n),Fi(-.969266*i+1.8760108*t+.041556*n),Fi(.0556434*i-.2040259*t+1.0572252*n),e.alpha)}function Gi(e,t,i){const n=t-e;return e+i*(n>180||n<-180?n-360*Math.round(n/360):n)}const ji={forward:Ui,reverse:Vi,interpolate:function(e,t,i){return{l:Ci(e.l,t.l,i),a:Ci(e.a,t.a,i),b:Ci(e.b,t.b,i),alpha:Ci(e.alpha,t.alpha,i)}}},Wi={forward:function(e){const{l:t,a:i,b:n}=Ui(e),r=Math.atan2(n,i)*Ri;return{h:r<0?r+360:r,c:Math.sqrt(i*i+n*n),l:t,alpha:e.a}},reverse:function(e){const t=e.h*Li,i=e.c;return Vi({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:Gi(e.h,t.h,i),c:Ci(e.c,t.c,i),l:Ci(e.l,t.l,i),alpha:Ci(e.alpha,t.alpha,i)}}};var $i=Object.freeze({__proto__:null,lab:ji,hcl:Wi});class qi{constructor(e,t,i,n,r){this.type=e,this.operator=t,this.interpolation=i,this.input=n,this.labels=[],this.outputs=[];for(const[e,t]of r)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,i,n){let r=0;if("exponential"===e.name)r=Zi(t,e.base,i,n);else if("linear"===e.name)r=Zi(t,1,i,n);else if("cubic-bezier"===e.name){const o=e.controlPoints;r=new d(o[0],o[1],o[2],o[3]).solve(Zi(t,1,i,n))}return r}static parse(e,t){let[i,n,r,...o]=e;if(!Array.isArray(n)||0===n.length)return t.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const e=n[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:e}}else{if("cubic-bezier"!==n[0])return t.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const e=n.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(r=t.parse(r,2,ot),!r)return null;const a=[];let s=null;"interpolate-hcl"===i||"interpolate-lab"===i?s=lt:t.expectedType&&"value"!==t.expectedType.kind&&(s=t.expectedType);for(let e=0;e<o.length;e+=2){const i=o[e],n=o[e+1],r=e+3,l=e+4;if("number"!=typeof i)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(a.length&&a[a.length-1][0]>=i)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const c=t.parse(n,l,s);if(!c)return null;s=s||c.type,a.push([i,c])}return"number"===s.kind||"color"===s.kind||"array"===s.kind&&"number"===s.itemType.kind&&"number"==typeof s.N?new qi(s,i,n,r,a):t.error(`Type ${mt(s)} is not interpolatable.`)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return i[0].evaluate(e);const r=t.length;if(n>=t[r-1])return i[r-1].evaluate(e);const o=Ti(t,n),a=qi.interpolationFactor(this.interpolation,n,t[o],t[o+1]),s=i[o].evaluate(e),l=i[o+1].evaluate(e);return"interpolate"===this.operator?Ai[this.type.kind.toLowerCase()](s,l,a):"interpolate-hcl"===this.operator?Wi.reverse(Wi.interpolate(Wi.forward(s),Wi.forward(l),a)):ji.reverse(ji.interpolate(ji.forward(s),ji.forward(l),a))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function Zi(e,t,i,n){const r=n-i,o=e-i;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}var Hi=qi;class Xi{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let i=null;const n=t.expectedType;n&&"value"!==n.kind&&(i=n);const r=[];for(const n of e.slice(1)){const e=t.parse(n,1+r.length,i,void 0,{typeAnnotation:"omit"});if(!e)return null;i=i||e.type,r.push(e)}const o=n&&r.some((e=>_t(n,e.type)));return new Xi(o?ut:i,r)}evaluate(e){let t,i=null,n=0;for(const r of this.args){if(n++,i=r.evaluate(e),i&&i instanceof kt&&!i.available&&(t||(t=i),i=null,n===this.args.length))return t;if(null!==i)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var Yi=Xi;class Ji{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let n=1;n<e.length-1;n+=2){const r=e[n];if("string"!=typeof r)return t.error(`Expected string, but found ${typeof r} instead.`,n);if(/[^a-zA-Z0-9_]/.test(r))return t.error("Variable names must contain only alphanumeric characters or '_'.",n);const o=t.parse(e[n+1],n+1);if(!o)return null;i.push([r,o])}const n=t.parse(e[e.length-1],e.length-1,t.expectedType,i);return n?new Ji(i,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,i]of this.bindings)e.push(t,i.serialize());return e.push(this.result.serialize()),e}}var Ki=Ji;class Qi{constructor(e,t,i){this.type=e,this.index=t,this.input=i}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,ot),n=t.parse(e[2],2,ft(t.expectedType||ut));return i&&n?new Qi(n.type.itemType,i,n):null}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new Ft(`Array index out of bounds: ${t} < 0.`);if(t>=i.length)throw new Ft(`Array index out of bounds: ${t} > ${i.length-1}.`);if(t!==Math.floor(t))throw new Ft(`Array index must be an integer, but found ${t} instead.`);return i[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var en=Qi;class tn{constructor(e,t){this.type=st,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,ut),n=t.parse(e[2],2,ut);return i&&n?yt(i.type,[st,at,ot,rt,ut])?new tn(i,n):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${mt(i.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(null==i)return!1;if(!xt(t,["boolean","string","number","null"]))throw new Ft(`Expected first argument to be of type boolean, string, number or null, but found ${mt(Lt(t))} instead.`);if(!xt(i,["string","array"]))throw new Ft(`Expected second argument to be of type array or string, but found ${mt(Lt(i))} instead.`);return i.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var nn=tn;class rn{constructor(e,t,i){this.type=ot,this.needle=e,this.haystack=t,this.fromIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,ut),n=t.parse(e[2],2,ut);if(!i||!n)return null;if(!yt(i.type,[st,at,ot,rt,ut]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${mt(i.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,ot);return r?new rn(i,n,r):null}return new rn(i,n)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!xt(t,["boolean","string","number","null"]))throw new Ft(`Expected first argument to be of type boolean, string, number or null, but found ${mt(Lt(t))} instead.`);if(!xt(i,["string","array"]))throw new Ft(`Expected second argument to be of type array or string, but found ${mt(Lt(i))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(e);return i.indexOf(t,n)}return i.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var on=rn;class an{constructor(e,t,i,n,r,o){this.inputType=e,this.type=t,this.input=i,this.cases=n,this.outputs=r,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let i,n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const r={},o=[];for(let a=2;a<e.length-1;a+=2){let s=e[a];const l=e[a+1];Array.isArray(s)||(s=[s]);const c=t.concat(a);if(0===s.length)return c.error("Expected at least one branch label.");for(const e of s){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,Lt(e)))return null}else i=Lt(e);if(void 0!==r[String(e)])return c.error("Branch labels must be unique.");r[String(e)]=o.length}const u=t.parse(l,a,n);if(!u)return null;n=n||u.type,o.push(u)}const a=t.parse(e[1],1,ut);if(!a)return null;const s=t.parse(e[e.length-1],e.length-1,n);return s?"value"!==a.type.kind&&t.concat(1).checkSubtype(i,a.type)?null:new an(i,n,a,r,o,s):null}evaluate(e){const t=this.input.evaluate(e);return(Lt(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),i=[],n={};for(const e of t){const t=n[this.cases[e]];void 0===t?(n[this.cases[e]]=i.length,i.push([this.cases[e],[e]])):i[t][1].push(e)}const r=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,n]of i)e.push(1===n.length?r(n[0]):n.map(r)),e.push(this.outputs[t].serialize());return e.push(this.otherwise.serialize()),e}}var sn=an;class ln{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const n=[];for(let r=1;r<e.length-1;r+=2){const o=t.parse(e[r],r,st);if(!o)return null;const a=t.parse(e[r+1],r+1,i);if(!a)return null;n.push([o,a]),i=i||a.type}const r=t.parse(e[e.length-1],e.length-1,i);return r?new ln(i,n,r):null}evaluate(e){for(const[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,i]of this.branches)e(t),e(i);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var cn=ln;class un{constructor(e,t,i,n){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,ut),n=t.parse(e[2],2,ot);if(!i||!n)return null;if(!yt(i.type,[ft(ut),at,ut]))return t.error(`Expected first argument to be of type array or string, but found ${mt(i.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,ot);return r?new un(i.type,i,n,r):null}return new un(i.type,i,n)}evaluate(e){const t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!xt(t,["string","array"]))throw new Ft(`Expected first argument to be of type array or string, but found ${mt(Lt(t))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(e);return t.slice(i,n)}return t.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var hn=un;function dn(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function pn(e,t,i,n){return 0===n.compare(t,i)}function fn(e,t,i){const n="=="!==e&&"!="!==e;return class r{constructor(e,t,i){this.type=st,this.lhs=e,this.rhs=t,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const i=e[0];let o=t.parse(e[1],1,ut);if(!o)return null;if(!dn(i,o.type))return t.concat(1).error(`"${i}" comparisons are not supported for type '${mt(o.type)}'.`);let a=t.parse(e[2],2,ut);if(!a)return null;if(!dn(i,a.type))return t.concat(2).error(`"${i}" comparisons are not supported for type '${mt(a.type)}'.`);if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return t.error(`Cannot compare types '${mt(o.type)}' and '${mt(a.type)}'.`);n&&("value"===o.type.kind&&"value"!==a.type.kind?o=new Vt(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new Vt(o.type,[a])));let s=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return t.error("Cannot use collator to compare non-string types.");if(s=t.parse(e[3],3,ht),!s)return null}return new r(o,a,s)}evaluate(r){const o=this.lhs.evaluate(r),a=this.rhs.evaluate(r);if(n&&this.hasUntypedArgument){const t=Lt(o),i=Lt(a);if(t.kind!==i.kind||"string"!==t.kind&&"number"!==t.kind)throw new Ft(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${i.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const e=Lt(o),i=Lt(a);if("string"!==e.kind||"string"!==i.kind)return t(r,o,a)}return this.collator?i(r,o,a,this.collator.evaluate(r)):t(r,o,a)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const mn=fn("==",(function(e,t,i){return t===i}),pn),gn=fn("!=",(function(e,t,i){return t!==i}),(function(e,t,i,n){return!pn(0,t,i,n)})),_n=fn("<",(function(e,t,i){return t<i}),(function(e,t,i,n){return n.compare(t,i)<0})),yn=fn(">",(function(e,t,i){return t>i}),(function(e,t,i,n){return n.compare(t,i)>0})),xn=fn("<=",(function(e,t,i){return t<=i}),(function(e,t,i,n){return n.compare(t,i)<=0})),vn=fn(">=",(function(e,t,i){return t>=i}),(function(e,t,i,n){return n.compare(t,i)>=0}));class bn{constructor(e,t,i,n,r,o){this.type=at,this.number=e,this.locale=t,this.currency=i,this.unit=n,this.minFractionDigits=r,this.maxFractionDigits=o}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,ot);if(!i)return null;const n=e[2];if("object"!=typeof n||Array.isArray(n))return t.error("NumberFormat options argument must be an object.");let r=null;if(n.locale&&(r=t.parse(n.locale,1,at),!r))return null;let o=null;if(n.currency&&(o=t.parse(n.currency,1,at),!o))return null;let a=null;if(n.unit&&(a=t.parse(n.unit,1,at),!a))return null;let s=null;if(n["min-fraction-digits"]&&(s=t.parse(n["min-fraction-digits"],1,ot),!s))return null;let l=null;return n["max-fraction-digits"]&&(l=t.parse(n["max-fraction-digits"],1,ot),!l)?null:new bn(i,r,o,a,s,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class wn{constructor(e){this.type=ot,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=t.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?t.error(`Expected argument of type string or array, but found ${mt(i.type)} instead.`):new wn(i):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new Ft(`Expected value to be of type string or array, but found ${mt(Lt(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}const Mn={"==":mn,"!=":gn,">":yn,"<":_n,">=":vn,"<=":xn,array:Vt,at:en,boolean:Vt,case:cn,coalesce:Yi,collator:Jt,format:Gt,image:jt,in:nn,"index-of":on,interpolate:Hi,"interpolate-hcl":Hi,"interpolate-lab":Hi,length:wn,let:Ki,literal:Bt,match:sn,number:Vt,"number-format":bn,object:Vt,slice:hn,step:Ei,string:Vt,"to-boolean":qt,"to-color":qt,"to-number":qt,"to-string":qt,var:vi,within:mi};function Tn(e,[t,i,n,r]){t=t.evaluate(e),i=i.evaluate(e),n=n.evaluate(e);const o=r?r.evaluate(e):1,a=zt(t,i,n,o);if(a)throw new Ft(a);return new Ct(t/255*o,i/255*o,n/255*o,o)}function Sn(e,t){return e in t}function En(e,t){const i=t[e];return void 0===i?null:i}function Cn(e){return{type:e}}Yt.register(Mn,{error:[{kind:"error"},[at],(e,[t])=>{throw new Ft(t.evaluate(e))}],typeof:[at,[ut],(e,[t])=>mt(Lt(t.evaluate(e)))],"to-rgba":[ft(ot,4),[lt],(e,[t])=>t.evaluate(e).toArray()],rgb:[lt,[ot,ot,ot],Tn],rgba:[lt,[ot,ot,ot,ot],Tn],has:{type:st,overloads:[[[at],(e,[t])=>Sn(t.evaluate(e),e.properties())],[[at,ct],(e,[t,i])=>Sn(t.evaluate(e),i.evaluate(e))]]},get:{type:ut,overloads:[[[at],(e,[t])=>En(t.evaluate(e),e.properties())],[[at,ct],(e,[t,i])=>En(t.evaluate(e),i.evaluate(e))]]},"feature-state":[ut,[at],(e,[t])=>En(t.evaluate(e),e.featureState||{})],properties:[ct,[],e=>e.properties()],"geometry-type":[at,[],e=>e.geometryType()],id:[ut,[],e=>e.id()],zoom:[ot,[],e=>e.globals.zoom],pitch:[ot,[],e=>e.globals.pitch||0],"distance-from-center":[ot,[],e=>e.distanceFromCenter()],"heatmap-density":[ot,[],e=>e.globals.heatmapDensity||0],"line-progress":[ot,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[ot,[],e=>e.globals.skyRadialProgress||0],accumulated:[ut,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[ot,Cn(ot),(e,t)=>{let i=0;for(const n of t)i+=n.evaluate(e);return i}],"*":[ot,Cn(ot),(e,t)=>{let i=1;for(const n of t)i*=n.evaluate(e);return i}],"-":{type:ot,overloads:[[[ot,ot],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[ot],(e,[t])=>-t.evaluate(e)]]},"/":[ot,[ot,ot],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[ot,[ot,ot],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[ot,[],()=>Math.LN2],pi:[ot,[],()=>Math.PI],e:[ot,[],()=>Math.E],"^":[ot,[ot,ot],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[ot,[ot],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[ot,[ot],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[ot,[ot],(e,[t])=>Math.log(t.evaluate(e))],log2:[ot,[ot],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[ot,[ot],(e,[t])=>Math.sin(t.evaluate(e))],cos:[ot,[ot],(e,[t])=>Math.cos(t.evaluate(e))],tan:[ot,[ot],(e,[t])=>Math.tan(t.evaluate(e))],asin:[ot,[ot],(e,[t])=>Math.asin(t.evaluate(e))],acos:[ot,[ot],(e,[t])=>Math.acos(t.evaluate(e))],atan:[ot,[ot],(e,[t])=>Math.atan(t.evaluate(e))],min:[ot,Cn(ot),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[ot,Cn(ot),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[ot,[ot],(e,[t])=>Math.abs(t.evaluate(e))],round:[ot,[ot],(e,[t])=>{const i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[ot,[ot],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[ot,[ot],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[st,[at,ut],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[st,[ut],(e,[t])=>e.id()===t.value],"filter-type-==":[st,[at],(e,[t])=>e.geometryType()===t.value],"filter-<":[st,[at,ut],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n<r}],"filter-id-<":[st,[ut],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i<n}],"filter->":[st,[at,ut],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n>r}],"filter-id->":[st,[ut],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i>n}],"filter-<=":[st,[at,ut],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n<=r}],"filter-id-<=":[st,[ut],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i<=n}],"filter->=":[st,[at,ut],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n>=r}],"filter-id->=":[st,[ut],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i>=n}],"filter-has":[st,[ut],(e,[t])=>t.value in e.properties()],"filter-has-id":[st,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[st,[ft(at)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[st,[ft(ut)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[st,[at,ft(ut)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[st,[at,ft(ut)],(e,[t,i])=>function(e,t,i,n){for(;i<=n;){const r=i+n>>1;if(t[r]===e)return!0;t[r]>e?n=r-1:i=r+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:st,overloads:[[[st,st],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[Cn(st),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:st,overloads:[[[st,st],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[Cn(st),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[st,[st],(e,[t])=>!t.evaluate(e)],"is-supported-script":[st,[at],(e,[t])=>{const i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[at,[at],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[at,[at],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[at,Cn(ut),(e,t)=>t.map((t=>Rt(t.evaluate(e)))).join("")],"resolved-locale":[at,[ht],(e,[t])=>t.evaluate(e).resolvedLocale()]});var An=Mn;function Pn(e){return{result:"success",value:e}}function In(e){return{result:"error",value:e}}function kn(e){return"data-driven"===e["property-type"]}function zn(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Dn(e){return!!e.expression&&e.expression.interpolated}function Ln(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Rn(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function On(e){return e}function Bn(e,t){const i="color"===t.type,n=e.stops&&"object"==typeof e.stops[0][0],r=n||!(n||void 0!==e.property),o=e.type||(Dn(t)?"exponential":"interval");if(i&&((e=Je({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],Ct.parse(e[1])]))),e.default=Ct.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!$i[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let a,s,l;if("exponential"===o)a=Vn;else if("interval"===o)a=Un;else if("categorical"===o){a=Nn,s=Object.create(null);for(const t of e.stops)s[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);a=Gn}if(n){const i={},n=[];for(let t=0;t<e.stops.length;t++){const r=e.stops[t],o=r[0].zoom;void 0===i[o]&&(i[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},n.push(o)),i[o].stops.push([r[0].value,r[1]])}const r=[];for(const e of n)r.push([i[e].zoom,Bn(i[e],t)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:Hi.interpolationFactor.bind(void 0,o),zoomStops:r.map((e=>e[0])),evaluate:({zoom:i},n)=>Vn({stops:r,base:e.base},t,i).evaluate(i,n)}}if(r){const i="exponential"===o?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:Hi.interpolationFactor.bind(void 0,i),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:i})=>a(e,t,i,s,l)}}return{kind:"source",evaluate(i,n){const r=n&&n.properties?n.properties[e.property]:void 0;return void 0===r?Fn(e.default,t.default):a(e,t,r,s,l)}}}function Fn(e,t,i){return void 0!==e?e:void 0!==t?t:void 0!==i?i:void 0}function Nn(e,t,i,n,r){return Fn(typeof i===r?n[i]:void 0,e.default,t.default)}function Un(e,t,i){if("number"!==Ln(i))return Fn(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[n-1][0])return e.stops[n-1][1];const r=Ti(e.stops.map((e=>e[0])),i);return e.stops[r][1]}function Vn(e,t,i){const n=void 0!==e.base?e.base:1;if("number"!==Ln(i))return Fn(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[r-1][0])return e.stops[r-1][1];const o=Ti(e.stops.map((e=>e[0])),i),a=function(e,t,i,n){const r=n-i,o=e-i;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}(i,n,e.stops[o][0],e.stops[o+1][0]),s=e.stops[o][1],l=e.stops[o+1][1];let c=Ai[t.type]||On;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=$i[e.colorSpace];c=(e,i)=>t.reverse(t.interpolate(t.forward(e),t.forward(i),a))}return"function"==typeof s.evaluate?{evaluate(...e){const t=s.evaluate.apply(void 0,e),i=l.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==i)return c(t,i,a)}}:c(s,l,a)}function Gn(e,t,i){return"color"===t.type?i=Ct.parse(i):"formatted"===t.type?i=It.fromString(i.toString()):"resolvedImage"===t.type?i=kt.fromString(i.toString()):Ln(i)===t.type||"enum"===t.type&&t.values[i]||(i=void 0),Fn(i,e.default,t.default)}class jn{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Ht,this._defaultValue=t?function(e){return"color"===e.type&&(Rn(e.default)||Array.isArray(e.default))?new Ct(0,0,0,0):"color"===e.type?Ct.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,i,n,r,o,a,s){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=n||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,n,r,o,a,s){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=i||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Ft(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function Wn(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in An}function $n(e,t){const i=new wi(An,[],t?function(e){const t={color:lt,string:at,number:ot,enum:at,boolean:st,formatted:dt,resolvedImage:pt};return"array"===e.type?ft(t[e.value]||ut,e.length):t[e.type]}(t):void 0),n=i.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return n?Pn(new jn(n,t)):In(i.errors)}class qn{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!_i(t.expression)}evaluateWithoutErrorHandling(e,t,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,n,r,o)}evaluate(e,t,i,n,r,o){return this._styleExpression.evaluate(e,t,i,n,r,o)}}class Zn{constructor(e,t,i,n){this.kind=e,this.zoomStops=i,this._styleExpression=t,this.isStateDependent="camera"!==e&&!_i(t.expression),this.interpolationType=n}evaluateWithoutErrorHandling(e,t,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,n,r,o)}evaluate(e,t,i,n,r,o){return this._styleExpression.evaluate(e,t,i,n,r,o)}interpolationFactor(e,t,i){return this.interpolationType?Hi.interpolationFactor(this.interpolationType,e,t,i):0}}function Hn(e,t){if("error"===(e=$n(e,t)).result)return e;const i=e.value.expression,n=gi(i);if(!n&&!kn(t))return In([new tt("","data expressions not supported")]);const r=yi(i,["zoom","pitch","distance-from-center"]);if(!r&&!zn(t))return In([new tt("","zoom expressions not supported")]);const o=Yn(i);return o||r?o instanceof tt?In([o]):o instanceof Hi&&!Dn(t)?In([new tt("",'"interpolate" expressions cannot be used with this property')]):Pn(o?new Zn(n?"camera":"composite",e.value,o.labels,o instanceof Hi?o.interpolation:void 0):new qn(n?"constant":"source",e.value)):In([new tt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Xn{constructor(e,t){this._parameters=e,this._specification=t,Je(this,Bn(this._parameters,this._specification))}static deserialize(e){return new Xn(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Yn(e){let t=null;if(e instanceof Ki)t=Yn(e.result);else if(e instanceof Yi){for(const i of e.args)if(t=Yn(i),t)break}else(e instanceof Ei||e instanceof Hi)&&e.input instanceof Yt&&"zoom"===e.input.name&&(t=e);return t instanceof tt||e.eachChild((e=>{const i=Yn(e);i instanceof tt?t=i:!t&&i?t=new tt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&i&&t!==i&&(t=new tt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}class Jn{constructor(e,t,i,n){this.message=(e?`${e}: `:"")+i,n&&(this.identifier=n),null!=t&&t.__line__&&(this.line=t.__line__)}}function Kn(e){const t=e.key,i=e.value,n=e.valueSpec||{},r=e.objectElementValidators||{},o=e.style,a=e.styleSpec;let s=[];const l=Ln(i);if("object"!==l)return[new Jn(t,i,`object expected, ${l} found`)];for(const e in i){const l=e.split(".")[0],c=n[l]||n["*"];let u;r[l]?u=r[l]:n[l]?u=zr:r["*"]?u=r["*"]:n["*"]&&(u=zr),u?s=s.concat(u({key:(t?`${t}.`:t)+e,value:i[e],valueSpec:c,style:o,styleSpec:a,object:i,objectKey:e},i)):s.push(new Jn(t,i[e],`unknown property "${e}"`))}for(const e in n)r[e]||n[e].required&&void 0===n[e].default&&void 0===i[e]&&s.push(new Jn(t,i,`missing required property "${e}"`));return s}function Qn(e){const t=e.value,i=e.valueSpec,n=e.style,r=e.styleSpec,o=e.key,a=e.arrayElementValidator||zr;if("array"!==Ln(t))return[new Jn(o,t,`array expected, ${Ln(t)} found`)];if(i.length&&t.length!==i.length)return[new Jn(o,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new Jn(o,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let s={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};r.$version<7&&(s.function=i.function),"object"===Ln(i.value)&&(s=i.value);let l=[];for(let e=0;e<t.length;e++)l=l.concat(a({array:t,arrayIndex:e,value:t[e],valueSpec:s,style:n,styleSpec:r,key:`${o}[${e}]`}));return l}function er(e){const t=e.key,i=e.value,n=e.valueSpec;let r=Ln(i);if("number"===r&&i!=i&&(r="NaN"),"number"!==r)return[new Jn(t,i,`number expected, ${r} found`)];if("minimum"in n){let r=n.minimum;if("array"===Ln(n.minimum)&&(r=n.minimum[e.arrayIndex]),i<r)return[new Jn(t,i,`${i} is less than the minimum value ${r}`)]}if("maximum"in n){let r=n.maximum;if("array"===Ln(n.maximum)&&(r=n.maximum[e.arrayIndex]),i>r)return[new Jn(t,i,`${i} is greater than the maximum value ${r}`)]}return[]}function tr(e){const t=e.valueSpec,i=Ke(e.value.type);let n,r,o,a={};const s="categorical"!==i&&void 0===e.value.property,l=!s,c="array"===Ln(e.value.stops)&&"array"===Ln(e.value.stops[0])&&"object"===Ln(e.value.stops[0][0]),u=Kn({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===i)return[new Jn(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const n=e.value;return t=t.concat(Qn({key:e.key,value:n,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===Ln(n)&&0===n.length&&t.push(new Jn(e.key,n,"array must have at least one stop")),t},default:function(e){return zr({key:e.key,value:e.value,valueSpec:t,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===i&&s&&u.push(new Jn(e.key,e.value,'missing required property "property"')),"identity"===i||e.value.stops||u.push(new Jn(e.key,e.value,'missing required property "stops"')),"exponential"===i&&e.valueSpec.expression&&!Dn(e.valueSpec)&&u.push(new Jn(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!kn(e.valueSpec)?u.push(new Jn(e.key,e.value,"property functions not supported")):s&&!zn(e.valueSpec)&&u.push(new Jn(e.key,e.value,"zoom functions not supported"))),"categorical"!==i&&!c||void 0!==e.value.property||u.push(new Jn(e.key,e.value,'"property" property is required')),u;function h(e){let i=[];const n=e.value,s=e.key;if("array"!==Ln(n))return[new Jn(s,n,`array expected, ${Ln(n)} found`)];if(2!==n.length)return[new Jn(s,n,`array length 2 expected, length ${n.length} found`)];if(c){if("object"!==Ln(n[0]))return[new Jn(s,n,`object expected, ${Ln(n[0])} found`)];if(void 0===n[0].zoom)return[new Jn(s,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new Jn(s,n,"object stop key must have value")];const t=Ke(n[0].zoom);if("number"!=typeof t)return[new Jn(s,n[0].zoom,"stop zoom values must be numbers")];if(o&&o>t)return[new Jn(s,n[0].zoom,"stop zoom values must appear in ascending order")];t!==o&&(o=t,r=void 0,a={}),i=i.concat(Kn({key:`${s}[0]`,value:n[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:er,value:d}}))}else i=i.concat(d({key:`${s}[0]`,value:n[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},n));return Wn(Qe(n[1]))?i.concat([new Jn(`${s}[1]`,n[1],"expressions are not allowed in function stops.")]):i.concat(zr({key:`${s}[1]`,value:n[1],valueSpec:t,style:e.style,styleSpec:e.styleSpec}))}function d(e,o){const s=Ln(e.value),l=Ke(e.value),c=null!==e.value?e.value:o;if(n){if(s!==n)return[new Jn(e.key,c,`${s} stop domain type must match previous stop domain type ${n}`)]}else n=s;if("number"!==s&&"string"!==s&&"boolean"!==s&&"number"!=typeof l&&"string"!=typeof l&&"boolean"!=typeof l)return[new Jn(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==i){let n=`number expected, ${s} found`;return kn(t)&&void 0===i&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Jn(e.key,c,n)]}return"categorical"!==i||"number"!==s||"number"==typeof l&&isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===s&&"number"==typeof l&&"number"==typeof r&&void 0!==r&&l<r?[new Jn(e.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===i&&l in a?[new Jn(e.key,c,"stop domain values must be unique")]:(a[l]=!0,[])):[new Jn(e.key,c,`integer expected, found ${String(l)}`)]}}function ir(e){const t=("property"===e.expressionContext?Hn:$n)(Qe(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new Jn(`${e.key}${t.key}`,e.value,t.message)));const i=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!i.outputDefined())return[new Jn(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!_i(i))return[new Jn(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return nr(i,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!yi(i,["zoom","feature-state"]))return[new Jn(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!gi(i))return[new Jn(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function nr(e,t){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const e of t.valueSpec.expression.parameters)i.delete(e);if(0===i.size)return[];const n=[];return e instanceof Yt&&i.has(e.name)?[new Jn(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild((e=>{n.push(...nr(e,t))})),n)}function rr(e){const t=e.key,i=e.value,n=e.valueSpec,r=[];return Array.isArray(n.values)?-1===n.values.indexOf(Ke(i))&&r.push(new Jn(t,i,`expected one of [${n.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(n.values).indexOf(Ke(i))&&r.push(new Jn(t,i,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(i)} found`)),r}function or(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!or(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function ar(e,t="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};or(e)||(e=pr(e));const i=e;let n=!0;try{n=function(e){if(!cr(e))return e;let t=Qe(e);return lr(t),t=sr(t),t}(i)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const r=Ye[`filter_${t}`],o=$n(n,r);let a=null;if("error"===o.result)throw new Error(o.value.map((e=>`${e.key}: ${e.message}`)).join(", "));a=(e,t,i)=>o.value.evaluate(e,t,{},i);let s=null,l=null;if(n!==i){const e=$n(i,r);if("error"===e.result)throw new Error(e.value.map((e=>`${e.key}: ${e.message}`)).join(", "));s=(t,i,n,r,o)=>e.value.evaluate(t,i,{},n,void 0,void 0,r,o),l=!gi(e.value.expression)}return{filter:a,dynamicFilter:s||void 0,needGeometry:dr(n),needFeature:!!l}}function sr(e){if(!Array.isArray(e))return e;const t=function(e){if(ur.has(e[0]))for(let t=1;t<e.length;t++)if(cr(e[t]))return!0;return e}(e);return!0===t?t:t.map((e=>sr(e)))}function lr(e){let t=!1;const i=[];if("case"===e[0]){for(let n=1;n<e.length-1;n+=2)t=t||cr(e[n]),i.push(e[n+1]);i.push(e[e.length-1])}else if("match"===e[0]){t=t||cr(e[1]);for(let t=2;t<e.length-1;t+=2)i.push(e[t+1]);i.push(e[e.length-1])}else if("step"===e[0]){t=t||cr(e[1]);for(let t=1;t<e.length-1;t+=2)i.push(e[t+1])}t&&(e.length=0,e.push("any",...i));for(let t=1;t<e.length;t++)lr(e[t])}function cr(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let t=1;t<e.length;t++)if(cr(e[t]))return!0;return!1}const ur=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function hr(e,t){return e<t?-1:e>t?1:0}function dr(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(let t=1;t<e.length;t++)if(dr(e[t]))return!0;return!1}function pr(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?fr(e[1],e[2],"=="):"!="===t?_r(fr(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?fr(e[1],e[2],t):"any"===t?(i=e.slice(1),["any"].concat(i.map(pr))):"all"===t?["all"].concat(e.slice(1).map(pr)):"none"===t?["all"].concat(e.slice(1).map(pr).map(_r)):"in"===t?mr(e[1],e.slice(2)):"!in"===t?_r(mr(e[1],e.slice(2))):"has"===t?gr(e[1]):"!has"===t?_r(gr(e[1])):"within"!==t||e;var i}function fr(e,t,i){switch(e){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,e,t]}}function mr(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(hr)]]:["filter-in-small",e,["literal",t]]}}function gr(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function _r(e){return["!",e]}function yr(e){return or(Qe(e.value))?ir(Je({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):xr(e)}function xr(e){const t=e.value,i=e.key;if("array"!==Ln(t))return[new Jn(i,t,`array expected, ${Ln(t)} found`)];const n=e.styleSpec;let r,o=[];if(t.length<1)return[new Jn(i,t,"filter array must have at least 1 element")];switch(o=o.concat(rr({key:`${i}[0]`,value:t[0],valueSpec:n.filter_operator,style:e.style,styleSpec:e.styleSpec})),Ke(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===Ke(t[1])&&o.push(new Jn(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&o.push(new Jn(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(r=Ln(t[1]),"string"!==r&&o.push(new Jn(`${i}[1]`,t[1],`string expected, ${r} found`)));for(let a=2;a<t.length;a++)r=Ln(t[a]),"$type"===Ke(t[1])?o=o.concat(rr({key:`${i}[${a}]`,value:t[a],valueSpec:n.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new Jn(`${i}[${a}]`,t[a],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let n=1;n<t.length;n++)o=o.concat(xr({key:`${i}[${n}]`,value:t[n],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":r=Ln(t[1]),2!==t.length?o.push(new Jn(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==r&&o.push(new Jn(`${i}[1]`,t[1],`string expected, ${r} found`));break;case"within":r=Ln(t[1]),2!==t.length?o.push(new Jn(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==r&&o.push(new Jn(`${i}[1]`,t[1],`object expected, ${r} found`))}return o}function vr(e,t){const i=e.key,n=e.style,r=e.styleSpec,o=e.value,a=e.objectKey,s=r[`${t}_${e.layerType}`];if(!s)return[];const l=a.match(/^(.*)-transition$/);if("paint"===t&&l&&s[l[1]]&&s[l[1]].transition)return zr({key:i,value:o,valueSpec:r.transition,style:n,styleSpec:r});const c=e.valueSpec||s[a];if(!c)return[new Jn(i,o,`unknown property "${a}"`)];let u;if("string"===Ln(o)&&kn(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(o)))return[new Jn(i,o,`"${a}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(u[1])} }\`.`)];const h=[];return"symbol"===e.layerType&&("text-field"===a&&n&&!n.glyphs&&h.push(new Jn(i,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&Rn(Qe(o))&&"identity"===Ke(o.type)&&h.push(new Jn(i,o,'"text-font" does not support identity functions'))),h.concat(zr({key:e.key,value:o,valueSpec:c,style:n,styleSpec:r,expressionContext:"property",propertyType:t,propertyKey:a}))}function br(e){return vr(e,"paint")}function wr(e){return vr(e,"layout")}function Mr(e){let t=[];const i=e.value,n=e.key,r=e.style,o=e.styleSpec;i.type||i.ref||t.push(new Jn(n,i,'either "type" or "ref" is required'));let a=Ke(i.type);const s=Ke(i.ref);if(i.id){const o=Ke(i.id);for(let a=0;a<e.arrayIndex;a++){const e=r.layers[a];Ke(e.id)===o&&t.push(new Jn(n,i.id,`duplicate layer id "${i.id}", previously used at line ${e.id.__line__}`))}}if("ref"in i){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in i&&t.push(new Jn(n,i[e],`"${e}" is prohibited for ref layers`))})),r.layers.forEach((t=>{Ke(t.id)===s&&(e=t)})),e?e.ref?t.push(new Jn(n,i.ref,"ref cannot reference another ref layer")):a=Ke(e.type):"string"==typeof s&&t.push(new Jn(n,i.ref,`ref layer "${s}" not found`))}else if("background"!==a&&"sky"!==a)if(i.source){const e=r.sources&&r.sources[i.source],o=e&&Ke(e.type);e?"vector"===o&&"raster"===a?t.push(new Jn(n,i.source,`layer "${i.id}" requires a raster source`)):"raster"===o&&"raster"!==a?t.push(new Jn(n,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==o||i["source-layer"]?"raster-dem"===o&&"hillshade"!==a?t.push(new Jn(n,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==a||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||"geojson"===o&&e.lineMetrics||t.push(new Jn(n,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Jn(n,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new Jn(n,i.source,`source "${i.source}" not found`))}else t.push(new Jn(n,i,'missing required property "source"'));return t=t.concat(Kn({key:n,value:i,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>zr({key:`${n}.type`,value:i.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,object:i,objectKey:"type"}),filter:e=>yr(Je({layerType:a},e)),layout:e=>Kn({layer:i,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>wr(Je({layerType:a},e))}}),paint:e=>Kn({layer:i,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>br(Je({layerType:a},e))}})}})),t}function Tr(e){const t=e.value,i=e.key,n=Ln(t);return"string"!==n?[new Jn(i,t,`string expected, ${n} found`)]:[]}const Sr={promoteId:function({key:e,value:t}){if("string"===Ln(t))return Tr({key:e,value:t});{const i=[];for(const n in t)i.push(...Tr({key:`${e}.${n}`,value:t[n]}));return i}}};function Er(e){const t=e.value,i=e.key,n=e.styleSpec,r=e.style;if(!t.type)return[new Jn(i,t,'"type" is required')];const o=Ke(t.type);let a;switch(o){case"vector":case"raster":case"raster-dem":return a=Kn({key:i,value:t,valueSpec:n[`source_${o.replace("-","_")}`],style:e.style,styleSpec:n,objectElementValidators:Sr}),a;case"geojson":if(a=Kn({key:i,value:t,valueSpec:n.source_geojson,style:r,styleSpec:n,objectElementValidators:Sr}),t.cluster)for(const e in t.clusterProperties){const[n,r]=t.clusterProperties[e],o="string"==typeof n?[n,["accumulated"],["get",e]]:n;a.push(...ir({key:`${i}.${e}.map`,value:r,expressionContext:"cluster-map"})),a.push(...ir({key:`${i}.${e}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return a;case"video":return Kn({key:i,value:t,valueSpec:n.source_video,style:r,styleSpec:n});case"image":return Kn({key:i,value:t,valueSpec:n.source_image,style:r,styleSpec:n});case"canvas":return[new Jn(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return rr({key:`${i}.type`,value:t.type,valueSpec:{values:Cr(n)},style:r,styleSpec:n})}}function Cr(e){return e.source.reduce(((t,i)=>{const n=e[i];return"enum"===n.type.type&&(t=t.concat(Object.keys(n.type.values))),t}),[])}function Ar(e){const t=e.value,i=e.styleSpec,n=i.light,r=e.style;let o=[];const a=Ln(t);if(void 0===t)return o;if("object"!==a)return o=o.concat([new Jn("light",t,`object expected, ${a} found`)]),o;for(const e in t){const a=e.match(/^(.*)-transition$/);o=o.concat(a&&n[a[1]]&&n[a[1]].transition?zr({key:e,value:t[e],valueSpec:i.transition,style:r,styleSpec:i}):n[e]?zr({key:e,value:t[e],valueSpec:n[e],style:r,styleSpec:i}):[new Jn(e,t[e],`unknown property "${e}"`)])}return o}function Pr(e){const t=e.value,i=e.key,n=e.style,r=e.styleSpec,o=r.terrain;let a=[];const s=Ln(t);if(void 0===t)return a;if("object"!==s)return a=a.concat([new Jn("terrain",t,`object expected, ${s} found`)]),a;for(const e in t){const i=e.match(/^(.*)-transition$/);a=a.concat(i&&o[i[1]]&&o[i[1]].transition?zr({key:e,value:t[e],valueSpec:r.transition,style:n,styleSpec:r}):o[e]?zr({key:e,value:t[e],valueSpec:o[e],style:n,styleSpec:r}):[new Jn(e,t[e],`unknown property "${e}"`)])}if(t.source){const e=n.sources&&n.sources[t.source],r=e&&Ke(e.type);e?"raster-dem"!==r&&a.push(new Jn(i,t.source,`terrain cannot be used with a source of type ${String(r)}, it only be used with a "raster-dem" source type`)):a.push(new Jn(i,t.source,`source "${t.source}" not found`))}else a.push(new Jn(i,t,'terrain is missing required property "source"'));return a}function Ir(e){const t=e.value,i=e.style,n=e.styleSpec,r=n.fog;let o=[];const a=Ln(t);if(void 0===t)return o;if("object"!==a)return o=o.concat([new Jn("fog",t,`object expected, ${a} found`)]),o;for(const e in t){const a=e.match(/^(.*)-transition$/);o=o.concat(a&&r[a[1]]&&r[a[1]].transition?zr({key:e,value:t[e],valueSpec:n.transition,style:i,styleSpec:n}):r[e]?zr({key:e,value:t[e],valueSpec:r[e],style:i,styleSpec:n}):[new Jn(e,t[e],`unknown property "${e}"`)])}return o}const kr={"*":()=>[],array:Qn,boolean:function(e){const t=e.value,i=e.key,n=Ln(t);return"boolean"!==n?[new Jn(i,t,`boolean expected, ${n} found`)]:[]},number:er,color:function(e){const t=e.key,i=e.value,n=Ln(i);return"string"!==n?[new Jn(t,i,`color expected, ${n} found`)]:null===vt(i)?[new Jn(t,i,`color expected, "${i}" found`)]:[]},enum:rr,filter:yr,function:tr,layer:Mr,object:Kn,source:Er,light:Ar,terrain:Pr,fog:Ir,string:Tr,formatted:function(e){return 0===Tr(e).length?[]:ir(e)},resolvedImage:function(e){return 0===Tr(e).length?[]:ir(e)},projection:function(e){const t=e.value,i=e.styleSpec,n=i.projection,r=e.style;let o=[];const a=Ln(t);if("object"===a)for(const e in t)o=o.concat(zr({key:e,value:t[e],valueSpec:n[e],style:r,styleSpec:i}));else"string"!==a&&(o=o.concat([new Jn("projection",t,`object or string expected, ${a} found`)]));return o}};function zr(e){const t=e.value,i=e.valueSpec,n=e.styleSpec;return i.expression&&Rn(Ke(t))?tr(e):i.expression&&Wn(Qe(t))?ir(e):i.type&&kr[i.type]?kr[i.type](e):Kn(Je({},e,{valueSpec:i.type?n[i.type]:i}))}function Dr(e){const t=e.value,i=e.key,n=Tr(e);return n.length||(-1===t.indexOf("{fontstack}")&&n.push(new Jn(i,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&n.push(new Jn(i,t,'"glyphs" url must include a "{range}" token'))),n}function Lr(e,t=Ye){return Br(zr({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Dr,"*":()=>[]}}))}const Rr=e=>Br(br(e)),Or=e=>Br(wr(e));function Br(e){return e.slice().sort(((e,t)=>e.line&&t.line?e.line-t.line:0))}function Fr(e,t){let i=!1;if(t&&t.length)for(const n of t)e.fire(new He(new Error(n.message))),i=!0;return i}var Nr=Ur;function Ur(e,t,i){var n=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var r=new Int32Array(this.arrayBuffer);e=r[0],this.d=(t=r[1])+2*(i=r[2]);for(var o=0;o<this.d*this.d;o++){var a=r[3+o],s=r[3+o+1];n.push(a===s?null:r.subarray(a,s))}var l=r[3+n.length+1];this.keys=r.subarray(r[3+n.length],l),this.bboxes=r.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var c=0;c<this.d*this.d;c++)n.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;var u=i/t*e;this.min=-u,this.max=e+u}Ur.prototype.insert=function(e,t,i,n,r){this._forEachCell(t,i,n,r,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)},Ur.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ur.prototype._insertCell=function(e,t,i,n,r,o){this.cells[r].push(o)},Ur.prototype.query=function(e,t,i,n,r){var o=this.min,a=this.max;if(e<=o&&t<=o&&a<=i&&a<=n&&!r)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(e,t,i,n,this._queryCell,s,{},r),s},Ur.prototype._queryCell=function(e,t,i,n,r,o,a,s){var l=this.cells[r];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===a[d]){var p=4*d;(s?s(u[p+0],u[p+1],u[p+2],u[p+3]):e<=u[p+2]&&t<=u[p+3]&&i>=u[p+0]&&n>=u[p+1])?(a[d]=!0,o.push(c[d])):a[d]=!1}}},Ur.prototype._forEachCell=function(e,t,i,n,r,o,a,s){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(i),h=this._convertToCellCoord(n),d=l;d<=u;d++)for(var p=c;p<=h;p++){var f=this.d*p+d;if((!s||s(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&r.call(this,e,t,i,n,f,o,a,s))return}},Ur.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Ur.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Ur.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var r=new Int32Array(t+i+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var o=t,a=0;a<e.length;a++){var s=e[a];r[3+a]=o,r.set(s,o),o+=s.length}return r[3+e.length]=o,r.set(this.keys,o),r[3+e.length+1]=o+=this.keys.length,r.set(this.bboxes,o),o+=this.bboxes.length,r.buffer};const Vr={};function Gr(e,t,i={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Vr[t]={klass:e,omit:i.omit||[]}}Gr(Object,"Object"),Nr.serialize=function(e,t){const i=e.toArrayBuffer();return t&&t.push(i),{buffer:i}},Nr.deserialize=function(e){return new Nr(e.buffer)},Object.defineProperty(Nr,"name",{value:"Grid"}),Gr(Nr,"Grid"),Gr(Ct,"Color"),Gr(Error,"Error"),Gr(ae,"AJAXError"),Gr(kt,"ResolvedImage"),Gr(Xn,"StylePropertyFunction"),Gr(jn,"StyleExpression",{omit:["_evaluator"]}),Gr(Zn,"ZoomDependentExpression"),Gr(qn,"ZoomConstantExpression"),Gr(Yt,"CompoundExpression",{omit:["_evaluate"]});for(const e in An)Vr[An[e]._classRegistryKey]||Gr(An[e],`Expression${e}`);function jr(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Wr(e){return t.ImageBitmap&&e instanceof t.ImageBitmap}function $r(e,i){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(jr(e)||Wr(e))return i&&i.push(e),e;if(ArrayBuffer.isView(e)){const t=e;return i&&i.push(t.buffer),t}if(e instanceof t.ImageData)return i&&i.push(e.data.buffer),e;if(Array.isArray(e)){const t=[];for(const n of e)t.push($r(n,i));return t}if("object"==typeof e){const t=e.constructor,n=t._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const r=t.serialize?t.serialize(e,i):{};if(!t.serialize){for(const t in e)e.hasOwnProperty(t)&&(Vr[n].omit.indexOf(t)>=0||(r[t]=$r(e[t],i)));e instanceof Error&&(r.message=e.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(r.$name=n),r}throw new Error("can't serialize object of type "+typeof e)}function qr(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||jr(e)||Wr(e)||ArrayBuffer.isView(e)||e instanceof t.ImageData)return e;if(Array.isArray(e))return e.map(qr);if("object"==typeof e){const t=e.$name||"Object",{klass:i}=Vr[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(e);const n=Object.create(i.prototype);for(const t of Object.keys(e))"$name"!==t&&(n[t]=qr(e[t]));return n}throw new Error("can't deserialize object of type "+typeof e)}const Zr=e=>e>=1536&&e<=1791,Hr=e=>e>=1872&&e<=1919,Xr=e=>e>=2208&&e<=2303,Yr=e=>e>=11904&&e<=12031,Jr=e=>e>=12032&&e<=12255,Kr=e=>e>=12272&&e<=12287,Qr=e=>e>=12288&&e<=12351,eo=e=>e>=12352&&e<=12447,to=e=>e>=12448&&e<=12543,io=e=>e>=12544&&e<=12591,no=e=>e>=12704&&e<=12735,ro=e=>e>=12736&&e<=12783,oo=e=>e>=12784&&e<=12799,ao=e=>e>=12800&&e<=13055,so=e=>e>=13056&&e<=13311,lo=e=>e>=13312&&e<=19903,co=e=>e>=19968&&e<=40959,uo=e=>e>=40960&&e<=42127,ho=e=>e>=42128&&e<=42191,po=e=>e>=44032&&e<=55215,fo=e=>e>=63744&&e<=64255,mo=e=>e>=64336&&e<=65023,go=e=>e>=65040&&e<=65055,_o=e=>e>=65072&&e<=65103,yo=e=>e>=65104&&e<=65135,xo=e=>e>=65136&&e<=65279,vo=e=>e>=65280&&e<=65519;function bo(e){for(const t of e)if(To(t.charCodeAt(0)))return!0;return!1}function wo(e){for(const t of e)if(!Mo(t.charCodeAt(0)))return!1;return!0}function Mo(e){return!(Zr(e)||Hr(e)||Xr(e)||mo(e)||xo(e))}function To(e){return!(746!==e&&747!==e&&(e<4352||!(no(e)||io(e)||_o(e)&&!(e>=65097&&e<=65103)||fo(e)||so(e)||Yr(e)||ro(e)||!(!Qr(e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||lo(e)||co(e)||ao(e)||(e=>e>=12592&&e<=12687)(e)||(e=>e>=43360&&e<=43391)(e)||(e=>e>=55216&&e<=55295)(e)||(e=>e>=4352&&e<=4607)(e)||po(e)||eo(e)||Kr(e)||(e=>e>=12688&&e<=12703)(e)||Jr(e)||oo(e)||to(e)&&12540!==e||!(!vo(e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!yo(e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||(e=>e>=5120&&e<=5759)(e)||(e=>e>=6320&&e<=6399)(e)||go(e)||(e=>e>=19904&&e<=19967)(e)||uo(e)||ho(e))))}function So(e){return!(To(e)||function(e){return!!((e=>e>=128&&e<=255)(e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(e=>e>=8192&&e<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(e=>e>=8448&&e<=8527)(e)||(e=>e>=8528&&e<=8591)(e)||(e=>e>=8960&&e<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(e=>e>=9216&&e<=9279)(e)&&9251!==e||(e=>e>=9280&&e<=9311)(e)||(e=>e>=9312&&e<=9471)(e)||(e=>e>=9632&&e<=9727)(e)||(e=>e>=9728&&e<=9983)(e)&&!(e>=9754&&e<=9759)||(e=>e>=11008&&e<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Qr(e)||to(e)||(e=>e>=57344&&e<=63743)(e)||_o(e)||yo(e)||vo(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function Eo(e){return e>=1424&&e<=2303||mo(e)||xo(e)}function Co(e,t){return!(!t&&Eo(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||(e=>e>=6016&&e<=6143)(e))}function Ao(e){for(const t of e)if(Eo(t.charCodeAt(0)))return!0;return!1}const Po="deferred",Io="loading",ko="loaded";let zo=null,Do="unavailable",Lo=null;const Ro=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(Do="error"),zo&&zo(e)};function Oo(){Bo.fire(new Ze("pluginStateChange",{pluginStatus:Do,pluginURL:Lo}))}const Bo=new Xe,Fo=function(){return Do},No=function(){if(Do!==Po||!Lo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Do=Io,Oo(),Lo&&ce({url:Lo},(e=>{e?Ro(e):(Do=ko,Oo())}))},Uo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Do===ko||null!=Uo.applyArabicShaping,isLoading:()=>Do===Io,setState(e){Do=e.pluginStatus,Lo=e.pluginURL},isParsed:()=>null!=Uo.applyArabicShaping&&null!=Uo.processBidirectionalText&&null!=Uo.processStyledBidirectionalText,getPluginURL:()=>Lo};class Vo{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(e,t){for(const i of e)if(!Co(i.charCodeAt(0),t))return!1;return!0}(e,Uo.isLoaded())}}class Go{constructor(e,t){this.property=e,this.value=t,this.expression=function(e,t){if(Rn(e))return new Xn(e,t);if(Wn(e)){const i=Hn(e,t);if("error"===i.result)throw new Error(i.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return i.value}{let i=e;return"string"==typeof e&&"color"===t.type&&(i=Ct.parse(e)),{kind:"constant",evaluate:()=>i}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,i){return this.property.possiblyEvaluate(this,e,t,i)}}class jo{constructor(e){this.property=e,this.value=new Go(e,void 0)}transitioned(e,t){return new $o(this.property,this.value,t,P({},e.transition,this.transition),e.now)}untransitioned(){return new $o(this.property,this.value,null,{},0)}}class Wo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return N(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new jo(this._values[e].property)),this._values[e].value=new Go(this._values[e].property,null===t?void 0:N(t))}getTransition(e){return N(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new jo(this._values[e].property)),this._values[e].transition=N(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i);const n=this.getTransition(t);void 0!==n&&(e[`${t}-transition`]=n)}return e}transitioned(e,t){const i=new qo(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].transitioned(e,t._values[n]);return i}untransitioned(){const e=new qo(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class $o{constructor(e,t,i,n,r){const o=n.delay||0,a=n.duration||0;r=r||0,this.property=e,this.value=t,this.begin=r+o,this.end=this.begin+a,e.specification.transition&&(n.delay||n.duration)&&(this.prior=i)}possiblyEvaluate(e,t,i){const n=e.now||0,r=this.value.possiblyEvaluate(e,t,i),o=this.prior;if(o){if(n>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(n<this.begin)return o.possiblyEvaluate(e,t,i);{const a=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,i),r,b(a))}}return r}}class qo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,i){const n=new Xo(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(e,t,i);return n}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Zo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return N(this._values[e].value)}setValue(e,t){this._values[e]=new Go(this._values[e].property,null===t?void 0:N(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i)}return e}possiblyEvaluate(e,t,i){const n=new Xo(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(e,t,i);return n}}class Ho{constructor(e,t,i){this.property=e,this.value=t,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,i,n){return this.property.evaluate(this.value,this.parameters,e,t,i,n)}}class Xo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Yo{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,i){const n=Ai[this.specification.type];return n?n(e,t,i):e}}class Jo{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,i,n){return new Ho(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},i,n)}:e.expression,t)}interpolate(e,t,i){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Ho(this,{kind:"constant",value:void 0},e.parameters);const n=Ai[this.specification.type];return n?new Ho(this,{kind:"constant",value:n(e.value.value,t.value.value,i)},e.parameters):e}evaluate(e,t,i,n,r,o){return"constant"===e.kind?e.value:e.evaluate(t,i,n,r,o)}}class Ko{constructor(e){this.specification=e}possiblyEvaluate(e,t,i,n){return!!e.expression.evaluate(t,null,{},i,n)}interpolate(){return!1}}class Qo{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new Vo(0,{});for(const i in e){const n=e[i];n.specification.overridable&&this.overridableProperties.push(i);const r=this.defaultPropertyValues[i]=new Go(n,void 0),o=this.defaultTransitionablePropertyValues[i]=new jo(n);this.defaultTransitioningPropertyValues[i]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=r.possiblyEvaluate(t)}}}function ea(e,t){return 256*(e=T(Math.floor(e),0,255))+T(Math.floor(t),0,255)}Gr(Jo,"DataDrivenProperty"),Gr(Yo,"DataConstantProperty"),Gr(Ko,"ColorRampProperty");const ta={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ia{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class na{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ra(e,t=1){let i=0,n=0;return{members:e.map((e=>{const r=ta[e.type].BYTES_PER_ELEMENT,o=i=oa(i,Math.max(t,r)),a=e.components||1;return n=Math.max(n,r),i+=r*a,{name:e.name,type:e.type,components:a,offset:o}})),size:oa(i,Math.max(n,t)),alignment:t}}function oa(e,t){return Math.ceil(e/t)*t}class aa extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const n=2*e;return this.int16[n+0]=t,this.int16[n+1]=i,e}}aa.prototype.bytesPerElement=4,Gr(aa,"StructArrayLayout2i4");class sa extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i)}emplace(e,t,i,n){const r=3*e;return this.int16[r+0]=t,this.int16[r+1]=i,this.int16[r+2]=n,e}}sa.prototype.bytesPerElement=6,Gr(sa,"StructArrayLayout3i6");class la extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i,n)}emplace(e,t,i,n,r){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=i,this.int16[o+2]=n,this.int16[o+3]=r,e}}la.prototype.bytesPerElement=8,Gr(la,"StructArrayLayout4i8");class ca extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,n,r,o,a)}emplace(e,t,i,n,r,o,a,s){const l=6*e,c=12*e,u=3*e;return this.int16[l+0]=t,this.int16[l+1]=i,this.uint8[c+4]=n,this.uint8[c+5]=r,this.uint8[c+6]=o,this.uint8[c+7]=a,this.float32[u+2]=s,e}}ca.prototype.bytesPerElement=12,Gr(ca,"StructArrayLayout2i4ub1f12");class ua extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i,n)}emplace(e,t,i,n,r){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=i,this.float32[o+2]=n,this.float32[o+3]=r,e}}ua.prototype.bytesPerElement=16,Gr(ua,"StructArrayLayout4f16");class ha extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,n,r)}emplace(e,t,i,n,r,o){const a=6*e,s=3*e;return this.uint16[a+0]=t,this.uint16[a+1]=i,this.uint16[a+2]=n,this.uint16[a+3]=r,this.float32[s+2]=o,e}}ha.prototype.bytesPerElement=12,Gr(ha,"StructArrayLayout4ui1f12");class da extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i,n)}emplace(e,t,i,n,r){const o=4*e;return this.uint16[o+0]=t,this.uint16[o+1]=i,this.uint16[o+2]=n,this.uint16[o+3]=r,e}}da.prototype.bytesPerElement=8,Gr(da,"StructArrayLayout4ui8");class pa extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,n,r,o)}emplace(e,t,i,n,r,o,a){const s=6*e;return this.int16[s+0]=t,this.int16[s+1]=i,this.int16[s+2]=n,this.int16[s+3]=r,this.int16[s+4]=o,this.int16[s+5]=a,e}}pa.prototype.bytesPerElement=12,Gr(pa,"StructArrayLayout6i12");class fa extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,a,s,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,i,n,r,o,a,s,l,c,u,h)}emplace(e,t,i,n,r,o,a,s,l,c,u,h,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=i,this.int16[p+2]=n,this.int16[p+3]=r,this.uint16[p+4]=o,this.uint16[p+5]=a,this.uint16[p+6]=s,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,e}}fa.prototype.bytesPerElement=24,Gr(fa,"StructArrayLayout4i4ui4i24");class ma extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,n,r,o)}emplace(e,t,i,n,r,o,a){const s=10*e,l=5*e;return this.int16[s+0]=t,this.int16[s+1]=i,this.int16[s+2]=n,this.float32[l+2]=r,this.float32[l+3]=o,this.float32[l+4]=a,e}}ma.prototype.bytesPerElement=20,Gr(ma,"StructArrayLayout3i3f20");class ga extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}ga.prototype.bytesPerElement=4,Gr(ga,"StructArrayLayout1ul4");class _a extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,a,s,l,c,u,h,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,i,n,r,o,a,s,l,c,u,h,d)}emplace(e,t,i,n,r,o,a,s,l,c,u,h,d,p){const f=20*e,m=10*e;return this.int16[f+0]=t,this.int16[f+1]=i,this.int16[f+2]=n,this.int16[f+3]=r,this.int16[f+4]=o,this.float32[m+3]=a,this.float32[m+4]=s,this.float32[m+5]=l,this.float32[m+6]=c,this.int16[f+14]=u,this.uint32[m+8]=h,this.uint16[f+18]=d,this.uint16[f+19]=p,e}}_a.prototype.bytesPerElement=40,Gr(_a,"StructArrayLayout5i4f1i1ul2ui40");class ya extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,n,r,o,a)}emplace(e,t,i,n,r,o,a,s){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=i,this.int16[l+2]=n,this.int16[l+4]=r,this.int16[l+5]=o,this.int16[l+6]=a,this.int16[l+7]=s,e}}ya.prototype.bytesPerElement=16,Gr(ya,"StructArrayLayout3i2i2i16");class xa extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,n,r)}emplace(e,t,i,n,r,o){const a=4*e,s=8*e;return this.float32[a+0]=t,this.float32[a+1]=i,this.float32[a+2]=n,this.int16[s+6]=r,this.int16[s+7]=o,e}}xa.prototype.bytesPerElement=16,Gr(xa,"StructArrayLayout2f1f2i16");class va extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i,n)}emplace(e,t,i,n,r){const o=12*e,a=3*e;return this.uint8[o+0]=t,this.uint8[o+1]=i,this.float32[a+1]=n,this.float32[a+2]=r,e}}va.prototype.bytesPerElement=12,Gr(va,"StructArrayLayout2ub2f12");class ba extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i)}emplace(e,t,i,n){const r=3*e;return this.float32[r+0]=t,this.float32[r+1]=i,this.float32[r+2]=n,e}}ba.prototype.bytesPerElement=12,Gr(ba,"StructArrayLayout3f12");class wa extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i)}emplace(e,t,i,n){const r=3*e;return this.uint16[r+0]=t,this.uint16[r+1]=i,this.uint16[r+2]=n,e}}wa.prototype.bytesPerElement=6,Gr(wa,"StructArrayLayout3ui6");class Ma extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,g,_,y,x,v){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,g,_,y,x,v)}emplace(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,g,_,y,x,v,b){const w=30*e,M=15*e,T=60*e;return this.int16[w+0]=t,this.int16[w+1]=i,this.int16[w+2]=n,this.float32[M+2]=r,this.float32[M+3]=o,this.uint16[w+8]=a,this.uint16[w+9]=s,this.uint32[M+5]=l,this.uint32[M+6]=c,this.uint32[M+7]=u,this.uint16[w+16]=h,this.uint16[w+17]=d,this.uint16[w+18]=p,this.float32[M+10]=f,this.float32[M+11]=m,this.uint8[T+48]=g,this.uint8[T+49]=_,this.uint8[T+50]=y,this.uint32[M+13]=x,this.int16[w+28]=v,this.uint8[T+58]=b,e}}Ma.prototype.bytesPerElement=60,Gr(Ma,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ta extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,g,_,y,x,v,b,w,M,T,S,E,C,A,P){const I=this.length;return this.resize(I+1),this.emplace(I,e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,g,_,y,x,v,b,w,M,T,S,E,C,A,P)}emplace(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,g,_,y,x,v,b,w,M,T,S,E,C,A,P,I){const k=38*e,z=19*e;return this.int16[k+0]=t,this.int16[k+1]=i,this.int16[k+2]=n,this.float32[z+2]=r,this.float32[z+3]=o,this.int16[k+8]=a,this.int16[k+9]=s,this.int16[k+10]=l,this.int16[k+11]=c,this.int16[k+12]=u,this.int16[k+13]=h,this.uint16[k+14]=d,this.uint16[k+15]=p,this.uint16[k+16]=f,this.uint16[k+17]=m,this.uint16[k+18]=g,this.uint16[k+19]=_,this.uint16[k+20]=y,this.uint16[k+21]=x,this.uint16[k+22]=v,this.uint16[k+23]=b,this.uint16[k+24]=w,this.uint16[k+25]=M,this.uint16[k+26]=T,this.uint16[k+27]=S,this.uint16[k+28]=E,this.uint32[z+15]=C,this.float32[z+16]=A,this.float32[z+17]=P,this.float32[z+18]=I,e}}Ta.prototype.bytesPerElement=76,Gr(Ta,"StructArrayLayout3i2f6i15ui1ul3f76");class Sa extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Sa.prototype.bytesPerElement=4,Gr(Sa,"StructArrayLayout1f4");class Ea extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,n,r)}emplace(e,t,i,n,r,o){const a=5*e;return this.float32[a+0]=t,this.float32[a+1]=i,this.float32[a+2]=n,this.float32[a+3]=r,this.float32[a+4]=o,e}}Ea.prototype.bytesPerElement=20,Gr(Ea,"StructArrayLayout5f20");class Ca extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i,n)}emplace(e,t,i,n,r){const o=6*e;return this.uint32[3*e+0]=t,this.uint16[o+2]=i,this.uint16[o+3]=n,this.uint16[o+4]=r,e}}Ca.prototype.bytesPerElement=12,Gr(Ca,"StructArrayLayout1ul3ui12");class Aa extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const n=2*e;return this.uint16[n+0]=t,this.uint16[n+1]=i,e}}Aa.prototype.bytesPerElement=4,Gr(Aa,"StructArrayLayout2ui4");class Pa extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}Pa.prototype.bytesPerElement=2,Gr(Pa,"StructArrayLayout1ui2");class Ia extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const n=2*e;return this.float32[n+0]=t,this.float32[n+1]=i,e}}Ia.prototype.bytesPerElement=8,Gr(Ia,"StructArrayLayout2f8");class ka extends ia{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ka.prototype.size=40;class za extends _a{get(e){return new ka(this,e)}}Gr(za,"CollisionBoxArray");class Da extends ia{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Da.prototype.size=60;class La extends Ma{get(e){return new Da(this,e)}}Gr(La,"PlacedSymbolArray");class Ra extends ia{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Ra.prototype.size=76;class Oa extends Ta{get(e){return new Ra(this,e)}}Gr(Oa,"SymbolInstanceArray");class Ba extends Sa{getoffsetX(e){return this.float32[1*e+0]}}Gr(Ba,"GlyphOffsetArray");class Fa extends aa{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Gr(Fa,"SymbolLineVertexArray");class Na extends ia{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Na.prototype.size=12;class Ua extends Ca{get(e){return new Na(this,e)}}Gr(Ua,"FeatureIndexArray");class Va extends Aa{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Gr(Va,"FillExtrusionCentroidArray");const Ga=ra([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ja=ra([{name:"a_dash",components:4,type:"Uint16"}]);var Wa={},$a={get exports(){return Wa},set exports(e){Wa=e}},qa={};({get exports(){return qa},set exports(e){qa=e}}).exports=function(e,t){var i,n,r,o,a,s,l,c;for(n=e.length-(i=3&e.length),r=t,a=3432918353,s=461845907,c=0;c<n;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,r=27492+(65535&(o=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0};var Za={};({get exports(){return Za},set exports(e){Za=e}}).exports=function(e,t){for(var i,n=e.length,r=t^n,o=0;n>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),n-=4,++o;switch(n){case 3:r^=(255&e.charCodeAt(o+2))<<16;case 2:r^=(255&e.charCodeAt(o+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(o)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0};var Ha=qa,Xa=Za;$a.exports=Ha,Wa.murmur3=Ha,Wa.murmur2=Xa;class Ya{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,i,n){this.ids.push(Ja(e)),this.positions.push(t,i,n)}getPositions(e){const t=Ja(e);let i=0,n=this.ids.length-1;for(;i<n;){const e=i+n>>1;this.ids[e]>=t?n=e:i=e+1}const r=[];for(;this.ids[i]===t;)r.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return r}static serialize(e,t){const i=new Float64Array(e.ids),n=new Uint32Array(e.positions);return Ka(i,n,0,i.length-1),t&&t.push(i.buffer,n.buffer),{ids:i,positions:n}}static deserialize(e){const t=new Ya;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function Ja(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Wa(String(e))}function Ka(e,t,i,n){for(;i<n;){const r=e[i+n>>1];let o=i-1,a=n+1;for(;;){do{o++}while(e[o]<r);do{a--}while(e[a]>r);if(o>=a)break;Qa(e,o,a),Qa(t,3*o,3*a),Qa(t,3*o+1,3*a+1),Qa(t,3*o+2,3*a+2)}a-i<n-a?(Ka(e,t,i,a),i=a+1):(Ka(e,t,a+1,n),n=a)}}function Qa(e,t,i){const n=e[t];e[t]=e[i],e[i]=n}Gr(Ya,"FeaturePositionMap");class es{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class ts extends es{constructor(e){super(e),this.current=0}set(e,t,i){this.fetchUniformLocation(e,t)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class is extends es{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class ns extends es{constructor(e){super(e),this.current=Ct.transparent}set(e,t,i){this.fetchUniformLocation(e,t)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}const rs=new Float32Array(16),os=new Float32Array(9),as=new Float32Array(4);function ss(e){return[ea(255*e.r,255*e.g),ea(255*e.b,255*e.a)]}class ls{constructor(e,t,i){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=i}setUniform(e,t,i,n,r){t.set(e,r,n.constantOr(this.value))}getBinding(e,t){return"color"===this.type?new ns(e):new ts(e)}}class cs{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,t,i,n,r){const o="u_pattern"===r||"u_dash"===r?this.pattern:"u_pixel_ratio"===r?this.pixelRatio:null;o&&t.set(e,r,o)}getBinding(e,t){return"u_pattern"===t||"u_dash"===t?new is(e):new ts(e)}}class us{constructor(e,t,i,n){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new n}populatePaintArray(e,t,i,n,r,o){const a=this.paintVertexArray.length,s=this.expression.evaluate(new Vo(0),t,{},r,n,o);this.paintVertexArray.resize(e),this._setPaintValue(a,e,s)}updatePaintArray(e,t,i,n,r){const o=this.expression.evaluate({zoom:0},i,n,void 0,r);this._setPaintValue(e,t,o)}_setPaintValue(e,t,i){if("color"===this.type){const n=ss(i);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n[0],n[1])}else{for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class hs{constructor(e,t,i,n,r,o){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=i,this.useIntegerZoom=n,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(e,t,i,n,r,o){const a=this.expression.evaluate(new Vo(this.zoom),t,{},r,n,o),s=this.expression.evaluate(new Vo(this.zoom+1),t,{},r,n,o),l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(l,e,a,s)}updatePaintArray(e,t,i,n,r){const o=this.expression.evaluate({zoom:this.zoom},i,n,void 0,r),a=this.expression.evaluate({zoom:this.zoom+1},i,n,void 0,r);this._setPaintValue(e,t,o,a)}_setPaintValue(e,t,i,n){if("color"===this.type){const r=ss(i),o=ss(n);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r[0],r[1],o[0],o[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i,n);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,i,n,r){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,a=T(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(e,r,a)}getBinding(e,t){return new ts(e)}}class ds{constructor(e,t,i,n,r){this.expression=e,this.layerId=r,this.paintVertexAttributes=("array"===i?ja:Ga).members;for(let e=0;e<t.length;++e);this.paintVertexArray=new n}populatePaintArray(e,t,i){const n=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(n,e,t.patterns&&t.patterns[this.layerId],i)}updatePaintArray(e,t,i,n,r,o){this._setPaintValues(e,t,i.patterns&&i.patterns[this.layerId],o)}_setPaintValues(e,t,i,n){if(!n||!i)return;const r=n[i];if(!r)return;const{tl:o,br:a,pixelRatio:s}=r;for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,o[0],o[1],a[0],a[1],s)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ps{constructor(e,t,i=(()=>!0)){this.binders={},this._buffers=[];const n=[];for(const r in e.paint._values){if(!i(r))continue;const o=e.paint.get(r);if(!(o instanceof Ho&&kn(o.property.specification)))continue;const a=gs(r,e.type),s=o.value,l=o.property.specification.type,c=o.property.useIntegerZoom,u="line-dasharray"===r||r.endsWith("pattern"),h="line-dasharray"===r&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==s.kind||h)if("source"===s.kind||h||u){const t=xs(r,l,"source");this.binders[r]=u?new ds(s,a,l,t,e.id):new us(s,a,l,t),n.push(`/a_${r}`)}else{const e=xs(r,l,"composite");this.binders[r]=new hs(s,a,l,c,t,e),n.push(`/z_${r}`)}else this.binders[r]=u?new cs(s.value,a):new ls(s.value,a,l),n.push(`/u_${r}`)}this.cacheKey=n.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof us||t instanceof hs?t.maxValue:0}populatePaintArrays(e,t,i,n,r,o){for(const a in this.binders){const s=this.binders[a];(s instanceof us||s instanceof hs||s instanceof ds)&&s.populatePaintArray(e,t,i,n,r,o)}}setConstantPatternPositions(e){for(const t in this.binders){const i=this.binders[t];i instanceof cs&&i.setConstantPatternPositions(e)}}updatePaintArrays(e,t,i,n,r,o){let a=!1;for(const s in e){const l=t.getPositions(s);for(const t of l){const l=i.feature(t.index);for(const i in this.binders){const c=this.binders[i];if((c instanceof us||c instanceof hs||c instanceof ds)&&!0===c.expression.isStateDependent){const u=n.paint.get(i);c.expression=u.value,c.updatePaintArray(t.start,t.end,l,e[s],r,o),a=!0}}}}return a}defines(){const e=[];for(const t in this.binders){const i=this.binders[t];(i instanceof ls||i instanceof cs)&&e.push(...i.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof us||i instanceof hs||i instanceof ds)for(let t=0;t<i.paintVertexAttributes.length;t++)e.push(i.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof ls||i instanceof cs||i instanceof hs)for(const t of i.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const i in this.binders){const n=this.binders[i];if(n instanceof ls||n instanceof cs||n instanceof hs)for(const r of n.uniformNames)t.push({name:r,property:i,binding:n.getBinding(e,r)})}return t}setUniforms(e,t,i,n,r){for(const{name:t,property:o,binding:a}of i)this.binders[o].setUniform(e,a,r,n.get(o),t)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof us||t instanceof hs||t instanceof ds)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer)}}upload(e){for(const t in this.binders){const i=this.binders[t];(i instanceof us||i instanceof hs||i instanceof ds)&&i.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof us||t instanceof hs||t instanceof ds)&&t.destroy()}}}class fs{constructor(e,t,i=(()=>!0)){this.programConfigurations={};for(const n of e)this.programConfigurations[n.id]=new ps(n,t,i);this.needsUpload=!1,this._featureMap=new Ya,this._bufferOffset=0}populatePaintArrays(e,t,i,n,r,o,a){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(e,t,n,r,o,a);void 0!==t.id&&this._featureMap.add(t.id,i,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,i,n,r){for(const o of i)this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(e,this._featureMap,t,o,n,r)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const ms={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function gs(e,t){return ms[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const _s={"line-pattern":{source:ha,composite:ha},"fill-pattern":{source:ha,composite:ha},"fill-extrusion-pattern":{source:ha,composite:ha},"line-dasharray":{source:da,composite:da}},ys={color:{source:Ia,composite:ua},number:{source:Sa,composite:Ia}};function xs(e,t,i){const n=_s[e];return n&&n[i]||ys[t][i]}Gr(ls,"ConstantBinder"),Gr(cs,"PatternConstantBinder"),Gr(us,"SourceExpressionBinder"),Gr(ds,"PatternCompositeBinder"),Gr(hs,"CompositeExpressionBinder"),Gr(ps,"ProgramConfiguration",{omit:["_buffers"]}),Gr(fs,"ProgramConfigurationSet");const vs="-transition";class bs extends Xe{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new Zo(t.layout)),t.paint)){this._transitionablePaint=new Wo(t.paint);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Xo(t.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,i={}){null!=t&&this._validate(Or,`layers.${this.id}.layout.${e}`,e,t,i)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return O(e,vs)?this._transitionablePaint.getTransition(e.slice(0,-vs.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,i={}){if(null!=t&&this._validate(Rr,`layers.${this.id}.paint.${e}`,e,t,i))return!1;if(O(e,vs))return this._transitionablePaint.setTransition(e.slice(0,-vs.length),t||void 0),!1;{const i=this._transitionablePaint._values[e],n=i.value.isDataDriven(),r=i.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const o=this._transitionablePaint._values[e].value,a=o.isDataDriven(),s=O(e,"pattern")||"line-dasharray"===e;return a||n||s||this._handleOverridablePaintPropertyUpdate(e,r,o)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,i){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),F(e,((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}_validate(e,t,i,n,r={}){return(!r||!1!==r.validate)&&Fr(this,e.call(Lr,{key:t,layerType:this.type,objectKey:i,value:n,styleSpec:Ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Ho&&kn(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ar(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const ws=ra([{name:"a_pos",components:2,type:"Int16"}],4),Ms=ra([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ts{constructor(e=[]){this.segments=e}prepareSegment(e,t,i,n){let r=this.segments[this.segments.length-1];return e>Ts.MAX_VERTEX_ARRAY_LENGTH&&V(`Max vertices per segment is ${Ts.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!r||r.vertexLength+e>Ts.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==n)&&(r={vertexOffset:t.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},void 0!==n&&(r.sortKey=n),this.segments.push(r)),r}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,i,n){return new Ts([{vertexOffset:e,primitiveOffset:t,vertexLength:i,primitiveLength:n,vaos:{},sortKey:0}])}}Ts.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Gr(Ts,"SegmentVector");var Ss=8192;class Es{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ic?new ic(e.lng,e.lat):ic.convert(e),this}setSouthWest(e){return this._sw=e instanceof ic?new ic(e.lng,e.lat):ic.convert(e),this}extend(e){const t=this._sw,i=this._ne;let n,r;if(e instanceof ic)n=e,r=e;else{if(!(e instanceof Es))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Es.convert(e)):this.extend(ic.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(ic.convert(e)):this;if(n=e._sw,r=e._ne,!n||!r)return this}return t||i?(t.lng=Math.min(n.lng,t.lng),t.lat=Math.min(n.lat,t.lat),i.lng=Math.max(r.lng,i.lng),i.lat=Math.max(r.lat,i.lat)):(this._sw=new ic(n.lng,n.lat),this._ne=new ic(r.lng,r.lat)),this}getCenter(){return new ic((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ic(this.getWest(),this.getNorth())}getSouthEast(){return new ic(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:i}=ic.convert(e);let n=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&n}static convert(e){return!e||e instanceof Es?e:new Es(e)}}var Cs=1e-6,As="undefined"!=typeof Float32Array?Float32Array:Array;function Ps(){var e=new As(9);return As!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Is(e,t,i){var n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=i[0],p=i[1],f=i[2],m=i[3],g=i[4],_=i[5],y=i[6],x=i[7],v=i[8];return e[0]=d*n+p*a+f*c,e[1]=d*r+p*s+f*u,e[2]=d*o+p*l+f*h,e[3]=m*n+g*a+_*c,e[4]=m*r+g*s+_*u,e[5]=m*o+g*l+_*h,e[6]=y*n+x*a+v*c,e[7]=y*r+x*s+v*u,e[8]=y*o+x*l+v*h,e}function ks(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function zs(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],y=i*s-n*a,x=i*l-r*a,v=i*c-o*a,b=n*l-r*s,w=n*c-o*s,M=r*c-o*l,T=u*m-h*f,S=u*g-d*f,E=u*_-p*f,C=h*g-d*m,A=h*_-p*m,P=d*_-p*g,I=y*P-x*A+v*C+b*E-w*S+M*T;return I?(e[0]=(s*P-l*A+c*C)*(I=1/I),e[1]=(r*A-n*P-o*C)*I,e[2]=(m*M-g*w+_*b)*I,e[3]=(d*w-h*M-p*b)*I,e[4]=(l*E-a*P-c*S)*I,e[5]=(i*P-r*E+o*S)*I,e[6]=(g*v-f*M-_*x)*I,e[7]=(u*M-d*v+p*x)*I,e[8]=(a*A-s*E+c*T)*I,e[9]=(n*E-i*A-o*T)*I,e[10]=(f*w-m*v+_*y)*I,e[11]=(h*v-u*w-p*y)*I,e[12]=(s*S-a*C-l*T)*I,e[13]=(i*C-n*S+r*T)*I,e[14]=(m*x-f*b-g*y)*I,e[15]=(u*b-h*x+d*y)*I,e):null}function Ds(e,t,i){var n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],_=t[14],y=t[15],x=i[0],v=i[1],b=i[2],w=i[3];return e[0]=x*n+v*s+b*h+w*m,e[1]=x*r+v*l+b*d+w*g,e[2]=x*o+v*c+b*p+w*_,e[3]=x*a+v*u+b*f+w*y,e[4]=(x=i[4])*n+(v=i[5])*s+(b=i[6])*h+(w=i[7])*m,e[5]=x*r+v*l+b*d+w*g,e[6]=x*o+v*c+b*p+w*_,e[7]=x*a+v*u+b*f+w*y,e[8]=(x=i[8])*n+(v=i[9])*s+(b=i[10])*h+(w=i[11])*m,e[9]=x*r+v*l+b*d+w*g,e[10]=x*o+v*c+b*p+w*_,e[11]=x*a+v*u+b*f+w*y,e[12]=(x=i[12])*n+(v=i[13])*s+(b=i[14])*h+(w=i[15])*m,e[13]=x*r+v*l+b*d+w*g,e[14]=x*o+v*c+b*p+w*_,e[15]=x*a+v*u+b*f+w*y,e}function Ls(e,t,i){var n,r,o,a,s,l,c,u,h,d,p,f,m=i[0],g=i[1],_=i[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*_+t[12],e[13]=t[1]*m+t[5]*g+t[9]*_+t[13],e[14]=t[2]*m+t[6]*g+t[10]*_+t[14],e[15]=t[3]*m+t[7]*g+t[11]*_+t[15]):(r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=n=t[0],e[1]=r,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=n*m+s*g+h*_+t[12],e[13]=r*m+l*g+d*_+t[13],e[14]=o*m+c*g+p*_+t[14],e[15]=a*m+u*g+f*_+t[15]),e}function Rs(e,t,i){var n=i[0],r=i[1],o=i[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Os(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[4],a=t[5],s=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*r+c*n,e[5]=a*r+u*n,e[6]=s*r+h*n,e[7]=l*r+d*n,e[8]=c*r-o*n,e[9]=u*r-a*n,e[10]=h*r-s*n,e[11]=d*r-l*n,e}function Bs(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[0],a=t[1],s=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r-c*n,e[1]=a*r-u*n,e[2]=s*r-h*n,e[3]=l*r-d*n,e[8]=o*n+c*r,e[9]=a*n+u*r,e[10]=s*n+h*r,e[11]=l*n+d*r,e}function Fs(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ns(e,t,i){var n,r,o,a=i[0],s=i[1],l=i[2],c=Math.hypot(a,s,l);return c<Cs?null:(a*=c=1/c,s*=c,l*=c,n=Math.sin(t),r=Math.cos(t),e[0]=a*a*(o=1-r)+r,e[1]=s*a*o+l*n,e[2]=l*a*o-s*n,e[3]=0,e[4]=a*s*o-l*n,e[5]=s*s*o+r,e[6]=l*s*o+a*n,e[7]=0,e[8]=a*l*o+s*n,e[9]=s*l*o-a*n,e[10]=l*l*o+r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Us=Ds;function Vs(){var e=new As(3);return As!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Gs(e){var t=new As(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function js(e){return Math.hypot(e[0],e[1],e[2])}function Ws(e,t,i){var n=new As(3);return n[0]=e,n[1]=t,n[2]=i,n}function $s(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function qs(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function Zs(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function Hs(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function Xs(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e}function Ys(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function Js(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e}function Ks(e,t){var i=t[0],n=t[1],r=t[2],o=i*i+n*n+r*r;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function Qs(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function el(e,t,i){var n=t[0],r=t[1],o=t[2],a=i[0],s=i[1],l=i[2];return e[0]=r*l-o*s,e[1]=o*a-n*l,e[2]=n*s-r*a,e}function tl(e,t,i){var n=t[0],r=t[1],o=t[2],a=i[3]*n+i[7]*r+i[11]*o+i[15];return e[0]=(i[0]*n+i[4]*r+i[8]*o+i[12])/(a=a||1),e[1]=(i[1]*n+i[5]*r+i[9]*o+i[13])/a,e[2]=(i[2]*n+i[6]*r+i[10]*o+i[14])/a,e}function il(e,t,i){var n=i[0],r=i[1],o=i[2],a=t[0],s=t[1],l=t[2],c=r*l-o*s,u=o*a-n*l,h=n*s-r*a,d=r*h-o*u,p=o*c-n*h,f=n*u-r*c,m=2*i[3];return u*=m,h*=m,p*=2,f*=2,e[0]=a+(c*=m)+(d*=2),e[1]=s+u+p,e[2]=l+h+f,e}var nl,rl=qs,ol=Zs,al=js;function sl(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function ll(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=i*i+n*n+r*r+o*o;return a>0&&(a=1/Math.sqrt(a)),e[0]=i*a,e[1]=n*a,e[2]=r*a,e[3]=o*a,e}function cl(e,t,i){var n=t[0],r=t[1],o=t[2],a=t[3];return e[0]=i[0]*n+i[4]*r+i[8]*o+i[12]*a,e[1]=i[1]*n+i[5]*r+i[9]*o+i[13]*a,e[2]=i[2]*n+i[6]*r+i[10]*o+i[14]*a,e[3]=i[3]*n+i[7]*r+i[11]*o+i[15]*a,e}function ul(){var e=new As(4);return As!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function hl(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function dl(e,t,i){i*=.5;var n=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(i),l=Math.cos(i);return e[0]=n*l+a*s,e[1]=r*l+o*s,e[2]=o*l-r*s,e[3]=a*l-n*s,e}function pl(e,t,i){i*=.5;var n=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(i),l=Math.cos(i);return e[0]=n*l-o*s,e[1]=r*l+a*s,e[2]=o*l+n*s,e[3]=a*l-r*s,e}Vs(),nl=new As(4),As!=Float32Array&&(nl[0]=0,nl[1]=0,nl[2]=0,nl[3]=0);var fl=ll;Vs(),Ws(1,0,0),Ws(0,1,0),ul(),ul(),Ps();const ml=ra([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:gl}=ml,_l=ra([{name:"a_pos_3",components:3,type:"Int16"}]);var yl=ra([{name:"a_pos",type:"Int16",components:2}]);class xl{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,i){const n=Qs(t,this.dir);if(Math.abs(n)<1e-6)return!1;const r=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/n;return i[0]=this.pos[0]+this.dir[0]*r,i[1]=this.pos[1]+this.dir[1]*r,i[2]=this.pos[2]+this.dir[2]*r,!0}closestPointOnSphere(e,t,i){if(function(e,t){var i=e[0],n=e[1],r=e[2],o=t[0],a=t[1],s=t[2];return Math.abs(i-o)<=Cs*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-a)<=Cs*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=Cs*Math.max(1,Math.abs(r),Math.abs(s))}(this.pos,e)||0===t)return i[0]=i[1]=i[2]=0,!1;const[n,r,o]=this.dir,a=this.pos[0]-e[0],s=this.pos[1]-e[1],l=this.pos[2]-e[2],c=n*n+r*r+o*o,u=2*(a*n+s*r+l*o),h=u*u-4*c*(a*a+s*s+l*l-t*t);if(h<0){const e=Math.max(-u/2,0),c=a+n*e,h=s+r*e,d=l+o*e,p=Math.hypot(c,h,d);return i[0]=c*t/p,i[1]=h*t/p,i[2]=d*t/p,!1}{const e=(-u-Math.sqrt(h))/(2*c);if(e<0){const e=Math.hypot(a,s,l);return i[0]=a*t/e,i[1]=s*t/e,i[2]=l*t/e,!1}return i[0]=a+n*e,i[1]=s+r*e,i[2]=l+o*e,!0}}}class vl{constructor(e,t,i,n,r){this.TL=e,this.TR=t,this.BR=i,this.BL=n,this.horizon=r}static fromInvProjectionMatrix(e,t,i){const n=[-1,1,1],r=[1,1,1],o=[1,-1,1],a=[-1,-1,1],s=tl(n,n,e),l=tl(r,r,e),c=tl(o,o,e),u=tl(a,a,e);return new vl(s,l,c,u,t/i)}}class bl{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(e,t,i,n){const r=Math.pow(2,i),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((i=>{const o=cl([],i,e),a=1/o[3]/t*r;return function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}(o,o,[a,a,n?1/o[3]:a,a])})),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((e=>{const t=Ks([],el([],rl([],o[e[0]],o[e[1]]),rl([],o[e[2]],o[e[1]]))),i=-Qs(t,o[e[1]]);return t.concat(i)}));return new bl(o,a)}}class wl{static fromPoints(e){const t=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0];for(const n of e)Hs(t,t,n),Xs(i,i,n);return new wl(t,i)}static applyTransform(e,t){const i=e.getCorners();for(let e=0;e<i.length;++e)tl(i[e],i[e],t);return wl.fromPoints(i)}constructor(e,t){this.min=e,this.max=t,this.center=Ys([],$s([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],i=Gs(this.min),n=Gs(this.max);for(let e=0;e<t.length;e++)i[e]=t[e]?this.min[e]:this.center[e],n[e]=t[e]?this.center[e]:this.max[e];return n[2]=this.max[2],new wl(i,n)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){const t=this.getCorners();let i=!0;for(let n=0;n<e.planes.length;n++){const r=e.planes[n];let o=0;for(let e=0;e<t.length;e++)o+=Qs(r,t[e])+r[3]>=0;if(0===o)return 0;o!==t.length&&(i=!1)}if(i)return 2;for(let t=0;t<3;t++){let i=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let r=0;r<e.points.length;r++){const o=e.points[r][t]-this.min[t];i=Math.min(i,o),n=Math.max(n,o)}if(n<0||i>this.max[t]-this.min[t])return 0}return 1}}const Ml=Ss/Math.PI/2,Tl=64,Sl=[Tl,32,16],El=-Ml,Cl=Ml,Al=[new wl([El,El,El],[Cl,Cl,Cl]),new wl([El,El,El],[0,0,Cl]),new wl([0,El,El],[Cl,0,Cl]),new wl([El,0,El],[0,Cl,Cl]),new wl([0,0,El],[Cl,Cl,Cl])];function Pl(e){return e*Ml/ec}function Il(e,t,i,n=!0){const r=Ys([],e._camera.position,e.worldSize),o=[t,i,1,1];cl(o,o,e.pixelMatrixInverse),sl(o,o,1/o[3]);const a=Ks([],rl([],o,r)),s=e.globeMatrix,l=[s[12],s[13],s[14]],c=rl([],l,r),u=js(c),h=Ks([],c),d=e.worldSize/(2*Math.PI),p=Qs(h,a),f=Math.asin(d/u);if(f<Math.acos(p)){if(!n)return null;const e=[],t=[];Ys(e,a,u/p),Ks(t,rl(t,e,c)),Ks(a,$s(a,c,Ys(a,t,Math.tan(f)*u)))}const m=[];new xl(r,a).closestPointOnSphere(l,d,m);const g=Ks([],X(s,0)),_=Ks([],X(s,1)),y=Ks([],X(s,2)),v=Qs(g,m),b=Qs(_,m),w=Qs(y,m),M=x(Math.asin(-b/d));let S=x(Math.atan2(v,w));S=e.center.lng+function(e,t){const i=(t-e+180)%360-180;return i<-180?i+360:i}(e.center.lng,S);const E=rc(S),C=T(oc(M),0,1);return new dc(E,C)}class kl{constructor(e,t,i){this.a=rl([],e,i),this.b=rl([],t,i),this.center=i;const n=Ks([],this.a),r=Ks([],this.b);this.angle=Math.acos(Qs(n,r))}}function zl(e,t){if(0===e.angle)return null;let i;return i=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),i<0||i>1?null:function(e,t,i,n){const r=Math.sin(i);return e*(Math.sin((1-n)*i)/r)+t*(Math.sin(n*i)/r)}(e.a[t],e.b[t],e.angle,T(i,0,1))+e.center[t]}function Dl(e){if(e.z<=1)return Al[e.z+2*e.y+e.x];const t=Nl(Fl(e));return wl.fromPoints(t)}function Ll(e,t,i){return Ys(e,e,1-i),Js(e,e,t,i)}function Rl(e,t){const i=Hl(t.zoom);if(0===i)return Dl(e);const n=Fl(e),r=Nl(n),o=rc(n.getWest())*t.worldSize,a=rc(n.getEast())*t.worldSize,s=oc(n.getNorth())*t.worldSize,l=oc(n.getSouth())*t.worldSize,c=[o,s,0],u=[a,s,0],h=[o,l,0],d=[a,l,0],p=zs([],t.globeMatrix);return tl(c,c,p),tl(u,u,p),tl(h,h,p),tl(d,d,p),r[0]=Ll(r[0],h,i),r[1]=Ll(r[1],d,i),r[2]=Ll(r[2],u,i),r[3]=Ll(r[3],c,i),wl.fromPoints(r)}function Ol(e,t,i){for(const n of e)tl(n,n,t),Ys(n,n,i)}function Bl(e,t,i){const n=t/e.worldSize,r=e.globeMatrix;if(i.z<=1){const e=Dl(i).getCorners();return Ol(e,r,n),wl.fromPoints(e)}const o=Fl(i),a=Nl(o);Ol(a,r,n);const s=Number.MAX_VALUE,l=[-s,-s,-s],c=[s,s,s];if(o.contains(e.center)){for(const e of a)Hs(c,c,e),Xs(l,l,e);l[2]=0;const t=e.point,i=[t.x*n,t.y*n,0];return Hs(c,c,i),Xs(l,l,i),new wl(c,l)}const u=[r[12]*n,r[13]*n,r[14]*n],h=o.getCenter(),d=T(e.center.lat,-uc,uc),p=T(h.lat,-uc,uc),f=rc(e.center.lng),m=oc(d);let g=f-rc(h.lng);const _=m-oc(p);g>.5?g-=1:g<-.5&&(g+=1);let x=0;Math.abs(g)>Math.abs(_)?x=g>=0?1:3:(x=_>=0?0:2,Js(u,u,[r[4]*n,r[5]*n,r[6]*n],-Math.sin(y(_>=0?o.getSouth():o.getNorth()))*Ml));const v=a[x],b=a[(x+1)%4],w=new kl(v,b,u),M=[zl(w,0)||v[0],zl(w,1)||v[1],zl(w,2)||v[2]],S=Hl(e.zoom);if(S>0){const n=function({x:e,y:t,z:i},n,r,o,a){const s=1/(1<<i);let l=e*s,c=l+s,u=t*s,h=u+s,d=0;const p=(l+c)/2-o;return p>.5?d=-1:p<-.5&&(d=1),l=((l+d)*n-(o*=n))*r+o,c=((c+d)*n-o)*r+o,u=(u*n-(a*=n))*r+a,h=(h*n-a)*r+a,[[l,h,0],[c,h,0],[c,u,0],[l,u,0]]}(i,t,e._pixelsPerMercatorPixel,f,m);for(let e=0;e<a.length;e++)Ll(a[e],n[e],S);const r=$s([],n[x],n[(x+1)%4]);Ys(r,r,.5),Ll(M,r,S)}for(const e of a)Hs(c,c,e),Xs(l,l,e);return c[2]=Math.min(v[2],b[2]),Hs(c,c,M),Xs(l,l,M),new wl(c,l)}function Fl({x:e,y:t,z:i}){const n=1/(1<<i),r=new ic(sc(e*n),lc((t+1)*n)),o=new ic(sc((e+1)*n),lc(t*n));return new Es(r,o)}function Nl(e){const t=y(e.getNorth()),i=y(e.getSouth()),n=Math.cos(t),r=Math.cos(i),o=Math.sin(t),a=Math.sin(i),s=e.getWest(),l=e.getEast();return[Ul(r,a,s),Ul(r,a,l),Ul(n,o,l),Ul(n,o,s)]}function Ul(e,t,i,n=Ml){return i=y(i),[e*Math.sin(i)*n,-t*n,e*Math.cos(i)*n]}function Vl(e,t,i){return Ul(Math.cos(y(e)),Math.sin(y(e)),t,i)}function Gl(e,t,i,n){const r=1<<i.z,o=(e/Ss+i.x)/r;return Vl(lc((t/Ss+i.y)/r),sc(o),n)}function jl({min:e,max:t}){return 16383/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}const Wl=new Float64Array(16);function $l(e){const t=jl(e),i=Fs(Wl,[t,t,t]);return Ls(i,i,((n=[])[0]=-(r=e.min)[0],n[1]=-r[1],n[2]=-r[2],n));var n,r}function ql(e){const t=(n=e.min,(i=Wl)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i);var i,n;const r=1/jl(e);return Rs(t,t,[r,r,r])}function Zl(e,t,i,n,r){const o=function(e){const t=Ss/(2*Math.PI);return e/(2*Math.PI)/t}(i),a=[e,t,-i/(2*Math.PI)],s=ks(new Float64Array(16));return Ls(s,s,a),Rs(s,s,[o,o,o]),Os(s,s,y(-r)),Bs(s,s,y(-n)),s}function Hl(e){return S(5,6,e)}function Xl(e,t){const i=Vl(t.lat,t.lng),n=function(e){const t=Vl(e._center.lat,e._center.lng);let i=el([],Ws(0,1,0),t);const n=Ns([],-e.angle,t);i=tl(i,i,n),Ns(n,-e._pitch,i);const r=Ks([],t);return Ys(r,r,Pl(e.cameraToCenterDistance/e.pixelsPerMeter)),tl(r,r,n),$s([],t,r)}(e);return a=(r=qs([],n,i))[0],s=r[1],l=r[2],c=(o=i)[0],u=o[1],h=o[2],p=(d=Math.sqrt(a*a+s*s+l*l)*Math.sqrt(c*c+u*u+h*h))&&Qs(r,o)/d,Math.acos(Math.min(Math.max(p,-1),1));var r,o,a,s,l,c,u,h,d,p}function Yl(e,t){return Xl(e,t)>Math.PI/2*1.01}const Jl=y(85),Kl=Math.cos(Jl),Ql=Math.sin(Jl),ec=6371008.8,tc=2*Math.PI*ec;class ic{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ic(E(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,i=this.lat*t,n=e.lat*t,r=Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos((e.lng-this.lng)*t);return ec*Math.acos(Math.min(r,1))}toBounds(e=0){const t=360*e/40075017,i=t/Math.cos(Math.PI/180*this.lat);return new Es(new ic(this.lng-i,this.lat-t),new ic(this.lng+i,this.lat+t))}toEcef(e){const t=Pl(e);return Vl(this.lat,this.lng,Ml+t)}static convert(e){if(e instanceof ic)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new ic(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new ic(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}function nc(e){return tc*Math.cos(e*Math.PI/180)}function rc(e){return(180+e)/360}function oc(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function ac(e,t){return e/nc(t)}function sc(e){return 360*e-180}function lc(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function cc(e,t){return e*nc(lc(t))}const uc=85.051129;function hc(e){return 1/Math.cos(e*Math.PI/180)}class dc{constructor(e,t,i=0){this.x=+e,this.y=+t,this.z=+i}static fromLngLat(e,t=0){const i=ic.convert(e);return new dc(rc(i.lng),oc(i.lat),ac(t,i.lat))}toLngLat(){return new ic(sc(this.x),lc(this.y))}toAltitude(){return cc(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/tc*hc(lc(this.y))}}function pc(e,t,i,n,r,o,a,s,l){const c=(t+n)/2,u=(i+r)/2,h=new f(c,u);s(h),function(e,t,i,n,r,o){const a=i-r,s=n-o;return Math.abs((n-t)*a-(i-e)*s)/Math.hypot(a,s)}(h.x,h.y,o.x,o.y,a.x,a.y)>=l?(pc(e,t,i,c,u,o,h,s,l),pc(e,c,u,n,r,h,a,s,l)):e.push(a)}function fc(e,t,i){let n=e[0],r=n.x,o=n.y;t(n);const a=[n];for(let s=1;s<e.length;s++){const l=e[s],{x:c,y:u}=l;t(l),pc(a,r,o,c,u,n,l,t,i),r=c,o=u,n=l}return a}function mc(e,t,i,n){if(n(t,i)){const r=t.add(i)._mult(.5);mc(e,t,r,n),mc(e,r,i,n)}else e.push(i)}function gc(e,t){let i=e[0];const n=[i];for(let r=1;r<e.length;r++){const o=e[r];mc(n,i,o,t),i=o}return n}const _c=Math.pow(2,14)-1,yc=-_c-1;function xc(e,t){const i=Math.round(e.x*t),n=Math.round(e.y*t);return e.x=T(i,yc,_c),e.y=T(n,yc,_c),(i<e.x||i>e.x+1||n<e.y||n>e.y+1)&&V("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function vc(e,t,i){const n=e.loadGeometry(),r=e.extent,o=Ss/r;if(t&&i&&i.projection.isReprojectedInTileSpace){const o=1<<t.z,{scale:a,x:s,y:l,projection:c}=i,u=e=>{const i=sc((t.x+e.x/r)/o),n=lc((t.y+e.y/r)/o),u=c.project(i,n);e.x=(u.x*a-s)*r,e.y=(u.y*a-l)*r};for(let t=0;t<n.length;t++)if(1!==e.type)n[t]=fc(n[t],u,1);else{const e=[];for(const i of n[t])i.x<0||i.x>=r||i.y<0||i.y>=r||(u(i),e.push(i));n[t]=e}}for(const e of n)for(const t of e)xc(t,o);return n}function bc(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?vc(e):[]}}function wc(e,t,i,n,r){e.emplaceBack(2*t+(n+1)/2,2*i+(r+1)/2)}function Mc(e,t,i){const n=16384;e.emplaceBack(t.x,t.y,t.z,i[0]*n,i[1]*n,i[2]*n)}class Tc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new aa,this.indexArray=new wa,this.segments=new Ts,this.programConfigurations=new fs(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i,n){const r=this.layers[0],o=[];let a=null;"circle"===r.type&&(a=r.layout.get("circle-sort-key"));for(const{feature:t,id:r,index:s,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=bc(t,e);if(!this.layers[0]._featureFilter.filter(new Vo(this.zoom),c,i))continue;const u=a?a.evaluate(c,{},i):void 0,h={id:r,properties:t.properties,type:t.type,sourceLayerIndex:l,index:s,geometry:e?c.geometry:vc(t,i,n),patterns:{},sortKey:u};o.push(h)}a&&o.sort(((e,t)=>e.sortKey-t.sortKey));let s=null;"globe"===n.projection.name&&(this.globeExtVertexArray=new pa,s=n.projection);for(const n of o){const{geometry:r,index:o,sourceLayerIndex:a}=n,l=e[o].feature;this.addFeature(n,r,o,t.availableImages,i,s),t.featureIndex.insert(l,r,o,a,this.index)}}update(e,t,i,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ws.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Ms.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,i,n,r,o){for(const i of t)for(const t of i){const i=t.x,n=t.y;if(i<0||i>=Ss||n<0||n>=Ss)continue;if(o){const e=o.projectTilePoint(i,n,r),t=o.upVector(r,i,n),a=this.globeExtVertexArray;Mc(a,e,t),Mc(a,e,t),Mc(a,e,t),Mc(a,e,t)}const a=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),s=a.vertexLength;wc(this.layoutVertexArray,i,n,-1,-1),wc(this.layoutVertexArray,i,n,1,-1),wc(this.layoutVertexArray,i,n,1,1),wc(this.layoutVertexArray,i,n,-1,1),this.indexArray.emplaceBack(s,s+1,s+2),this.indexArray.emplaceBack(s,s+2,s+3),a.vertexLength+=4,a.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},n,r)}}function Sc(e,t){for(let i=0;i<e.length;i++)if(Lc(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(Lc(e,t[i]))return!0;return!!Pc(e,t)}function Ec(e,t,i){return!!Lc(e,t)||!!kc(t,e,i)}function Cc(e,t){if(1===e.length)return Dc(t,e[0]);for(let i=0;i<t.length;i++){const n=t[i];for(let t=0;t<n.length;t++)if(Lc(e,n[t]))return!0}for(let i=0;i<e.length;i++)if(Dc(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(Pc(e,t[i]))return!0;return!1}function Ac(e,t,i){if(e.length>1){if(Pc(e,t))return!0;for(let n=0;n<t.length;n++)if(kc(t[n],e,i))return!0}for(let n=0;n<e.length;n++)if(kc(e[n],t,i))return!0;return!1}function Pc(e,t){if(0===e.length||0===t.length)return!1;for(let i=0;i<e.length-1;i++){const n=e[i],r=e[i+1];for(let e=0;e<t.length-1;e++)if(Ic(n,r,t[e],t[e+1]))return!0}return!1}function Ic(e,t,i,n){return G(e,i,n)!==G(t,i,n)&&G(e,t,i)!==G(e,t,n)}function kc(e,t,i){const n=i*i;if(1===t.length)return e.distSqr(t[0])<n;for(let i=1;i<t.length;i++)if(zc(e,t[i-1],t[i])<n)return!0;return!1}function zc(e,t,i){const n=t.distSqr(i);if(0===n)return e.distSqr(t);const r=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/n;return e.distSqr(r<0?t:r>1?i:i.sub(t)._mult(r)._add(t))}function Dc(e,t){let i,n,r,o=!1;for(let a=0;a<e.length;a++){i=e[a];for(let e=0,a=i.length-1;e<i.length;a=e++)n=i[e],r=i[a],n.y>t.y!=r.y>t.y&&t.x<(r.x-n.x)*(t.y-n.y)/(r.y-n.y)+n.x&&(o=!o)}return o}function Lc(e,t){let i=!1;for(let n=0,r=e.length-1;n<e.length;r=n++){const o=e[n],a=e[r];o.y>t.y!=a.y>t.y&&t.x<(a.x-o.x)*(t.y-o.y)/(a.y-o.y)+o.x&&(i=!i)}return i}function Rc(e,t,i,n,r){for(const o of e)if(t<=o.x&&i<=o.y&&n>=o.x&&r>=o.y)return!0;const o=[new f(t,i),new f(t,r),new f(n,r),new f(n,i)];if(e.length>2)for(const t of o)if(Lc(e,t))return!0;for(let t=0;t<e.length-1;t++)if(Oc(e[t],e[t+1],o))return!0;return!1}function Oc(e,t,i){const n=i[0],r=i[2];if(e.x<n.x&&t.x<n.x||e.x>r.x&&t.x>r.x||e.y<n.y&&t.y<n.y||e.y>r.y&&t.y>r.y)return!1;const o=G(e,t,i[0]);return o!==G(e,t,i[1])||o!==G(e,t,i[2])||o!==G(e,t,i[3])}function Bc(e,t,i){const n=t.paint.get(e).value;return"constant"===n.kind?n.value:i.programConfigurations.get(t.id).getMaxValue(e)}function Fc(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Nc(e,t,i,n,r){if(!t[0]&&!t[1])return e;const o=f.convert(t)._mult(r);"viewport"===i&&o._rotate(-n);const a=[];for(let t=0;t<e.length;t++)a.push(e[t].sub(o));return a}function Uc(e,t,i,n){const r=f.convert(e)._mult(n);return"viewport"===t&&r._rotate(-i),r}Gr(Tc,"CircleBucket",{omit:["layers"]});const Vc=new Qo({"circle-sort-key":new Jo(Ye.layout_circle["circle-sort-key"])});var Gc={paint:new Qo({"circle-radius":new Jo(Ye.paint_circle["circle-radius"]),"circle-color":new Jo(Ye.paint_circle["circle-color"]),"circle-blur":new Jo(Ye.paint_circle["circle-blur"]),"circle-opacity":new Jo(Ye.paint_circle["circle-opacity"]),"circle-translate":new Yo(Ye.paint_circle["circle-translate"]),"circle-translate-anchor":new Yo(Ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Yo(Ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Yo(Ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Jo(Ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Jo(Ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Jo(Ye.paint_circle["circle-stroke-opacity"])}),layout:Vc};function jc(e,t,i,n,r,o,a,s,l){if(o&&e.queryGeometry.isAboveHorizon)return!1;o&&(l*=e.pixelToTileUnitsFactor);const c=e.tileID.canonical,u=i.projection.upVectorScale(c,i.center.lat,i.worldSize).metersToTile;for(const h of t)for(const t of h){const h=t.add(s),d=r&&i.elevation?i.elevation.exaggeration()*r.getElevationAt(h.x,h.y,!0):0,p=i.projection.projectTilePoint(h.x,h.y,c);if(d>0){const e=i.projection.upVector(c,h.x,h.y);p.x+=e[0]*u*d,p.y+=e[1]*u*d,p.z+=e[2]*u*d}const f=o?h:Wc(p.x,p.y,p.z,n),m=o?e.tilespaceRays.map((e=>Zc(e,d))):e.queryGeometry.screenGeometry,g=cl([],[p.x,p.y,p.z,1],n);if(!a&&o?l*=g[3]/i.cameraToCenterDistance:a&&!o&&(l*=i.cameraToCenterDistance/g[3]),o){const e=lc((t.y/Ss+c.y)/(1<<c.z));l/=i.projection.pixelsPerMeter(e,1)/ac(1,e)}if(Ec(m,f,l))return!0}return!1}function Wc(e,t,i,n){const r=cl([],[e,t,i,1],n);return new f(r[0]/r[3],r[1]/r[3])}const $c=Ws(0,0,0),qc=Ws(0,0,1);function Zc(e,t){const i=Vs();return $c[2]=t,e.intersectsPlane($c,qc,i),new f(i[0],i[1])}class Hc extends Tc{}function Xc(e,{width:t,height:i},n,r){if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==t*i*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(t*i*n);return e.width=t,e.height=i,e.data=r,e}function Yc(e,t,i){const{width:n,height:r}=t;n===e.width&&r===e.height||(Jc(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,n),height:Math.min(e.height,r)},i),e.width=n,e.height=r,e.data=t.data)}function Jc(e,t,i,n,r,o){if(0===r.width||0===r.height)return t;if(r.width>e.width||r.height>e.height||i.x>e.width-r.width||i.y>e.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>t.width||r.height>t.height||n.x>t.width-r.width||n.y>t.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const a=e.data,s=t.data;for(let l=0;l<r.height;l++){const c=((i.y+l)*e.width+i.x)*o,u=((n.y+l)*t.width+n.x)*o;for(let e=0;e<r.width*o;e++)s[u+e]=a[c+e]}return t}Gr(Hc,"HeatmapBucket",{omit:["layers"]});class Kc{constructor(e,t){Xc(this,e,1,t)}resize(e){Yc(this,new Kc(e),1)}clone(){return new Kc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,n,r){Jc(e,t,i,n,r,1)}}class Qc{constructor(e,t){Xc(this,e,4,t)}resize(e){Yc(this,new Qc(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Qc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,n,r){Jc(e,t,i,n,r,4)}}Gr(Kc,"AlphaImage"),Gr(Qc,"RGBAImage");var eu={paint:new Qo({"heatmap-radius":new Jo(Ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Jo(Ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Yo(Ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ko(Ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Yo(Ye.paint_heatmap["heatmap-opacity"])})};function tu(e){const t={},i=e.resolution||256,n=e.clips?e.clips.length:1,r=e.image||new Qc({width:i,height:n}),o=(i,n,o)=>{t[e.evaluationKey]=o;const a=e.expression.evaluate(t);r.data[i+n+0]=Math.floor(255*a.r/a.a),r.data[i+n+1]=Math.floor(255*a.g/a.a),r.data[i+n+2]=Math.floor(255*a.b/a.a),r.data[i+n+3]=Math.floor(255*a.a)};if(e.clips)for(let t=0,r=0;t<n;++t,r+=4*i)for(let n=0,a=0;n<i;n++,a+=4){const s=n/(i-1),{start:l,end:c}=e.clips[t];o(r,a,l*(1-s)+c*s)}else for(let e=0,t=0;e<i;e++,t+=4)o(0,t,e/(i-1));return r}var iu={paint:new Qo({"hillshade-illumination-direction":new Yo(Ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Yo(Ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Yo(Ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Yo(Ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Yo(Ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Yo(Ye.paint_hillshade["hillshade-accent-color"])})};const nu=ra([{name:"a_pos",components:2,type:"Int16"}],4),{members:ru}=nu;var ou={};function au(e,t,i){i=i||2;var n,r,o,a,s,l,c,u=t&&t.length,h=u?t[0]*i:e.length,d=su(e,0,h,i,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(e,t,i,n){var r,o,a,s=[];for(r=0,o=t.length;r<o;r++)(a=su(e,t[r]*n,r<o-1?t[r+1]*n:e.length,n,!1))===a.next&&(a.steiner=!0),s.push(yu(a));for(s.sort(fu),r=0;r<s.length;r++)i=mu(s[r],i);return i}(e,t,d,i)),e.length>80*i){n=o=e[0],r=a=e[1];for(var f=i;f<h;f+=i)(s=e[f])<n&&(n=s),(l=e[f+1])<r&&(r=l),s>o&&(o=s),l>a&&(a=l);c=0!==(c=Math.max(o-n,a-r))?32767/c:0}return cu(d,p,i,n,r,c,0),p}function su(e,t,i,n,r){var o,a;if(r===ku(e,t,i,n)>0)for(o=t;o<i;o+=n)a=Au(o,e[o],e[o+1],a);else for(o=i-n;o>=t;o-=n)a=Au(o,e[o],e[o+1],a);return a&&wu(a,a.next)&&(Pu(a),a=a.next),a}function lu(e,t){if(!e)return e;t||(t=e);var i,n=e;do{if(i=!1,n.steiner||!wu(n,n.next)&&0!==bu(n.prev,n,n.next))n=n.next;else{if(Pu(n),(n=t=n.prev)===n.next)break;i=!0}}while(i||n!==t);return t}function cu(e,t,i,n,r,o,a){if(e){!a&&o&&function(e,t,i,n){var r=e;do{0===r.z&&(r.z=_u(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,i,n,r,o,a,s,l,c=1;do{for(i=e,e=null,o=null,a=0;i;){for(a++,n=i,s=0,t=0;t<c&&(s++,n=n.nextZ);t++);for(l=c;s>0||l>0&&n;)0!==s&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,s--):(r=n,n=n.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;i=n}o.nextZ=null,c*=2}while(a>1)}(r)}(e,n,r,o);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,o?hu(e,n,r,o):uu(e))t.push(s.i/i|0),t.push(e.i/i|0),t.push(l.i/i|0),Pu(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?cu(e=du(lu(e),t,i),t,i,n,r,o,2):2===a&&pu(e,t,i,n,r,o):cu(lu(e),t,i,n,r,o,1);break}}}function uu(e){var t=e.prev,i=e,n=e.next;if(bu(t,i,n)>=0)return!1;for(var r=t.x,o=i.x,a=n.x,s=t.y,l=i.y,c=n.y,u=r<o?r<a?r:a:o<a?o:a,h=s<l?s<c?s:c:l<c?l:c,d=r>o?r>a?r:a:o>a?o:a,p=s>l?s>c?s:c:l>c?l:c,f=n.next;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&xu(r,s,o,l,a,c,f.x,f.y)&&bu(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function hu(e,t,i,n){var r=e.prev,o=e,a=e.next;if(bu(r,o,a)>=0)return!1;for(var s=r.x,l=o.x,c=a.x,u=r.y,h=o.y,d=a.y,p=s<l?s<c?s:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=s>l?s>c?s:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,_=_u(p,f,t,i,n),y=_u(m,g,t,i,n),x=e.prevZ,v=e.nextZ;x&&x.z>=_&&v&&v.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==a&&xu(s,u,l,h,c,d,x.x,x.y)&&bu(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==r&&v!==a&&xu(s,u,l,h,c,d,v.x,v.y)&&bu(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;x&&x.z>=_;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==a&&xu(s,u,l,h,c,d,x.x,x.y)&&bu(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;v&&v.z<=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==r&&v!==a&&xu(s,u,l,h,c,d,v.x,v.y)&&bu(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function du(e,t,i){var n=e;do{var r=n.prev,o=n.next.next;!wu(r,o)&&Mu(r,n,n.next,o)&&Eu(r,o)&&Eu(o,r)&&(t.push(r.i/i|0),t.push(n.i/i|0),t.push(o.i/i|0),Pu(n),Pu(n.next),n=e=o),n=n.next}while(n!==e);return lu(n)}function pu(e,t,i,n,r,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&vu(a,s)){var l=Cu(a,s);return a=lu(a,a.next),l=lu(l,l.next),cu(a,t,i,n,r,o,0),void cu(l,t,i,n,r,o,0)}s=s.next}a=a.next}while(a!==e)}function fu(e,t){return e.x-t.x}function mu(e,t){var i=function(e,t){var i,n=t,r=e.x,o=e.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=r&&s>a&&(a=s,i=n.x<n.next.x?n:n.next,s===r))return i}n=n.next}while(n!==t);if(!i)return null;var l,c=i,u=i.x,h=i.y,d=1/0;n=i;do{r>=n.x&&n.x>=u&&r!==n.x&&xu(o<h?r:a,o,u,h,o<h?a:r,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(r-n.x),Eu(n,e)&&(l<d||l===d&&(n.x>i.x||n.x===i.x&&gu(i,n)))&&(i=n,d=l)),n=n.next}while(n!==c);return i}(e,t);if(!i)return t;var n=Cu(i,e);return lu(n,n.next),lu(i,i.next)}function gu(e,t){return bu(e.prev,e,t.prev)<0&&bu(t.next,e,e.next)<0}function _u(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function yu(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function xu(e,t,i,n,r,o,a,s){return(r-a)*(t-s)>=(e-a)*(o-s)&&(e-a)*(n-s)>=(i-a)*(t-s)&&(i-a)*(o-s)>=(r-a)*(n-s)}function vu(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Mu(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(Eu(e,t)&&Eu(t,e)&&function(e,t){var i=e,n=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(bu(e.prev,e,t.prev)||bu(e,t.prev,t))||wu(e,t)&&bu(e.prev,e,e.next)>0&&bu(t.prev,t,t.next)>0)}function bu(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function wu(e,t){return e.x===t.x&&e.y===t.y}function Mu(e,t,i,n){var r=Su(bu(e,t,i)),o=Su(bu(e,t,n)),a=Su(bu(i,n,e)),s=Su(bu(i,n,t));return r!==o&&a!==s||!(0!==r||!Tu(e,i,t))||!(0!==o||!Tu(e,n,t))||!(0!==a||!Tu(i,e,n))||!(0!==s||!Tu(i,t,n))}function Tu(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Su(e){return e>0?1:e<0?-1:0}function Eu(e,t){return bu(e.prev,e,e.next)<0?bu(e,t,e.next)>=0&&bu(e,e.prev,t)>=0:bu(e,t,e.prev)<0||bu(e,e.next,t)<0}function Cu(e,t){var i=new Iu(e.i,e.x,e.y),n=new Iu(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function Au(e,t,i,n){var r=new Iu(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Pu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Iu(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ku(e,t,i,n){for(var r=0,o=t,a=i-n;o<i;o+=n)r+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return r}function zu(e,t,i,n,r){Du(e,t,i||0,n||e.length-1,r||Ru)}function Du(e,t,i,n,r){for(;n>i;){if(n-i>600){var o=n-i+1,a=t-i+1,s=Math.log(o),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(o-l)/o)*(a-o/2<0?-1:1);Du(e,t,Math.max(i,Math.floor(t-a*l/o+c)),Math.min(n,Math.floor(t+(o-a)*l/o+c)),r)}var u=e[t],h=i,d=n;for(Lu(e,i,t),r(e[n],u)>0&&Lu(e,i,n);h<d;){for(Lu(e,h,d),h++,d--;r(e[h],u)<0;)h++;for(;r(e[d],u)>0;)d--}0===r(e[i],u)?Lu(e,i,d):Lu(e,++d,n),d<=t&&(i=d+1),t<=d&&(n=d-1)}}function Lu(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function Ru(e,t){return e<t?-1:e>t?1:0}function Ou(e,t){const i=e.length;if(i<=1)return[e];const n=[];let r,o;for(let t=0;t<i;t++){const i=j(e[t]);0!==i&&(e[t].area=Math.abs(i),void 0===o&&(o=i<0),o===i<0?(r&&n.push(r),r=[e[t]]):r.push(e[t]))}if(r&&n.push(r),t>1)for(let e=0;e<n.length;e++)n[e].length<=t||(zu(n[e],t,1,n[e].length-1,Bu),n[e]=n[e].slice(0,t));return n}function Bu(e,t){return t.area-e.area}function Fu(e,t,i){const n=i.patternDependencies;let r=!1;for(const i of t){const t=i.paint.get(`${e}-pattern`);t.isConstant()||(r=!0);const o=t.constantOr(null);o&&(r=!0,n[o]=!0)}return r}function Nu(e,t,i,n,r){const o=r.patternDependencies;for(const a of t){const t=a.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:n},i,{},r.availableImages);e=e&&e.name?e.name:e,o[e]=!0,i.patterns[a.id]=e}}return i}({get exports(){return ou},set exports(e){ou=e}}).exports=au,ou.default=au,au.deviation=function(e,t,i,n){var r=t&&t.length,o=Math.abs(ku(e,0,r?t[0]*i:e.length,i));if(r)for(var a=0,s=t.length;a<s;a++)o-=Math.abs(ku(e,t[a]*i,a<s-1?t[a+1]*i:e.length,i));var l=0;for(a=0;a<n.length;a+=3){var c=n[a]*i,u=n[a+1]*i,h=n[a+2]*i;l+=Math.abs((e[c]-e[h])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[h+1]-e[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},au.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var a=0;a<t;a++)i.vertices.push(e[r][o][a]);r>0&&i.holes.push(n+=e[r-1].length)}return i};class Uu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new aa,this.indexArray=new wa,this.indexArray2=new Aa,this.programConfigurations=new fs(e.layers,e.zoom),this.segments=new Ts,this.segments2=new Ts,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.projection=e.projection}populate(e,t,i,n){this.hasPattern=Fu("fill",this.layers,t);const r=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:a,id:s,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=bc(a,e);if(!this.layers[0]._featureFilter.filter(new Vo(this.zoom),u,i))continue;const h=r?r.evaluate(u,{},i,t.availableImages):void 0,d={id:s,properties:a.properties,type:a.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:vc(a,i,n),patterns:{},sortKey:h};o.push(d)}r&&o.sort(((e,t)=>e.sortKey-t.sortKey));for(const n of o){const{geometry:r,index:o,sourceLayerIndex:a}=n;if(this.hasPattern){const e=Nu("fill",this.layers,n,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(n,r,o,i,{},t.availableImages);t.featureIndex.insert(e[o].feature,r,o,a,this.index)}}update(e,t,i,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i,n)}addFeatures(e,t,i,n,r){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ru),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,i,n,r,o=[]){for(const e of Ou(t,500)){let t=0;for(const i of e)t+=i.length;const i=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),n=i.vertexLength,r=[],o=[];for(const t of e){if(0===t.length)continue;t!==e[0]&&o.push(r.length/2);const i=this.segments2.prepareSegment(t.length,this.layoutVertexArray,this.indexArray2),n=i.vertexLength;this.layoutVertexArray.emplaceBack(t[0].x,t[0].y),this.indexArray2.emplaceBack(n+t.length-1,n),r.push(t[0].x),r.push(t[0].y);for(let e=1;e<t.length;e++)this.layoutVertexArray.emplaceBack(t[e].x,t[e].y),this.indexArray2.emplaceBack(n+e-1,n+e),r.push(t[e].x),r.push(t[e].y);i.vertexLength+=t.length,i.primitiveLength+=t.length}const a=ou(r,o);for(let e=0;e<a.length;e+=3)this.indexArray.emplaceBack(n+a[e],n+a[e+1],n+a[e+2]);i.vertexLength+=t,i.primitiveLength+=a.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,o,n)}}Gr(Uu,"FillBucket",{omit:["layers","patternFeatures"]});const Vu=new Qo({"fill-sort-key":new Jo(Ye.layout_fill["fill-sort-key"])});var Gu={paint:new Qo({"fill-antialias":new Yo(Ye.paint_fill["fill-antialias"]),"fill-opacity":new Jo(Ye.paint_fill["fill-opacity"]),"fill-color":new Jo(Ye.paint_fill["fill-color"]),"fill-outline-color":new Jo(Ye.paint_fill["fill-outline-color"]),"fill-translate":new Yo(Ye.paint_fill["fill-translate"]),"fill-translate-anchor":new Yo(Ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new Jo(Ye.paint_fill["fill-pattern"])}),layout:Vu};const ju=ra([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Wu=ra([{name:"a_centroid_pos",components:2,type:"Uint16"}]),$u=ra([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:qu}=ju;var Zu={},Hu=f,Xu=Yu;function Yu(e,t,i,n,r){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=r,e.readFields(Ju,this,t)}function Ju(e,t,i){1==e?t.id=i.readVarint():2==e?function(e,t){for(var i=e.readVarint()+e.pos;e.pos<i;){var n=t._keys[e.readVarint()],r=t._values[e.readVarint()];t.properties[n]=r}}(i,t):3==e?t.type=i.readVarint():4==e&&(t._geometry=i.pos)}function Ku(e){for(var t,i,n=0,r=0,o=e.length,a=o-1;r<o;a=r++)n+=((i=e[a]).x-(t=e[r]).x)*(t.y+i.y);return n}Yu.types=["Unknown","Point","LineString","Polygon"],Yu.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i=e.readVarint()+e.pos,n=1,r=0,o=0,a=0,s=[];e.pos<i;){if(r<=0){var l=e.readVarint();n=7&l,r=l>>3}if(r--,1===n||2===n)o+=e.readSVarint(),a+=e.readSVarint(),1===n&&(t&&s.push(t),t=[]),t.push(new Hu(o,a));else{if(7!==n)throw new Error("unknown command "+n);t&&t.push(t[0].clone())}}return t&&s.push(t),s},Yu.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,n=0,r=0,o=0,a=1/0,s=-1/0,l=1/0,c=-1/0;e.pos<t;){if(n<=0){var u=e.readVarint();i=7&u,n=u>>3}if(n--,1===i||2===i)(r+=e.readSVarint())<a&&(a=r),r>s&&(s=r),(o+=e.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error("unknown command "+i)}return[a,l,s,c]},Yu.prototype.toGeoJSON=function(e,t,i){var n,r,o=this.extent*Math.pow(2,i),a=this.extent*e,s=this.extent*t,l=this.loadGeometry(),c=Yu.types[this.type];function u(e){for(var t=0;t<e.length;t++){var i=e[t];e[t]=[360*(i.x+a)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+s)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<l.length;n++)h[n]=l[n][0];u(l=h);break;case 2:for(n=0;n<l.length;n++)u(l[n]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var i,n,r=[],o=0;o<t;o++){var a=Ku(e[o]);0!==a&&(void 0===n&&(n=a<0),n===a<0?(i&&r.push(i),i=[e[o]]):i.push(e[o]))}return i&&r.push(i),r}(l),n=0;n<l.length;n++)for(r=0;r<l[n].length;r++)u(l[n][r])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var Qu=Xu,eh=th;function th(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(ih,this,t),this.length=this._features.length}function ih(e,t,i){15===e?t.version=i.readVarint():1===e?t.name=i.readString():5===e?t.extent=i.readVarint():2===e?t._features.push(i.pos):3===e?t._keys.push(i.readString()):4===e&&t._values.push(function(e){for(var t=null,i=e.readVarint()+e.pos;e.pos<i;){var n=e.readVarint()>>3;t=1===n?e.readString():2===n?e.readFloat():3===n?e.readDouble():4===n?e.readVarint64():5===n?e.readVarint():6===n?e.readSVarint():7===n?e.readBoolean():null}return t}(i))}th.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Qu(this._pbf,t,this.extent,this._keys,this._values)};var nh=eh;function rh(e,t,i){if(3===e){var n=new nh(i,i.readVarint()+i.pos);n.length&&(t[n.name]=n)}}var oh=Zu.VectorTile=function(e,t){this.layers=e.readFields(rh,{},t)},ah=Zu.VectorTileFeature=Xu;function sh(e,t,i,n){const r=[],o=0===n?(e,t,i,n,r,o)=>{e.push(new f(o,i+(o-t)/(n-t)*(r-i)))}:(e,t,i,n,r,o)=>{e.push(new f(t+(o-i)/(r-i)*(n-t),o))};for(const a of e){const e=[];for(const r of a){if(r.length<=2)continue;const a=[];for(let e=0;e<r.length-1;e++){const s=r[e].x,l=r[e].y,c=r[e+1].x,u=r[e+1].y,h=0===n?s:l,d=0===n?c:u;h<t?d>t&&o(a,s,l,c,u,t):h>i?d<i&&o(a,s,l,c,u,i):a.push(r[e]),d<t&&h>=t&&o(a,s,l,c,u,t),d>i&&h<=i&&o(a,s,l,c,u,i)}let s=r[r.length-1];const l=0===n?s.x:s.y;l>=t&&l<=i&&a.push(s),a.length&&(s=a[a.length-1],a[0].x===s.x&&a[0].y===s.y||a.push(a[0]),e.push(a))}e.length&&r.push(e)}return r}Zu.VectorTileLayer=eh;const lh=ah.types,ch=Math.pow(2,13);function uh(e,t,i,n,r,o,a,s){e.emplaceBack((t<<1)+a,(i<<1)+o,(Math.floor(n*ch)<<1)+r,Math.round(s))}function hh(e,t,i){const n=16384;e.emplaceBack(t.x,t.y,t.z,i[0]*n,i[1]*n,i[2]*n)}class dh{constructor(){this.acc=new f(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new f(e.x,e.y),this.max=new f(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);const i=this.min,n=this.max;e.x<i.x?i.x=e.x:e.x>n.x&&(n.x=e.x),e.y<i.y?i.y=e.y:e.y>n.y&&(n.y=e.y),((0===e.x||e.x===Ss)&&e.x===t.x)!=((0===e.y||e.y===Ss)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,Ci(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>Ss!=e.x>Ss&&this.addBorderIntersection(1,Ci(t.y,e.y,(Ss-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,Ci(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>Ss!=e.y>Ss&&this.addBorderIntersection(3,Ci(t.x,e.x,(Ss-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[e];t<i[0]&&(i[0]=t),t>i[1]&&(i[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const i=0===e.x?0:1;this.addBorderIntersection(i,t.y),this.addBorderIntersection(i,e.y)}else{const i=0===e.y?2:3;this.addBorderIntersection(i,t.x),this.addBorderIntersection(i,e.x)}}centroid(){const e=this.polyCount.reduce(((e,t)=>e+t.edges),0);return 0!==e?this.acc.div(e)._round():new f(0,0)}span(){return new f(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce(((e,t)=>e+ +(t[0]!==Number.MAX_VALUE)),0)}}class ph{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new la,this.centroidVertexArray=new Va,this.indexArray=new wa,this.programConfigurations=new fs(e.layers,e.zoom),this.segments=new Ts,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.enableTerrain=e.enableTerrain}populate(e,t,i,n){this.features=[],this.hasPattern=Fu("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(e){const t=Math.exp(Math.PI*(1-e.y/(1<<e.z)*2));return 80150034*t/(t*t+1)/Ss/(1<<e.z)}(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:r,id:o,index:a,sourceLayerIndex:s}of e){const e=this.layers[0]._featureFilter.needGeometry,l=bc(r,e);if(!this.layers[0]._featureFilter.filter(new Vo(this.zoom),l,i))continue;const c={id:o,sourceLayerIndex:s,index:a,geometry:e?l.geometry:vc(r,i,n),properties:r.properties,type:r.type,patterns:{}},u=this.layoutVertexArray.length;this.hasPattern?this.features.push(Nu("fill-extrusion",this.layers,c,this.zoom,t)):this.addFeature(c,c.geometry,a,i,{},t.availableImages,n),t.featureIndex.insert(r,c.geometry,a,s,this.index,u)}this.sortBorders()}addFeatures(e,t,i,n,r){for(const e of this.features){const{geometry:o}=e;this.addFeature(e,o,e.index,t,i,n,r)}this.sortBorders()}update(e,t,i,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qu),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,$u.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Wu.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,i,n,r,o,a){const s=[new f(0,0),new f(Ss,Ss)],l=a.projection,c="globe"===l.name,u=this.enableTerrain&&!c?new dh:null,h="Polygon"===lh[e.type];c&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new pa);const d=Ou(t,500);for(let e=d.length-1;e>=0;e--){const t=d[e];(0===t.length||(p=t[0]).every((e=>e.x<=0))||p.every((e=>e.x>=Ss))||p.every((e=>e.y<=0))||p.every((e=>e.y>=Ss)))&&d.splice(e,1)}var p;let m;if(c)m=bh(d,s,n);else{m=[];for(const e of d)m.push({polygon:e,bounds:s})}const g=h?this.edgeRadius:0;for(const{polygon:e,bounds:t}of m){let i=0,r=0;for(const t of e)h&&!t[0].equals(t[t.length-1])&&t.push(t[0]),r+=h?t.length-1:t.length;const o=this.segments.prepareSegment((h?5:4)*r,this.layoutVertexArray,this.indexArray);if(h){const t=[],r=[];i=o.vertexLength;for(const i of e){let a,s;i.length&&i!==e[0]&&r.push(t.length/2),a=i[1].sub(i[0])._perp()._unit();for(let e=1;e<i.length;e++){const r=i[e],u=i[e===i.length-1?1:e+1];let{x:h,y:d}=r;if(g){s=u.sub(r)._perp()._unit();const e=a.add(s)._unit(),t=g*Math.min(4,1/(a.x*e.x+a.y*e.y));h+=t*e.x,d+=t*e.y,a=s}uh(this.layoutVertexArray,h,d,0,0,1,1,0),o.vertexLength++,t.push(r.x,r.y),c&&hh(this.layoutVertexExtArray,l.projectTilePoint(h,d,n),l.upVector(n,h,d))}}const a=ou(t,r);for(let e=0;e<a.length;e+=3)this.indexArray.emplaceBack(i+a[e],i+a[e+2],i+a[e+1]),o.primitiveLength++}for(const r of e){u&&r.length&&u.startRing(r[0]);let e,a,s,d=r.length>4&&yh(r[r.length-2],r[0],r[1]),p=g?mh(r[r.length-2],r[0],r[1],g):0;a=r[1].sub(r[0])._perp()._unit();let f=!0;for(let m=1,_=0;m<r.length;m++){let y=r[m-1],x=r[m];const v=r[m===r.length-1?1:m+1];if(u&&h&&u.currentPolyCount.top++,_h(x,y,t)){g&&(a=v.sub(x)._perp()._unit(),f=!f);continue}u&&u.append(x,y);const b=x.sub(y)._perp(),w=b.x/(Math.abs(b.x)+Math.abs(b.y)),M=b.y>0?1:0,T=y.dist(x);if(_+T>32768&&(_=0),g){s=v.sub(x)._perp()._unit();let e=gh(y,x,v,fh(a,s),g);isNaN(e)&&(e=0);const t=x.sub(y)._unit();y=y.add(t.mult(p))._round(),x=x.add(t.mult(-e))._round(),p=e,a=s}const S=o.vertexLength,E=r.length>4&&yh(y,x,v);let C=xh(_,d,f);if(uh(this.layoutVertexArray,y.x,y.y,w,M,0,0,C),uh(this.layoutVertexArray,y.x,y.y,w,M,0,1,C),_+=T,C=xh(_,E,!f),d=E,uh(this.layoutVertexArray,x.x,x.y,w,M,0,0,C),uh(this.layoutVertexArray,x.x,x.y,w,M,0,1,C),o.vertexLength+=4,this.indexArray.emplaceBack(S+0,S+1,S+2),this.indexArray.emplaceBack(S+1,S+3,S+2),o.primitiveLength+=2,g){const n=i+(1===m?r.length-2:m-2),a=1===m?i:n+1;if(this.indexArray.emplaceBack(S+1,n,S+3),this.indexArray.emplaceBack(n,a,S+3),o.primitiveLength+=2,void 0===e&&(e=S),!_h(v,r[m],t)){const t=m===r.length-1?e:o.vertexLength;this.indexArray.emplaceBack(S+2,S+3,t),this.indexArray.emplaceBack(S+3,t+1,t),this.indexArray.emplaceBack(S+3,a,t+1),o.primitiveLength+=3}f=!f}if(c){const e=this.layoutVertexExtArray,t=l.projectTilePoint(y.x,y.y,n),i=l.projectTilePoint(x.x,x.y,n),r=l.upVector(n,y.x,y.y),o=l.upVector(n,x.x,x.y);hh(e,t,r),hh(e,t,r),hh(e,i,o),hh(e,i,o)}}h&&(i+=r.length-1)}}if(u&&u.polyCount.length>0){if(u.borders){u.vertexArrayOffset=this.centroidVertexArray.length;const e=u.borders,t=this.featuresOnBorder.push(u)-1;for(let i=0;i<4;i++)e[i][0]!==Number.MAX_VALUE&&this.borders[i].push(t)}this.encodeCentroid(u.borders?void 0:u.centroid(),u)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,o,n)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort(((t,i)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[i].borders[e][0]))}encodeCentroid(e,t,i=!0){let n,r;if(e)if(0!==e.y){const i=t.span()._mult(this.tileToMeter);n=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(i.x/10)),r=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(i.y/10))}else n=Math.ceil(7*(e.x+450)),r=0;else n=0,r=+i;let o=i?this.centroidVertexArray.length:t.vertexArrayOffset;for(const e of t.polyCount){i&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*e.edges+e.top);for(let t=0;t<e.top;t++)this.centroidVertexArray.emplace(o++,n,r);for(let t=0;t<2*e.edges;t++)this.centroidVertexArray.emplace(o++,0,r),this.centroidVertexArray.emplace(o++,n,r)}}}function fh(e,t){const i=e.add(t)._unit();return e.x*i.x+e.y*i.y}function mh(e,t,i,n){const r=t.sub(e)._perp()._unit(),o=i.sub(t)._perp()._unit();return gh(e,t,i,fh(r,o),n)}function gh(e,t,i,n,r){const o=Math.sqrt(1-n*n);return Math.min(e.dist(t)/3,t.dist(i)/3,r*o/n)}function _h(e,t,i){return e.x<i[0].x&&t.x<i[0].x||e.x>i[1].x&&t.x>i[1].x||e.y<i[0].y&&t.y<i[0].y||e.y>i[1].y&&t.y>i[1].y}function yh(e,t,i){if(e.x<0||e.x>=Ss||t.x<0||t.x>=Ss||i.x<0||i.x>=Ss)return!1;const n=i.sub(t),r=n.perp(),o=e.sub(t);return(n.x*o.x+n.y*o.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(o.x*o.x+o.y*o.y))>-.866&&r.x*o.x+r.y*o.y<0}function xh(e,t,i){const n=t?2|e:-3&e;return i?1|n:-2&n}function vh(){const e=Math.PI/32,t=Math.tan(e),i=ec;return i*Math.sqrt(1+2*t*t)-i}function bh(e,t,i){const n=1<<i.z,r=sc(i.x/n),o=sc((i.x+1)/n),a=lc(i.y/n),s=lc((i.y+1)/n);return function(e,t,i,n,r=0,o){const a=[];if(!e.length||!i||!n)return a;const s=(e,t)=>{for(const i of e)a.push({polygon:i,bounds:t})},l=Math.ceil(Math.log2(i)),c=Math.ceil(Math.log2(n)),u=l-c,h=[];for(let e=0;e<Math.abs(u);e++)h.push(u>0?0:1);for(let e=0;e<Math.min(l,c);e++)h.push(0),h.push(1);let d=e;if(d=sh(d,t[0].y-r,t[1].y+r,1),d=sh(d,t[0].x-r,t[1].x+r,0),!d.length)return a;const p=[];for(h.length?p.push({polygons:d,bounds:t,depth:0}):s(d,t);p.length;){const e=p.pop(),t=e.depth,i=h[t],n=e.bounds[0],a=e.bounds[1],l=0===i?n.x:n.y,c=0===i?a.x:a.y,u=o?o(i,l,c):.5*(l+c),d=sh(e.polygons,l-r,u+r,i),m=sh(e.polygons,u-r,c+r,i);if(d.length){const e=[n,new f(0===i?u:a.x,1===i?u:a.y)];h.length>t+1?p.push({polygons:d,bounds:e,depth:t+1}):s(d,e)}if(m.length){const e=[new f(0===i?u:n.x,1===i?u:n.y),a];h.length>t+1?p.push({polygons:m,bounds:e,depth:t+1}):s(m,e)}}return a}(e,t,Math.ceil((o-r)/11.25),Math.ceil((a-s)/11.25),1,((e,t,r)=>{if(0===e)return.5*(t+r);{const e=lc((i.y+t/Ss)/n);return(oc(.5*(lc((i.y+r/Ss)/n)+e))*n-i.y)*Ss}}))}Gr(ph,"FillExtrusionBucket",{omit:["layers","features"]}),Gr(dh,"PartMetadata");const wh=new Qo({"fill-extrusion-edge-radius":new Yo(Ye["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Mh={paint:new Qo({"fill-extrusion-opacity":new Yo(Ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Jo(Ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Yo(Ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Yo(Ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Jo(Ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Jo(Ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Jo(Ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Yo(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Yo(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Yo(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:wh};function Th(e,t,i){var n=2*Math.PI*6378137/256/Math.pow(2,i);return[e*n-2*Math.PI*6378137/2,t*n-2*Math.PI*6378137/2]}class Sh{constructor(e,t,i){this.z=e,this.x=t,this.y=i,this.key=Ah(0,e,e,t,i)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const i=function(e,t,i){var n=Th(256*e,256*(t=Math.pow(2,i)-t-1),i),r=Th(256*(e+1),256*(t+1),i);return n[0]+","+n[1]+","+r[0]+","+r[1]}(this.x,this.y,this.z),n=function(e,t,i){let n,r="";for(let o=e;o>0;o--)n=1<<o-1,r+=(t&n?1:0)+(i&n?2:0);return r}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Eh{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Ah(e,t.z,t.z,t.x,t.y)}}class Ch{constructor(e,t,i,n,r){this.overscaledZ=e,this.wrap=t,this.canonical=new Sh(i,+n,+r),this.key=0===t&&e===i?this.canonical.key:Ah(t,e,i,n,r)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Ch(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ch(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Ah(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-e;return Ah(this.wrap*+t,e,e,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Ch(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,i=2*this.canonical.x,n=2*this.canonical.y;return[new Ch(t,this.wrap,t,i,n),new Ch(t,this.wrap,t,i+1,n),new Ch(t,this.wrap,t,i,n+1),new Ch(t,this.wrap,t,i+1,n+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ch(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ch(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Eh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ah(e,t,i,n,r){const o=1<<Math.min(i,22);let a=o*(r%o)+n%o;return e&&i<22&&(a+=o*o*((e<0?-2*e-1:2*e)%(1<<2*(22-i)))),16*(32*a+i)+(t-i)}Gr(Sh,"CanonicalTileID"),Gr(Ch,"OverscaledTileID",{omit:["projMatrix"]});class Ph extends f{constructor(e,t,i){super(e,t),this.z=i}}function Ih(e,t){return e.x*t.x+e.y*t.y}function kh(e,t){if(1===e.length){let i=0;const n=t[i++];let r;for(;!r||n.equals(r);)if(r=t[i++],!r)return 1/0;for(;i<t.length;i++){const o=t[i],a=e[0],s=r.sub(n),l=o.sub(n),c=a.sub(n),u=Ih(s,s),h=Ih(s,l),d=Ih(l,l),p=Ih(c,s),f=Ih(c,l),m=u*d-h*h,g=(d*p-h*f)/m,_=(u*f-h*p)/m,y=n.z*(1-g-_)+r.z*g+o.z*_;if(isFinite(y))return y}return 1/0}{let e=1/0;for(const i of t)e=Math.min(e,i.z);return e}}function zh(e,t,i,n,r,o,a,s){const l=a*r.getElevationAt(e,t,!0,!0),c=0!==o[0],u=c?0===o[1]?a*(o[0]/7-450):a*function(e,t,i){const n=Math.floor(t[0]/8),r=Math.floor(t[1]/8),o=10*(t[0]-8*n),a=10*(t[1]-8*r),s=e.getElevationAt(n,r,!0,!0),l=e.getMeterToDEM(i),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(a*l-1)),h=e.tileCoordToPixel(n,r),d=2*c+1,p=2*u+1,f=function(e,t,i,n,r){return[e.getElevationAtPixel(t,i,!0),e.getElevationAtPixel(t+r,i,!0),e.getElevationAtPixel(t,i+r,!0),e.getElevationAtPixel(t+n,i+r,!0)]}(e,h.x-c,h.y-u,d,p),m=Math.abs(f[0]-f[1]),g=Math.abs(f[2]-f[3]),_=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),y=Math.min(.25,.5*l*(m+g)/d),x=Math.min(.25,.5*l*_/p);return s+Math.max(y*o,x*a)}(r,o,s):l;return{base:l+(0===i)?-1:i,top:c?Math.max(u+n,l+i+2):l+n}}const Dh=ra([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Lh}=Dh,Rh=ra([{name:"a_packed",components:4,type:"Float32"}]),{members:Oh}=Rh,Bh=ah.types,Fh=Math.cos(Math.PI/180*37.5);class Nh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new ca,this.layoutVertexArray2=new ua,this.indexArray=new wa,this.programConfigurations=new fs(e.layers,e.zoom),this.segments=new Ts,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i,n){this.hasPattern=Fu("line",this.layers,t);const r=this.layers[0].layout.get("line-sort-key"),o=[];for(const{feature:t,id:a,index:s,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=bc(t,e);if(!this.layers[0]._featureFilter.filter(new Vo(this.zoom),c,i))continue;const u=r?r.evaluate(c,{},i):void 0,h={id:a,properties:t.properties,type:t.type,sourceLayerIndex:l,index:s,geometry:e?c.geometry:vc(t,i,n),patterns:{},sortKey:u};o.push(h)}r&&o.sort(((e,t)=>e.sortKey-t.sortKey));const{lineAtlas:a,featureIndex:s}=t,l=this.addConstantDashes(a);for(const n of o){const{geometry:r,index:o,sourceLayerIndex:c}=n;if(l&&this.addFeatureDashes(n,a),this.hasPattern){const e=Nu("line",this.layers,n,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(n,r,o,i,a.positions,t.availableImages);s.insert(e[o].feature,r,o,c,this.index)}}addConstantDashes(e){let t=!1;for(const i of this.layers){const n=i.paint.get("line-dasharray").value,r=i.layout.get("line-cap").value;if("constant"!==n.kind||"constant"!==r.kind)t=!0;else{const t=r.value,i=n.value;if(!i)continue;e.addDash(i,t)}}return t}addFeatureDashes(e,t){const i=this.zoom;for(const n of this.layers){const r=n.paint.get("line-dasharray").value,o=n.layout.get("line-cap").value;if("constant"===r.kind&&"constant"===o.kind)continue;let a,s;if("constant"===r.kind){if(a=r.value,!a)continue}else a=r.evaluate({zoom:i},e);s="constant"===o.kind?o.value:o.evaluate({zoom:i},e),t.addDash(a,s),e.patterns[n.id]=t.getKey(a,s)}}update(e,t,i,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i,n)}addFeatures(e,t,i,n,r){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Oh)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,i,n,r,o){const a=this.layers[0].layout,s=a.get("line-join").evaluate(e,{}),l=a.get("line-cap").evaluate(e,{}),c=a.get("line-miter-limit"),u=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const i of t)this.addLine(i,e,s,l,c,u);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,o,n)}addLine(e,t,i,n,r,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const a="Polygon"===Bh[t.type];let s=e.length;for(;s>=2&&e[s-1].equals(e[s-2]);)s--;let l=0;for(;l<s-1&&e[l].equals(e[l+1]);)l++;if(s<(a?3:2))return;"bevel"===i&&(r=1.05);const c=this.overscaling<=16?122880/(512*this.overscaling):0,u=this.segments.prepareSegment(10*s,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,a&&(h=e[s-2],m=e[l].sub(h)._unit()._perp());for(let t=l;t<s;t++){if(p=t===s-1?a?e[l+1]:void 0:e[t+1],p&&e[t].equals(p))continue;m&&(f=m),h&&(d=h),h=e[t],m=p?p.sub(h)._unit()._perp():f,f=f||m;let g=f.add(m);0===g.x&&0===g.y||g._unit();const _=f.x*m.x+f.y*m.y,y=g.x*m.x+g.y*m.y,x=0!==y?1/y:1/0,v=2*Math.sqrt(2-2*y),b=y<Fh&&d&&p,w=f.x*m.y-f.y*m.x>0;if(b&&t>l){const e=h.dist(d);if(e>2*c){const t=h.sub(h.sub(d)._mult(c/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,f,0,0,u),d=t}}const M=d&&p;let T=M?i:a?"butt":n;if(M&&"round"===T&&(x<o?T="miter":x<=2&&(T="fakeround")),"miter"===T&&x>r&&(T="bevel"),"bevel"===T&&(x>2&&(T="flipbevel"),x<r&&(T="miter")),d&&this.updateDistance(d,h),"miter"===T)g._mult(x),this.addCurrentVertex(h,g,0,0,u);else if("flipbevel"===T){if(x>100)g=m.mult(-1);else{const e=x*f.add(m).mag()/f.sub(m).mag();g._perp()._mult(e*(w?-1:1))}this.addCurrentVertex(h,g,0,0,u),this.addCurrentVertex(h,g.mult(-1),0,0,u)}else if("bevel"===T||"fakeround"===T){const e=-Math.sqrt(x*x-1),t=w?e:0,i=w?0:e;if(d&&this.addCurrentVertex(h,f,t,i,u),"fakeround"===T){const e=Math.round(180*v/Math.PI/20);for(let t=1;t<e;t++){let i=t/e;if(.5!==i){const e=i-.5;i+=i*e*(i-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*e*e+(.848013+_*(.215638*_-1.06021)))}const n=m.sub(f)._mult(i)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,n.x,n.y,!1,w,0,u)}}p&&this.addCurrentVertex(h,m,-t,-i,u)}else if("butt"===T)this.addCurrentVertex(h,g,0,0,u);else if("square"===T){const e=d?1:-1;d||this.addCurrentVertex(h,g,e,e,u),this.addCurrentVertex(h,g,0,0,u),d&&this.addCurrentVertex(h,g,e,e,u)}else"round"===T&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(b&&t<s-1){const e=h.dist(p);if(e>2*c){const t=h.add(p.sub(h)._mult(c/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,m,0,0,u),h=t}}}}addCurrentVertex(e,t,i,n,r,o=!1){const a=t.y*n-t.x,s=-t.y-t.x*n;this.addHalfVertex(e,t.x+t.y*i,t.y-t.x*i,o,!1,i,r),this.addHalfVertex(e,a,s,o,!0,-n,r)}addHalfVertex({x:e,y:t},i,n,r,o,a,s){this.layoutVertexArray.emplaceBack((e<<1)+(r?1:0),(t<<1)+(o?1:0),Math.round(63*i)+128,Math.round(63*n)+128,1+(0===a?0:a<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const l=s.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),s.primitiveLength++),o?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}Gr(Nh,"LineBucket",{omit:["layers","patternFeatures"]});const Uh=new Qo({"line-cap":new Jo(Ye.layout_line["line-cap"]),"line-join":new Jo(Ye.layout_line["line-join"]),"line-miter-limit":new Yo(Ye.layout_line["line-miter-limit"]),"line-round-limit":new Yo(Ye.layout_line["line-round-limit"]),"line-sort-key":new Jo(Ye.layout_line["line-sort-key"])});var Vh={paint:new Qo({"line-opacity":new Jo(Ye.paint_line["line-opacity"]),"line-color":new Jo(Ye.paint_line["line-color"]),"line-translate":new Yo(Ye.paint_line["line-translate"]),"line-translate-anchor":new Yo(Ye.paint_line["line-translate-anchor"]),"line-width":new Jo(Ye.paint_line["line-width"]),"line-gap-width":new Jo(Ye.paint_line["line-gap-width"]),"line-offset":new Jo(Ye.paint_line["line-offset"]),"line-blur":new Jo(Ye.paint_line["line-blur"]),"line-dasharray":new Jo(Ye.paint_line["line-dasharray"]),"line-pattern":new Jo(Ye.paint_line["line-pattern"]),"line-gradient":new Ko(Ye.paint_line["line-gradient"]),"line-trim-offset":new Yo(Ye.paint_line["line-trim-offset"])}),layout:Uh};const Gh=new class extends Jo{possiblyEvaluate(e,t){return t=new Vo(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,n){return t=P({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,n)}}(Vh.paint.properties["line-width"].specification);function jh(e,t){return t>0?t+2*e:e}Gh.useIntegerZoom=!0;const Wh=ra([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),$h=ra([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),qh=ra([{name:"a_projected_pos",components:4,type:"Float32"}],4);ra([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Zh=ra([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Hh=ra([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ra([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Xh=ra([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Yh=ra([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ra([{name:"triangle",components:3,type:"Uint16"}]),ra([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ra([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ra([{type:"Float32",name:"offsetX"}]),ra([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Jh=24;const Kh=128;function Qh(e,t){const{expression:i}=t;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new Vo(e+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:n}=i;let r=0;for(;r<t.length&&t[r]<=e;)r++;r=Math.max(0,r-1);let o=r;for(;o<t.length&&t[o]<e+1;)o++;o=Math.min(t.length-1,o);const a=t[r],s=t[o];return"composite"===i.kind?{kind:"composite",minZoom:a,maxZoom:s,interpolationType:n}:{kind:"camera",minZoom:a,maxZoom:s,minSize:i.evaluate(new Vo(a)),maxSize:i.evaluate(new Vo(s)),interpolationType:n}}}function ed(e,{uSize:t,uSizeT:i},{lowerSize:n,upperSize:r}){return"source"===e.kind?n/Kh:"composite"===e.kind?Ci(n/Kh,r/Kh,i):t}function td(e,t){let i=0,n=0;if("constant"===e.kind)n=e.layoutSize;else if("source"!==e.kind){const{interpolationType:r,minZoom:o,maxZoom:a}=e,s=r?T(Hi.interpolationFactor(r,t,o,a),0,1):0;"camera"===e.kind?n=Ci(e.minSize,e.maxSize,s):i=s}return{uSizeT:i,uSize:n}}var id=Object.freeze({__proto__:null,getSizeData:Qh,evaluateSizeForFeature:ed,evaluateSizeForZoom:td,SIZE_PACK_FACTOR:Kh});function nd(e,t,i){return e.sections.forEach((e=>{e.text=function(e,t,i){const n=t.layout.get("text-transform").evaluate(i,{});return"uppercase"===n?e=e.toLocaleUpperCase():"lowercase"===n&&(e=e.toLocaleLowerCase()),Uo.applyArabicShaping&&(e=Uo.applyArabicShaping(e)),e}(e.text,t,i)})),e}const rd={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function od(e){return"︶"===e||"﹈"===e||"︸"===e||"﹄"===e||"﹂"===e||"︾"===e||"︼"===e||"︺"===e||"︘"===e||"﹀"===e||"︐"===e||"︓"===e||"︔"===e||"｀"===e||"￣"===e||"︑"===e||"︒"===e}function ad(e){return"︵"===e||"﹇"===e||"︷"===e||"﹃"===e||"﹁"===e||"︽"===e||"︻"===e||"︹"===e||"︗"===e||"︿"===e}var sd=ud,ld=function(e,t,i,n,r){var o,a,s=8*r-n-1,l=(1<<s)-1,c=l>>1,u=-7,h=i?r-1:0,d=i?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=s;u>0;o=256*o+e[t+h],h+=d,u-=8);for(a=o&(1<<-u)-1,o>>=-u,u+=n;u>0;a=256*a+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,n),o-=c}return(p?-1:1)*a*Math.pow(2,o-n)},cd=function(e,t,i,n,r,o){var a,s,l,c=8*o-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,f=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=u?(s=0,a=u):a+h>=1?(s=(t*l-1)*Math.pow(2,r),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,r),a=0));r>=8;e[i+p]=255&s,p+=f,s/=256,r-=8);for(a=a<<r|s,c+=r;c>0;e[i+p]=255&a,p+=f,a/=256,c-=8);e[i+p-f]|=128*m};
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function ud(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}ud.Varint=0,ud.Fixed64=1,ud.Bytes=2,ud.Fixed32=5;var hd=4294967296,dd=1/hd,pd="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function fd(e){return e.type===ud.Bytes?e.readVarint()+e.pos:e.pos+1}function md(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function gd(e,t,i){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=e;r--)i.buf[r+n]=i.buf[r]}function _d(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function yd(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function xd(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function vd(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function bd(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function wd(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function Md(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function Td(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function Sd(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function Ed(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Cd(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function Ad(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Pd(e,t,i){t.glyphs=[],1===e&&i.readMessage(Id,t)}function Id(e,t,i){if(3===e){const{id:e,bitmap:n,width:r,height:o,left:a,top:s,advance:l}=i.readMessage(kd,{});t.glyphs.push({id:e,bitmap:new Kc({width:r+6,height:o+6},n),metrics:{width:r,height:o,left:a,top:s,advance:l}})}else 4===e?t.ascender=i.readSVarint():5===e&&(t.descender=i.readSVarint())}function kd(e,t,i){1===e?t.id=i.readVarint():2===e?t.bitmap=i.readBytes():3===e?t.width=i.readVarint():4===e?t.height=i.readVarint():5===e?t.left=i.readSVarint():6===e?t.top=i.readSVarint():7===e&&(t.advance=i.readVarint())}function zd(e){let t=0,i=0;for(const n of e)t+=n.w*n.h,i=Math.max(i,n.w);e.sort(((e,t)=>t.h-e.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let r=0,o=0;for(const t of e)for(let e=n.length-1;e>=0;e--){const i=n[e];if(!(t.w>i.w||t.h>i.h)){if(t.x=i.x,t.y=i.y,o=Math.max(o,t.y+t.h),r=Math.max(r,t.x+t.w),t.w===i.w&&t.h===i.h){const t=n.pop();e<n.length&&(n[e]=t)}else t.h===i.h?(i.x+=t.w,i.w-=t.w):t.w===i.w?(i.y+=t.h,i.h-=t.h):(n.push({x:i.x+t.w,y:i.y,w:i.w-t.w,h:t.h}),i.y+=t.h,i.h-=t.h);break}}return{w:r,h:o,fill:t/(r*o)||0}}ud.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,o=this.pos;this.type=7&n,e(r,t,this),this.pos===o&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Ed(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Ad(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Ed(this.buf,this.pos)+Ed(this.buf,this.pos+4)*hd;return this.pos+=8,e},readSFixed64:function(){var e=Ed(this.buf,this.pos)+Ad(this.buf,this.pos+4)*hd;return this.pos+=8,e},readFloat:function(){var e=ld(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=ld(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,n=this.buf;return t=127&(i=n[this.pos++]),i<128?t:(t|=(127&(i=n[this.pos++]))<<7,i<128?t:(t|=(127&(i=n[this.pos++]))<<14,i<128?t:(t|=(127&(i=n[this.pos++]))<<21,i<128?t:function(e,t,i){var n,r,o=i.buf;if(n=(112&(r=o[i.pos++]))>>4,r<128)return md(e,n,t);if(n|=(127&(r=o[i.pos++]))<<3,r<128)return md(e,n,t);if(n|=(127&(r=o[i.pos++]))<<10,r<128)return md(e,n,t);if(n|=(127&(r=o[i.pos++]))<<17,r<128)return md(e,n,t);if(n|=(127&(r=o[i.pos++]))<<24,r<128)return md(e,n,t);if(n|=(1&(r=o[i.pos++]))<<31,r<128)return md(e,n,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=n[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&pd?function(e,t,i){return pd.decode(e.subarray(t,i))}(this.buf,t,e):function(e,t,i){for(var n="",r=t;r<i;){var o,a,s,l=e[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=e[r+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(a=e[r+2],128==(192&(o=e[r+1]))&&128==(192&a)&&((c=(15&l)<<12|(63&o)<<6|63&a)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(a=e[r+2],s=e[r+3],128==(192&(o=e[r+1]))&&128==(192&a)&&128==(192&s)&&((c=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),r+=u}return n}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==ud.Bytes)return e.push(this.readVarint(t));var i=fd(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==ud.Bytes)return e.push(this.readSVarint());var t=fd(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==ud.Bytes)return e.push(this.readBoolean());var t=fd(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==ud.Bytes)return e.push(this.readFloat());var t=fd(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==ud.Bytes)return e.push(this.readDouble());var t=fd(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==ud.Bytes)return e.push(this.readFixed32());var t=fd(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==ud.Bytes)return e.push(this.readSFixed32());var t=fd(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==ud.Bytes)return e.push(this.readFixed64());var t=fd(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==ud.Bytes)return e.push(this.readSFixed64());var t=fd(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===ud.Varint)for(;this.buf[this.pos++]>127;);else if(t===ud.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ud.Fixed32)this.pos+=4;else{if(t!==ud.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Cd(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Cd(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Cd(this.buf,-1&e,this.pos),Cd(this.buf,Math.floor(e*dd),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Cd(this.buf,-1&e,this.pos),Cd(this.buf,Math.floor(e*dd),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,n;if(e>=0?(i=e%4294967296|0,n=e/4294967296|0):(n=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,n=n+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,i.buf[i.pos]=127&(e>>>=7)}(i,0,t),function(e,t){var i=(7&e)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(n,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var n,r,o=0;o<t.length;o++){if((n=t.charCodeAt(o))>55295&&n<57344){if(!r){n>56319||o+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):r=n;continue}if(n<56320){e[i++]=239,e[i++]=191,e[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null}else r&&(e[i++]=239,e[i++]=191,e[i++]=189,r=null);n<128?e[i++]=n:(n<2048?e[i++]=n>>6|192:(n<65536?e[i++]=n>>12|224:(e[i++]=n>>18|240,e[i++]=n>>12&63|128),e[i++]=n>>6&63|128),e[i++]=63&n|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&gd(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),cd(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),cd(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var n=this.pos-i;n>=128&&gd(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,i){this.writeTag(e,ud.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,_d,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,yd,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,bd,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,xd,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,vd,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,wd,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Md,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Td,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Sd,t)},writeBytesField:function(e,t){this.writeTag(e,ud.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,ud.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,ud.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,ud.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,ud.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,ud.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,ud.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,ud.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,ud.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,ud.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};class Dd{constructor(e,{pixelRatio:t,version:i,stretchX:n,stretchY:r,content:o}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=n,this.stretchY=r,this.content=o,this.version=i}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Ld{constructor(e,t){const i={},n={};this.haveRenderCallbacks=[];const r=[];this.addImages(e,i,r),this.addImages(t,n,r);const{w:o,h:a}=zd(r),s=new Qc({width:o||1,height:a||1});for(const t in e){const n=e[t],r=i[t].paddedRect;Qc.copy(n.data,s,{x:0,y:0},{x:r.x+1,y:r.y+1},n.data)}for(const e in t){const i=t[e],r=n[e].paddedRect,o=r.x+1,a=r.y+1,l=i.data.width,c=i.data.height;Qc.copy(i.data,s,{x:0,y:0},{x:o,y:a},i.data),Qc.copy(i.data,s,{x:0,y:c-1},{x:o,y:a-1},{width:l,height:1}),Qc.copy(i.data,s,{x:0,y:0},{x:o,y:a+c},{width:l,height:1}),Qc.copy(i.data,s,{x:l-1,y:0},{x:o-1,y:a},{width:1,height:c}),Qc.copy(i.data,s,{x:0,y:0},{x:o+l,y:a},{width:1,height:c})}this.image=s,this.iconPositions=i,this.patternPositions=n}addImages(e,t,i){for(const n in e){const r=e[n],o={x:0,y:0,w:r.data.width+2,h:r.data.height+2};i.push(o),t[n]=new Dd(o,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(n)}}patchUpdatedImages(e,t){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((t=>e.hasImage(t))),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const i in e.updatedImages)this.patchUpdatedImage(this.iconPositions[i],e.getImage(i),t),this.patchUpdatedImage(this.patternPositions[i],e.getImage(i),t)}patchUpdatedImage(e,t,i){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[n,r]=e.tl;i.update(t.data,void 0,{x:n,y:r})}}Gr(Dd,"ImagePosition"),Gr(Ld,"ImageAtlas");const Rd={horizontal:1,vertical:2,horizontalOnly:3};class Od{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const i=new Od;return i.scale=e||1,i.fontStack=t,i}static forImage(e){const t=new Od;return t.imageName=e,t}}class Bd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const i=new Bd;for(let n=0;n<e.sections.length;n++){const r=e.sections[n];r.image?i.addImageSection(r):i.addTextSection(r,t)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(e,t){let i="";for(let n=0;n<e.length;n++){const r=e.charCodeAt(n+1)||null,o=e.charCodeAt(n-1)||null;i+=!t&&(r&&So(r)&&!rd[e[n+1]]||o&&So(o)&&!rd[e[n-1]])||!rd[e[n]]?e[n]:rd[e[n]]}return i}(this.text,e)}trim(){let e=0;for(let t=0;t<this.text.length&&Nd[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&Nd[this.text.charCodeAt(i)];i--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const i=new Bd;return i.text=this.text.substring(e,t),i.sectionIndex=this.sectionIndex.slice(e,t),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Od.forText(e.scale,e.fontStack||t));const i=this.sections.length-1;for(let t=0;t<e.text.length;++t)this.sectionIndex.push(i)}addImageSection(e){const t=e.image?e.image.name:"";if(0===t.length)return void V("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCharCode(i),this.sections.push(Od.forImage(t)),this.sectionIndex.push(this.sections.length-1)):V("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Fd(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f){const m=Bd.fromFeature(e,r);h===Rd.vertical&&m.verticalizePunctuation(d);let g=[];const _=function(e,t,i,n,r,o){if(!e)return[];const a=[],s=function(e,t,i,n,r,o){let a=0;for(let i=0;i<e.length();i++){const s=e.getSection(i);a+=Vd(e.getCharCode(i),s,n,r,t,o)}return a/Math.max(1,Math.ceil(a/i))}(e,t,i,n,r,o),l=e.text.indexOf("​")>=0;let c=0;for(let i=0;i<e.length();i++){const h=e.getSection(i),d=e.getCharCode(i);if(Nd[d]||(c+=Vd(d,h,n,r,t,o)),i<e.length()-1){const t=!((u=d)<11904||!(no(u)||io(u)||_o(u)||fo(u)||so(u)||Yr(u)||ro(u)||Qr(u)||lo(u)||co(u)||ao(u)||vo(u)||eo(u)||Kr(u)||Jr(u)||oo(u)||to(u)||go(u)||ho(u)||uo(u)));(Ud[d]||t||h.imageName)&&a.push(Wd(i+1,c,s,a,jd(d,e.getCharCode(i+1),t&&l),!1))}}var u;return $d(Wd(e.length(),c,s,a,0,!0))}(m,c,o,t,n,p),{processBidirectionalText:y,processStyledBidirectionalText:x}=Uo;if(y&&1===m.sections.length){const e=y(m.toString(),_);for(const t of e){const e=new Bd;e.text=t,e.sections=m.sections;for(let i=0;i<t.length;i++)e.sectionIndex.push(0);g.push(e)}}else if(x){const e=x(m.text,m.sectionIndex,_);for(const t of e){const e=new Bd;e.text=t[0],e.sectionIndex=t[1],e.sections=m.sections,g.push(e)}}else g=function(e,t){const i=[],n=e.text;let r=0;for(const n of t)i.push(e.substring(r,n)),r=n;return r<n.length&&i.push(e.substring(r,n.length)),i}(m,_);const v=[],b={positionedLines:v,text:m.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(e,t,i,n,r,o,a,s,l,c,u,h){let d=0,p=0,f=0;const m="right"===s?1:"left"===s?0:.5;let g=!1;for(const e of r){const i=e.getSections();for(const e of i){if(e.imageName)continue;const i=t[e.fontStack];if(i&&(g=void 0!==i.ascender&&void 0!==i.descender,!g))break}if(!g)break}let _=0;for(const a of r){a.trim();const r=a.getMaxScale(),s=(r-1)*Jh,x={positionedGlyphs:[],lineOffset:0};e.positionedLines[_]=x;const v=x.positionedGlyphs;let b=0;if(!a.length()){p+=o,++_;continue}let w=0,M=0;for(let o=0;o<a.length();o++){const s=a.getSection(o),f=a.getSectionIndex(o),m=a.getCharCode(o);let _=s.scale,x=null,T=null,S=null,E=Jh,C=0;const A=!(l===Rd.horizontal||!u&&!To(m)||u&&(Nd[m]||(y=m,Zr(y)||Hr(y)||Xr(y)||mo(y)||xo(y))));if(s.imageName){const t=n[s.imageName];if(!t)continue;S=s.imageName,e.iconsInText=e.iconsInText||!0,T=t.paddedRect;const i=t.displaySize;_=_*Jh/h,x={width:i[0],height:i[1],left:1,top:-3,advance:A?i[1]:i[0],localGlyph:!1},C=g?-x.height*_:r*Jh-17-i[1]*_,E=x.advance;const o=(A?i[0]:i[1])*_-Jh*r;o>0&&o>b&&(b=o)}else{const e=i[s.fontStack];if(!e)continue;e[m]&&(T=e[m]);const n=t[s.fontStack];if(!n)continue;const o=n.glyphs[m];if(!o)continue;if(x=o.metrics,E=8203!==m?Jh:0,g){const e=void 0!==n.ascender?Math.abs(n.ascender):0,t=void 0!==n.descender?Math.abs(n.descender):0,i=(e+t)*_;w<i&&(w=i,M=(e-t)/2*_),C=-e*_}else C=(r-_)*Jh-17}A?(e.verticalizable=!0,v.push({glyph:m,imageName:S,x:d,y:p+C,vertical:A,scale:_,localGlyph:x.localGlyph,fontStack:s.fontStack,sectionIndex:f,metrics:x,rect:T}),d+=E*_+c):(v.push({glyph:m,imageName:S,x:d,y:p+C,vertical:A,scale:_,localGlyph:x.localGlyph,fontStack:s.fontStack,sectionIndex:f,metrics:x,rect:T}),d+=x.advance*_+c)}0!==v.length&&(f=Math.max(d-c,f),g?Zd(v,m,b,M,o*r/2):Zd(v,m,b,0,o/2)),d=0;const T=o*r+b;x.lineOffset=Math.max(b,s),p+=T,++_}var y;const x=p,{horizontalAlign:v,verticalAlign:b}=qd(a);(function(e,t,i,n,r,o){const a=(t-i)*r,s=-o*n;for(const t of e)for(const e of t.positionedGlyphs)e.x+=a,e.y+=s})(e.positionedLines,m,v,b,f,x),e.top+=-b*x,e.bottom=e.top+x,e.left+=-v*f,e.right=e.left+f,e.hasBaseline=g}(b,t,i,n,g,a,s,l,h,c,d,f),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(v)&&b}const Nd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ud={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Vd(e,t,i,n,r,o){if(t.imageName){const e=n[t.imageName];return e?e.displaySize[0]*t.scale*Jh/o+r:0}{const n=i[t.fontStack],o=n&&n.glyphs[e];return o?o.metrics.advance*t.scale+r:0}}function Gd(e,t,i,n){const r=Math.pow(e-t,2);return n?e<t?r/2:2*r:r+Math.abs(i)*i}function jd(e,t,i){let n=0;return 10===e&&(n-=1e4),i&&(n+=150),40!==e&&65288!==e||(n+=50),41!==t&&65289!==t||(n+=50),n}function Wd(e,t,i,n,r,o){let a=null,s=Gd(t,i,r,o);for(const e of n){const n=Gd(t-e.x,i,r,o)+e.badness;n<=s&&(a=e,s=n)}return{index:e,x:t,priorBreak:a,badness:s}}function $d(e){return e?$d(e.priorBreak).concat(e.index):[]}function qd(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function Zd(e,t,i,n,r){if(!(t||i||n||r))return;const o=e.length-1,a=e[o],s=(a.x+a.metrics.advance*a.scale)*t;for(let t=0;t<=o;t++)e[t].x-=s,e[t].y+=i+n+r}function Hd(e,t,i){const{horizontalAlign:n,verticalAlign:r}=qd(i),o=t[0]-e.displaySize[0]*n,a=t[1]-e.displaySize[1]*r;return{image:e,top:a,bottom:a+e.displaySize[1],left:o,right:o+e.displaySize[0]}}function Xd(e,t,i,n,r,o){const a=e.image;let s;if(a.content){const e=a.content,t=a.pixelRatio||1;s=[e[0]/t,e[1]/t,a.displaySize[0]-e[2]/t,a.displaySize[1]-e[3]/t]}const l=t.left*o,c=t.right*o;let u,h,d,p;"width"===i||"both"===i?(p=r[0]+l-n[3],h=r[0]+c+n[1]):(p=r[0]+(l+c-a.displaySize[0])/2,h=p+a.displaySize[0]);const f=t.top*o,m=t.bottom*o;return"height"===i||"both"===i?(u=r[1]+f-n[0],d=r[1]+m+n[2]):(u=r[1]+(f+m-a.displaySize[1])/2,d=u+a.displaySize[1]),{image:a,top:u,right:h,bottom:d,left:p,collisionPadding:s}}class Yd extends f{constructor(e,t,i,n,r){super(e,t),this.angle=n,this.z=i,void 0!==r&&(this.segment=r)}clone(){return new Yd(this.x,this.y,this.z,this.angle,this.segment)}}function Jd(e,t,i,n,r){if(void 0===t.segment)return!0;let o=t,a=t.segment+1,s=0;for(;s>-i/2;){if(a--,a<0)return!1;s-=e[a].dist(o),o=e[a]}s+=e[a].dist(e[a+1]),a++;const l=[];let c=0;for(;s<i/2;){const t=e[a],i=e[a+1];if(!i)return!1;let o=e[a-1].angleTo(t)-t.angleTo(i);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:o}),c+=o;s-l[0].distance>n;)c-=l.shift().angleDelta;if(c>r)return!1;a++,s+=t.dist(i)}return!0}function Kd(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}function Qd(e,t,i){return e?.6*t*i:0}function ep(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function tp(e,t,i,n,r,o){const a=Qd(i,r,o),s=ep(i,n)*o;let l=0;const c=Kd(e)/2;for(let i=0;i<e.length-1;i++){const n=e[i],r=e[i+1],o=n.dist(r);if(l+o>c){const u=(c-l)/o,h=Ci(n.x,r.x,u),d=Ci(n.y,r.y,u),p=new Yd(h,d,0,r.angleTo(n),i);return!a||Jd(e,p,s,a,t)?p:void 0}l+=o}}function ip(e,t,i,n,r,o,a,s,l){const c=Qd(n,o,a),u=ep(n,r),h=u*a,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),np(e,d?t/2*s%t:(u/2+2*o)*a*s%t,t,c,i,h,d,!1,l)}function np(e,t,i,n,r,o,a,s,l){const c=o/2,u=Kd(e);let h=0,d=t-i,p=[];for(let t=0;t<e.length-1;t++){const a=e[t],s=e[t+1],f=a.dist(s),m=s.angleTo(a);for(;d+i<h+f;){d+=i;const g=(d-h)/f,_=Ci(a.x,s.x,g),y=Ci(a.y,s.y,g);if(_>=0&&_<l&&y>=0&&y<l&&d-c>=0&&d+c<=u){const i=new Yd(_,y,0,m,t);i._round(),n&&!Jd(e,i,o,n,r)||p.push(i)}}h+=f}return s||p.length||a||(p=np(e,h/2,i,n,r,o,a,!0,l)),p}function rp(e,t,i,n,r){const o=[];for(let a=0;a<e.length;a++){const s=e[a];let l;for(let e=0;e<s.length-1;e++){let a=s[e],c=s[e+1];a.x<t&&c.x<t||(a.x<t?a=new f(t,a.y+(t-a.x)/(c.x-a.x)*(c.y-a.y))._round():c.x<t&&(c=new f(t,a.y+(t-a.x)/(c.x-a.x)*(c.y-a.y))._round()),a.y<i&&c.y<i||(a.y<i?a=new f(a.x+(i-a.y)/(c.y-a.y)*(c.x-a.x),i)._round():c.y<i&&(c=new f(a.x+(i-a.y)/(c.y-a.y)*(c.x-a.x),i)._round()),a.x>=n&&c.x>=n||(a.x>=n?a=new f(n,a.y+(n-a.x)/(c.x-a.x)*(c.y-a.y))._round():c.x>=n&&(c=new f(n,a.y+(n-a.x)/(c.x-a.x)*(c.y-a.y))._round()),a.y>=r&&c.y>=r||(a.y>=r?a=new f(a.x+(r-a.y)/(c.y-a.y)*(c.x-a.x),r)._round():c.y>=r&&(c=new f(a.x+(r-a.y)/(c.y-a.y)*(c.x-a.x),r)._round()),l&&a.equals(l[l.length-1])||(l=[a],o.push(l)),l.push(c)))))}}return o}Gr(Yd,"Anchor");const op=1e20;function ap(e,t,i,n,r,o,a,s,l){for(let c=t;c<t+n;c++)sp(e,i*o+c,o,r,a,s,l);for(let c=i;c<i+r;c++)sp(e,c*o+t,1,n,a,s,l)}function sp(e,t,i,n,r,o,a){o[0]=0,a[0]=-op,a[1]=op,r[0]=e[t];for(let s=1,l=0,c=0;s<n;s++){r[s]=e[t+s*i];const n=s*s;do{const e=o[l];c=(r[s]-r[e]+n-e*e)/(s-e)/2}while(c<=a[l]&&--l>-1);l++,o[l]=s,a[l]=c,a[l+1]=op}for(let s=0,l=0;s<n;s++){for(;a[l+1]<s;)l++;const n=o[l],c=s-n;e[t+s*i]=r[n]+c*c}}const lp={none:0,ideographs:1,all:2};class cp{constructor(e,t,i){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=i,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const i=[];for(const t in e)for(const n of e[t])i.push({stack:t,id:n});C(i,(({stack:e,id:t},i)=>{let n=this.entries[e];n||(n=this.entries[e]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let r=n.glyphs[t];if(void 0!==r)return void i(null,{stack:e,id:t,glyph:r});if(r=this._tinySDF(n,e,t),r)return n.glyphs[t]=r,void i(null,{stack:e,id:t,glyph:r});const o=Math.floor(t/256);if(256*o>65535)return void i(new Error("glyphs > 65535 not supported"));if(n.ranges[o])return void i(null,{stack:e,id:t,glyph:r});let a=n.requests[o];a||(a=n.requests[o]=[],cp.loadGlyphRange(e,o,this.url,this.requestManager,((e,t)=>{if(t){n.ascender=t.ascender,n.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(n.glyphs[+e]=t.glyphs[+e]);n.ranges[o]=!0}for(const i of a)i(e,t);delete n.requests[o]}))),a.push(((n,r)=>{n?i(n):r&&i(null,{stack:e,id:t,glyph:r.glyphs[t]||null})}))}),((e,i)=>{if(e)t(e);else if(i){const e={};for(const{stack:t,id:n,glyph:r}of i)void 0===e[t]&&(e[t]={}),void 0===e[t].glyphs&&(e[t].glyphs={}),e[t].glyphs[n]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics},e[t].ascender=this.entries[t].ascender,e[t].descender=this.entries[t].descender;t(null,e)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==lp.none&&(this.localGlyphMode===lp.all?!!this.localFontFamily:!!this.localFontFamily&&(co(e)||po(e)||eo(e)||to(e)||Qr(e)))}_tinySDF(e,t,i){const n=this.localFontFamily;if(!n||!this._doesCharSupportLocalGlyph(i))return;let r=e.tinySDF;if(!r){let i="400";/bold/i.test(t)?i="900":/medium/i.test(t)?i="500":/light/i.test(t)&&(i="200"),r=e.tinySDF=new cp.TinySDF({fontFamily:n,fontWeight:i,fontSize:48,buffer:6,radius:16}),r.fontWeight=i}if(this.localGlyphs[r.fontWeight][i])return this.localGlyphs[r.fontWeight][i];const o=String.fromCharCode(i),{data:a,width:s,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:h,glyphTop:d,glyphAdvance:p}=r.draw(o);return this.localGlyphs[r.fontWeight][i]={id:i,bitmap:new Kc({width:s,height:l},a),metrics:{width:c/2,height:u/2,left:h/2,top:d/2-27,advance:p/2,localGlyph:!0}}}}function up(e,t,i,n){const r=[],o=e.image,a=o.pixelRatio,s=o.paddedRect.w-2,l=o.paddedRect.h-2,c=e.right-e.left,u=e.bottom-e.top,h=o.stretchX||[[0,s]],d=o.stretchY||[[0,l]],p=(e,t)=>e+t[1]-t[0],m=h.reduce(p,0),g=d.reduce(p,0),_=s-m,y=l-g;let x=0,v=m,b=0,w=g,M=0,T=_,S=0,E=y;if(o.content&&n){const e=o.content;x=hp(h,0,e[0]),b=hp(d,0,e[1]),v=hp(h,e[0],e[2]),w=hp(d,e[1],e[3]),M=e[0]-x,S=e[1]-b,T=e[2]-e[0]-v,E=e[3]-e[1]-w}const C=(n,r,s,l)=>{const h=pp(n.stretch-x,v,c,e.left),d=fp(n.fixed-M,T,n.stretch,m),p=pp(r.stretch-b,w,u,e.top),_=fp(r.fixed-S,E,r.stretch,g),y=pp(s.stretch-x,v,c,e.left),C=fp(s.fixed-M,T,s.stretch,m),A=pp(l.stretch-b,w,u,e.top),P=fp(l.fixed-S,E,l.stretch,g),I=new f(h,p),k=new f(y,p),z=new f(y,A),D=new f(h,A),L=new f(d/a,_/a),R=new f(C/a,P/a),O=t*Math.PI/180;if(O){const e=Math.sin(O),t=Math.cos(O),i=[t,-e,e,t];I._matMult(i),k._matMult(i),D._matMult(i),z._matMult(i)}const B=n.stretch+n.fixed,F=r.stretch+r.fixed;return{tl:I,tr:k,bl:D,br:z,tex:{x:o.paddedRect.x+1+B,y:o.paddedRect.y+1+F,w:s.stretch+s.fixed-B,h:l.stretch+l.fixed-F},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:L,pixelOffsetBR:R,minFontScaleX:T/a/c,minFontScaleY:E/a/u,isSDF:i}};if(n&&(o.stretchX||o.stretchY)){const e=dp(h,_,m),t=dp(d,y,g);for(let i=0;i<e.length-1;i++){const n=e[i],o=e[i+1];for(let e=0;e<t.length-1;e++)r.push(C(n,t[e],o,t[e+1]))}}else r.push(C({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:s+1},{fixed:0,stretch:l+1}));return r}function hp(e,t,i){let n=0;for(const r of e)n+=Math.max(t,Math.min(i,r[1]))-Math.max(t,Math.min(i,r[0]));return n}function dp(e,t,i){const n=[{fixed:-1,stretch:0}];for(const[t,i]of e){const e=n[n.length-1];n.push({fixed:t-e.stretch,stretch:e.stretch}),n.push({fixed:t-e.stretch,stretch:e.stretch+(i-t)})}return n.push({fixed:t+1,stretch:i}),n}function pp(e,t,i,n){return e/t*i+n}function fp(e,t,i,n){return e-t*i/n}function mp(e,t,i,n){const r=t+e.positionedLines[n].lineOffset;return 0===n?i+r/2:i+(r+(t+e.positionedLines[n-1].lineOffset))/2}cp.loadGlyphRange=function(e,t,i,n,r){const o=256*t,a=o+255,s=n.transformRequest(n.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}",`${o}-${a}`),oe.Glyphs);ce(s,((e,t)=>{if(e)r(e);else if(t){const e={},i=function(e){return new sd(e).readFields(Pd,{})}(t);for(const t of i.glyphs)e[t.id]=t;r(null,{glyphs:e,ascender:i.ascender,descender:i.descender})}}))},cp.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:n=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=t,this.cutoff=n,this.radius=i;const s=this.size=e+4*t,l=this._createCanvas(s),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${a} ${o} ${e}px ${r}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(i),s=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-r))),l=Math.min(this.size-this.buffer,a+Math.ceil(n)),c=s+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:s,glyphHeight:l,glyphTop:a,glyphLeft:0,glyphAdvance:t};if(0===s||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:_}=this;f.clearRect(m,m,s,l),f.fillText(e,m,m+a);const y=f.getImageData(m,m,s,l);_.fill(op,0,h),g.fill(0,0,h);for(let e=0;e<l;e++)for(let t=0;t<s;t++){const i=y.data[4*(e*s+t)+3]/255;if(0===i)continue;const n=(e+m)*c+t+m;if(1===i)_[n]=0,g[n]=op;else{const e=.5-i;_[n]=e>0?e*e:0,g[n]=e<0?e*e:0}}ap(_,0,0,c,u,c,this.f,this.v,this.z),ap(g,m,m,s,l,c,this.f,this.v,this.z);for(let e=0;e<h;e++){const t=Math.sqrt(_[e])-Math.sqrt(g[e]);d[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}};class gp{constructor(e=[],t=_p){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,n=t[e];for(;e>0;){const r=e-1>>1,o=t[r];if(i(n,o)>=0)break;t[e]=o,e=r}t[e]=n}_down(e){const{data:t,compare:i}=this,n=this.length>>1,r=t[e];for(;e<n;){let n=1+(e<<1),o=t[n];const a=n+1;if(a<this.length&&i(t[a],o)<0&&(n=a,o=t[a]),i(o,r)>=0)break;t[e]=o,e=n}t[e]=r}}function _p(e,t){return e<t?-1:e>t?1:0}function yp(e,t=1,i=!1){let n=1/0,r=1/0,o=-1/0,a=-1/0;const s=e[0];for(let e=0;e<s.length;e++){const t=s[e];(!e||t.x<n)&&(n=t.x),(!e||t.y<r)&&(r=t.y),(!e||t.x>o)&&(o=t.x),(!e||t.y>a)&&(a=t.y)}const l=Math.min(o-n,a-r);let c=l/2;const u=new gp([],xp);if(0===l)return new f(n,r);for(let t=n;t<o;t+=l)for(let i=r;i<a;i+=l)u.push(new vp(t+c,i+c,c,e));let h=function(e){let t=0,i=0,n=0;const r=e[0];for(let e=0,o=r.length,a=o-1;e<o;a=e++){const o=r[e],s=r[a],l=o.x*s.y-s.x*o.y;i+=(o.x+s.x)*l,n+=(o.y+s.y)*l,t+=3*l}return new vp(i/t,n/t,0,e)}(e),d=u.length;for(;u.length;){const n=u.pop();(n.d>h.d||!h.d)&&(h=n,i&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,d)),n.max-h.d<=t||(c=n.h/2,u.push(new vp(n.p.x-c,n.p.y-c,c,e)),u.push(new vp(n.p.x+c,n.p.y-c,c,e)),u.push(new vp(n.p.x-c,n.p.y+c,c,e)),u.push(new vp(n.p.x+c,n.p.y+c,c,e)),d+=4)}return i&&(console.log(`num probes: ${d}`),console.log(`best distance: ${h.d}`)),h.p}function xp(e,t){return t.max-e.max}function vp(e,t,i,n){this.p=new f(e,t),this.h=i,this.d=function(e,t){let i=!1,n=1/0;for(let r=0;r<t.length;r++){const o=t[r];for(let t=0,r=o.length,a=r-1;t<r;a=t++){const r=o[t],s=o[a];r.y>e.y!=s.y>e.y&&e.x<(s.x-r.x)*(e.y-r.y)/(s.y-r.y)+r.x&&(i=!i),n=Math.min(n,zc(e,r,s))}}return(i?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const bp=Number.POSITIVE_INFINITY,wp=Math.sqrt(2);function Mp(e,[t,i]){let n=0,r=0;if(i===bp){t<0&&(t=0);const i=t/wp;switch(e){case"top-right":case"top-left":r=i-7;break;case"bottom-right":case"bottom-left":r=7-i;break;case"bottom":r=7-t;break;case"top":r=t-7}switch(e){case"top-right":case"bottom-right":n=-i;break;case"top-left":case"bottom-left":n=i;break;case"left":n=t;break;case"right":n=-t}}else{switch(t=Math.abs(t),i=Math.abs(i),e){case"top-right":case"top-left":case"top":r=i-7;break;case"bottom-right":case"bottom-left":case"bottom":r=7-i}switch(e){case"top-right":case"bottom-right":case"right":n=-t;break;case"top-left":case"bottom-left":case"left":n=t}}return[n,r]}function Tp(e,t,i,n,r,o,a,s,l,c){e.createArrays(),e.tilePixelRatio=Ss/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const u=e.layers[0].layout,h=e.layers[0]._unevaluatedLayout._values,d={};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:i}=e.textSizeData;d.compositeTextSizes=[h["text-size"].possiblyEvaluate(new Vo(t),s),h["text-size"].possiblyEvaluate(new Vo(i),s)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:i}=e.iconSizeData;d.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new Vo(t),s),h["icon-size"].possiblyEvaluate(new Vo(i),s)]}d.layoutTextSize=h["text-size"].possiblyEvaluate(new Vo(l+1),s),d.layoutIconSize=h["icon-size"].possiblyEvaluate(new Vo(l+1),s),d.textMaxSize=h["text-size"].possiblyEvaluate(new Vo(18),s);const p="map"===u.get("text-rotation-alignment")&&"point"!==u.get("symbol-placement"),f=u.get("text-size");for(const o of e.features){const l=u.get("text-font").evaluate(o,{},s).join(","),h=f.evaluate(o,{},s),m=d.layoutTextSize.evaluate(o,{},s),g=(d.layoutIconSize.evaluate(o,{},s),{horizontal:{},vertical:void 0}),_=o.text;let y,x=[0,0];if(_){const n=_.toString(),a=u.get("text-letter-spacing").evaluate(o,{},s)*Jh,c=u.get("text-line-height").evaluate(o,{},s)*Jh,d=wo(n)?a:0,f=u.get("text-anchor").evaluate(o,{},s),y=u.get("text-variable-anchor");if(!y){const e=u.get("text-radial-offset").evaluate(o,{},s);x=e?Mp(f,[e*Jh,bp]):u.get("text-offset").evaluate(o,{},s).map((e=>e*Jh))}let v=p?"center":u.get("text-justify").evaluate(o,{},s);const b="point"===u.get("symbol-placement"),w=b?u.get("text-max-width").evaluate(o,{},s)*Jh:1/0,M=o=>{e.allowVerticalPlacement&&bo(n)&&(g.vertical=Fd(_,t,i,r,l,w,c,f,o,d,x,Rd.vertical,!0,m,h))};if(!p&&y){const e="auto"===v?y.map((e=>Sp(e))):[v];let n=!1;for(let o=0;o<e.length;o++){const a=e[o];if(!g.horizontal[a])if(n)g.horizontal[a]=g.horizontal[0];else{const e=Fd(_,t,i,r,l,w,c,"center",a,d,x,Rd.horizontal,!1,m,h);e&&(g.horizontal[a]=e,n=1===e.positionedLines.length)}}M("left")}else{if("auto"===v&&(v=Sp(f)),b||u.get("text-writing-mode").indexOf("horizontal")>=0||!bo(n)){const e=Fd(_,t,i,r,l,w,c,f,v,d,x,Rd.horizontal,!1,m,h);e&&(g.horizontal[v]=e)}M(b?"left":v)}}let v=!1;if(o.icon&&o.icon.name){const t=n[o.icon.name];t&&(y=Hd(r[o.icon.name],u.get("icon-offset").evaluate(o,{},s),u.get("icon-anchor").evaluate(o,{},s)),v=t.sdf,void 0===e.sdfIcons?e.sdfIcons=t.sdf:e.sdfIcons!==t.sdf&&V("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==u.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const b=Pp(g.horizontal)||g.vertical;e.iconsInText||(e.iconsInText=!!b&&b.iconsInText),(b||y)&&Ep(e,o,g,y,n,d,m,0,x,v,a,s,c)}o&&e.generateCollisionDebugBuffers(l,e.collisionBoxArray)}function Sp(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ep(e,t,i,n,r,o,a,s,l,c,u,h,d){let p=o.textMaxSize.evaluate(t,{},h);void 0===p&&(p=a);const f=e.layers[0].layout,m=f.get("icon-offset").evaluate(t,{},h),g=Pp(i.horizontal)||i.vertical,_="globe"===d.name,x=a/24,v=e.tilePixelRatio*p/24,b=(P=e.overscaling,e.zoom>18&&P>2&&(P>>=1),Math.max(Ss/(512*P),1)*f.get("symbol-spacing")),w=f.get("text-padding")*e.tilePixelRatio,M=f.get("icon-padding")*e.tilePixelRatio,T=y(f.get("text-max-angle")),S="map"===f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),E="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),C=f.get("symbol-placement"),A=b/2;var P;const I=f.get("icon-text-fit");let k;n&&"none"!==I&&(e.allowVerticalPlacement&&i.vertical&&(k=Xd(n,i.vertical,I,f.get("icon-text-fit-padding"),m,x)),g&&(n=Xd(n,g,I,f.get("icon-text-fit-padding"),m,x)));const z=(a,s,p)=>{if(s.x<0||s.x>=Ss||s.y<0||s.y>=Ss)return;let f=null;if(_){const{x:e,y:t,z:i}=d.projectTilePoint(s.x,s.y,p);f={anchor:new Yd(e,t,i,0,void 0),up:d.upVector(p,s.x,s.y)}}!function(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,g,_,y,x,v,b,w,M,T){const S=e.addToLineVertexArray(t,n);let E,C,A,P,I,k,z,D=0,L=0,R=0,O=0,B=-1,F=-1;const N={};let U=Wa("");const G=i?i.anchor:t;let j=0,W=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[j,W]=l.layout.get("text-offset").evaluate(v,{},T).map((e=>e*Jh)):(j=l.layout.get("text-radial-offset").evaluate(v,{},T)*Jh,W=bp),e.allowVerticalPlacement&&r.vertical){const e=r.vertical;if(f)k=kp(e),s&&(z=kp(s));else{const i=l.layout.get("text-rotate").evaluate(v,{},T)+90;A=Ip(c,G,t,u,h,d,e,p,i,m),s&&(P=Ip(c,G,t,u,h,d,s,_,i))}}if(o){const n=l.layout.get("icon-rotate").evaluate(v,{},T),r="none"!==l.layout.get("icon-text-fit"),a=up(o,n,w,r),p=s?up(s,n,w,r):void 0;C=Ip(c,G,t,u,h,d,o,_,n),D=4*a.length;const f=e.iconSizeData;let m=null;"source"===f.kind?(m=[Kh*l.layout.get("icon-size").evaluate(v,{},T)],m[0]>Cp&&V(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===f.kind&&(m=[Kh*b.compositeIconSizes[0].evaluate(v,{},T),Kh*b.compositeIconSizes[1].evaluate(v,{},T)],(m[0]>Cp||m[1]>Cp)&&V(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),e.addSymbols(e.icon,a,m,x,y,v,!1,i,t,S.lineStartIndex,S.lineLength,-1,M,T),B=e.icon.placedSymbolArray.length-1,p&&(L=4*p.length,e.addSymbols(e.icon,p,m,x,y,v,Rd.vertical,i,t,S.lineStartIndex,S.lineLength,-1,M,T),F=e.icon.placedSymbolArray.length-1)}for(const n in r.horizontal){const o=r.horizontal[n];E||(U=Wa(o.text),f?I=kp(o):E=Ip(c,G,t,u,h,d,o,p,l.layout.get("text-rotate").evaluate(v,{},T),m));const s=1===o.positionedLines.length;if(R+=Ap(e,i,t,o,a,l,f,v,m,S,r.vertical?Rd.horizontal:Rd.horizontalOnly,s?Object.keys(r.horizontal):[n],N,B,b,M,T),s)break}r.vertical&&(O+=Ap(e,i,t,r.vertical,a,l,f,v,m,S,Rd.vertical,["vertical"],N,F,b,M,T));let $=-1;const q=(e,t)=>e?Math.max(e,t):t;$=q(I,$),$=q(k,$),$=q(z,$);const Z=$>-1?1:0;e.glyphOffsetArray.length>=hf.MAX_GLYPHS&&V("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==v.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,v.sortKey),e.symbolInstances.emplaceBack(G.x,G.y,G.z,t.x,t.y,N.right>=0?N.right:-1,N.center>=0?N.center:-1,N.left>=0?N.left:-1,N.vertical>=0?N.vertical:-1,B,F,U,void 0!==E?E:e.collisionBoxArray.length,void 0!==E?E+1:e.collisionBoxArray.length,void 0!==A?A:e.collisionBoxArray.length,void 0!==A?A+1:e.collisionBoxArray.length,void 0!==C?C:e.collisionBoxArray.length,void 0!==C?C+1:e.collisionBoxArray.length,P||e.collisionBoxArray.length,P?P+1:e.collisionBoxArray.length,u,R,O,D,L,Z,0,j,W,$)}(e,s,f,a,i,n,r,k,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,w,S,l,0,M,E,m,t,o,c,u,h)};if("line"===C)for(const r of rp(t.geometry,0,0,Ss,Ss)){const t=ip(r,b,T,i.vertical||g,n,24,v,e.overscaling,Ss);for(const i of t)g&&zp(e,g.text,A,i)||z(r,i,h)}else if("line-center"===C){for(const e of t.geometry)if(e.length>1){const t=tp(e,T,i.vertical||g,n,24,v);t&&z(e,t,h)}}else if("Polygon"===t.type)for(const e of Ou(t.geometry,0)){const t=yp(e,16);z(e[0],new Yd(t.x,t.y,0,0,void 0),h)}else if("LineString"===t.type)for(const e of t.geometry)z(e,new Yd(e[0].x,e[0].y,0,0,void 0),h);else if("Point"===t.type)for(const e of t.geometry)for(const t of e)z([t],new Yd(t.x,t.y,0,0,void 0),h)}const Cp=32640;function Ap(e,t,i,n,r,o,a,s,l,c,u,h,d,p,m,g,_){const y=function(e,t,i,n,r,o,a,s){const l=[];if(0===t.positionedLines.length)return l;const c=n.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=function(e){const t=e[0],i=e[1],n=t*i;return n>0?[t,-i]:n<0?[-t,i]:0===t?[i,t]:[i,-t]}(i);let h=Math.abs(t.top-t.bottom);for(const e of t.positionedLines)h-=e.lineOffset;const d=t.positionedLines.length,p=h/d;let m=t.top-i[1];for(let e=0;e<d;++e){const n=t.positionedLines[e];m=mp(t,p,m,e);for(const e of n.positionedGlyphs){if(!e.rect)continue;const n=e.rect||{};let o=4,h=!0,d=1,p=0;if(e.imageName){const t=a[e.imageName];if(!t)continue;if(t.sdf){V("SDF images are not supported in formatted text and will be ignored.");continue}h=!1,d=t.pixelRatio,o=1/d}const g=(r||s)&&e.vertical,_=e.metrics.advance*e.scale/2,y=e.metrics,x=e.rect;if(null===x)continue;s&&t.verticalizable&&(p=e.imageName?_-e.metrics.width*e.scale/2:0);const v=r?[e.x+_,e.y]:[0,0];let b=[0,0],w=[0,0],M=!1;r||(g?(w=[e.x+_+u[0],e.y+u[1]-p],M=!0):b=[e.x+_+i[0],e.y+i[1]-p]);const T=x.w*e.scale/(d*(e.localGlyph?2:1)),S=x.h*e.scale/(d*(e.localGlyph?2:1));let E,C,A,P;if(g){const t=e.y-m,i=new f(-_,_-t),n=-Math.PI/2,r=new f(...w);E=new f(-_+b[0],b[1]),E._rotateAround(n,i)._add(r),E.x+=-t+_,E.y-=(y.left-o)*e.scale;const a=e.imageName?y.advance*e.scale:Jh*e.scale,s=String.fromCharCode(e.glyph);od(s)?E.x+=(1-o)*e.scale:ad(s)?E.x+=a-y.height*e.scale+(-o-1)*e.scale:E.x+=e.imageName||y.width+2*o===x.w&&y.height+2*o===x.h?(a-S)/2:(a-(y.height+2*o)*e.scale)/2,C=new f(E.x,E.y-T),A=new f(E.x+S,E.y),P=new f(E.x+S,E.y-T)}else{const t=(y.left-o)*e.scale-_+b[0],i=(-y.top-o)*e.scale+b[1],n=t+T,r=i+S;E=new f(t,i),C=new f(n,i),A=new f(t,r),P=new f(n,r)}if(c){let e;e=r?new f(0,0):M?new f(u[0],u[1]):new f(i[0],i[1]),E._rotateAround(c,e),C._rotateAround(c,e),A._rotateAround(c,e),P._rotateAround(c,e)}const I=new f(0,0),k=new f(0,0);l.push({tl:E,tr:C,bl:A,br:P,tex:n,writingMode:t.writingMode,glyphOffset:v,sectionIndex:e.sectionIndex,isSDF:h,pixelOffsetTL:I,pixelOffsetBR:k,minFontScaleX:0,minFontScaleY:0})}}return l}(0,n,l,o,a,s,r,e.allowVerticalPlacement),x=e.textSizeData;let v=null;"source"===x.kind?(v=[Kh*o.layout.get("text-size").evaluate(s,{},_)],v[0]>Cp&&V(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===x.kind&&(v=[Kh*m.compositeTextSizes[0].evaluate(s,{},_),Kh*m.compositeTextSizes[1].evaluate(s,{},_)],(v[0]>Cp||v[1]>Cp)&&V(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),e.addSymbols(e.text,y,v,l,a,s,u,t,i,c.lineStartIndex,c.lineLength,p,g,_);for(const t of h)d[t]=e.text.placedSymbolArray.length-1;return 4*y.length}function Pp(e){for(const t in e)return e[t];return null}function Ip(e,t,i,n,r,o,a,s,l,c){let u=a.top,h=a.bottom,d=a.left,p=a.right;const m=a.collisionPadding;if(m&&(d-=m[0],u-=m[1],p+=m[2],h+=m[3]),l){const e=new f(d,u),t=new f(p,u),i=new f(d,h),n=new f(p,h),r=y(l);let o=new f(0,0);c&&(o=new f(c[0],c[1])),e._rotateAround(r,o),t._rotateAround(r,o),i._rotateAround(r,o),n._rotateAround(r,o),d=Math.min(e.x,t.x,i.x,n.x),p=Math.max(e.x,t.x,i.x,n.x),u=Math.min(e.y,t.y,i.y,n.y),h=Math.max(e.y,t.y,i.y,n.y)}return e.emplaceBack(t.x,t.y,t.z,i.x,i.y,d,u,p,h,s,n,r,o),e.length-1}function kp(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function zp(e,t,i,n){const r=e.compareText;if(t in r){const e=r[t];for(let t=e.length-1;t>=0;t--)if(n.dist(e[t])<i)return!0}else r[t]=[];return r[t].push(n),!1}function Dp(e,t){const i=e.fovAboveCenter,n=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,r=(e._camera.position[2]*e.worldSize-n)/Math.cos(e._pitch),o=Math.sin(i)*r/Math.sin(Math.max(Math.PI/2-e._pitch-i,.01)),a=Math.sin(e._pitch)*o+r;return Math.min(1.01*a,r*(1/e._horizonShift))}function Lp(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const i=Math.pow(2,-e.z),n=e.x*i,r=(e.x+1)*i,o=e.y*i,a=(e.y+1)*i,s=sc(n),l=sc(r),c=lc(o),u=lc(a),h=t.project(s,c),d=t.project(l,c),p=t.project(l,u),f=t.project(s,u);let m=Math.min(h.x,d.x,p.x,f.x),g=Math.min(h.y,d.y,p.y,f.y),_=Math.max(h.x,d.x,p.x,f.x),y=Math.max(h.y,d.y,p.y,f.y);const x=i/16;function v(e,i,n,r,o,a){const s=(n+o)/2,l=(r+a)/2,c=t.project(sc(s),lc(l)),u=Math.max(0,m-c.x,g-c.y,c.x-_,c.y-y);m=Math.min(m,c.x),_=Math.max(_,c.x),g=Math.min(g,c.y),y=Math.max(y,c.y),u>x&&(v(e,c,n,r,s,l),v(c,i,s,l,o,a))}v(h,d,n,o,r,o),v(d,p,r,o,r,a),v(p,f,r,a,n,a),v(f,h,n,a,n,o),m-=x,g-=x,_+=x,y+=x;const b=1/Math.max(_-m,y-g);return{scale:b,x:m*b,y:g*b,x2:_*b,y2:y*b,projection:t}}const Rp=ks(new Float32Array(16));class Op{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new ic(0,0)}projectTilePoint(e,t,i){return{x:e,y:t,z:0}}locationPoint(e,t,i=!0){return e._coordinatePoint(e.locationCoordinate(t),i)}pixelsPerMeter(e,t){return ac(1,e)*t}pixelSpaceConversion(e,t,i){return 1}farthestPixelDistance(e){return Dp(e,e.pixelsPerMeter)}pointCoordinate(e,t,i,n){const r=e.horizonLineFromTop(!1),o=new f(t,Math.max(r,i));return e.rayIntersectionCoordinate(e.pointRayIntersection(o,n))}pointCoordinate3D(e,t,i){const n=new f(t,i);if(e.elevation)return e.elevation.pointCoordinate(n);{const t=this.pointCoordinate(e,n.x,n.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const i=e.horizonLineFromTop();return t.y<i}createInversionMatrix(e,t){return Rp}createTileMatrix(e,t,i){let n,r,o;const a=i.canonical,s=ks(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=Lp(a,this);n=1,r=l.x+i.wrap*l.scale,o=l.y,Rs(s,s,[n/l.scale,n/l.scale,e.pixelsPerMeter/t])}else n=t/e.zoomScale(a.z),r=(a.x+Math.pow(2,a.z)*i.wrap)*n,o=a.y*n;return Ls(s,s,[r,o,0]),Rs(s,s,[n/Ss,n/Ss,1]),s}upVector(e,t,i){return[0,0,1]}upVectorScale(e,t,i){return{metersToTile:1}}}class Bp extends Op{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,i]=this.parallels=e.parallels||[29.5,45.5],n=Math.sin(y(t));this.n=(n+Math.sin(y(i)))/2,this.c=1+n*(2*this.n-n),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:i,c:n,r0:r}=this,o=y(e-this.center[0]),a=y(t),s=Math.sqrt(n-2*i*Math.sin(a))/i;return{x:s*Math.sin(o*i),y:s*Math.cos(o*i)-r,z:0}}unproject(e,t){const{n:i,c:n,r0:r}=this,o=r+t;let a=Math.atan2(e,Math.abs(o))*Math.sign(o);o*i<0&&(a-=Math.PI*Math.sign(e)*Math.sign(o));const s=y(this.center[0])*i;a=E(a,-Math.PI-s,Math.PI-s);const l=T(x(a/i)+this.center[0],-180,180),c=Math.asin(T((n-(e*e+o*o)*i*i)/(2*i),-1,1)),u=T(x(c),-uc,uc);return new ic(l,u)}}const Fp=1.340264,Np=-.081106,Up=893e-6,Vp=.003796,Gp=Math.sqrt(3)/2;class jp extends Op{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const i=Math.asin(Gp*Math.sin(t)),n=i*i,r=n*n*n;return{x:.5*(e*Math.cos(i)/(Gp*(Fp+3*Np*n+r*(7*Up+9*Vp*n)))/Math.PI+.5),y:1-.5*(i*(Fp+Np*n+r*(Up+Vp*n))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let i=t=(2*(1-t)-1)*Math.PI,n=i*i,r=n*n*n;for(let e,o,a,s=0;s<12&&(o=i*(Fp+Np*n+r*(Up+Vp*n))-t,a=Fp+3*Np*n+r*(7*Up+9*Vp*n),e=o/a,i=T(i-e,-Math.PI/3,Math.PI/3),n=i*i,r=n*n*n,!(Math.abs(e)<1e-12));++s);const o=Gp*e*(Fp+3*Np*n+r*(7*Up+9*Vp*n))/Math.cos(i),a=Math.asin(Math.sin(i)/Gp),s=T(180*o/Math.PI,-180,180),l=T(180*a/Math.PI,-uc,uc);return new ic(s,l)}}class Wp extends Op{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const i=360*(e-.5),n=T(360*(.5-t),-uc,uc);return new ic(i,n)}}const $p=Math.PI/2;function qp(e){return Math.tan(($p+e)/2)}class Zp extends Op{constructor(e){super(e),this.center=e.center||[0,30];const[t,i]=this.parallels=e.parallels||[30,30];let n=y(t),r=y(i);this.southernCenter=n+r<0,this.southernCenter&&(n=-n,r=-r);const o=Math.cos(n),a=qp(n);this.n=n===r?Math.sin(n):Math.log(o/Math.cos(r))/Math.log(qp(r)/a),this.f=o*Math.pow(qp(n),this.n)/this.n}project(e,t){t=y(t),this.southernCenter&&(t=-t),e=y(e-this.center[0]);const i=1e-6,{n:n,f:r}=this;r>0?t<-$p+i&&(t=-$p+i):t>$p-i&&(t=$p-i);const o=r/Math.pow(qp(t),n);let a=o*Math.sin(n*e),s=r-o*Math.cos(n*e);return a=.5*(a/Math.PI+.5),s=.5*(s/Math.PI+.5),{x:a,y:this.southernCenter?s:1-s,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n:i,f:n}=this,r=n-t,o=Math.sign(r),a=Math.sign(i)*Math.sqrt(e*e+r*r);let s=Math.atan2(e,Math.abs(r))*o;r*i<0&&(s-=Math.PI*Math.sign(e)*o);const l=T(x(s/i)+this.center[0],-180,180),c=T(x(2*Math.atan(Math.pow(n/a,1/i))-$p),-uc,uc);return new ic(l,this.southernCenter?-c:c)}}class Hp extends Op{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:rc(e),y:oc(t),z:0}}unproject(e,t){const i=sc(e),n=lc(t);return new ic(i,n)}}const Xp=y(uc);class Yp extends Op{project(e,t){const i=(t=y(t))*t,n=i*i;return{x:.5*((e=y(e))*(.8707-.131979*i+n*(n*(.003971*i-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+i*(.015085+n*(.028874*i-.044475-.005916*n)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let i=t=(2*(1-t)-1)*Math.PI,n=25,r=0,o=i*i;do{o=i*i;const e=o*o;r=(i*(1.007226+o*(.015085+e*(.028874*o-.044475-.005916*e)))-t)/(1.007226+o*(.045255+e*(.259866*o-.311325-.005916*11*e))),i=T(i-r,-Xp,Xp)}while(Math.abs(r)>1e-6&&--n>0);o=i*i;const a=T(x(e/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),s=x(i);return new ic(a,s)}}const Jp=y(uc);class Kp extends Op{project(e,t){t=y(t),e=y(e);const i=Math.cos(t),n=2/Math.PI,r=Math.acos(i*Math.cos(e/2)),o=Math.sin(r)/r,a=.5*(e*n+2*i*Math.sin(e/2)/o)||0,s=.5*(t+Math.sin(t)/o)||0;return{x:.5*(a/Math.PI+.5),y:1-.5*(s/Math.PI+1),z:0}}unproject(e,t){let i=e=(2*e-.5)*Math.PI,n=t=(2*(1-t)-1)*Math.PI,r=25;const o=1e-6;let a=0,s=0;do{const r=Math.cos(n),o=Math.sin(n),l=2*o*r,c=o*o,u=r*r,h=Math.cos(i/2),d=Math.sin(i/2),p=2*h*d,f=d*d,m=1-u*h*h,g=m?1/m:0,_=m?Math.acos(r*h)*Math.sqrt(1/m):0,y=.5*(2*_*r*d+2*i/Math.PI)-e,x=.5*(_*o+n)-t,v=.5*g*(u*f+_*r*h*c)+1/Math.PI,b=g*(p*l/4-_*o*d),w=.125*g*(l*d-_*o*u*p),M=.5*g*(c*h+_*f*r)+.5,S=b*w-M*v;a=(x*b-y*M)/S,s=(y*w-x*v)/S,i=T(i-a,-Math.PI,Math.PI),n=T(n-s,-Jp,Jp)}while((Math.abs(a)>o||Math.abs(s)>o)&&--r>0);return new ic(x(i),x(n))}}class Qp extends Op{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(y(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:i,cosPhi:n}=this;return{x:y(e)*n*i+.5,y:-Math.sin(y(t))/n*i+.5,z:0}}unproject(e,t){const{scale:i,cosPhi:n}=this,r=-(t-.5)/i,o=T(x((e-.5)/i)/n,-180,180),a=Math.asin(T(r*n,-1,1)),s=T(x(a),-uc,uc);return new ic(o,s)}}class ef extends Hp{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,t,i){const n=Gl(e,t,i);return tl(n,n,$l(Dl(i))),{x:n[0],y:n[1],z:n[2]}}locationPoint(e,t){const i=Vl(t.lat,t.lng),n=Ks([],i),r=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;Js(i,i,n,ac(1,0)*Ss*r);const o=ks(new Float64Array(16));return Ds(o,e.pixelMatrix,e.globeMatrix),tl(i,i,o),new f(i[0],i[1])}pixelsPerMeter(e,t){return ac(1,0)*t}pixelSpaceConversion(e,t,i){const n=ac(1,e)*t,r=Ci(ac(1,45)*t,n,i);return this.pixelsPerMeter(e,t)/r}createTileMatrix(e,t,i){const n=ql(Dl(i.canonical));return Ds(new Float64Array(16),e.globeMatrix,n)}createInversionMatrix(e,t){const{center:i}=e,n=$l(Dl(t));return Bs(n,n,y(i.lng)),Os(n,n,y(i.lat)),Rs(n,n,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(n)}pointCoordinate(e,t,i,n){return Il(e,t,i,!0)||new dc(0,0)}pointCoordinate3D(e,t,i){const n=this.pointCoordinate(e,t,i,0);return[n.x,n.y,n.z]}isPointAboveHorizon(e,t){return!Il(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(e,t){const i=e.cameraToCenterDistance,n=e._centerAltitude*t,r=e._camera,o=e._camera.forward(),a=$s([],Ys([],o,-i),[0,0,n]),s=e.worldSize/(2*Math.PI),l=[0,0,-s],c=e.width/e.height,u=Math.tan(e.fovAboveCenter),h=Ys([],r.up(),u),d=Ys([],r.right(),u*c),p=Ks([],$s([],$s([],o,h),d)),f=[];let m;if(new xl(a,p).closestPointOnSphere(l,s,f)){const t=$s([],f,l),i=rl([],t,a);m=Math.cos(e.fovAboveCenter)*js(i)}else{const e=rl([],a,l),t=rl([],l,a);Ks(t,t);const i=js(e)-s;m=Math.sqrt(i*(i+2*s));const n=Math.acos(m/(s+i))-Math.acos(Qs(o,t));m*=Math.cos(n)}return 1.01*m}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),i=Hl(e.zoom);if(i>0){const n=Dp(e,ac(1,e.center.lat)*e.worldSize),r=e.worldSize/(2*Math.PI),o=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ci(t,n+r*(1-Math.cos(o)),Math.pow(i,10))}return t}upVector(e,t,i){return Gl(t,i,e,1)}upVectorScale(e){return{metersToTile:Pl(jl(Dl(e)))}}}function tf(e){const t=e.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new Hp(e);case"equirectangular":return new Wp(e);case"naturalEarth":return new Yp(e);case"equalEarth":return new jp(e);case"winkelTripel":return new Kp(e);case"albers":return i?new Qp(e):new Bp(e);case"lambertConformalConic":return i?new Qp(e):new Zp(e);case"globe":return new ef(e)}throw new Error(`Invalid projection name: ${e.name}`)}const nf=ah.types,rf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function of(e,t,i,n,r,o,a,s,l,c,u,h,d){const p=s?Math.min(Cp,Math.round(s[0])):0,f=s?Math.min(Cp,Math.round(s[1])):0;e.emplaceBack(t,i,Math.round(32*n),Math.round(32*r),o,a,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function af(e,t,i,n,r,o,a){e.emplaceBack(t,i,n,r,o,a)}function sf(e,t,i,n,r){e.emplaceBack(t,i,n,r),e.emplaceBack(t,i,n,r),e.emplaceBack(t,i,n,r),e.emplaceBack(t,i,n,r)}function lf(e){for(const t of e.sections)if(Ao(t.text))return!0;return!1}class cf{constructor(e){this.layoutVertexArray=new fa,this.indexArray=new wa,this.programConfigurations=e,this.segments=new Ts,this.dynamicLayoutVertexArray=new ua,this.opacityVertexArray=new ga,this.placedSymbolArray=new La,this.globeExtVertexArray=new ma}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,i,n){this.isEmpty()||(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,qh.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,rf,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,$h.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||n)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Gr(cf,"SymbolBuffers");class uf{constructor(e,t,i){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new i,this.segments=new Ts,this.collisionVertexArray=new va,this.collisionVertexArrayExt=new ba}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Zh.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Hh.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Gr(uf,"CollisionBuffers");class hf{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ks([]),this.placementViewportMatrix=ks([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Qh(this.zoom,t["text-size"]),this.iconSizeData=Qh(this.zoom,t["icon-size"]);const i=this.layers[0].layout,n=i.get("symbol-sort-key"),r=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==r&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map((e=>Rd[e])),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new cf(new fs(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new cf(new fs(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new Ba,this.lineVertexArray=new Fa,this.symbolInstances=new Oa}calculateGlyphDependencies(e,t,i,n,r){for(let i=0;i<e.length;i++)if(t[e.charCodeAt(i)]=!0,n&&r){const n=rd[e.charAt(i)];n&&(t[n.charCodeAt(0)]=!0)}}populate(e,t,i,n){const r=this.layers[0],o=r.layout,a="globe"===this.projection.name,s=o.get("text-font"),l=o.get("text-field"),c=o.get("icon-image"),u=("constant"!==l.value.kind||l.value.value instanceof It&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==s.value.kind||s.value.value.length>0),h="constant"!==c.value.kind||!!c.value.value||Object.keys(c.parameters).length>0,d=o.get("symbol-sort-key");if(this.features=[],!u&&!h)return;const p=t.iconDependencies,f=t.glyphDependencies,m=t.availableImages,g=new Vo(this.zoom);for(const{feature:t,id:l,index:c,sourceLayerIndex:_}of e){const e=r._featureFilter.needGeometry,y=bc(t,e);if(!r._featureFilter.filter(g,y,i))continue;if(e||(y.geometry=vc(t,i,n)),a&&1!==t.type&&i.z<=5){const e=y.geometry,t=.98078528056,n=(e,n)=>Qs(Gl(e.x,e.y,i,1),Gl(n.x,n.y,i,1))<t;for(let t=0;t<e.length;t++)e[t]=gc(e[t],n)}let x,v;if(u){const e=r.getValueAndResolveTokens("text-field",y,i,m),t=It.factory(e);lf(t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Fo()||this.hasRTLText&&Uo.isParsed())&&(x=nd(t,r,y))}if(h){const e=r.getValueAndResolveTokens("icon-image",y,i,m);v=e instanceof kt?e:kt.fromString(e)}if(!x&&!v)continue;const b=this.sortFeaturesByKey?d.evaluate(y,{},i):void 0;if(this.features.push({id:l,text:x,icon:v,index:c,sourceLayerIndex:_,geometry:y.geometry,properties:t.properties,type:nf[t.type],sortKey:b}),v&&(p[v.name]=!0),x){const e=s.evaluate(y,{},i).join(","),t="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Rd.vertical)>=0;for(const i of x.sections)if(i.image)p[i.image.name]=!0;else{const n=bo(x.toString()),r=i.fontStack||e,o=f[r]=f[r]||{};this.calculateGlyphDependencies(i.text,o,t,this.allowVerticalPlacement,n)}}}"line"===o.get("symbol-placement")&&(this.features=function(e){const t={},i={},n=[];let r=0;function o(t){n.push(e[t]),r++}function a(e,t,r){const o=i[e];return delete i[e],i[t]=o,n[o].geometry[0].pop(),n[o].geometry[0]=n[o].geometry[0].concat(r[0]),o}function s(e,i,r){const o=t[i];return delete t[i],t[e]=o,n[o].geometry[0].shift(),n[o].geometry[0]=r[0].concat(n[o].geometry[0]),o}function l(e,t,i){const n=i?t[0][t[0].length-1]:t[0][0];return`${e}:${n.x}:${n.y}`}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in i&&f in t&&i[p]!==t[f]){const e=s(p,f,h),r=a(p,f,n[e].geometry);delete t[p],delete i[f],i[l(d,n[r].geometry,!0)]=r,n[e].geometry=null}else p in i?a(p,f,h):f in t?s(p,f,h):(o(c),t[p]=r-1,i[f]=r-1)}return n.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,i,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,i,n),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,i,n))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=tf(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const i=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:e,y:i}of t)this.lineVertexArray.emplaceBack(e,i);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,t,i,n,r,o,a,s,l,c,u,h,d,p){const f=e.indexArray,m=e.layoutVertexArray,g=e.globeExtVertexArray,_=e.segments.prepareSegment(4*t.length,m,f,this.canOverlap?o.sortKey:void 0),y=this.glyphOffsetArray.length,x=_.vertexLength,v=this.allowVerticalPlacement&&a===Rd.vertical?Math.PI/2:0,b=o.text&&o.text.sections;for(let n=0;n<t.length;n++){const{tl:r,tr:a,bl:c,br:u,tex:h,pixelOffsetTL:y,pixelOffsetBR:x,minFontScaleX:w,minFontScaleY:M,glyphOffset:T,isSDF:S,sectionIndex:E}=t[n],C=_.vertexLength,A=T[1];if(of(m,l.x,l.y,r.x,A+r.y,h.x,h.y,i,S,y.x,y.y,w,M),of(m,l.x,l.y,a.x,A+a.y,h.x+h.w,h.y,i,S,x.x,y.y,w,M),of(m,l.x,l.y,c.x,A+c.y,h.x,h.y+h.h,i,S,y.x,x.y,w,M),of(m,l.x,l.y,u.x,A+u.y,h.x+h.w,h.y+h.h,i,S,x.x,x.y,w,M),s){const{x:t,y:i,z:n}=s.anchor,[r,o,a]=s.up;af(g,t,i,n,r,o,a),af(g,t,i,n,r,o,a),af(g,t,i,n,r,o,a),af(g,t,i,n,r,o,a),sf(e.dynamicLayoutVertexArray,t,i,n,v)}else sf(e.dynamicLayoutVertexArray,l.x,l.y,l.z,v);f.emplaceBack(C,C+1,C+2),f.emplaceBack(C+1,C+2,C+3),_.vertexLength+=4,_.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(T[0]),n!==t.length-1&&E===t[n+1].sectionIndex||e.programConfigurations.populatePaintArrays(m.length,o,o.index,{},d,p,b&&b[E])}const w=s?s.anchor:l;e.placedSymbolArray.emplaceBack(w.x,w.y,w.z,l.x,l.y,y,this.glyphOffsetArray.length-y,x,c,u,l.segment,i?i[0]:0,i?i[1]:0,n[0],n[1],a,0,!1,0,h,0)}_commitLayoutVertex(e,t,i,n,r,o,a){e.emplaceBack(t,i,n,r,o,Math.round(a.x),Math.round(a.y))}_addCollisionDebugVertices(e,t,i,n,r,o,a){const s=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),l=s.vertexLength,c=a.tileAnchorX,u=a.tileAnchorY;for(let e=0;e<4;e++)i.collisionVertexArray.emplaceBack(0,0,0,0);i.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),i.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),i.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),i.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(i.layoutVertexArray,n,r,o,c,u,new f(e.x1,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,n,r,o,c,u,new f(e.x2,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,n,r,o,c,u,new f(e.x2,e.y2)),this._commitLayoutVertex(i.layoutVertexArray,n,r,o,c,u,new f(e.x1,e.y2)),s.vertexLength+=4;const h=i.indexArray;h.emplaceBack(l,l+1),h.emplaceBack(l+1,l+2),h.emplaceBack(l+2,l+3),h.emplaceBack(l+3,l),s.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,i,n,r,o){for(let a=n;a<r;a++){const n=i.get(a),r=this.getSymbolInstanceTextSize(e,o,t,a);this._addCollisionDebugVertices(n,r,this.textCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(e,t,i,n,r,o){for(let a=n;a<r;a++){const n=i.get(a),r=this.getSymbolInstanceIconSize(e,t,o.placedIconSymbolIndex);this._addCollisionDebugVertices(n,r,this.iconCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,o)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new uf(ya,Xh.members,Aa),this.iconCollisionBox=new uf(ya,Xh.members,Aa);const i=td(this.iconSizeData,e),n=td(this.textSizeData,e);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this._addTextDebugCollisionBoxes(n,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(n,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(i,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(i,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(e,t,i,n){const r=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:n),o=ed(this.textSizeData,e,r)/Jh;return this.tilePixelRatio*o}getSymbolInstanceIconSize(e,t,i){const n=this.icon.placedSymbolArray.get(i),r=ed(this.iconSizeData,e,n);return this.tilePixelRatio*r}_commitDebugCollisionVertexUpdate(e,t,i){e.emplaceBack(t,-i,-i),e.emplaceBack(t,i,-i),e.emplaceBack(t,i,i),e.emplaceBack(t,-i,i)}_updateTextDebugCollisionBoxes(e,t,i,n,r,o){for(let a=n;a<r;a++){const n=i.get(a),r=this.getSymbolInstanceTextSize(e,o,t,a);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,r,n.padding)}}_updateIconDebugCollisionBoxes(e,t,i,n,r,o){for(let a=n;a<r;a++){const n=i.get(a),r=this.getSymbolInstanceIconSize(e,t,o);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,r,n.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=td(this.iconSizeData,e),n=td(this.textSizeData,e);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this._updateTextDebugCollisionBoxes(n,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(n,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(i,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(i,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,i,n,r,o,a,s,l){const c={};if(t<i){const{x1:i,y1:n,x2:r,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(t);c.textBox={x1:i,y1:n,x2:r,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.textFeatureIndex=p}if(n<r){const{x1:t,y1:i,x2:r,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(n);c.verticalTextBox={x1:t,y1:i,x2:r,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalTextFeatureIndex=p}if(o<a){const{x1:t,y1:i,x2:n,y2:r,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(o);c.iconBox={x1:t,y1:i,x2:n,y2:r,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.iconFeatureIndex=p}if(s<l){const{x1:t,y1:i,x2:n,y2:r,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(s);c.verticalIconBox={x1:t,y1:i,x2:n,y2:r,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalIconFeatureIndex=p}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const i=e.placedSymbolArray.get(t),n=i.vertexStartIndex+4*i.numGlyphs;for(let t=i.vertexStartIndex;t<n;t+=4)e.indexArray.emplaceBack(t,t+1,t+2),e.indexArray.emplaceBack(t+1,t+2,t+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),i=Math.cos(e),n=[],r=[],o=[];for(let e=0;e<this.symbolInstances.length;++e){o.push(e);const a=this.symbolInstances.get(e);n.push(0|Math.round(t*a.tileAnchorX+i*a.tileAnchorY)),r.push(a.featureIndex)}return o.sort(((e,t)=>n[e]-n[t]||r[t]-r[e])),o}addToSortKeyRanges(e,t){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===t?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex);const{rightJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:n,leftJustifiedTextSymbolIndex:r,verticalPlacedTextSymbolIndex:o,placedIconSymbolIndex:a,verticalPlacedIconSymbolIndex:s}=t;i>=0&&this.addIndicesForPlacedSymbol(this.text,i),n>=0&&n!==i&&this.addIndicesForPlacedSymbol(this.text,n),r>=0&&r!==n&&r!==i&&this.addIndicesForPlacedSymbol(this.text,r),o>=0&&this.addIndicesForPlacedSymbol(this.text,o),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Gr(hf,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),hf.MAX_GLYPHS=65535,hf.addDynamicAttributes=sf;const df=new Qo({"symbol-placement":new Yo(Ye.layout_symbol["symbol-placement"]),"symbol-spacing":new Yo(Ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Yo(Ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Jo(Ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Yo(Ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Yo(Ye.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Yo(Ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new Yo(Ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Yo(Ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new Jo(Ye.layout_symbol["icon-size"]),"icon-text-fit":new Yo(Ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Yo(Ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new Jo(Ye.layout_symbol["icon-image"]),"icon-rotate":new Jo(Ye.layout_symbol["icon-rotate"]),"icon-padding":new Yo(Ye.layout_symbol["icon-padding"]),"icon-keep-upright":new Yo(Ye.layout_symbol["icon-keep-upright"]),"icon-offset":new Jo(Ye.layout_symbol["icon-offset"]),"icon-anchor":new Jo(Ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Yo(Ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Yo(Ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Yo(Ye.layout_symbol["text-rotation-alignment"]),"text-field":new Jo(Ye.layout_symbol["text-field"]),"text-font":new Jo(Ye.layout_symbol["text-font"]),"text-size":new Jo(Ye.layout_symbol["text-size"]),"text-max-width":new Jo(Ye.layout_symbol["text-max-width"]),"text-line-height":new Jo(Ye.layout_symbol["text-line-height"]),"text-letter-spacing":new Jo(Ye.layout_symbol["text-letter-spacing"]),"text-justify":new Jo(Ye.layout_symbol["text-justify"]),"text-radial-offset":new Jo(Ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Yo(Ye.layout_symbol["text-variable-anchor"]),"text-anchor":new Jo(Ye.layout_symbol["text-anchor"]),"text-max-angle":new Yo(Ye.layout_symbol["text-max-angle"]),"text-writing-mode":new Yo(Ye.layout_symbol["text-writing-mode"]),"text-rotate":new Jo(Ye.layout_symbol["text-rotate"]),"text-padding":new Yo(Ye.layout_symbol["text-padding"]),"text-keep-upright":new Yo(Ye.layout_symbol["text-keep-upright"]),"text-transform":new Jo(Ye.layout_symbol["text-transform"]),"text-offset":new Jo(Ye.layout_symbol["text-offset"]),"text-allow-overlap":new Yo(Ye.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Yo(Ye.layout_symbol["text-ignore-placement"]),"text-optional":new Yo(Ye.layout_symbol["text-optional"])});var pf={paint:new Qo({"icon-opacity":new Jo(Ye.paint_symbol["icon-opacity"]),"icon-color":new Jo(Ye.paint_symbol["icon-color"]),"icon-halo-color":new Jo(Ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new Jo(Ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Jo(Ye.paint_symbol["icon-halo-blur"]),"icon-translate":new Yo(Ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new Yo(Ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new Jo(Ye.paint_symbol["text-opacity"]),"text-color":new Jo(Ye.paint_symbol["text-color"],{runtimeType:lt,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Jo(Ye.paint_symbol["text-halo-color"]),"text-halo-width":new Jo(Ye.paint_symbol["text-halo-width"]),"text-halo-blur":new Jo(Ye.paint_symbol["text-halo-blur"]),"text-translate":new Yo(Ye.paint_symbol["text-translate"]),"text-translate-anchor":new Yo(Ye.paint_symbol["text-translate-anchor"])}),layout:df};class ff{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:rt,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Gr(ff,"FormatSectionOverride",{omit:["defaultValue"]});class mf extends bs{constructor(e){super(e,pf)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const e=[];for(const t of i)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,i,n){const r=this.layout.get(e).evaluate(t,{},i,n),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||Wn(o.value)||!r?r:function(e,t){return t.replace(/{([^{}]+)}/g,((t,i)=>i in e?String(e[i]):""))}(t.properties,r)}createBucket(e){return new hf(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of pf.paint.overridableProperties){if(!mf.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),i=new ff(t),n=new jn(i,t.property.specification);let r=null;r="constant"===t.value.kind||"source"===t.value.kind?new qn("source",n):new Zn("composite",n,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new Ho(t.property,r,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven())&&mf.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const i=e.get("text-field"),n=pf.paint.properties[t];let r=!1;const o=e=>{for(const t of e)if(n.overrides&&n.overrides.hasOverride(t))return void(r=!0)};if("constant"===i.value.kind&&i.value.value instanceof It)o(i.value.value.sections);else if("source"===i.value.kind){const e=t=>{r||(t instanceof Bt&&Lt(t.value)===dt?o(t.value.sections):t instanceof Gt?o(t.sections):t.eachChild(e))},t=i.value;t._styleExpression&&e(t._styleExpression.expression)}return r}getProgramConfiguration(e){return new ps(this,e)}}var gf={paint:new Qo({"background-color":new Yo(Ye.paint_background["background-color"]),"background-pattern":new Yo(Ye.paint_background["background-pattern"]),"background-opacity":new Yo(Ye.paint_background["background-opacity"])})},_f={paint:new Qo({"raster-opacity":new Yo(Ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new Yo(Ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Yo(Ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Yo(Ye.paint_raster["raster-brightness-max"]),"raster-saturation":new Yo(Ye.paint_raster["raster-saturation"]),"raster-contrast":new Yo(Ye.paint_raster["raster-contrast"]),"raster-resampling":new Yo(Ye.paint_raster["raster-resampling"]),"raster-fade-duration":new Yo(Ye.paint_raster["raster-fade-duration"])})};class yf extends bs{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var xf={paint:new Qo({"sky-type":new Yo(Ye.paint_sky["sky-type"]),"sky-atmosphere-sun":new Yo(Ye.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Yo(Ye.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Yo(Ye.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Yo(Ye.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ko(Ye.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Yo(Ye.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Yo(Ye.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Yo(Ye.paint_sky["sky-opacity"])})};function vf(e,t,i){const n=[0,0,1],r=hl([]);return pl(r,r,i?-y(e)+Math.PI:y(e)),dl(r,r,-y(t)),il(n,n,r),Ks(n,n)}const bf={circle:class extends bs{constructor(e){super(e,Gc)}createBucket(e){return new Tc(e)}queryRadius(e){const t=e;return Bc("circle-radius",this,t)+Bc("circle-stroke-width",this,t)+Fc(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,i,n,r,o,a,s){const l=Uc(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return jc(e,n,o,a,s,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getProgramConfiguration(e){return new ps(this,e)}},heatmap:class extends bs{createBucket(e){return new Hc(e)}constructor(e){super(e,eu),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=tu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Bc("heatmap-radius",this,e)}queryIntersectsFeature(e,t,i,n,r,o,a,s){const l=this.paint.get("heatmap-radius").evaluate(t,i);return jc(e,n,o,a,s,!0,!0,new f(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(e){return new ps(this,e)}},hillshade:class extends bs{constructor(e){super(e,iu)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends bs{constructor(e){super(e,Gu)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(e){return new ps(this,e)}recalculate(e,t){super.recalculate(e,t);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Uu(e)}queryRadius(){return Fc(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,i,n,r,o){return!e.queryGeometry.isAboveHorizon&&Cc(Nc(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends bs{constructor(e){super(e,Mh)}createBucket(e){return new ph(e)}queryRadius(){return Fc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(e){return new ps(this,e)}queryIntersectsFeature(e,t,i,n,r,o,a,s,l){const c=Uc(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),u=this.paint.get("fill-extrusion-height").evaluate(t,i),h=this.paint.get("fill-extrusion-base").evaluate(t,i),d=[0,0],p=s&&o.elevation,m=o.elevation?o.elevation.exaggeration():1,g=e.tile.getBucket(this);if(p&&g instanceof ph){const e=g.centroidVertexArray,t=l+1;t<e.length&&(d[0]=e.geta_centroid_pos0(t),d[1]=e.geta_centroid_pos1(t))}if(0===d[0]&&1===d[1])return!1;"globe"===o.projection.name&&(n=bh([n],[new f(0,0),new f(Ss,Ss)],e.tileID.canonical).map((e=>e.polygon)).flat());const _=p?s:null,[y,x]=function(e,t,i,n,r,o,a,s,l,c,u){return"globe"===e.projection.name?function(e,t,i,n,r,o,a,s,l,c,u){const h=[],d=[],p=e.projection.upVectorScale(u,e.center.lat,e.worldSize).metersToTile,f=[0,0,0,1],m=[0,0,0,1],g=(e,t,i,n)=>{e[0]=t,e[1]=i,e[2]=n,e[3]=1},_=vh();i>0&&(i+=_),n+=_;for(const _ of t){const t=[],y=[];for(const h of _){const d=h.x+r.x,_=h.y+r.y,x=e.projection.projectTilePoint(d,_,u),v=e.projection.upVector(u,h.x,h.y);let b=i,w=n;if(a){const e=zh(d,_,i,n,a,s,l,c);b+=e.base,w+=e.top}0!==i?g(f,x.x+v[0]*p*b,x.y+v[1]*p*b,x.z+v[2]*p*b):g(f,x.x,x.y,x.z),g(m,x.x+v[0]*p*w,x.y+v[1]*p*w,x.z+v[2]*p*w),tl(f,f,o),tl(m,m,o),t.push(new Ph(f[0],f[1],f[2])),y.push(new Ph(m[0],m[1],m[2]))}h.push(t),d.push(y)}return[h,d]}(e,t,i,n,r,o,a,s,l,c,u):a?function(e,t,i,n,r,o,a,s,l){const c=[],u=[],h=[0,0,0,1];for(const d of e){const e=[],p=[];for(const c of d){const u=c.x+n.x,d=c.y+n.y,f=zh(u,d,t,i,o,a,s,l);h[0]=u,h[1]=d,h[2]=f.base,h[3]=1,cl(h,h,r),h[3]=Math.max(h[3],1e-5);const m=new Ph(h[0]/h[3],h[1]/h[3],h[2]/h[3]);h[0]=u,h[1]=d,h[2]=f.top,h[3]=1,cl(h,h,r),h[3]=Math.max(h[3],1e-5);const g=new Ph(h[0]/h[3],h[1]/h[3],h[2]/h[3]);e.push(m),p.push(g)}c.push(e),u.push(p)}return[c,u]}(t,i,n,r,o,a,s,l,c):function(e,t,i,n,r){const o=[],a=[],s=r[8]*t,l=r[9]*t,c=r[10]*t,u=r[11]*t,h=r[8]*i,d=r[9]*i,p=r[10]*i,f=r[11]*i;for(const t of e){const e=[],i=[];for(const o of t){const t=o.x+n.x,a=o.y+n.y,m=r[0]*t+r[4]*a+r[12],g=r[1]*t+r[5]*a+r[13],_=r[2]*t+r[6]*a+r[14],y=r[3]*t+r[7]*a+r[15],x=m+s,v=g+l,b=_+c,w=Math.max(y+u,1e-5),M=m+h,T=g+d,S=_+p,E=Math.max(y+f,1e-5);e.push(new Ph(x/w,v/w,b/w)),i.push(new Ph(M/E,T/E,S/E))}o.push(e),a.push(i)}return[o,a]}(t,i,n,r,o)}(o,n,h,u,c,a,_,d,m,o.center.lat,e.tileID.canonical),v=e.queryGeometry;return function(e,t,i){let n=1/0;Cc(i,t)&&(n=kh(i,t[0]));for(let r=0;r<t.length;r++){const o=t[r],a=e[r];for(let e=0;e<o.length-1;e++){const t=o[e],r=[t,o[e+1],a[e+1],a[e],t];Sc(i,r)&&(n=Math.min(n,kh(i,r)))}}return n!==1/0&&n}(y,x,v.isPointQuery()?v.screenBounds:v.screenGeometry)}},line:class extends bs{constructor(e){super(e,Vh),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ei,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Gh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Nh(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(e){return new ps(this,e)}queryRadius(e){const t=e,i=jh(Bc("line-width",this,t),Bc("line-gap-width",this,t)),n=Bc("line-offset",this,t);return i/2+Math.abs(n)+Fc(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,i,n,r,o){if(e.queryGeometry.isAboveHorizon)return!1;const a=Nc(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),s=e.pixelToTileUnitsFactor/2*jh(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),l=this.paint.get("line-offset").evaluate(t,i);return l&&(n=function(e,t){const i=[],n=new f(0,0);for(let r=0;r<e.length;r++){const o=e[r],a=[];for(let e=0;e<o.length;e++){const i=o[e-1],r=o[e],s=o[e+1],l=0===e?n:r.sub(i)._unit()._perp(),c=e===o.length-1?n:s.sub(r)._unit()._perp(),u=l._add(c)._unit();u._mult(1/(u.x*c.x+u.y*c.y)),a.push(u._mult(t)._add(r))}i.push(a)}return i}(n,l*e.pixelToTileUnitsFactor)),function(e,t,i){for(let n=0;n<t.length;n++){const r=t[n];if(e.length>=3)for(let t=0;t<r.length;t++)if(Lc(e,r[t]))return!0;if(Ac(e,r,i))return!0}return!1}(a,n,s)}isTileClipped(){return!0}},symbol:mf,background:class extends bs{constructor(e){super(e,gf)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends bs{constructor(e){super(e,_f)}getProgramIds(){return["raster"]}},sky:class extends bs{constructor(e){super(e,xf),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=tu({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),n=!i,r=e.style.light,o=r.properties.get("position");return n&&"viewport"===r.properties.get("anchor")&&V("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?vf(o.azimuthal,90-o.polar,t):vf(i[0],90-i[1],t)}const i=this.paint.get("sky-gradient-center");return vf(i[0],90-i[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}}};class wf{constructor(e,t,i,n){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this.update(t,n)}update(e,i,n){const{width:r,height:o}=e,{context:a}=this,{gl:s}=a,{HTMLImageElement:l,HTMLCanvasElement:c,HTMLVideoElement:u,ImageData:h,ImageBitmap:d}=t;if(s.bindTexture(s.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!i||!1!==i.premultiply)),n||this.size&&this.size[0]===r&&this.size[1]===o){const{x:t,y:i}=n||{x:0,y:0};e instanceof l||e instanceof c||e instanceof u||e instanceof h||d&&e instanceof d?s.texSubImage2D(s.TEXTURE_2D,0,t,i,s.RGBA,s.UNSIGNED_BYTE,e):s.texSubImage2D(s.TEXTURE_2D,0,t,i,r,o,s.RGBA,s.UNSIGNED_BYTE,e.data)}else this.size=[r,o],e instanceof l||e instanceof c||e instanceof u||e instanceof h||d&&e instanceof d?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,e):s.texImage2D(s.TEXTURE_2D,0,this.format,r,o,0,this.format,s.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&s.generateMipmap(s.TEXTURE_2D)}bind(e,t){const{context:i}=this,{gl:n}=i;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.useMipmap?e===n.NEAREST?n.NEAREST_MIPMAP_NEAREST:n.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Mf{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Tf{constructor(){this.tasks={},this.taskQueue=[],R(["process"],this),this.invoker=new Mf(this.process),this.nextId=0}add(e,t){const i=this.nextId++,n=function({type:e,isSymbolTile:t,zoom:i}){return i=i||0,"message"===e?0:"maybePrepare"!==e||t?"parseTile"!==e||t?"parseTile"===e&&t?300-i:"maybePrepare"===e&&t?400-i:500:200-i:100-i}(t);if(0===n){W();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[i]={fn:e,metadata:t,priority:n,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){W();try{if(this.taskQueue=this.taskQueue.filter((e=>!!this.tasks[e])),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let i=0;i<this.taskQueue.length;i++){const n=this.tasks[this.taskQueue[i]];n.priority<t&&(t=n.priority,e=i)}if(null===e)return null;const i=this.taskQueue[e];return this.taskQueue.splice(e,1),i}remove(){this.invoker.remove()}}class Sf{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const i=e[t];this._stringToNumber[i]=t,this._numberToString[t]=i}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Ef=["tile","layer","source","sourceLayer","state"];class Cf{constructor(e,t,i,n,r){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=i,this._y=n,this.properties=e.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of Ef)void 0!==this[t]&&(e[t]=this[t]);return e}}const Af=32,Pf=33,If=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,i=0,n=0,r=0,o=0,a=0,s=0;for(1&t?r=o=a=Af:i=n=s=Af;(t>>=1)>1;){const e=i+r>>1,l=n+o>>1;1&t?(r=i,o=n,i=a,n=s):(i=r,n=o,r=a,o=s),a=e,s=l}const l=4*e;If[l+0]=i,If[l+1]=n,If[l+2]=r,If[l+3]=o}const kf=new Uint16Array(2178),zf=new Uint8Array(1089),Df=new Uint16Array(1089);function Lf(e){return 0===e?-.03125:32===e?.03125:0}var Rf=ra([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Of={type:2,extent:Ss,loadGeometry:()=>[[new f(0,0),new f(8193,0),new f(8193,8193),new f(0,8193),new f(0,0)]]};class Bf{constructor(e,t,i,n,r){this.tileID=e,this.uid=k(),this.uses=0,this.tileSize=t,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=r,this.expiredRequestCount=0,this.state="loading",n&&n.transform&&(this.projection=n.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<We.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Lp(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,i){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const i={};if(!t)return i;for(const n of e){const e=n.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){n.layers=e,n.stateDependentLayerIds&&(n.stateDependentLayers=n.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)i[t.id]=n}}return i}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const t=this.buckets[e];if(t instanceof hf){if(this.hasSymbolBuckets=!0,!i)break;t.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const t=this.buckets[e];if(t instanceof hf&&t.hasRTLText){this.hasRTLText=!0,Uo.isLoading()||Uo.isLoaded()||"deferred"!==Fo()||No();break}}this.queryPadding=0;for(const e in this.buckets){const i=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(e).queryRadius(i))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new za}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const t in this.buckets){const i=this.buckets[t];i.uploadPending()&&i.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new wf(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new wf(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new wf(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,i,n,r,o,a,s){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:n,pixelPosMatrix:a,transform:o,params:r,tileTransform:this.tileTransform},e,t,i):{}}querySourceFeatures(e,t){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const n=i.loadVTLayers(),r=t?t.sourceLayer:"",o=n._geojsonTileLayer||n[r];if(!o)return;const a=ar(t&&t.filter),{z:s,x:l,y:c}=this.tileID.canonical,u={z:s,x:l,y:c};for(let t=0;t<o.length;t++){const n=o.feature(t);if(a.needGeometry){const e=bc(n,!0);if(!a.filter(new Vo(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!a.filter(new Vo(this.tileID.overscaledZ),n))continue;const h=i.getId(n,r),d=new Cf(n,s,l,c,h);d.tile=u,e.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const t=$(e.cacheControl);t["max-age"]&&(this.expirationTime=Date.now()+1e3*t["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let i=!1;if(this.expirationTime>e)i=!1;else if(t)if(this.expirationTime<t)i=!0;else{const n=this.expirationTime-t;n?this.expirationTime=e+Math.max(n,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!t)return;const i=this.latestFeatureIndex.loadVTLayers(),n=t.style.listImages();for(const r in this.buckets){if(!t.style.hasLayer(r))continue;const o=this.buckets[r],a=o.layers[0].sourceLayer||"_geojsonTileLayer",s=i[a],l=e[a];if(!s||!l||0===Object.keys(l).length)continue;if(o.update(l,s,n,this.imageAtlas&&this.imageAtlas.patternPositions||{}),o instanceof Nh||o instanceof Uu){const e=t.style._getSourceCache(o.layers[0].source);t._terrain&&t._terrain.enabled&&e&&o.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(e.id,this.tileID)}const c=t&&t.style&&t.style.getLayer(r);c&&(this.queryPadding=Math.max(this.queryPadding,c.queryRadius(o)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<We.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=We.now()+e}setTexture(e,t){const i=t.context,n=i.gl;this.texture=this.texture||t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new wf(i,e,n.RGBA,{useMipmap:!0}),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),i.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax))}setDependencies(e,t){const i={};for(const e of t)i[e]=!0;this.dependencies[e]=i}hasDependency(e,t){for(const i of e){const e=this.dependencies[i];if(e)for(const i of t)if(e[i])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||"mercator"===t.name||this._tileDebugBuffer)return;const i=vc(Of,this.tileID.canonical,this.tileTransform)[0],n=new aa,r=new Pa;for(let e=0;e<i.length;e++){const{x:t,y:o}=i[e];n.emplaceBack(t,o),r.emplaceBack(e)}r.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(r),this._tileDebugBuffer=e.createVertexBuffer(n,yl.members),this._tileDebugSegments=Ts.simpleSegment(0,0,n.length,r.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||"mercator"===t.name)return;const i=vc(Of,this.tileID.canonical,this.tileTransform)[0];let n,r;if(this.isRaster){const e=function(e,t){const i=Lp(e,t),n=Math.pow(2,e.z);for(let r=0;r<Pf;r++)for(let o=0;o<Pf;o++){const a=sc((e.x+(o+Lf(o))/Af)/n),s=lc((e.y+(r+Lf(r))/Af)/n),l=t.project(a,s),c=r*Pf+o;kf[2*c+0]=Math.round((l.x*i.scale-i.x)*Ss),kf[2*c+1]=Math.round((l.y*i.scale-i.y)*Ss)}zf.fill(0),Df.fill(0);for(let e=2045;e>=0;e--){const t=4*e,i=If[t+0],n=If[t+1],r=If[t+2],o=If[t+3],a=i+r>>1,s=n+o>>1,l=a+s-n,c=s+i-a,u=n*Pf+i,h=o*Pf+r,d=s*Pf+a,p=Math.hypot((kf[2*u+0]+kf[2*h+0])/2-kf[2*d+0],(kf[2*u+1]+kf[2*h+1])/2-kf[2*d+1])>=16;if(zf[d]=zf[d]||(p?1:0),e<1022){const e=(n+c>>1)*Pf+(i+l>>1),t=(o+c>>1)*Pf+(r+l>>1);zf[d]=zf[d]||zf[e]||zf[t]}}const r=new la,o=new wa;let a=0;function s(e,t){const i=t*Pf+e;return 0===Df[i]&&(r.emplaceBack(kf[2*i+0],kf[2*i+1],e*Ss/Af,t*Ss/Af),Df[i]=++a),Df[i]-1}function l(e,t,i,n,r,a){const c=e+i>>1,u=t+n>>1;if(Math.abs(e-r)+Math.abs(t-a)>1&&zf[u*Pf+c])l(r,a,e,t,c,u),l(i,n,r,a,c,u);else{const l=s(e,t),c=s(i,n),u=s(r,a);o.emplaceBack(l,c,u)}}return l(0,0,Af,Af,Af,0),l(Af,Af,0,0,0,Af),{vertices:r,indices:o}}(this.tileID.canonical,t);n=e.vertices,r=e.indices}else{n=new la,r=new wa;for(const{x:e,y:t}of i)n.emplaceBack(e,t,0,0);const e=ou(n.int16,void 0,4);for(let t=0;t<e.length;t+=3)r.emplaceBack(e[t],e[t+1],e[t+2])}this._tileBoundsBuffer=e.createVertexBuffer(n,Rf.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(r),this._tileBoundsSegments=Ts.simpleSegment(0,0,n.length,r.length)}_makeGlobeTileDebugBuffers(e,t){const i=t.projection;if(!i||"globe"!==i.name||t.freezeTileCoverage)return;const n=this.tileID.canonical,r=$l(Rl(n,t)),o=Hl(t.zoom);let a;o>0&&(a=zs(new Float64Array(16),t.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,n,t,r,a,o),this._makeGlobeTileDebugTextBuffer(e,n,t,r,a,o)}_globePoint(e,t,i,n,r,o,a){let s=Gl(e,t,i);if(o){const r=1<<i.z,l=rc(n.center.lng),c=oc(n.center.lat),u=(i.x+.5)/r-l;let h=0;u>.5?h=-1:u<-.5&&(h=1);let d=(e/Ss+i.x)/r+h,p=(t/Ss+i.y)/r;d=(d-l)*n._pixelsPerMercatorPixel+l,p=(p-c)*n._pixelsPerMercatorPixel+c;const f=[d*n.worldSize,p*n.worldSize,0];tl(f,f,o),s=Ll(s,f,a)}return tl(s,s,r)}_makeGlobeTileDebugBorderBuffer(e,t,i,n,r,o){const a=new aa,s=new Pa,l=new sa,c=(e,c,u,h,d)=>{const p=(u-e)/(d-1),f=(h-c)/(d-1),m=a.length;for(let u=0;u<d;u++){const h=e+u*p,d=c+u*f;a.emplaceBack(h,d);const g=this._globePoint(h,d,t,i,n,r,o);l.emplaceBack(g[0],g[1],g[2]),s.emplaceBack(m+u)}},u=Ss;c(0,0,u,0,16),c(u,0,u,u,16),c(u,u,0,u,16),c(0,u,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(s),this._tileDebugBuffer=e.createVertexBuffer(a,yl.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(l,_l.members),this._tileDebugSegments=Ts.simpleSegment(0,0,a.length,s.length)}_makeGlobeTileDebugTextBuffer(e,t,i,n,r,o){const a=new aa,s=new wa,l=new sa,c=25;s.reserve(32),a.reserve(c),l.reserve(c);const u=(e,t)=>c*e+t;for(let e=0;e<c;e++){const s=2048*e;for(let e=0;e<c;e++){const c=2048*e;a.emplaceBack(c,s);const u=this._globePoint(c,s,t,i,n,r,o);l.emplaceBack(u[0],u[1],u[2])}}for(let e=0;e<4;e++)for(let t=0;t<4;t++){const i=u(e,t),n=u(e,t+1),r=u(e+1,t),o=u(e+1,t+1);s.emplaceBack(i,n,r),s.emplaceBack(r,n,o)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(s),this._tileDebugTextBuffer=e.createVertexBuffer(a,yl.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(l,_l.members),this._tileDebugTextSegments=Ts.simpleSegment(0,0,c,32)}}class Ff{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,i){const n=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][n]=this.stateChanges[e][n]||{},P(this.stateChanges[e][n],i),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==n&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][n]){this.deletedStates[e][n]={};for(const t in this.state[e][n])i[t]||(this.deletedStates[e][n][t]=null)}else for(const t in i)this.deletedStates[e]&&this.deletedStates[e][n]&&null===this.deletedStates[e][n][t]&&delete this.deletedStates[e][n][t]}removeFeatureState(e,t,i){if(null===this.deletedStates[e])return;const n=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&void 0!==t)null!==this.deletedStates[e][n]&&(this.deletedStates[e][n]=this.deletedStates[e][n]||{},this.deletedStates[e][n][i]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][n])for(i in this.deletedStates[e][n]={},this.stateChanges[e][n])this.deletedStates[e][n][i]=null;else this.deletedStates[e][n]=null;else this.deletedStates[e]=null}getState(e,t){const i=String(t),n=P({},(this.state[e]||{})[i],(this.stateChanges[e]||{})[i]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const i=this.deletedStates[e][t];if(null===i)return{};for(const e in i)delete n[e]}return n}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const i={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const t={};for(const i in this.stateChanges[e])this.state[e][i]||(this.state[e][i]={}),P(this.state[e][i],this.stateChanges[e][i]),t[i]=this.state[e][i];i[e]=t}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const t={};if(null===this.deletedStates[e])for(const i in this.state[e])t[i]={},this.state[e][i]={};else for(const i in this.deletedStates[e]){if(null===this.deletedStates[e][i])this.state[e][i]={};else if(this.state[e][i])for(const t of Object.keys(this.deletedStates[e][i]))delete this.state[e][i][t];t[i]=this.state[e][i]}i[e]=i[e]||{},P(i[e],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const n in e)e[n].setFeatureState(i,t)}}class Nf{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const i=this.toIdx(e,t);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Uf(e,t,i,n){let r=0,o=Number.MAX_VALUE;for(let a=0;a<3;a++)if(Math.abs(n[a])<1e-15){if(i[a]<e[a]||i[a]>t[a])return null}else{const s=1/n[a];let l=(e[a]-i[a])*s,c=(t[a]-i[a])*s;if(l>c){const e=l;l=c,c=e}if(l>r&&(r=l),c<o&&(o=c),r>o)return null}return r}function Vf(e,t,i,n,r,o,a,s,l,c,u){const h=n-e,d=r-t,p=o-i,f=a-e,m=s-t,g=l-i,_=u[1]*g-u[2]*m,y=u[2]*f-u[0]*g,x=u[0]*m-u[1]*f,v=h*_+d*y+p*x;if(Math.abs(v)<1e-15)return null;const b=1/v,w=c[0]-e,M=c[1]-t,T=c[2]-i,S=(w*_+M*y+T*x)*b;if(S<0||S>1)return null;const E=M*p-T*d,C=T*h-w*p,A=w*d-M*h,P=(u[0]*E+u[1]*C+u[2]*A)*b;return P<0||S+P>1?null:(f*E+m*C+g*A)*b}function Gf(e,t,i){return(e-t)/(i-t)}function jf(e,t,i,n,r,o,a,s,l){const c=1<<i,u=o-n,h=a-r,d=(e+1)/c*u+n,p=(t+0)/c*h+r,f=(t+1)/c*h+r;s[0]=(e+0)/c*u+n,s[1]=p,l[0]=d,l[1]=f}class Wf{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),i=[];let n=Math.ceil(Math.pow(2,t));const r=1/n,o=(e,t,i,n,r)=>{const o=n?1:0,a=(e+1)*i-o,s=t*i,l=(t+1)*i-o;r[0]=e*i,r[1]=s,r[2]=a,r[3]=l};let a=new Nf(n);const s=[];for(let t=0;t<n*n;t++){o(t%n,Math.floor(t/n),r,!1,s);const i=qf(s[0],s[1],e),l=qf(s[2],s[1],e),c=qf(s[2],s[3],e),u=qf(s[0],s[3],e);a.minimums.push(Math.min(i,l,c,u)),a.maximums.push(Math.max(i,l,c,u)),a.leaves.push(1)}for(i.push(a),n/=2;n>=1;n/=2){const e=i[i.length-1];a=new Nf(n);for(let t=0;t<n*n;t++){o(t%n,Math.floor(t/n),2,!0,s);const i=e.getElevation(s[0],s[1]),r=e.getElevation(s[2],s[1]),l=e.getElevation(s[2],s[3]),c=e.getElevation(s[0],s[3]),u=e.isLeaf(s[0],s[1]),h=e.isLeaf(s[2],s[1]),d=e.isLeaf(s[2],s[3]),p=e.isLeaf(s[0],s[3]),f=Math.min(i.min,r.min,l.min,c.min),m=Math.max(i.max,r.max,l.max,c.max),g=u&&h&&d&&p;a.maximums.push(m),a.minimums.push(f),a.leaves.push(m-f<=5&&g?1:0)}i.push(a)}return i}(this.dem),i=t.length-1,n=t[i];this._addNode(n.minimums[0],n.maximums[0],n.leaves[0]),this._construct(t,0,0,i,0)}raycastRoot(e,t,i,n,r,o,a=1){return Uf([e,t,-100],[i,n,this.maximums[0]*a],r,o)}raycast(e,t,i,n,r,o,a=1){if(!this.nodeCount)return null;const s=this.raycastRoot(e,t,i,n,r,o,a);if(null==s)return null;const l=[],c=[],u=[],h=[],d=[{idx:0,t:s,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:s,t:p,nodex:f,nodey:m,depth:g}=d.pop();if(this.leaves[s]){jf(f,m,g,e,t,i,n,u,h);const s=1<<g,l=(f+0)/s,c=(f+1)/s,d=(m+0)/s,_=(m+1)/s,y=qf(l,d,this.dem)*a,x=qf(c,d,this.dem)*a,v=qf(c,_,this.dem)*a,b=qf(l,_,this.dem)*a,w=Vf(u[0],u[1],y,h[0],u[1],x,h[0],h[1],v,r,o),M=Vf(h[0],h[1],v,u[0],h[1],b,u[0],u[1],y,r,o),T=Math.min(null!==w?w:Number.MAX_VALUE,null!==M?M:Number.MAX_VALUE);if(T!==Number.MAX_VALUE)return T;{const e=Js([],r,o,p);if($f(y,x,b,v,Gf(e[0],u[0],h[0]),Gf(e[1],u[1],h[1]))>=e[2])return p}continue}let _=0;for(let d=0;d<this._siblingOffset.length;d++){jf((f<<1)+this._siblingOffset[d][0],(m<<1)+this._siblingOffset[d][1],g+1,e,t,i,n,u,h),u[2]=-100,h[2]=this.maximums[this.childOffsets[s]+d]*a;const p=Uf(u,h,r,o);if(null!=p){const e=p;l[d]=e;let t=!1;for(let i=0;i<_&&!t;i++)e>=l[c[i]]&&(c.splice(i,0,d),t=!0);t||(c[_]=d),_++}}for(let e=0;e<_;e++){const t=c[e];d.push({idx:this.childOffsets[s]+t,t:l[t],nodex:(f<<1)+this._siblingOffset[t][0],nodey:(m<<1)+this._siblingOffset[t][1],depth:g+1})}}return null}_addNode(e,t,i){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,i,n,r){if(1===e[n].isLeaf(t,i))return;this.childOffsets[r]||(this.childOffsets[r]=this.nodeCount);const o=n-1,a=e[o];let s=0,l=0;for(let e=0;e<this._siblingOffset.length;e++){const n=2*t+this._siblingOffset[e][0],r=2*i+this._siblingOffset[e][1],o=a.getElevation(n,r),c=a.isLeaf(n,r),u=this._addNode(o.min,o.max,c);c&&(s|=1<<e),l||(l=u)}for(let n=0;n<this._siblingOffset.length;n++)s&1<<n||this._construct(e,2*t+this._siblingOffset[n][0],2*i+this._siblingOffset[n][1],o,l+n)}}function $f(e,t,i,n,r,o){return Ci(Ci(e,i,o),Ci(t,n,o),r)}function qf(e,t,i){const n=i.dim,r=T(e*n-.5,0,n-1),o=T(t*n-.5,0,n-1),a=Math.floor(r),s=Math.floor(o),l=Math.min(a+1,n-1),c=Math.min(s+1,n-1);return $f(i.get(a,s),i.get(l,s),i.get(a,c),i.get(l,c),r-a,o-s)}const Zf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Hf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,i,n=!1,r=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return V(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const o=this.dim=t.height-2,a=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=i||"mapbox",this.borderReady=n,!n){for(let e=0;e<o;e++)a[this._idx(-1,e)]=a[this._idx(0,e)],a[this._idx(o,e)]=a[this._idx(o-1,e)],a[this._idx(e,-1)]=a[this._idx(e,0)],a[this._idx(e,o)]=a[this._idx(e,o-1)];a[this._idx(-1,-1)]=a[this._idx(0,0)],a[this._idx(o,-1)]=a[this._idx(o-1,0)],a[this._idx(-1,o)]=a[this._idx(0,o-1)],a[this._idx(o,o)]=a[this._idx(o-1,o-1)],r&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Wf(this)}get(e,t,i=!1){i&&(e=T(e,-1,this.dim),t=T(t,-1,this.dim));const n=4*this._idx(e,t);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[n],this.pixels[n+1],this.pixels[n+2])}static getUnpackVector(e){return Zf[e]}get unpackVector(){return Zf[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,i){return(256*e*256+256*t+i)/10-1e4}_unpackTerrarium(e,t,i){return 256*e+t+i/256-32768}static pack(e,t){const i=[0,0,0,0],n=Hf.getUnpackVector(t);let r=Math.floor((e+n[3])/n[2]);return i[2]=r%256,r=Math.floor(r/256),i[1]=r%256,r=Math.floor(r/256),i[0]=r,i}getPixels(){return new Qc({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,i){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let n=t*this.dim,r=t*this.dim+this.dim,o=i*this.dim,a=i*this.dim+this.dim;switch(t){case-1:n=r-1;break;case 1:r=n+1}switch(i){case-1:o=a-1;break;case 1:a=o+1}const s=-t*this.dim,l=-i*this.dim;for(let t=o;t<a;t++)for(let i=n;i<r;i++){const n=4*this._idx(i,t),r=4*this._idx(i+s,t+l);this.pixels[n+0]=e.pixels[r+0],this.pixels[n+1]=e.pixels[r+1],this.pixels[n+2]=e.pixels[r+2],this.pixels[n+3]=e.pixels[r+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Gr(Hf,"DEMData"),Gr(Wf,"DemMinMaxQuadTree",{omit:["dem"]});class Xf{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,i){const n=e.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);const r={value:t,timeout:void 0};if(void 0!==i&&(r.timeout=setTimeout((()=>{this.remove(e,r)}),i)),this.data[n].push(r),this.order.push(n),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const i=e.wrapped().key,n=void 0===t?0:this.data[i].indexOf(t),r=this.data[i][n];return this.data[i].splice(n,1),r.timeout&&clearTimeout(r.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(r.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const i in this.data)for(const n of this.data[i])e(n.value)||t.push(n);for(const e of t)this.remove(e.value.tileID,e)}}class Yf{constructor(e,t,i){this.func=e,this.mask=t,this.range=i}}Yf.ReadOnly=!1,Yf.ReadWrite=!0,Yf.disabled=new Yf(519,Yf.ReadOnly,[0,1]);const Jf=7680;class Kf{constructor(e,t,i,n,r,o){this.test=e,this.ref=t,this.mask=i,this.fail=n,this.depthFail=r,this.pass=o}}Kf.disabled=new Kf({func:519,mask:0},0,0,Jf,Jf,Jf);class Qf{constructor(e,t,i){this.blendFunction=e,this.blendColor=t,this.mask=i}}Qf.Replace=[1,0],Qf.disabled=new Qf(Qf.Replace,Ct.transparent,[!1,!1,!1,!1]),Qf.unblended=new Qf(Qf.Replace,Ct.transparent,[!0,!0,!0,!0]),Qf.alphaBlended=new Qf([1,771],Ct.transparent,[!0,!0,!0,!0]);const em=1029,tm=2305;class im{constructor(e,t,i){this.enable=e,this.mode=t,this.frontFace=i}}im.disabled=new im(!1,em,tm),im.backCCW=new im(!0,em,tm),im.backCW=new im(!0,em,2304),im.frontCW=new im(!0,1028,2304),im.frontCCW=new im(!0,1028,tm);class nm extends Xe{constructor(e,t,i){super(),this.id=e,this._onlySymbols=i,t.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),t.on("error",(()=>{this._sourceErrored=!0})),this._source=t,this._tiles={},this._cache=new Xf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ff,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const i=this._tiles[t];i.upload(e),i.prepare(this.map.style.imageManager)}}getIds(){return A(this._tiles).map((e=>e.tileID)).sort(rm).map((e=>e.key))}getRenderableIds(e){const t=[];for(const i in this._tiles)this._isIdRenderable(+i,e)&&t.push(this._tiles[i]);return e?t.sort(((e,t)=>{const i=e.tileID,n=t.tileID,r=new f(i.canonical.x,i.canonical.y)._rotate(this.transform.angle),o=new f(n.canonical.x,n.canonical.y)._rotate(this.transform.angle);return i.overscaledZ-n.overscaledZ||o.y-r.y||o.x-r.x})).map((e=>e.tileID.key)):t.map((e=>e.tileID)).sort(rm).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const i=this._tiles[e];i&&("loading"!==i.state&&(i.state=t),this._loadTile(i,this._tileLoaded.bind(this,i,e,t)))}_tileLoaded(e,t,i,n){if(n)if(e.state="errored",404!==n.status)this._source.fire(new He(n,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=We.now(),"expired"===i&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ze("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let n=0;n<t.length;n++){const r=t[n];if(e.neighboringTiles&&e.neighboringTiles[r]){const t=this.getTileByID(r);i(e,t),i(t,e)}}function i(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let i=t.tileID.canonical.x-e.tileID.canonical.x;const n=t.tileID.canonical.y-e.tileID.canonical.y,r=Math.pow(2,e.tileID.canonical.z),o=t.tileID.key;0===i&&0===n||Math.abs(n)>1||(Math.abs(i)>1&&(1===Math.abs(i+r)?i+=r:1===Math.abs(i-r)&&(i-=r)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,i,n),e.neighboringTiles&&e.neighboringTiles[o]&&(e.neighboringTiles[o].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,i,n){for(const r in this._tiles){let o=this._tiles[r];if(n[r]||!o.hasData()||o.tileID.overscaledZ<=t||o.tileID.overscaledZ>i)continue;let a=o.tileID;for(;o&&o.tileID.overscaledZ>t+1;){const e=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[e.key],o&&o.hasData()&&(a=e)}let s=a;for(;s.overscaledZ>t;)if(s=s.scaledTo(s.overscaledZ-1),e[s.key]){n[a.key]=a;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=t?i:null}for(let i=e.overscaledZ-1;i>=t;i--){const t=e.scaledTo(i),n=this._getLoadedTile(t);if(n)return n}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const i=Math.ceil(e.width/t)+1,n=Math.ceil(e.height/t)+1,r=Math.floor(i*n*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,r):r,a="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(a)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const i in this._tiles){const n=this._tiles[i];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),e[n.tileID.key]=n}this._tiles=e;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(e,t,i){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!i)return;let n;this.updateCacheSize(e,t),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?n=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new Ch(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(n=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(n=n.filter((e=>this._source.hasTile(e))))):n=[];const r=this._updateRetainedTiles(n);if(om(this._source.type)&&0!==n.length){const e={},t={},i=Object.keys(r);for(const n of i){const i=r[n],o=this._tiles[n];if(!o||o.fadeEndTime&&o.fadeEndTime<=We.now())continue;const a=this.findLoadedParent(i,Math.max(i.overscaledZ-nm.maxOverzooming,this._source.minzoom));a&&(this._addTile(a.tileID),e[a.tileID.key]=a.tileID),t[n]=i}const o=n[n.length-1].overscaledZ;for(const e in this._tiles){const i=this._tiles[e];if(r[e]||!i.hasData())continue;let n=i.tileID;for(;n.overscaledZ>o;){n=n.scaledTo(n.overscaledZ-1);const o=this._tiles[n.key];if(o&&o.hasData()&&t[n.key]){r[e]=i.tileID;break}}}for(const t in e)r[t]||(this._coveredTiles[t]=!0,r[t]=e[t])}for(const e in r)this._tiles[e].clearFadeHold();const o=function(e,t){const i=[];for(const n in e)n in t||i.push(n);return i}(this._tiles,r);for(const e of o){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const i={},n=e.reduce(((e,t)=>Math.min(e,t.overscaledZ)),1/0),r=e[0].overscaledZ,o=Math.max(r-nm.maxOverzooming,this._source.minzoom),a=Math.max(r+nm.maxUnderzooming,this._source.minzoom),s={};for(const i of e){const e=this._addTile(i);t[i.key]=i,e.hasData()||n<this._source.maxzoom&&(s[i.key]=i)}this._retainLoadedChildren(s,n,a,t);for(const n of e){let e=this._tiles[n.key];if(e.hasData())continue;if(n.canonical.z>=this._source.maxzoom){const e=n.children(this._source.maxzoom)[0],i=this.getTile(e);if(i&&i.hasData()){t[e.key]=e;continue}}else{const e=n.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let r=e.wasRequested();for(let a=n.overscaledZ-1;a>=o;--a){const o=n.scaledTo(a);if(i[o.key])break;if(i[o.key]=!0,e=this.getTile(o),!e&&r&&(e=this._addTile(o)),e&&(t[o.key]=o,r=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let i,n=this._tiles[e].tileID;for(;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){i=this._loadedParentTiles[n.key];break}t.push(n.key);const e=n.scaledTo(n.overscaledZ-1);if(i=this._getLoadedTile(e),i)break;n=e}for(const e of t)this._loadedParentTiles[e]=i}}_addTile(e){let t=this._tiles[e.key];if(t)return t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const i=Boolean(t);if(!i){const i=this.map?this.map.painter:null;t=new Bf(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,i,this._isRaster),this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,i||this._source.fire(new Ze("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=t.getExpiryTimeout();i&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),i))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,i){const n=[],r=this.transform;if(!r)return n;const o="globe"===r.projection.name,a=rc(r.center.lng);for(const s in this._tiles){const l=this._tiles[s];if(i&&l.clearQueryDebugViz(),l.holdingForFade())continue;let c;if(o){const e=l.tileID.canonical;if(0===e.z){const t=[Math.abs(T(a,...am(e,-1))-a),Math.abs(T(a,...am(e,1))-a)];c=[0,2*t.indexOf(Math.min(...t))-1]}else{const t=[Math.abs(T(a,...am(e,-1))-a),Math.abs(T(a,...am(e,0))-a),Math.abs(T(a,...am(e,1))-a)];c=[t.indexOf(Math.min(...t))-1]}}else c=[0];for(const i of c){const o=e.containsTile(l,r,t,i);o&&n.push(o)}}return n}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map((e=>this._tiles[e].tileID));for(const e of t)e.projMatrix=this.transform.calculateProjMatrix(e.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(om(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=We.now())return!0}return!1}setFeatureState(e,t,i){this._state.updateState(e=e||"_geojsonTileLayer",t,i)}removeFeatureState(e,t,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,i)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,i){const n=this._tiles[e];n&&n.setDependencies(t,i)}reloadTilesForDependencies(e,t){for(const i in this._tiles)this._tiles[i].hasDependency(e,t)&&this._reloadTile(+i,"reloading");this._cache.filter((i=>!i.hasDependency(e,t)))}_preloadTiles(e,t){const i=new Map,n=Array.isArray(e)?e:[e],r=this.map.painter.terrain,o=this.usedForTerrain&&r?r.getScaledDemTileSize():this._source.tileSize;for(const e of n){const t=e.coveringTiles({tileSize:o,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)i.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1)}C(Array.from(i.values()),((e,t)=>{const i=new Bf(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(i,(e=>{"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),t(e,i)}))}),t)}}function rm(e,t){const i=Math.abs(2*e.wrap)-+(e.wrap<0),n=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||n-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function om(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function am(e,t){const i=1<<e.z;return[e.x/i+t,(e.x+1)/i+t]}nm.maxOverzooming=10,nm.maxUnderzooming=3;class sm{constructor(e,t,i){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=i}static create(e,t,i){const n=i||e.findDEMTileFor(t);if(!n||!n.dem)return;const r=n.dem,o=n.tileID,a=1<<t.canonical.z-o.canonical.z;return new sm(n,n.tileSize/Ss/a,[(t.canonical.x/a-o.canonical.x)*r.dim,(t.canonical.y/a-o.canonical.y)*r.dim])}tileCoordToPixel(e,t){const i=t*this._scale+this._offset[1],n=Math.floor(e*this._scale+this._offset[0]),r=Math.floor(i);return new f(n,r)}getElevationAt(e,t,i,n){const r=e*this._scale+this._offset[0],o=t*this._scale+this._offset[1],a=Math.floor(r),s=Math.floor(o),l=this._dem;return n=!!n,i?Ci(Ci(l.get(a,s,n),l.get(a,s+1,n),o-s),Ci(l.get(a+1,s,n),l.get(a+1,s+1,n),o-s),r-a):l.get(a,s,n)}getElevationAtPixel(e,t,i){return this._dem.get(e,t,!!i)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ac(1,e)*this._dem.stride}}class lm{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Nr(Ss,16,0),this.featureIndexArray=new Ua,this.promoteId=t}insert(e,t,i,n,r,o=0){const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,n,r,o);const s=this.grid;for(let e=0;e<t.length;e++){const i=t[e],n=[1/0,1/0,-1/0,-1/0];for(let e=0;e<i.length;e++){const t=i[e];n[0]=Math.min(n[0],t.x),n[1]=Math.min(n[1],t.y),n[2]=Math.max(n[2],t.x),n[3]=Math.max(n[3],t.y)}n[0]<Ss&&n[1]<Ss&&n[2]>=0&&n[3]>=0&&s.insert(a,n[0],n[1],n[2],n[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new oh(new sd(this.rawTileData)).layers,this.sourceLayerCoder=new Sf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,i,n){this.loadVTLayers();const r=e.params||{},o=ar(r.filter),a=e.tileResult,s=e.transform,l=a.bufferedTilespaceBounds,c=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,((e,t,i,n)=>Rc(a.bufferedTilespaceGeometry,e,t,i,n)));c.sort(um);let u=null;s.elevation&&c.length>0&&(u=sm.create(s.elevation,this.tileID));const h={};let d;for(let s=0;s<c.length;s++){const l=c[s];if(l===d)continue;d=l;const p=this.featureIndexArray.get(l);let f=null;this.loadMatchingFeature(h,p,o,r.layers,r.availableImages,t,i,n,((t,i,n,r=0)=>(f||(f=vc(t,this.tileID.canonical,e.tileTransform)),i.queryIntersectsFeature(a,t,n,f,this.z,e.transform,e.pixelPosMatrix,u,r))))}return h}loadMatchingFeature(e,t,i,n,r,o,a,s,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:d}=t,p=this.bucketLayerIDs[u];if(n&&!function(e,t){for(let i=0;i<e.length;i++)if(t.indexOf(e[i])>=0)return!0;return!1}(n,p))return;const f=this.sourceLayerCoder.decode(h),m=this.vtLayers[f].feature(c);if(i.needGeometry){const e=bc(m,!0);if(!i.filter(new Vo(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!i.filter(new Vo(this.tileID.overscaledZ),m))return;const g=this.getId(m,f);for(let t=0;t<p.length;t++){const i=p[t];if(n&&n.indexOf(i)<0)continue;const u=o[i];if(!u)continue;let h={};void 0!==g&&s&&(h=s.getState(u.sourceLayer||"_geojsonTileLayer",g));const f=P({},a[i]);f.paint=cm(f.paint,u.paint,m,h,r),f.layout=cm(f.layout,u.layout,m,h,r);const _=!l||l(m,u,h,d);if(!_)continue;const y=new Cf(m,this.z,this.x,this.y,g);y.layer=f;let x=e[i];void 0===x&&(x=e[i]=[]),x.push({featureIndex:c,feature:y,intersectionZ:_})}}lookupSymbolFeatures(e,t,i,n,r,o,a,s){const l={};this.loadVTLayers();const c=ar(r);for(const r of e)this.loadMatchingFeature(l,{bucketIndex:i,sourceLayerIndex:n,featureIndex:r,layoutVertexArrayOffset:0},c,o,a,s,t);return l}loadFeature(e){const{featureIndex:t,sourceLayerIndex:i}=e;this.loadVTLayers();const n=this.sourceLayerCoder.decode(i),r=this.vtFeatures[n];if(r[t])return r[t];const o=this.vtLayers[n].feature(t);return r[t]=o,o}hasLayer(e){for(const t of this.bucketLayerIDs)for(const i of t)if(e===i)return!0;return!1}getId(e,t){let i=e.id;if(this.promoteId){const n="string"==typeof this.promoteId?this.promoteId:this.promoteId[t];null!=n&&(i=e.properties[n]),"boolean"==typeof i&&(i=Number(i))}return i}}function cm(e,t,i,n,r){return B(e,((e,o)=>{const a=t instanceof Xo?t.get(o):null;return a&&a.evaluate?a.evaluate(i,n,r):a}))}function um(e,t){return t-e}Gr(lm,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class hm{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new Kc({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const i=this.getKey(e,t);return this.positions[i]}trim(){const e=this.width,t=this.height=D(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,i){const n=[];let r=e.length%2==1?-e[e.length-1]*i:0,o=e[0]*i,a=!0;n.push({left:r,right:o,isDash:a,zeroLength:0===e[0]});let s=e[0];for(let t=1;t<e.length;t++){a=!a;const l=e[t];r=s*i,s+=l,o=s*i,n.push({left:r,right:o,isDash:a,zeroLength:0===l})}return n}addRoundDash(e,t,i){const n=t/2;for(let t=-i;t<=i;t++){const r=this.width*(this.nextRow+i+t);let o=0,a=e[o];for(let s=0;s<this.width;s++){s/a.right>1&&(a=e[++o]);const l=Math.abs(s-a.left),c=Math.abs(s-a.right),u=Math.min(l,c);let h;const d=t/i*(n+1);if(a.isDash){const e=n-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=n-Math.sqrt(u*u+d*d);this.image.data[r+s]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e,t){for(let t=e.length-1;t>=0;--t){const i=e[t],n=e[t+1];i.zeroLength?e.splice(t,1):n&&n.isDash===i.isDash&&(n.left=i.left,e.splice(t,1))}const i=e[0],n=e[e.length-1];i.isDash===n.isDash&&(i.left=n.left-this.width,n.right=i.right+this.width);const r=this.width*this.nextRow;let o=0,a=e[o];for(let i=0;i<this.width;i++){i/a.right>1&&(a=e[++o]);const n=Math.abs(i-a.left),s=Math.abs(i-a.right),l=Math.min(n,s);this.image.data[r+i]=Math.max(0,Math.min(255,(a.isDash?l:-l)+t+128))}}addDash(e,t){const i=this.getKey(e,t);if(this.positions[i])return this.positions[i];const n="round"===t,r=n?7:0,o=2*r+1;if(this.nextRow+o>this.height)return V("LineAtlas out of space"),null;0===e.length&&e.push(1);let a=0;for(let t=0;t<e.length;t++)e[t]<0&&(V("Negative value is found in line dasharray, replacing values with 0"),e[t]=0),a+=e[t];if(0!==a){const i=this.width/a,o=this.getDashRanges(e,this.width,i);n?this.addRoundDash(o,i,r):this.addRegularDash(o,"square"===t?.5*i:0)}const s=this.nextRow+r;this.nextRow+=o;const l={tl:[s,r],br:[a,0]};return this.positions[i]=l,l}}Gr(hm,"LineAtlas");class dm{constructor(e){const t={},i=[];for(const n in e){const r=e[n],o=t[n]={};for(const e in r.glyphs){const t=r.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const n=t.metrics.localGlyph?2:1,a={x:0,y:0,w:t.bitmap.width+2*n,h:t.bitmap.height+2*n};i.push(a),o[e]=a}}const{w:n,h:r}=zd(i),o=new Kc({width:n||1,height:r||1});for(const i in e){const n=e[i];for(const e in n.glyphs){const r=n.glyphs[+e];if(!r||0===r.bitmap.width||0===r.bitmap.height)continue;const a=t[i][e],s=r.metrics.localGlyph?2:1;Kc.copy(r.bitmap,o,{x:0,y:0},{x:a.x+s,y:a.y+s},r.bitmap)}}this.image=o,this.positions=t}}Gr(dm,"GlyphAtlas");class pm{constructor(e){this.tileID=new Ch(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Lp(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,t,i,n,r){this.status="parsing",this.data=e,this.collisionBoxArray=new za;const o=new Sf(Object.keys(e.layers).sort()),a=new lm(this.tileID,this.promoteId);a.bucketLayerIDs=[];const s={},l=new hm(256,256),c={featureIndex:a,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:l,availableImages:i},u=t.familiesBySource[this.source];for(const t in u){const n=e.layers[t];if(!n)continue;let r=!1,l=!1;for(const e of u[t])"symbol"===e[0].type?r=!0:l=!0;if(!0===this.isSymbolTile&&!r)continue;if(!1===this.isSymbolTile&&!l)continue;1===n.version&&V(`Vector tile source "${this.source}" layer "${t}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const h=o.encode(t),d=[];for(let e=0;e<n.length;e++){const i=n.feature(e),r=a.getId(i,t);d.push({feature:i,id:r,index:e,sourceLayerIndex:h})}for(const e of u[t]){const t=e[0];void 0!==this.isSymbolTile&&"symbol"===t.type!==this.isSymbolTile||t.minzoom&&this.zoom<Math.floor(t.minzoom)||t.maxzoom&&this.zoom>=t.maxzoom||"none"!==t.visibility&&(fm(e,this.zoom,i),(s[t.id]=t.createBucket({index:a.bucketLayerIDs.length,layers:e,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:h,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:i})).populate(d,c,this.tileID.canonical,this.tileTransform),a.bucketLayerIDs.push(e.map((e=>e.id))))}}let h,d,p,f;l.trim();const m={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},g=B(c.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(g).length?n.send("getGlyphs",{uid:this.uid,stacks:g},((e,t)=>{h||(h=e,d=t,x.call(this))}),void 0,!1,m):d={};const _=Object.keys(c.iconDependencies);_.length?n.send("getImages",{icons:_,source:this.source,tileID:this.tileID,type:"icons"},((e,t)=>{h||(h=e,p=t,x.call(this))}),void 0,!1,m):p={};const y=Object.keys(c.patternDependencies);function x(){if(h)return r(h);if(d&&p&&f){const e=new dm(d),t=new Ld(p,f);for(const n in s){const r=s[n];r instanceof hf?(fm(r.layers,this.zoom,i),Tp(r,d,e.positions,p,t.iconPositions,this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection)):r.hasPattern&&(r instanceof Nh||r instanceof Uu||r instanceof ph)&&(fm(r.layers,this.zoom,i),r.addFeatures(c,this.tileID.canonical,t.patternPositions,i,this.tileTransform))}this.status="done",r(null,{buckets:A(s).filter((e=>!e.isEmpty())),featureIndex:a,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:l,imageAtlas:t,glyphMap:this.returnDependencies?d:null,iconMap:this.returnDependencies?p:null,glyphPositions:this.returnDependencies?e.positions:null})}}y.length?n.send("getImages",{icons:y,source:this.source,tileID:this.tileID,type:"patterns"},((e,t)=>{h||(h=e,f=t,x.call(this))}),void 0,!1,m):f={},x.call(this)}}function fm(e,t,i){const n=new Vo(t);for(const t of e)t.recalculate(n,i)}class mm{constructor(e){this.entries={},this.scheduler=e}request(e,t,i,n){const r=this.entries[e]=this.entries[e]||{callbacks:[]};if(r.result){const[e,i]=r.result;return this.scheduler?this.scheduler.add((()=>{n(e,i)}),t):n(e,i),()=>{}}return r.callbacks.push(n),r.cancel||(r.cancel=i(((i,n)=>{r.result=[i,n];for(const e of r.callbacks)this.scheduler?this.scheduler.add((()=>{e(i,n)}),t):e(i,n);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{r.result||(r.callbacks=r.callbacks.filter((e=>e!==n)),r.callbacks.length||(r.cancel(),delete this.entries[e]))}}}function gm(e,t,i){const n=JSON.stringify(e.request);return e.data&&(this.deduped.entries[n]={result:[null,e.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(t=>{const n=ce(e.request,((e,n,r,o)=>{e?t(e):n&&t(null,{vectorTile:i?void 0:new oh(new sd(n)),rawData:n,cacheControl:r,expires:o})}));return()=>{n.cancel(),t()}}),t)}e.ARRAY_TYPE=As,e.AUTH_ERR_MSG=me,e.Aabb=wl,e.Actor=class{constructor(e,i,n){this.target=e,this.parent=i,this.mapId=n,this.callbacks={},this.cancelCallbacks={},R(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=W()?e:t,this.scheduler=new Tf}send(e,t,i,n,r=!1,o){const a=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=o,this.callbacks[a]=i);const s=Z(this.globalScope)?void 0:[];return this.target.postMessage({id:a,type:e,hasCallback:!!i,targetMapId:n,mustQueue:r,sourceMapId:this.mapId,data:$r(t,s)},s),{cancel:()=>{i&&delete this.callbacks[a],this.target.postMessage({id:a,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(e){const t=e.data,i=t.id;if(i&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[i];delete this.cancelCallbacks[i],e&&e.cancel()}else if(t.mustQueue||W()){const e=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add((()=>this.processTask(i,t)),e&&e.metadata||{type:"message"})}else this.processTask(i,t)}processTask(e,t){if("<response>"===t.type){const i=this.callbacks[e];delete this.callbacks[e],i&&(t.error?i(qr(t.error)):i(null,qr(t.data)))}else{const i=Z(this.globalScope)?void 0:[],n=t.hasCallback?(t,n)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?$r(t):null,data:$r(n,i)},i)}:e=>{},r=qr(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,r,n);else if(this.parent.getWorkerSource){const e=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,e[0],r.source)[e[1]](r,n)}else n(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},e.CanonicalTileID=Sh,e.Color=Ct,e.ColorMode=Qf,e.CullFaceMode=im,e.DEMData=Hf,e.DataConstantProperty=Yo,e.DedupedRequest=mm,e.DepthMode=Yf,e.EXTENT=Ss,e.Elevation=class{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const i=t.getSource().maxzoom,n=1<<i,r=Math.floor(e.x),o=Math.floor((e.x-r)*n),a=Math.floor(e.y*n),s=this.findDEMTileFor(new Ch(i,r,i,o,a));return!(!s||!s.dem)}getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,i=!0){if(this.isUsingMockSource())return null;null==t&&(t=null);const n=this._source();if(!n)return t;if(e.y<0||e.y>1)return t;const r=n.getSource().maxzoom,o=1<<r,a=Math.floor(e.x),s=e.x-a,l=new Ch(r,a,r,Math.floor(s*o),Math.floor(e.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const u=c.dem,h=1<<c.tileID.canonical.z,d=(s*h-c.tileID.canonical.x)*u.dim,p=(e.y*h-c.tileID.canonical.y)*u.dim,f=Math.floor(d),m=Math.floor(p);return(i?this.exaggeration():1)*Ci(Ci(u.get(f,m),u.get(f,m+1),p-m),Ci(u.get(f+1,m),u.get(f+1,m+1),p-m),d-f)}getAtTileOffset(e,t,i){const n=1<<e.canonical.z;return this.getAtPointOrZero(new dc(e.wrap+(e.canonical.x+t/Ss)/n,(e.canonical.y+i/Ss)/n))}getAtTileOffsetFunc(e,t,i,n){return r=>{const o=this.getAtTileOffset(e,r.x,r.y),a=n.upVector(e.canonical,r.x,r.y);return Ys(a,a,o*n.upVectorScale(e.canonical,t,i).metersToTile),a}}getForTilePoints(e,t,i,n){if(this.isUsingMockSource())return!1;const r=sm.create(this,e,n);return!!r&&(t.forEach((e=>{e[2]=this.exaggeration()*r.getElevationAt(e[0],e[1],i)})),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const i=t.dem.tree,n=t.tileID,r=1<<e.canonical.z-n.canonical.z;let o=e.canonical.x/r-n.canonical.x,a=e.canonical.y/r-n.canonical.y,s=0;for(let t=0;t<e.canonical.z-n.canonical.z&&!i.leaves[s];t++){o*=2,a*=2;const e=2*Math.floor(a)+Math.floor(o);s=i.childOffsets[s]+e,o%=1,a%=1}return{min:this.exaggeration()*i.minimums[s],max:this.exaggeration()*i.maximums[s]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,i){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},e.ErrorEvent=He,e.EvaluationParameters=Vo,e.Event=Ze,e.Evented=Xe,e.FillExtrusionBucket=ph,e.Frustum=bl,e.FrustumCorners=vl,e.GLOBE_RADIUS=Ml,e.GLOBE_SCALE_MATCH_LATITUDE=45,e.GLOBE_ZOOM_THRESHOLD_MAX=6,e.GLOBE_ZOOM_THRESHOLD_MIN=5,e.GlobeSharedBuffers=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const e of this._wireframeSegments)e.destroy()}}_fillGridMeshWithLods(e,t){const i=new aa,n=new wa,r=[],o=e+1+2,a=t[0]+1,s=t[0]+1+(1+t.length),l=(e,t,i)=>{let n=e===o-1?e-2:0===e?e:e-1;return n+=i?24575:0,[n,t]};for(let e=0;e<o;++e)i.emplaceBack(...l(e,0,!0));for(let e=0;e<a;++e)for(let t=0;t<o;++t)i.emplaceBack(...l(t,e,(0===t||t===o-1)&&!0));for(let e=0;e<t.length;++e){const n=t[e];for(let e=0;e<o;++e)i.emplaceBack(...l(e,n,!0))}for(let e=0;e<t.length;++e){const a=n.length,l=t[e]+1+2,c=new wa;for(let i=0;i<l-1;i++){const r=i===l-2,a=r?o*(s-t.length+e-i):o;for(let e=0;e<o-1;e++){const t=i*o+e;0===i||r||0===e||e===o-2?(c.emplaceBack(t+1,t,t+a),c.emplaceBack(t+a,t+a+1,t+1)):(n.emplaceBack(t+1,t,t+a),n.emplaceBack(t+a,t+a+1,t+1))}}const u=Ts.simpleSegment(0,a,i.length,n.length-a);for(let e=0;e<c.uint16.length;e+=3)n.emplaceBack(c.uint16[e],c.uint16[e+1],c.uint16[e+2]);const h=Ts.simpleSegment(0,a,i.length,n.length-a);r.push({withoutSkirts:u,withSkirts:h})}return{vertices:i,indices:n,segments:r}}_createGrid(e){const t=this._fillGridMeshWithLods(Tl,Sl);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,yl.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new wa;for(let e=0;e<=Tl;e++)t.emplaceBack(0,e+1,e+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const i=new Ea,n=new Ea;this._poleSegments=[];for(let e=0,t=0;e<5;e++){const r=360/(1<<e);i.emplaceBack(0,-Ml,0,.5,0),n.emplaceBack(0,-Ml,0,.5,1);for(let e=0;e<=Tl;e++){const t=e/Tl,o=Ci(0,r,t),[a,s,l]=Ul(Kl,Ql,o,Ml);i.emplaceBack(a,s,l,t,0),n.emplaceBack(a,s,l,t,1)}this._poleSegments.push(Ts.simpleSegment(t,0,66,64)),t+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(i,gl,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(n,gl,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}getWirefameBuffers(e,t){if(!this._wireframeSegments){const t=new Aa,i=Tl,n=i+1+2,r=1;this._wireframeSegments=[];for(let e=0,o=0;e<Sl.length;e++){const a=Sl[e];for(let e=r;e<a+r;e++)for(let o=r;o<i+r;o++){const i=e*n+o;t.emplaceBack(i,i+1),t.emplaceBack(i,i+n),t.emplaceBack(i,i+n+1)}const s=a*i*3;this._wireframeSegments.push(Ts.simpleSegment(0,o,(a+1)*n,s)),o+=s}this._wireframeIndexBuffer=e.createIndexBuffer(t)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}},e.GlyphManager=cp,e.ImagePosition=Dd,e.LivePerformanceUtils=Oe,e.LngLat=ic,e.LngLatBounds=Es,e.LocalGlyphMode=lp,e.MAX_MERCATOR_LATITUDE=uc,e.MercatorCoordinate=dc,e.ONE_EM=Jh,e.OverscaledTileID=Ch,e.PerformanceMarkers=Re,e.Properties=Qo,e.RGBAImage=Qc,e.Ray=xl,e.RequestManager=class{constructor(e,t,i){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",h,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){if(!ge(e))return e;const i=we(e);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeGlyphsURL(e,t){if(!ge(e))return e;const i=we(e);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeSourceURL(e,t,i,n){if(!ge(e))return e;const r=we(e);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),i&&r.params.push(`language=${i}`),n&&r.params.push(`worldview=${n}`),this._makeAPIURL(r,this._customAccessToken||t)}normalizeSpriteURL(e,t,i,n){const r=we(e);return ge(e)?(r.path=`/styles/v1${r.path}/sprite${t}${i}`,this._makeAPIURL(r,this._customAccessToken||n)):(r.path+=`${t}${i}`,Me(r))}normalizeTileURL(e,t,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!ge(e))return e;const n=we(e);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||i&&"raster"!==n.authority&&512===i?"@2x":""}${o.supported?".webp":"$1"}`),"raster"===n.authority?n.path=`/${r.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${r.TILE_URL_VERSION}${n.path}`);const a=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(n.params)||r.ACCESS_TOKEN;return r.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,a)}canonicalizeTileURL(e,t){const i=we(e);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return e;let n="mapbox://";i.path.match(/^\/raster\/v1\//)?n+=`raster/${i.path.replace(`/${r.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${i.path.replace(`/${r.TILE_URL_VERSION}/`,"")}`;let o=i.params;return t&&(o=o.filter((e=>!e.match(/^access_token=/)))),o.length&&(n+=`?${o.join("&")}`),n}canonicalizeTileset(e,t){const i=!!t&&ge(t),n=[];for(const t of e.tiles||[])_e(t)?n.push(this.canonicalizeTileURL(t,i)):n.push(t);return n}_makeAPIURL(e,t){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",n=we(r.API_URL);if(e.protocol=n.protocol,e.authority=n.authority,"http"===e.protocol){const t=e.params.indexOf("secure");t>=0&&e.params.splice(t,1)}if("/"!==n.path&&(e.path=`${n.path}${e.path}`),!r.REQUIRE_ACCESS_TOKEN)return Me(e);if(t=t||r.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return e.params=e.params.filter((e=>-1===e.indexOf("access_token"))),e.params.push(`access_token=${t||""}`),Me(e)}},e.ResourceType=oe,e.SegmentVector=Ts,e.SourceCache=nm,e.StencilMode=Kf,e.StructArrayLayout1ui2=Pa,e.StructArrayLayout2f1f2i16=xa,e.StructArrayLayout2i4=aa,e.StructArrayLayout2ui4=Aa,e.StructArrayLayout3f12=ba,e.StructArrayLayout3ui6=wa,e.StructArrayLayout4i8=la,e.StructArrayLayout5f20=Ea,e.Texture=wf,e.Tile=Bf,e.Transitionable=Wo,e.Uniform1f=ts,e.Uniform1i=class extends es{constructor(e){super(e),this.current=0}set(e,t,i){this.fetchUniformLocation(e,t)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},e.Uniform2f=class extends es{constructor(e){super(e),this.current=[0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},e.Uniform3f=class extends es{constructor(e){super(e),this.current=[0,0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},e.Uniform4f=is,e.UniformColor=ns,e.UniformMatrix2f=class extends es{constructor(e){super(e),this.current=as}set(e,t,i){if(this.fetchUniformLocation(e,t))for(let e=0;e<4;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},e.UniformMatrix3f=class extends es{constructor(e){super(e),this.current=os}set(e,t,i){if(this.fetchUniformLocation(e,t))for(let e=0;e<9;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},e.UniformMatrix4f=class extends es{constructor(e){super(e),this.current=rs}set(e,t,i){if(this.fetchUniformLocation(e,t)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},e.UnwrappedTileID=Eh,e.ValidationError=Jn,e.VectorTileFeature=ah,e.VectorTileWorkerSource=class extends Xe{constructor(e,t,i,n,r){super(),this.actor=e,this.layerIndex=t,this.availableImages=i,this.loadVectorData=r||gm,this.loading={},this.loaded={},this.deduped=new mm(e.scheduler),this.isSpriteLoaded=n,this.scheduler=e.scheduler}loadTile(e,t){const i=e.uid,n=e&&e.request,r=n&&n.collectResourceTiming,o=this.loading[i]=new pm(e);o.abort=this.loadVectorData(e,((a,s)=>{const l=!this.loading[i];if(delete this.loading[i],l||a||!s)return o.status="done",l||(this.loaded[i]=o),t(a);const c=s.rawData,u={};s.expires&&(u.expires=s.expires),s.cacheControl&&(u.cacheControl=s.cacheControl),o.vectorTile=s.vectorTile||new oh(new sd(c));const h=()=>{o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,i)=>{if(e||!i)return t(e);const o={};if(r){const e=Ne(n);e.length>0&&(o.resourceTiming=JSON.parse(JSON.stringify(e)))}t(null,P({rawTileData:c.slice(0)},i,u,o))}))};this.isSpriteLoaded?h():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(h,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):h()})),this.loaded=this.loaded||{},this.loaded[i]=o}))}reloadTile(e,t){const i=this.loaded,n=e.uid,r=this;if(i&&i[n]){const o=i[n];o.showCollisionBoxes=e.showCollisionBoxes,o.enableTerrain=!!e.enableTerrain,o.projection=e.projection,o.tileTransform=Lp(e.tileID.canonical,e.projection);const a=(e,i)=>{const n=o.reloadCallback;n&&(delete o.reloadCallback,o.parse(o.vectorTile,r.layerIndex,this.availableImages,r.actor,n)),t(e,i)};"parsing"===o.status?o.reloadCallback=a:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,a):a())}}abortTile(e,t){const i=e.uid,n=this.loading[i];n&&(n.abort&&n.abort(),delete this.loading[i]),t()}removeTile(e,t){const i=this.loaded,n=e.uid;i&&i[n]&&delete i[n],t()}},e.WritingMode=Rd,e.ZoomDependentExpression=Zn,e.add=$s,e.addDynamicAttributes=sf,e.adjoint=function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8];return e[0]=a*u-s*c,e[1]=r*c-n*u,e[2]=n*s-r*a,e[3]=s*l-o*u,e[4]=i*u-r*l,e[5]=r*o-i*s,e[6]=o*c-a*l,e[7]=n*l-i*c,e[8]=i*a-n*o,e},e.asyncAll=C,e.bezier=w,e.bindAll=R,e.boundsAttributes=Rf,e.bufferConvexPolygon=function(e,t){const i=[];for(let n=0;n<e.length;n++){const r=E(n-1,-1,e.length-1),o=E(n+1,-1,e.length-1),a=e[n],s=e[o],l=e[r].sub(a).unit(),c=s.sub(a).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*t/Math.sin(u/2));i.push(a.add(h))}return i},e.cacheEntryPossiblyAdded=function(e){re++,re>ee&&(e.getActor().send("enforceCacheSizeLimit",Q),re=0)},e.calculateGlobeLabelMatrix=function(e,t){const{x:i,y:n}=e.point,r=Zl(i,n,e.worldSize/e._pixelsPerMercatorPixel,0,0);return Ds(r,r,ql(Dl(t)))},e.calculateGlobeMatrix=function(e){const{x:t,y:i}=e.point,{lng:n,lat:r}=e._center;return Zl(t,i,e.worldSize,n,r)},e.calculateGlobeMercatorMatrix=function(e){const t=e.pixelsPerMeter,i=t/ac(1,e.center.lat),n=ks(new Float64Array(16));return Ls(n,n,[e.point.x,e.point.y,0]),Rs(n,n,[i,i,t]),Float32Array.from(n)},e.circumferenceAtLatitude=nc,e.clamp=T,e.clearTileCache=function(e){if(!te())return;const i=t.caches.delete(Y);e&&i.catch(e).then((()=>e()))},e.clipLine=rp,e.clone=function(e){var t=new As(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.clone$1=N,e.collisionCircleLayout=Yh,e.config=r,e.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},e.create=function(){var e=new As(16);return As!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e.create$1=Ps,e.createExpression=$n,e.createLayout=ra,e.createStyleLayer=function(e){return"custom"===e.type?new yf(e):new bf[e.type](e)},e.cross=el,e.degToRad=y,e.distance=function(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])},e.div=function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e},e.dot=Qs,e.earthRadius=ec,e.ease=M,e.easeCubicInOut=b,e.ecefToLatLng=function([e,t,i]){const n=Math.hypot(e,t,i),r=Math.atan2(e,i),o=.5*Math.PI-Math.acos(-t/n);return new ic(x(r),x(o))},e.emitValidationErrors=Fr,e.endsWith=O,e.enforceCacheSizeLimit=function(e){ie(),J&&J.then((t=>{t.keys().then((i=>{for(let n=0;n<i.length-e;n++)t.delete(i[n])}))}))},e.evaluateSizeForFeature=ed,e.evaluateSizeForZoom=td,e.evaluateVariableOffset=Mp,e.evented=Bo,e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.exactEquals$1=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.exported=We,e.exported$1=o,e.extend=P,e.extend$1=Je,e.fillExtrusionHeightLift=vh,e.filterObject=F,e.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},e.fromQuat=function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=i+i,s=n+n,l=r+r,c=i*a,u=n*a,h=n*s,d=r*a,p=r*s,f=r*l,m=o*a,g=o*s,_=o*l;return e[0]=1-h-f,e[1]=u+_,e[2]=d-g,e[3]=0,e[4]=u-_,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.fromRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=i,e[2]=0,e[3]=-i,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.fromScaling=Fs,e.furthestTileCorner=function(e){const t=Math.round((e+45+360)%360/90)%4;return v[t]},e.getAABBPointSquareDist=function(e,t,i){let n=0;for(let r=0;r<2;++r){const o=i?i[r]:0;e[r]>o&&(n+=(e[r]-o)*(e[r]-o)),t[r]<o&&(n+=(o-t[r])*(o-t[r]))}return n},e.getAnchorAlignment=qd,e.getAnchorJustification=Sp,e.getBounds=function(e){let t=1/0,i=1/0,n=-1/0,r=-1/0;for(const o of e)t=Math.min(t,o.x),i=Math.min(i,o.y),n=Math.max(n,o.x),r=Math.max(r,o.y);return{min:new f(t,i),max:new f(n,r)}},e.getColumn=X,e.getGridMatrix=function(e,t,i,n){const r=t.getNorth(),o=t.getSouth(),a=t.getWest(),s=t.getEast(),l=1<<e.z,c=s-a,u=r-o,h=c/Tl,d=-u/Sl[i],p=[0,h,0,d,0,0,r,a,0];if(e.z>0){const e=180/n;Is(p,p,[e/c+1,0,0,0,e/u+1,0,-.5*e/h,.5*e/d,1])}return p[2]=l,p[5]=e.x,p[8]=e.y,p},e.getImage=fe,e.getJSON=function(e,t){return le(P(e,{type:"json"}),t)},e.getLatitudinalLod=function(e){const t=uc-5;e=T(e,-t,t)/t*90;const i=Math.pow(Math.abs(Math.sin(y(e))),3);return Math.round(i*(Sl.length-1))},e.getMapSessionAPI=De,e.getPerformanceMeasurement=Ne,e.getProjection=tf,e.getRTLTextPluginStatus=Fo,e.getReferrer=se,e.getTilePoint=function(e,{x:t,y:i},n=0){return new f(((t-n)*e.scale-e.x)*Ss,(i*e.scale-e.y)*Ss)},e.getTileVec3=function(e,t,i=0){return Ws(((t.x-i)*e.scale-e.x)*Ss,(t.y*e.scale-e.y)*Ss,cc(t.z,t.y))},e.getVideo=function(e,i){const n=t.document.createElement("video");n.muted=!0,n.onloadstart=function(){i(null,n)};for(let i=0;i<e.length;i++){const r=t.document.createElement("source");ue(e[i])||(n.crossOrigin="Anonymous"),r.src=e[i],n.appendChild(r)}return{cancel:()=>{}}},e.globeCenterToScreenPoint=function(e){const t=[0,0,0],i=ks(new Float64Array(16));return Ds(i,e.pixelMatrix,e.globeMatrix),tl(t,t,i),new f(t[0],t[1])},e.globeDenormalizeECEF=ql,e.globeECEFOrigin=function(e,t){const i=[0,0,0];return tl(i,i,$l(Dl(t.canonical))),tl(i,i,e),i},e.globeMetersToEcef=Pl,e.globeNormalizeECEF=$l,e.globePixelsToTileUnits=function(e,t){return Ss/(512*Math.pow(2,e))*jl(Dl(t))},e.globePoleMatrixForTile=function(e,t,i){const n=ks(new Float64Array(16)),r=(t/(1<<e)-.5)*Math.PI*2;return Bs(n,i.globeMatrix,r),Float32Array.from(n)},e.globeTileBounds=Dl,e.globeTiltAtLngLat=Xl,e.globeToMercatorTransition=Hl,e.globeUseCustomAntiAliasing=function(e,t,i){const n=Hl(i.zoom),r=e.style.map._antialias,o=!!t.extStandardDerivatives,a=t.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===n&&!r&&!a&&o},e.identity=ks,e.identity$1=hl,e.invert=zs,e.isFullscreen=function(){return!!t.document.fullscreenElement||!!t.document.webkitFullscreenElement},e.isLngLatBehindGlobe=Yl,e.isMapAuthenticated=function(e){return Le.has(e)},e.isMapboxURL=ge,e.isSafariWithAntialiasingBug=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!Z(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},e.latFromMercatorY=lc,e.latLngToECEF=Vl,e.len=al,e.length=js,e.length$1=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},e.lngFromMercatorX=sc,e.loadVectorTile=gm,e.makeRequest=le,e.mapValue=function(e,t,i,n,r){return T((e-t)/(i-t)*(r-n)+n,n,r)},e.mercatorScale=hc,e.mercatorXfromLng=rc,e.mercatorYfromLat=oc,e.mercatorZfromAltitude=ac,e.mul=Us,e.mul$1=ol,e.multiply=Ds,e.multiply$1=Is,e.multiply$2=Zs,e.nextPowerOfTwo=D,e.normalize=Ks,e.normalize$1=fl,e.normalize$2=ll,e.number=Ci,e.ortho=function(e,t,i,n,r,o,a){var s=1/(t-i),l=1/(n-r),c=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*s,e[13]=(r+n)*l,e[14]=(a+o)*c,e[15]=1,e},e.pbf=sd,e.perspective=function(e,t,i,n,r){var o,a=1/Math.tan(t/2);return e[0]=a/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=(r+n)*(o=1/(n-r)),e[14]=2*r*n*o):(e[10]=-1,e[14]=-2*n),e},e.pick=function(e,t){const i={};for(let n=0;n<t.length;n++){const r=t[n];r in e&&(i[r]=e[r])}return i},e.plugin=Uo,e.pointGeometry=f,e.polesInViewport=function(e){const t=ks(new Float64Array(16));Ds(t,e.pixelMatrix,e.globeMatrix);const i=[0,El,0],n=[0,Cl,0];return tl(i,i,t),tl(n,n,t),[i[0]>0&&i[0]<=e.width&&i[1]>0&&i[1]<=e.height&&!Yl(e,new ic(e.center.lat,90)),n[0]>0&&n[0]<=e.width&&n[1]>0&&n[1]<=e.height&&!Yl(e,new ic(e.center.lat,-90))]},e.polygonContainsPoint=Lc,e.polygonIntersectsBox=Rc,e.polygonIntersectsPolygon=Sc,e.polygonizeBounds=function(e,t,i=0,n=!0){const r=new f(i,i),o=e.sub(r),a=t.add(r),s=[o,new f(a.x,o.y),a,new f(o.x,a.y)];return n&&s.push(o.clone()),s},e.posAttributes=yl,e.postMapLoadEvent=Pe,e.postPerformanceEvent=ke,e.postTurnstileEvent=Ce,e.potpack=zd,e.prevPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.radToDeg=x,e.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.registerForPluginStateChange=function(e){return e({pluginStatus:Do,pluginURL:Lo}),Bo.on("pluginStateChange",e),e},e.removeAuthState=function(e){Le.delete(e)},e.renderColorRamp=tu,e.resample=fc,e.rotateX=Os,e.rotateX$1=dl,e.rotateY=Bs,e.rotateY$1=pl,e.rotateZ=function(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[0],a=t[1],s=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r+c*n,e[1]=a*r+u*n,e[2]=s*r+h*n,e[3]=l*r+d*n,e[4]=c*r-o*n,e[5]=u*r-a*n,e[6]=h*r-s*n,e[7]=d*r-l*n,e},e.rotateZ$1=function(e,t,i){i*=.5;var n=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(i),l=Math.cos(i);return e[0]=n*l+r*s,e[1]=r*l-n*s,e[2]=o*l+a*s,e[3]=a*l-o*s,e},e.scale=Rs,e.scale$1=sl,e.scale$2=Ys,e.scaleAndAdd=Js,e.set=function(e,t,i,n){return e[0]=t,e[1]=i,e[2]=n,e},e.setCacheLimits=function(e,t){Q=e,ee=t},e.setColumn=function(e,t,i){e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},e.setRTLTextPlugin=function(e,t,i=!1){if(Do===Po||Do===Io||Do===ko)throw new Error("setRTLTextPlugin cannot be called multiple times.");Lo=We.resolveURL(e),Do=Po,zo=t,Oo(),i||No()},e.smoothstep=S,e.spec=Ye,e.squaredLength=function(e){var t=e[0],i=e[1],n=e[2];return t*t+i*i+n*n},e.storeAuthState=function(e,t){t?Le.add(e):Le.delete(e)},e.sub=rl,e.subtract=qs,e.symbolSize=id,e.tileAABB=function(e,t,i,n,r,o,a,s,l){if("globe"===l.name)return Bl(e,t,new Sh(i,n,r));const c=Lp({z:i,x:n,y:r},l);return new wl([(o+c.x/c.scale)*t,t*(c.y/c.scale),a],[(o+c.x2/c.scale)*t,t*(c.y2/c.scale),s])},e.tileCornersToBounds=Fl,e.tileTransform=Lp,e.transformMat3=function(e,t,i){var n=t[0],r=t[1],o=t[2];return e[0]=n*i[0]+r*i[3]+o*i[6],e[1]=n*i[1]+r*i[4]+o*i[7],e[2]=n*i[2]+r*i[5]+o*i[8],e},e.transformMat4=tl,e.transformMat4$1=cl,e.transformQuat=il,e.transitionTileAABBinECEF=Rl,e.translate=Ls,e.transpose=function(e,t){if(e===t){var i=t[1],n=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=n,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},e.triggerPluginCompletionEvent=Ro,e.uniqueId=k,e.updateGlobeVertexNormal=function(e,t,i,n,r){const o=5*t+2;e.float32[o+0]=i,e.float32[o+1]=n,e.float32[o+2]=r},e.validateCustomStyleLayer=function(e){const t=[],i=e.id;return void 0===i&&t.push({message:`layers.${i}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${i}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},e.validateFilter=e=>Br(yr(e)),e.validateFog=e=>Br(Ir(e)),e.validateLayer=e=>Br(Mr(e)),e.validateLight=e=>Br(Ar(e)),e.validateSource=e=>Br(Er(e)),e.validateStyle=Lr,e.validateTerrain=e=>Br(Pr(e)),e.values=A,e.vectorTile=Zu,e.version=i,e.warnOnce=V,e.window=t,e.wrap=E})),n(["./shared"],(function(e){function t(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let i="[";for(const n of e)i+=`${t(n)},`;return`${i}]`}let i="{";for(const n of Object.keys(e).sort())i+=`${n}:${t(e[n])},`;return`${i}}`}function i(i){let n="";for(const r of e.refProperties)n+=`/${t(i[r])}`;return n}class n{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(t,n){for(const i of t)this._layerConfigs[i.id]=i,(this._layers[i.id]=e.createStyleLayer(i)).compileFilter(),this.keyCache[i.id]&&delete this.keyCache[i.id];for(const e of n)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const r=function(e,t){const n={};for(let r=0;r<e.length;r++){const o=t&&t[e[r].id]||i(e[r]);t&&(t[e[r].id]=o);let a=n[o];a||(a=n[o]=[]),a.push(e[r])}const r=[];for(const e in n)r.push(n[e]);return r}(e.values(this._layerConfigs),this.keyCache);for(const e of r){const t=e.map((e=>this._layers[e.id])),i=t[0];if("none"===i.visibility)continue;const n=i.source||"";let r=this.familiesBySource[n];r||(r=this.familiesBySource[n]={});const o=i.sourceLayer||"_geojsonTileLayer";let a=r[o];a||(a=r[o]=[]),a.push(t)}}}class r{loadTile(t,i){const{uid:n,encoding:r,rawImageData:o,padding:a,buildQuadTree:s}=t,l=e.window.ImageBitmap&&o instanceof e.window.ImageBitmap?this.getImageData(o,a):o;i(null,new e.DEMData(n,l,r,a<1,s))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const i=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),i}}var o=function e(t,i){var n,r=t&&t.type;if("FeatureCollection"===r)for(n=0;n<t.features.length;n++)e(t.features[n],i);else if("GeometryCollection"===r)for(n=0;n<t.geometries.length;n++)e(t.geometries[n],i);else if("Feature"===r)e(t.geometry,i);else if("Polygon"===r)a(t.coordinates,i);else if("MultiPolygon"===r)for(n=0;n<t.coordinates.length;n++)a(t.coordinates[n],i);return t};function a(e,t){if(0!==e.length){s(e[0],t);for(var i=1;i<e.length;i++)s(e[i],!t)}}function s(e,t){for(var i=0,n=0,r=0,o=e.length,a=o-1;r<o;a=r++){var s=(e[r][0]-e[a][0])*(e[a][1]+e[r][1]),l=i+s;n+=Math.abs(i)>=Math.abs(s)?i-l+s:s-l+i,i=l}i+n>=0!=!!t&&e.reverse()}const l=e.VectorTileFeature.prototype.toGeoJSON;class c{constructor(t){this._feature=t,this.extent=e.EXTENT,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const i of this._feature.geometry)t.push([new e.pointGeometry(i[0],i[1])]);return t}{const t=[];for(const i of this._feature.geometry){const n=[];for(const t of i)n.push(new e.pointGeometry(t[0],t[1]));t.push(n)}return t}}toGeoJSON(e,t,i){return l.call(this,e,t,i)}}class u{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.EXTENT,this.length=t.length,this._features=t}feature(e){return new c(this._features[e])}}var h={},d={get exports(){return h},set exports(e){h=e}},p=e.pointGeometry,f=e.vectorTile.VectorTileFeature,m=g;function g(e,t){this.options=t||{},this.features=e,this.length=e.length}function _(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}g.prototype.feature=function(e){return new _(this.features[e],this.options.extent)},_.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var i=e[t],n=[],r=0;r<i.length;r++)n.push(new p(i[r][0],i[r][1]));this.geometry.push(n)}return this.geometry},_.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,i=-1/0,n=1/0,r=-1/0,o=0;o<e.length;o++)for(var a=e[o],s=0;s<a.length;s++){var l=a[s];t=Math.min(t,l.x),i=Math.max(i,l.x),n=Math.min(n,l.y),r=Math.max(r,l.y)}return[t,n,i,r]},_.prototype.toGeoJSON=f.prototype.toGeoJSON;var y=e.pbf,x=m;function v(e){var t=new y;return function(e,t){for(var i in e.layers)t.writeMessage(3,b,e.layers[i])}(e,t),t.finish()}function b(e,t){var i;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<e.length;i++)n.feature=e.feature(i),t.writeMessage(2,w,n);var r=n.keys;for(i=0;i<r.length;i++)t.writeStringField(3,r[i]);var o=n.values;for(i=0;i<o.length;i++)t.writeMessage(4,C,o[i])}function w(e,t){var i=e.feature;void 0!==i.id&&t.writeVarintField(1,i.id),t.writeMessage(2,M,e),t.writeVarintField(3,i.type),t.writeMessage(4,E,i)}function M(e,t){var i=e.feature,n=e.keys,r=e.values,o=e.keycache,a=e.valuecache;for(var s in i.properties){var l=i.properties[s],c=o[s];if(null!==l){void 0===c&&(n.push(s),o[s]=c=n.length-1),t.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=a[h];void 0===d&&(r.push(l),a[h]=d=r.length-1),t.writeVarint(d)}}}function T(e,t){return(t<<3)+(7&e)}function S(e){return e<<1^e>>31}function E(e,t){for(var i=e.loadGeometry(),n=e.type,r=0,o=0,a=i.length,s=0;s<a;s++){var l=i[s],c=1;1===n&&(c=l.length),t.writeVarint(T(1,c));for(var u=3===n?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==n&&t.writeVarint(T(2,u-1));var d=l[h].x-r,p=l[h].y-o;t.writeVarint(S(d)),t.writeVarint(S(p)),r+=d,o+=p}3===n&&t.writeVarint(T(7,1))}}function C(e,t){var i=typeof e;"string"===i?t.writeStringField(1,e):"boolean"===i?t.writeBooleanField(7,e):"number"===i&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}function A(e,t,i,n,r,o){if(r-n<=i)return;const a=n+r>>1;P(e,t,a,n,r,o%2),A(e,t,i,n,a-1,o+1),A(e,t,i,a+1,r,o+1)}function P(e,t,i,n,r,o){for(;r>n;){if(r-n>600){const a=r-n+1,s=i-n+1,l=Math.log(a),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(a-c)/a)*(s-a/2<0?-1:1);P(e,t,i,Math.max(n,Math.floor(i-s*c/a+u)),Math.min(r,Math.floor(i+(a-s)*c/a+u)),o)}const a=t[2*i+o];let s=n,l=r;for(I(e,t,n,i),t[2*r+o]>a&&I(e,t,n,r);s<l;){for(I(e,t,s,l),s++,l--;t[2*s+o]<a;)s++;for(;t[2*l+o]>a;)l--}t[2*n+o]===a?I(e,t,n,l):(l++,I(e,t,l,r)),l<=i&&(n=l+1),i<=l&&(r=l-1)}}function I(e,t,i,n){k(e,i,n),k(t,2*i,2*n),k(t,2*i+1,2*n+1)}function k(e,t,i){const n=e[t];e[t]=e[i],e[i]=n}function z(e,t,i,n){const r=e-i,o=t-n;return r*r+o*o}d.exports=v,h.fromVectorTileJs=v,h.fromGeojsonVt=function(e,t){t=t||{};var i={};for(var n in e)i[n]=new x(e[n].features,t),i[n].name=n,i[n].version=t.version,i[n].extent=t.extent;return v({layers:i})},h.GeoJSONWrapper=x;const D=e=>e[0],L=e=>e[1];class R{constructor(e,t=D,i=L,n=64,r=Float64Array){this.nodeSize=n,this.points=e;const o=e.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(e.length),s=this.coords=new r(2*e.length);for(let n=0;n<e.length;n++)a[n]=n,s[2*n]=t(e[n]),s[2*n+1]=i(e[n]);A(a,s,n,0,a.length-1,0)}range(e,t,i,n){return function(e,t,i,n,r,o,a){const s=[0,e.length-1,0],l=[];let c,u;for(;s.length;){const h=s.pop(),d=s.pop(),p=s.pop();if(d-p<=a){for(let a=p;a<=d;a++)c=t[2*a],u=t[2*a+1],c>=i&&c<=r&&u>=n&&u<=o&&l.push(e[a]);continue}const f=Math.floor((p+d)/2);c=t[2*f],u=t[2*f+1],c>=i&&c<=r&&u>=n&&u<=o&&l.push(e[f]);const m=(h+1)%2;(0===h?i<=c:n<=u)&&(s.push(p),s.push(f-1),s.push(m)),(0===h?r>=c:o>=u)&&(s.push(f+1),s.push(d),s.push(m))}return l}(this.ids,this.coords,e,t,i,n,this.nodeSize)}within(e,t,i){return function(e,t,i,n,r,o){const a=[0,e.length-1,0],s=[],l=r*r;for(;a.length;){const c=a.pop(),u=a.pop(),h=a.pop();if(u-h<=o){for(let r=h;r<=u;r++)z(t[2*r],t[2*r+1],i,n)<=l&&s.push(e[r]);continue}const d=Math.floor((h+u)/2),p=t[2*d],f=t[2*d+1];z(p,f,i,n)<=l&&s.push(e[d]);const m=(c+1)%2;(0===c?i-r<=p:n-r<=f)&&(a.push(h),a.push(d-1),a.push(m)),(0===c?i+r>=p:n+r>=f)&&(a.push(d+1),a.push(u),a.push(m))}return s}(this.ids,this.coords,e,t,i,this.nodeSize)}}const O={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},B=Math.fround||(F=new Float32Array(1),e=>(F[0]=+e,F[0]));var F;class N{constructor(e){this.options=Z(Object.create(O),e),this.trees=new Array(this.options.maxZoom+1)}load(e){const{log:t,minZoom:i,maxZoom:n,nodeSize:r}=this.options;t&&console.time("total time");const o=`prepare ${e.length} points`;t&&console.time(o),this.points=e;let a=[];for(let t=0;t<e.length;t++)e[t].geometry&&a.push(V(e[t],t));this.trees[n+1]=new R(a,H,X,r,Float32Array),t&&console.timeEnd(o);for(let e=n;e>=i;e--){const i=+Date.now();a=this._cluster(a,e),this.trees[e]=new R(a,H,X,r,Float32Array),t&&console.log("z%d: %d clusters in %dms",e,a.length,+Date.now()-i)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let i=((e[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,e[1]));let r=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)i=-180,r=180;else if(i>r){const e=this.getClusters([i,n,180,o],t),a=this.getClusters([-180,n,r,o],t);return e.concat(a)}const a=this.trees[this._limitZoom(t)],s=a.range(W(i),$(o),W(r),$(n)),l=[];for(const e of s){const t=a.points[e];l.push(t.numPoints?G(t):this.points[t.index])}return l}getChildren(e){const t=this._getOriginId(e),i=this._getOriginZoom(e),n="No cluster with the specified id.",r=this.trees[i];if(!r)throw new Error(n);const o=r.points[t];if(!o)throw new Error(n);const a=this.options.radius/(this.options.extent*Math.pow(2,i-1)),s=r.within(o.x,o.y,a),l=[];for(const t of s){const i=r.points[t];i.parentId===e&&l.push(i.numPoints?G(i):this.points[i.index])}if(0===l.length)throw new Error(n);return l}getLeaves(e,t,i){const n=[];return this._appendLeaves(n,e,t=t||10,i=i||0,0),n}getTile(e,t,i){const n=this.trees[this._limitZoom(e)],r=Math.pow(2,e),{extent:o,radius:a}=this.options,s=a/o,l=(i-s)/r,c=(i+1+s)/r,u={features:[]};return this._addTileFeatures(n.range((t-s)/r,l,(t+1+s)/r,c),n.points,t,i,r,u),0===t&&this._addTileFeatures(n.range(1-s/r,l,1,c),n.points,r,i,r,u),t===r-1&&this._addTileFeatures(n.range(0,l,s/r,c),n.points,-1,i,r,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const i=this.getChildren(e);if(t++,1!==i.length)break;e=i[0].properties.cluster_id}return t}_appendLeaves(e,t,i,n,r){const o=this.getChildren(t);for(const t of o){const o=t.properties;if(o&&o.cluster?r+o.point_count<=n?r+=o.point_count:r=this._appendLeaves(e,o.cluster_id,i,n,r):r<n?r++:e.push(t),e.length===i)break}return r}_addTileFeatures(e,t,i,n,r,o){for(const a of e){const e=t[a],s=e.numPoints;let l,c,u;if(s)l=j(e),c=e.x,u=e.y;else{const t=this.points[e.index];l=t.properties,c=W(t.geometry.coordinates[0]),u=$(t.geometry.coordinates[1])}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-i)),Math.round(this.options.extent*(u*r-n))]],tags:l};let d;s?d=e.id:this.options.generateId?d=e.index:this.points[e.index].id&&(d=this.points[e.index].id),void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const i=[],{radius:n,extent:r,reduce:o,minPoints:a}=this.options,s=n/(r*Math.pow(2,t));for(let n=0;n<e.length;n++){const r=e[n];if(r.zoom<=t)continue;r.zoom=t;const l=this.trees[t+1],c=l.within(r.x,r.y,s),u=r.numPoints||1;let h=u;for(const e of c){const i=l.points[e];i.zoom>t&&(h+=i.numPoints||1)}if(h>u&&h>=a){let e=r.x*u,a=r.y*u,s=o&&u>1?this._map(r,!0):null;const d=(n<<5)+(t+1)+this.points.length;for(const i of c){const n=l.points[i];if(n.zoom<=t)continue;n.zoom=t;const c=n.numPoints||1;e+=n.x*c,a+=n.y*c,n.parentId=d,o&&(s||(s=this._map(r,!0)),o(s,this._map(n)))}r.parentId=d,i.push(U(e/h,a/h,d,h,s))}else if(i.push(r),h>1)for(const e of c){const n=l.points[e];n.zoom<=t||(n.zoom=t,i.push(n))}}return i}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t){if(e.numPoints)return t?Z({},e.properties):e.properties;const i=this.points[e.index].properties,n=this.options.map(i);return t&&n===i?Z({},n):n}}function U(e,t,i,n,r){return{x:B(e),y:B(t),zoom:1/0,id:i,parentId:-1,numPoints:n,properties:r}}function V(e,t){const[i,n]=e.geometry.coordinates;return{x:B(W(i)),y:B($(n)),zoom:1/0,index:t,parentId:-1}}function G(e){return{type:"Feature",id:e.id,properties:j(e),geometry:{type:"Point",coordinates:[(t=e.x,360*(t-.5)),q(e.y)]}};var t}function j(e){const t=e.numPoints,i=t>=1e4?`${Math.round(t/1e3)}k`:t>=1e3?Math.round(t/100)/10+"k":t;return Z(Z({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:i})}function W(e){return e/360+.5}function $(e){const t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function q(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function Z(e,t){for(const i in t)e[i]=t[i];return e}function H(e){return e.x}function X(e){return e.y}function Y(e,t,i,n){for(var r,o=n,a=i-t>>1,s=i-t,l=e[t],c=e[t+1],u=e[i],h=e[i+1],d=t+3;d<i;d+=3){var p=J(e[d],e[d+1],l,c,u,h);if(p>o)r=d,o=p;else if(p===o){var f=Math.abs(d-a);f<s&&(r=d,s=f)}}o>n&&(r-t>3&&Y(e,t,r,n),e[r+2]=o,i-r>3&&Y(e,r,i,n))}function J(e,t,i,n,r,o){var a=r-i,s=o-n;if(0!==a||0!==s){var l=((e-i)*a+(t-n)*s)/(a*a+s*s);l>1?(i=r,n=o):l>0&&(i+=a*l,n+=s*l)}return(a=e-i)*a+(s=t-n)*s}function K(e,t,i,n){var r={id:void 0===e?null:e,type:t,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,i=e.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)Q(e,t);else if("Polygon"===i||"MultiLineString"===i)for(var n=0;n<t.length;n++)Q(e,t[n]);else if("MultiPolygon"===i)for(n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++)Q(e,t[n][r])}(r),r}function Q(e,t){for(var i=0;i<t.length;i+=3)e.minX=Math.min(e.minX,t[i]),e.minY=Math.min(e.minY,t[i+1]),e.maxX=Math.max(e.maxX,t[i]),e.maxY=Math.max(e.maxY,t[i+1])}function ee(e,t,i,n){if(t.geometry){var r=t.geometry.coordinates,o=t.geometry.type,a=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),s=[],l=t.id;if(i.promoteId?l=t.properties[i.promoteId]:i.generateId&&(l=n||0),"Point"===o)te(r,s);else if("MultiPoint"===o)for(var c=0;c<r.length;c++)te(r[c],s);else if("LineString"===o)ie(r,s,a,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(c=0;c<r.length;c++)ie(r[c],s=[],a,!1),e.push(K(l,"LineString",s,t.properties));return}ne(r,s,a,!1)}else if("Polygon"===o)ne(r,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(c=0;c<t.geometry.geometries.length;c++)ee(e,{id:l,geometry:t.geometry.geometries[c],properties:t.properties},i,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<r.length;c++){var u=[];ne(r[c],u,a,!0),s.push(u)}}e.push(K(l,o,s,t.properties))}}function te(e,t){t.push(re(e[0])),t.push(oe(e[1])),t.push(0)}function ie(e,t,i,n){for(var r,o,a=0,s=0;s<e.length;s++){var l=re(e[s][0]),c=oe(e[s][1]);t.push(l),t.push(c),t.push(0),s>0&&(a+=n?(r*c-l*o)/2:Math.sqrt(Math.pow(l-r,2)+Math.pow(c-o,2))),r=l,o=c}var u=t.length-3;t[2]=1,Y(t,0,u,i),t[u+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function ne(e,t,i,n){for(var r=0;r<e.length;r++){var o=[];ie(e[r],o,i,n),t.push(o)}}function re(e){return e/360+.5}function oe(e){var t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function ae(e,t,i,n,r,o,a,s){if(n/=t,o>=(i/=t)&&a<n)return e;if(a<i||o>=n)return null;for(var l=[],c=0;c<e.length;c++){var u=e[c],h=u.geometry,d=u.type,p=0===r?u.minX:u.minY,f=0===r?u.maxX:u.maxY;if(p>=i&&f<n)l.push(u);else if(!(f<i||p>=n)){var m=[];if("Point"===d||"MultiPoint"===d)se(h,m,i,n,r);else if("LineString"===d)le(h,m,i,n,r,!1,s.lineMetrics);else if("MultiLineString"===d)ue(h,m,i,n,r,!1);else if("Polygon"===d)ue(h,m,i,n,r,!0);else if("MultiPolygon"===d)for(var g=0;g<h.length;g++){var _=[];ue(h[g],_,i,n,r,!0),_.length&&m.push(_)}if(m.length){if(s.lineMetrics&&"LineString"===d){for(g=0;g<m.length;g++)l.push(K(u.id,d,m[g],u.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===m.length?(d="LineString",m=m[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===m.length?"Point":"MultiPoint"),l.push(K(u.id,d,m,u.tags))}}}return l.length?l:null}function se(e,t,i,n,r){for(var o=0;o<e.length;o+=3){var a=e[o+r];a>=i&&a<=n&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function le(e,t,i,n,r,o,a){for(var s,l,c=ce(e),u=0===r?de:pe,h=e.start,d=0;d<e.length-3;d+=3){var p=e[d],f=e[d+1],m=e[d+2],g=e[d+3],_=e[d+4],y=0===r?p:f,x=0===r?g:_,v=!1;a&&(s=Math.sqrt(Math.pow(p-g,2)+Math.pow(f-_,2))),y<i?x>i&&(l=u(c,p,f,g,_,i),a&&(c.start=h+s*l)):y>n?x<n&&(l=u(c,p,f,g,_,n),a&&(c.start=h+s*l)):he(c,p,f,m),x<i&&y>=i&&(l=u(c,p,f,g,_,i),v=!0),x>n&&y<=n&&(l=u(c,p,f,g,_,n),v=!0),!o&&v&&(a&&(c.end=h+s*l),t.push(c),c=ce(e)),a&&(h+=s)}var b=e.length-3;p=e[b],f=e[b+1],m=e[b+2],(y=0===r?p:f)>=i&&y<=n&&he(c,p,f,m),b=c.length-3,o&&b>=3&&(c[b]!==c[0]||c[b+1]!==c[1])&&he(c,c[0],c[1],c[2]),c.length&&t.push(c)}function ce(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function ue(e,t,i,n,r,o){for(var a=0;a<e.length;a++)le(e[a],t,i,n,r,o,!1)}function he(e,t,i,n){e.push(t),e.push(i),e.push(n)}function de(e,t,i,n,r,o){var a=(o-t)/(n-t);return e.push(o),e.push(i+(r-i)*a),e.push(1),a}function pe(e,t,i,n,r,o){var a=(o-i)/(r-i);return e.push(t+(n-t)*a),e.push(o),e.push(1),a}function fe(e,t){for(var i=[],n=0;n<e.length;n++){var r,o=e[n],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)r=me(o.geometry,t);else if("MultiLineString"===a||"Polygon"===a){r=[];for(var s=0;s<o.geometry.length;s++)r.push(me(o.geometry[s],t))}else if("MultiPolygon"===a)for(r=[],s=0;s<o.geometry.length;s++){for(var l=[],c=0;c<o.geometry[s].length;c++)l.push(me(o.geometry[s][c],t));r.push(l)}i.push(K(o.id,a,r,o.tags))}return i}function me(e,t){var i=[];i.size=e.size,void 0!==e.start&&(i.start=e.start,i.end=e.end);for(var n=0;n<e.length;n+=3)i.push(e[n]+t,e[n+1],e[n+2]);return i}function ge(e,t){if(e.transformed)return e;var i,n,r,o=1<<e.z,a=e.x,s=e.y;for(i=0;i<e.features.length;i++){var l=e.features[i],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(n=0;n<c.length;n+=2)l.geometry.push(_e(c[n],c[n+1],t,o,a,s));else for(n=0;n<c.length;n++){var h=[];for(r=0;r<c[n].length;r+=2)h.push(_e(c[n][r],c[n][r+1],t,o,a,s));l.geometry.push(h)}}return e.transformed=!0,e}function _e(e,t,i,n,r,o){return[Math.round(i*(e*n-r)),Math.round(i*(t*n-o))]}function ye(e,t,i,n,r){for(var o=t===r.maxZoom?0:r.tolerance/((1<<t)*r.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,xe(a,e[s],o,r);var l=e[s].minX,c=e[s].minY,u=e[s].maxX,h=e[s].maxY;l<a.minX&&(a.minX=l),c<a.minY&&(a.minY=c),u>a.maxX&&(a.maxX=u),h>a.maxY&&(a.maxY=h)}return a}function xe(e,t,i,n){var r=t.geometry,o=t.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<r.length;s+=3)a.push(r[s]),a.push(r[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)ve(a,r,e,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<r.length;s++)ve(a,r[s],e,i,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var l=0;l<r.length;l++){var c=r[l];for(s=0;s<c.length;s++)ve(a,c[s],e,i,!0,0===s)}if(a.length){var u=t.tags||null;if("LineString"===o&&n.lineMetrics){for(var h in u={},t.tags)u[h]=t.tags[h];u.mapbox_clip_start=r.start/r.size,u.mapbox_clip_end=r.end/r.size}var d={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==t.id&&(d.id=t.id),e.features.push(d)}}function ve(e,t,i,n,r,o){var a=n*n;if(n>0&&t.size<(r?a:n))i.numPoints+=t.length/3;else{for(var s=[],l=0;l<t.length;l+=3)(0===n||t[l+2]>a)&&(i.numSimplified++,s.push(t[l]),s.push(t[l+1])),i.numPoints++;r&&function(e,t){for(var i=0,n=0,r=e.length,o=r-2;n<r;o=n,n+=2)i+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(i>0===t)for(n=0,r=e.length;n<r/2;n+=2){var a=e[n],s=e[n+1];e[n]=e[r-2-n],e[n+1]=e[r-1-n],e[r-2-n]=a,e[r-1-n]=s}}(s,o),e.push(s)}}function be(e,t){var i=(t=this.options=function(e,t){for(var i in t)e[i]=t[i];return e}(Object.create(this.options),t)).debug;if(i&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(e,t){var i=[];if("FeatureCollection"===e.type)for(var n=0;n<e.features.length;n++)ee(i,e.features[n],t,n);else ee(i,"Feature"===e.type?e:{geometry:e},t);return i}(e,t);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=function(e,t){var i=t.buffer/t.extent,n=e,r=ae(e,1,-1-i,i,0,-1,2,t),o=ae(e,1,1-i,2+i,0,-1,2,t);return(r||o)&&(n=ae(e,1,-i,1+i,0,-1,2,t)||[],r&&(n=fe(r,1).concat(n)),o&&(n=n.concat(fe(o,-1)))),n}(n,t),n.length&&this.splitTile(n,0,0,0),i&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function we(e,t,i){return 32*((1<<e)*i+t)+e}function Me(e,t){const i=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);const n=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!n)return t(null,null);const r=new u(n.features);let o=h(r);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),t(null,{vectorTile:r,rawData:o.buffer})}be.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},be.prototype.splitTile=function(e,t,i,n,r,o,a){for(var s=[e,t,i,n],l=this.options,c=l.debug;s.length;){n=s.pop(),i=s.pop(),t=s.pop(),e=s.pop();var u=1<<t,h=we(t,i,n),d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=ye(e,t,i,n,l),this.tileCoords.push({z:t,x:i,y:n}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,n,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=e,r){if(t===l.maxZoom||t===r)continue;var f=1<<r-t;if(i!==Math.floor(o/f)||n!==Math.floor(a/f))continue}else if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==e.length){c>1&&console.time("clipping");var m,g,_,y,x,v,b=.5*l.buffer/l.extent,w=.5-b,M=.5+b,T=1+b;m=g=_=y=null,x=ae(e,u,i-b,i+M,0,d.minX,d.maxX,l),v=ae(e,u,i+w,i+T,0,d.minX,d.maxX,l),e=null,x&&(m=ae(x,u,n-b,n+M,1,d.minY,d.maxY,l),g=ae(x,u,n+w,n+T,1,d.minY,d.maxY,l),x=null),v&&(_=ae(v,u,n-b,n+M,1,d.minY,d.maxY,l),y=ae(v,u,n+w,n+T,1,d.minY,d.maxY,l),v=null),c>1&&console.timeEnd("clipping"),s.push(m||[],t+1,2*i,2*n),s.push(g||[],t+1,2*i,2*n+1),s.push(_||[],t+1,2*i+1,2*n),s.push(y||[],t+1,2*i+1,2*n+1)}}},be.prototype.getTile=function(e,t,i){var n=this.options,r=n.extent,o=n.debug;if(e<0||e>24)return null;var a=1<<e,s=we(e,t=(t%a+a)%a,i);if(this.tiles[s])return ge(this.tiles[s],r);o>1&&console.log("drilling down to z%d-%d-%d",e,t,i);for(var l,c=e,u=t,h=i;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[we(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,e,t,i),o>1&&console.timeEnd("drilling down"),this.tiles[s]?ge(this.tiles[s],r):null):null};class Te extends e.VectorTileWorkerSource{constructor(e,t,i,n,r){super(e,t,i,n,Me),r&&(this.loadGeoJSON=r)}loadData(t,i){const n=t&&t.request,r=n&&n.collectResourceTiming;this.loadGeoJSON(t,((a,s)=>{if(a||!s)return i(a);if("object"!=typeof s)return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));{o(s,!0);try{if(t.filter){const i=e.createExpression(t.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===i.result)throw new Error(i.value.map((e=>`${e.key}: ${e.message}`)).join(", "));const n=s.features.filter((e=>i.value.evaluate({zoom:0},e)));s={type:"FeatureCollection",features:n}}this._geoJSONIndex=t.cluster?new N(function({superclusterOptions:t,clusterProperties:i}){if(!i||!t)return t;const n={},r={},o={accumulated:null,zoom:0},a={properties:null},s=Object.keys(i);for(const t of s){const[o,a]=i[t],s=e.createExpression(a),l=e.createExpression("string"==typeof o?[o,["accumulated"],["get",t]]:o);n[t]=s.value,r[t]=l.value}return t.map=e=>{a.properties=e;const t={};for(const e of s)t[e]=n[e].evaluate(o,a);return t},t.reduce=(e,t)=>{a.properties=t;for(const t of s)o.accumulated=e[t],e[t]=r[t].evaluate(o,a)},t}(t)).load(s.features):function(e,t){return new be(e,t)}(s,t.geojsonVtOptions)}catch(a){return i(a)}this.loaded={};const l={};if(r){const i=e.getPerformanceMeasurement(n);i&&(l.resourceTiming={},l.resourceTiming[t.source]=JSON.parse(JSON.stringify(i)))}i(null,l)}}))}reloadTile(e,t){const i=this.loaded;return i&&i[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,i){if(t.request)e.getJSON(t.request,i);else{if("string"!=typeof t.data)return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));try{return i(null,JSON.parse(t.data))}catch(e){return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class Se{constructor(t){this.self=t,this.actor=new e.Actor(t,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=e.getProjection({name:"mercator"}),this.workerSourceTypes={vector:e.VectorTileWorkerSource,geojson:Te},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.plugin.isParsed())throw new Error("RTL text plugin already registered.");e.plugin.applyArabicShaping=t.applyArabicShaping,e.plugin.processBidirectionalText=t.processBidirectionalText,e.plugin.processStyledBidirectionalText=t.processStyledBidirectionalText}}clearCaches(e,t,i){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],i()}checkIfReady(e,t,i){i()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,i){this.isSpriteLoaded[t]=i;for(const n in this.workerSources[t]){const r=this.workerSources[t][n];for(const t in r)r[t]instanceof e.VectorTileWorkerSource&&(r[t].isSpriteLoaded=i,r[t].fire(new e.Event("isSpriteLoaded")))}}setImages(e,t,i){this.availableImages[e]=t;for(const i in this.workerSources[e]){const n=this.workerSources[e][i];for(const e in n)n[e].availableImages=t}i()}enableTerrain(e,t,i){this.terrain=t,i()}setProjection(t,i){this.projections[t]=e.getProjection(i)}setLayers(e,t,i){this.getLayerIndex(e).replace(t),i()}updateLayers(e,t,i){this.getLayerIndex(e).update(t.layers,t.removedIds),i()}loadTile(t,i,n){const r=this.enableTerrain?e.extend({enableTerrain:this.terrain},i):i;r.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,i.type,i.source).loadTile(r,n)}loadDEMTile(t,i,n){const r=this.enableTerrain?e.extend({buildQuadTree:this.terrain},i):i;this.getDEMWorkerSource(t,i.source).loadTile(r,n)}reloadTile(t,i,n){const r=this.enableTerrain?e.extend({enableTerrain:this.terrain},i):i;r.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,i.type,i.source).reloadTile(r,n)}abortTile(e,t,i){this.getWorkerSource(e,t.type,t.source).abortTile(t,i)}removeTile(e,t,i){this.getWorkerSource(e,t.type,t.source).removeTile(t,i)}removeSource(e,t,i){if(!this.workerSources[e]||!this.workerSources[e][t.type]||!this.workerSources[e][t.type][t.source])return;const n=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],void 0!==n.removeSource?n.removeSource(t,i):i()}loadWorkerSource(e,t,i){try{this.self.importScripts(t.url),i()}catch(e){i(e.toString())}}syncRTLPluginState(t,i,n){try{e.plugin.setState(i);const t=e.plugin.getPluginURL();if(e.plugin.isLoaded()&&!e.plugin.isParsed()&&null!=t){this.self.importScripts(t);const i=e.plugin.isParsed();n(i?void 0:new Error(`RTL Text Plugin failed to import scripts from ${t}`),i)}}catch(e){n(e.toString())}}getAvailableImages(e){let t=this.availableImages[e];return t||(t=[]),t}getLayerIndex(e){let t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new n),t}getWorkerSource(e,t,i){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),!this.workerSources[e][t][i]){const n={send:(t,i,n,r,o,a)=>{this.actor.send(t,i,n,e,o,a)},scheduler:this.actor.scheduler};this.workerSources[e][t][i]=new this.workerSourceTypes[t](n,this.getLayerIndex(e),this.getAvailableImages(e),this.isSpriteLoaded[e])}return this.workerSources[e][t][i]}getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new r),this.demWorkerSources[e][t]}enforceCacheSizeLimit(t,i){e.enforceCacheSizeLimit(i)}getWorkerPerformanceMetrics(e,t,i){i(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Se(self)),Se})),n(["./shared"],(function(e){function t(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let n=0;n<e.length;n++)if(!t(e[n],i[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(e).length!==Object.keys(i).length)return!1;for(const n in e)if(!t(e[n],i[n]))return!1;return!0}return e===i}var i=n;function n(e){return!function(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,i=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(i);try{t=new Worker(n),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(n),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var i=t.getImageData(0,0,1,1);return i&&i.width===e.width}()?(void 0===r[t=e&&e.failIfMajorPerformanceCaveat]&&(r[t]=function(e){var t,i=function(e){var t=document.createElement("canvas"),i=Object.create(n.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=e,t.getContext("webgl",i)||t.getContext("experimental-webgl",i)}(e);if(!i)return!1;try{t=i.createShader(i.VERTEX_SHADER)}catch(e){return!1}return!(!t||i.isContextLost())&&(i.shaderSource(t,"void main() {}"),i.compileShader(t),!0===i.getShaderParameter(t,i.COMPILE_STATUS))}(t)),r[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var t}(e)}var r={};function o(t,i,n){const r=e.window.document.createElement(t);return void 0!==i&&(r.className=i),n&&n.appendChild(r),r}function a(t,i,n){const r=e.window.document.createElementNS("http://www.w3.org/2000/svg",t);for(const e of Object.keys(i))r.setAttributeNS(null,e,i[e]);return n&&n.appendChild(r),r}n.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const s=e.window.document&&e.window.document.documentElement.style,l=s&&void 0!==s.userSelect?"userSelect":"WebkitUserSelect";let c;function u(){s&&l&&(c=s[l],s[l]="none")}function h(){s&&l&&(s[l]=c)}function d(t){t.preventDefault(),t.stopPropagation(),e.window.removeEventListener("click",d,!0)}function p(){e.window.addEventListener("click",d,!0),e.window.setTimeout((()=>{e.window.removeEventListener("click",d,!0)}),0)}function f(e,t){const i=e.getBoundingClientRect();return _(e,i,t)}function m(e,t){const i=e.getBoundingClientRect(),n=[];for(let r=0;r<t.length;r++)n.push(_(e,i,t[r]));return n}function g(t){return void 0!==e.window.InstallTrigger&&2===t.button&&t.ctrlKey&&e.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button}function _(t,i,n){const r=t.offsetWidth===i.width?1:t.offsetWidth/i.width;return new e.pointGeometry((n.clientX-i.left)*r,(n.clientY-i.top)*r)}function y(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=i*o-r*n;return a?(e[0]=o*(a=1/a),e[1]=-n*a,e[2]=-r*a,e[3]=i*a,e):null}function x(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class v extends e.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:e,callback:t}of this.requestors)this._notify(e,t);this.requestors=[]}}hasImage(e){return!!this.getImage(e)}getImage(e){return this.images[e]}addImage(e,t){this._validate(e,t)&&(this.images[e]=t)}_validate(t,i){let n=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),n=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),n=!1),this._validateContent(i.content,i)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),n=!1),n}_validateStretch(e,t){if(!e)return!0;let i=0;for(const n of e){if(n[0]<i||n[1]<n[0]||t<n[1])return!1;i=n[1]}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t){t.version=this.images[e].version+1,this.images[e]=t,this.updatedImages[e]=!0}removeImage(e){const t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,t){let i=!0;if(!this.isLoaded())for(const t of e)this.images[t]||(i=!1);this.isLoaded()||i?this._notify(e,t):this.requestors.push({ids:e,callback:t})}_notify(t,i){const n={};for(const i of t){this.images[i]||this.fire(new e.Event("styleimagemissing",{id:i}));const t=this.images[i];t?n[i]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.warnOnce(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}i(null,n)}getPixelSize(){const{width:e,height:t}=this.atlasImage;return{width:e,height:t}}getPattern(t){const i=this.patterns[t],n=this.getImage(t);if(!n)return null;if(i&&i.position.version===n.version)return i.position;if(i)i.position.version=n.version;else{const i={w:n.data.width+2,h:n.data.height+2,x:0,y:0},r=new e.ImagePosition(i,n);this.patterns[t]={bin:i,position:r}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const i=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new e.Texture(t,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const e in this.patterns)t.push(this.patterns[e].bin);const{w:i,h:n}=e.potpack(t),r=this.atlasImage;r.resize({width:i||1,height:n||1});for(const t in this.patterns){const{bin:i}=this.patterns[t],n=i.x+1,o=i.y+1,a=this.images[t].data,s=a.width,l=a.height;e.RGBAImage.copy(a,r,{x:0,y:0},{x:n,y:o},{width:s,height:l}),e.RGBAImage.copy(a,r,{x:0,y:l-1},{x:n,y:o-1},{width:s,height:1}),e.RGBAImage.copy(a,r,{x:0,y:0},{x:n,y:o+l},{width:s,height:1}),e.RGBAImage.copy(a,r,{x:s-1,y:0},{x:n-1,y:o},{width:1,height:l}),e.RGBAImage.copy(a,r,{x:0,y:0},{x:n+s,y:o},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const t of e){if(this.callbackDispatchedThisFrame[t])continue;this.callbackDispatchedThisFrame[t]=!0;const e=this.images[t];x(e)&&this.updateImage(t,e)}}}const b=new e.Properties({anchor:new e.DataConstantProperty(e.spec.light.anchor),position:new class{constructor(){this.specification=e.spec.light.position}possiblyEvaluate(t,i){return function([t,i,n]){const r=e.degToRad(i+90),o=e.degToRad(n);return{x:t*Math.cos(r)*Math.sin(o),y:t*Math.sin(r)*Math.sin(o),z:t*Math.cos(o),azimuthal:i,polar:n}}(t.expression.evaluate(i))}interpolate(t,i,n){return{x:e.number(t.x,i.x,n),y:e.number(t.y,i.y,n),z:e.number(t.z,i.z,n),azimuthal:e.number(t.azimuthal,i.azimuthal,n),polar:e.number(t.polar,i.polar,n)}}},color:new e.DataConstantProperty(e.spec.light.color),intensity:new e.DataConstantProperty(e.spec.light.intensity)}),w="-transition";class M extends e.Evented{constructor(t){super(),this._transitionable=new e.Transitionable(b),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,i={}){if(!this._validate(e.validateLight,t,i))for(const i in t){const n=t[i];e.endsWith(i,w)?this._transitionable.setTransition(i.slice(0,-w.length),n):this._transitionable.setValue(i,n)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,n){return(!n||!1!==n.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.spec})))}}const T=new e.Properties({source:new e.DataConstantProperty(e.spec.terrain.source),exaggeration:new e.DataConstantProperty(e.spec.terrain.exaggeration)}),S="-transition";class E extends e.Evented{constructor(t,i){super(),this._transitionable=new e.Transitionable(T),this.set(t),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(t){for(const i in t){const n=t[i];e.endsWith(i,S)?this._transitionable.setTransition(i.slice(0,-S.length),n):this._transitionable.setValue(i,n)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}}function C(t,i,n,r){const o=e.smoothstep(45,65,n),[a,s]=A(t,r),l=e.length(i);let c=1-Math.min(1,Math.exp((l-a)/(s-a)*-6));return c*=c*c,c=Math.min(1,1.00747*c),c*o*t.alpha}function A(e,t){const i=.5/Math.tan(.5*t);return[e.range[0]+i,e.range[1]+i]}const P=new e.Properties({range:new e.DataConstantProperty(e.spec.fog.range),color:new e.DataConstantProperty(e.spec.fog.color),"high-color":new e.DataConstantProperty(e.spec.fog["high-color"]),"space-color":new e.DataConstantProperty(e.spec.fog["space-color"]),"horizon-blend":new e.DataConstantProperty(e.spec.fog["horizon-blend"]),"star-intensity":new e.DataConstantProperty(e.spec.fog["star-intensity"])}),I="-transition";class k extends e.Evented{constructor(t,i){super(),this._transitionable=new e.Transitionable(P),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=i}get state(){const t=this._transform,i="globe"===t.projection.name,n=e.globeToMercatorTransition(t.zoom),r=this.properties.get("range"),o=[.5,3];return{range:i?[e.number(o[0],r[0],n),e.number(o[1],r[1],n)]:r,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,i={}){if(!this._validate(e.validateFog,t,i)){for(const i of Object.keys(e.spec.fog))t&&void 0===t[i]&&(t[i]=e.spec.fog[i].default);for(const i in t){const n=t[i];e.endsWith(i,I)?this._transitionable.setTransition(i.slice(0,-I.length),n):this._transitionable.setValue(i,n)}}}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:e.smoothstep(45,65,t))*i.a}getOpacityAtLatLng(t,i){return this._transform.projection.supportsFog?function(t,i,n){const r=e.MercatorCoordinate.fromLngLat(i),o=n.elevation?n.elevation.getAtPointOrZero(r):0,a=[r.x,r.y,o];return e.transformMat4(a,a,n.mercatorFogMatrix),C(t,a,n.pitch,n._fov)}(this.state,t,i):0}getFovAdjustedRange(e){return this._transform.projection.supportsFog?A(this.state,e):[0,1]}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,n){return(!n||!1!==n.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.spec})))}}class z{constructor(t,i){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=e.uniqueId();const n=this.workerPool.acquire(this.id);for(let e=0;e<n.length;e++){const t=new z.Actor(n[e],i,this.id);t.name=`Worker ${e}`,this.actors.push(t)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(t,i,n){e.asyncAll(this.actors,((e,n)=>{e.send(t,i,n)}),n=n||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}function D(t,i,n){return i*(e.EXTENT/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}z.Actor=e.Actor;class L{constructor(e,t,i,n){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,n)}static createFromScreenPoints(t,i){let n,r;if(t instanceof e.pointGeometry||"number"==typeof t[0]){const o=e.pointGeometry.convert(t);n=[o],r=i.isPointAboveHorizon(o)}else{const o=e.pointGeometry.convert(t[0]),a=e.pointGeometry.convert(t[1]);n=[o,a],r=e.polygonizeBounds(o,a).every((e=>i.isPointAboveHorizon(e)))}return new L(n,i.getCameraPoint(),r,i)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return e.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const i=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new e.pointGeometry(1,1)):this.screenBounds[1],r=e.polygonizeBounds(i,n,0,!1);return this.cameraPoint.y>n.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<n.x?r.splice(3,0,this.cameraPoint):this.cameraPoint.x>=n.x?r[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(r[3]=this.cameraPoint)),e.bufferConvexPolygon(r,t)}bufferedCameraGeometryGlobe(t){const i=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new e.pointGeometry(1,1)):this.screenBounds[1],r=e.polygonizeBounds(i,n,t),o=this.cameraPoint.clone();switch(3*((o.y>i.y)+(o.y>n.y))+((o.x>i.x)+(o.x>n.x))){case 0:r[0]=o,r[4]=o.clone();break;case 1:r.splice(1,0,o);break;case 2:r[1]=o;break;case 3:r.splice(4,0,o);break;case 5:r.splice(2,0,o);break;case 6:r[3]=o;break;case 7:r.splice(3,0,o);break;case 8:r[2]=o}return r}containsTile(t,i,n,r=0){const o=t.queryPadding/i._pixelsPerMercatorPixel+1,a=n?this._bufferedCameraMercator(o,i):this._bufferedScreenMercator(o,i);let s=t.tileID.wrap+(a.unwrapped?r:0);const l=a.polygon.map((i=>e.getTilePoint(t.tileTransform,i,s)));if(!e.polygonIntersectsBox(l,0,0,e.EXTENT,e.EXTENT))return;s=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?r:0);const c=this.screenGeometryMercator.polygon.map((i=>e.getTileVec3(t.tileTransform,i,s))),u=c.map((t=>new e.pointGeometry(t[0],t[1]))),h=i.getFreeCameraOptions().position||new e.MercatorCoordinate(0,0,0),d=e.getTileVec3(t.tileTransform,h,s),p=c.map((t=>{const i=e.sub(t,t,d);return e.normalize(i,i),new e.Ray(d,i)})),f=D(t,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:p,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(m=e.getBounds(l),m.min.x=e.clamp(m.min.x,0,e.EXTENT),m.min.y=e.clamp(m.min.y,0,e.EXTENT),m.max.x=e.clamp(m.max.x,0,e.EXTENT),m.max.y=e.clamp(m.max.y,0,e.EXTENT),m),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:f};var m}_bufferedScreenMercator(e,t){const i=B(e);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let n;return n="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._screenRaycastCache[i]=n,n}}_bufferedCameraMercator(e,t){const i=B(e);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let n;return n="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._cameraRaycastCache[i]=n,n}}_projectAndResample(t,i){const n=function(t,i){const n=e.multiply([],i.pixelMatrix,i.globeMatrix),r=[0,-e.GLOBE_RADIUS,0,1],o=[0,e.GLOBE_RADIUS,0,1],a=[0,0,0,1];e.transformMat4$1(r,r,n),e.transformMat4$1(o,o,n),e.transformMat4$1(a,a,n);const s=new e.pointGeometry(r[0]/r[3],r[1]/r[3]),l=new e.pointGeometry(o[0]/o[3],o[1]/o[3]),c=e.polygonContainsPoint(t,s)&&r[3]<a[3],u=e.polygonContainsPoint(t,l)&&o[3]<a[3];if(!c&&!u)return null;const h=function(e,t,i){for(let n=1;n<e.length;n++){const r=O(t.pointCoordinate3D(e[n-1]).x),o=O(t.pointCoordinate3D(e[n]).x);if(i<0){if(r<o)return{idx:n,t:-r/(o-1-r)}}else if(o<r)return{idx:n,t:(1-r)/(o+1-r)}}return null}(t,i,c?-1:1);if(!h)return null;const{idx:d,t:p}=h;let f=d>1?R(t.slice(0,d),i):[],m=d<t.length?R(t.slice(d),i):[];f=f.map((t=>new e.pointGeometry(O(t.x),t.y))),m=m.map((t=>new e.pointGeometry(O(t.x),t.y)));const g=[...f];0===g.length&&g.push(m[m.length-1]);const _=e.number(g[g.length-1].y,(0===m.length?f[0]:m[0]).y,p);let y;return y=c?[new e.pointGeometry(0,_),new e.pointGeometry(0,0),new e.pointGeometry(1,0),new e.pointGeometry(1,_)]:[new e.pointGeometry(1,_),new e.pointGeometry(1,1),new e.pointGeometry(0,1),new e.pointGeometry(0,_)],g.push(...y),0===m.length?g.push(f[0]):g.push(...m),{polygon:g.map((t=>new e.MercatorCoordinate(t.x,t.y))),unwrapped:!1}}(t,i);if(n)return n;const r=function(t,i){let n=!1,r=-1/0,o=0;for(let e=0;e<t.length-1;e++)t[e].x>r&&(r=t[e].x,o=e);for(let e=0;e<t.length-1;e++){const i=(o+e)%(t.length-1),r=t[i],a=t[i+1];Math.abs(r.x-a.x)>.5&&(r.x<a.x?(r.x+=1,0===i&&(t[t.length-1].x+=1)):(a.x+=1,i+1===t.length-1&&(t[0].x+=1)),n=!0)}const a=e.mercatorXfromLng(i.center.lng);return n&&a<Math.abs(a-1)&&t.forEach((e=>{e.x-=1})),{polygon:t,unwrapped:n}}(R(t,i).map((t=>new e.pointGeometry(O(t.x),t.y))),i);return{polygon:r.polygon.map((t=>new e.MercatorCoordinate(t.x,t.y))),unwrapped:r.unwrapped}}}function R(t,i){return e.resample(t,(e=>{const t=i.pointCoordinate3D(e);e.x=t.x,e.y=t.y}),1/256)}function O(e){return e<0?1+e%1:e%1}function B(e){return 100*e|0}function F(t,i,n,r,o){const a=function(n,r){if(n)return o(n);if(r){t.url&&r.tiles&&t.tiles&&delete t.tiles;const n=e.pick(e.extend(r,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);r.vector_layers&&(n.vectorLayers=r.vector_layers,n.vectorLayerIds=n.vectorLayers.map((e=>e.id))),n.tiles=i.canonicalizeTileset(n,t.url),o(null,n)}};return t.url?e.getJSON(i.transformRequest(i.normalizeSourceURL(t.url,null,n,r),e.ResourceType.Source),a):e.exported.frame((()=>a(null,t)))}class N{constructor(t,i,n){this.bounds=e.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=n||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(t){const i=Math.pow(2,t.z),n=Math.floor(e.mercatorXfromLng(this.bounds.getWest())*i),r=Math.floor(e.mercatorYfromLat(this.bounds.getNorth())*i),o=Math.ceil(e.mercatorXfromLng(this.bounds.getEast())*i),a=Math.ceil(e.mercatorYfromLat(this.bounds.getSouth())*i);return t.x>=n&&t.x<o&&t.y>=r&&t.y<a}}class U{constructor(e,t,i){this.context=e;const n=e.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const V={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class G{constructor(e,t,i,n){this.length=t.length,this.attributes=i,this.itemSize=t.bytesPerElement,this.dynamicDraw=n,this.context=e;const r=e.gl;this.buffer=r.createBuffer(),e.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let i=0;i<this.attributes.length;i++){const n=t.attributes[this.attributes[i].name];void 0!==n&&e.enableVertexAttribArray(n)}}setVertexAttribPointers(e,t,i){for(let n=0;n<this.attributes.length;n++){const r=this.attributes[n],o=t.attributes[r.name];void 0!==o&&e.vertexAttribPointer(o,r.components,e[V[r.type]],!1,this.itemSize,r.offset+this.itemSize*(i||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class j{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class W extends j{getDefault(){return e.Color.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class $ extends j{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class q extends j{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Z extends j{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class H extends j{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class X extends j{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Y extends j{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class J extends j{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class K extends j{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class Q extends j{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ee extends j{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class te extends j{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class ie extends j{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class ne extends j{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class re extends j{getDefault(){return e.Color.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class oe extends j{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ae extends j{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class se extends j{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class le extends j{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ce extends j{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class ue extends j{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class he extends j{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class de extends j{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class pe extends j{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class fe extends j{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class me extends j{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ge extends j{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class _e extends j{constructor(e){super(e),this.vao=e.extVertexArrayObject}getDefault(){return null}set(e){this.vao&&(e!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(e),this.current=e,this.dirty=!1)}}class ye extends j{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class xe extends j{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class ve extends j{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class be extends j{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class we extends be{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Me extends be{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Te extends Me{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Se{constructor(e,t,i,n){this.context=e,this.width=t,this.height=i;const r=this.framebuffer=e.gl.createFramebuffer();this.colorAttachment=new we(e,r),n&&(this.depthAttachment=new Me(e,r))}destroy(){const e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}e.deleteFramebuffer(this.framebuffer)}}class Ee{constructor(e,t=!1){if(this.gl=e,this.isWebGL2=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),t){const t=e;this.extVertexArrayObject={createVertexArrayOES:t.createVertexArray.bind(e),deleteVertexArrayOES:t.deleteVertexArray.bind(e),bindVertexArrayOES:t.bindVertexArray.bind(e)}}this.clearColor=new W(this),this.clearDepth=new $(this),this.clearStencil=new q(this),this.colorMask=new Z(this),this.depthMask=new H(this),this.stencilMask=new X(this),this.stencilFunc=new Y(this),this.stencilOp=new J(this),this.stencilTest=new K(this),this.depthRange=new Q(this),this.depthTest=new ee(this),this.depthFunc=new te(this),this.blend=new ie(this),this.blendFunc=new ne(this),this.blendColor=new re(this),this.blendEquation=new oe(this),this.cullFace=new ae(this),this.cullFaceSide=new se(this),this.frontFace=new le(this),this.program=new ce(this),this.activeTexture=new ue(this),this.viewport=new he(this),this.bindFramebuffer=new de(this),this.bindRenderbuffer=new pe(this),this.bindTexture=new fe(this),this.bindVertexBuffer=new me(this),this.bindElementBuffer=new ge(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new _e(this),this.pixelStoreUnpack=new ye(this),this.pixelStoreUnpackPremultiplyAlpha=new xe(this),this.pixelStoreUnpackFlipY=new ve(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),t||(this.extTextureHalfFloat=e.getExtension("OES_texture_half_float")),(t||this.extTextureHalfFloat&&e.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=t||e.getExtension("OES_standard_derivatives"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t){return new U(this,e,t)}createVertexBuffer(e,t,i){return new G(this,e,t,i)}createRenderbuffer(e,t,i){const n=this.gl,r=n.createRenderbuffer();return this.bindRenderbuffer.set(r),n.renderbufferStorage(n.RENDERBUFFER,e,t,i),this.bindRenderbuffer.set(null),r}createFramebuffer(e,t,i){return new Se(this,e,t,i)}clear({color:e,depth:t,stencil:i}){const n=this.gl;let r=0;e&&(r|=n.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==t&&(r|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==i&&(r|=n.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),n.clear(r)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(i){t(i.blendFunction,e.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Ce extends e.Evented{constructor(t,i,n,r){if(super(),this.id=t,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.extend(this,e.pick(i,["url","scheme","tileSize","promoteId"])),this._options=e.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r),this._tileWorkers={},this._deduped=new e.DedupedRequest}load(t){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=F(this._options,this.map._requestManager,i,n,((r,o)=>{this._tileJSONRequest=null,this._loaded=!0,r?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),n&&2!==n.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new e.ErrorEvent(r))):o&&(e.extend(this,o),o.bounds&&(this.tileBounds=new N(o.bounds,this.minzoom,this.maxzoom)),e.postTurnstileEvent(o.tiles,this.map._requestManager._customAccessToken),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return e.extend({},this._options)}loadTile(t,i){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(n,e.ResourceType.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile};if(r.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=i:t.request=t.actor.send("reloadTile",r,o.bind(this));else if(t.actor=this._tileWorkers[n]=this._tileWorkers[n]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",r,o.bind(this),void 0,!0);else{const i=e.loadVectorTile.call({deduped:this._deduped},r,((e,i)=>{e||!i?o.call(this,e):(r.data={cacheControl:i.cacheControl,expires:i.expires,rawData:i.rawData.slice(0)},t.actor&&t.actor.send("loadTile",r,o.bind(this),void 0,!0))}),!0);t.request={cancel:i}}function o(n,r){return delete t.request,t.aborted?i(null):n&&404!==n.status?i(n):(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),e.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id})}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ae extends e.Evented{constructor(t,i,n,r){super(),this.id=t,this.dispatcher=n,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.extend({type:"raster"},i),e.extend(this,e.pick(i,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=F(this._options,this.map._requestManager,null,null,((i,n)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new e.ErrorEvent(i)):n&&(e.extend(this,n),n.bounds&&(this.tileBounds=new N(n.bounds,this.minzoom,this.maxzoom)),e.postTurnstileEvent(n.tiles),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return e.extend({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,i){const n=e.exported.devicePixelRatio>=2,r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),n,this.tileSize);t.request=e.getImage(this.map._requestManager.transformRequest(r,e.ResourceType.Tile),((n,r,o,a)=>(delete t.request,t.aborted?(t.state="unloaded",i(null)):n?(t.state="errored",i(n)):r?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:o,expires:a}),t.setTexture(r,this.map.painter),t.state="loaded",e.cacheEntryPossiblyAdded(this.dispatcher),void i(null)):i(null))))}static loadTileData(e,t,i){e.setTexture(t,i)}static unloadTileData(e,t){e.texture&&t.saveTileTexture(e.texture)}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let Pe;function Ie(t,i,n,r,o,a,s,l){const c=[t,n,o,i,r,a,1,1,1],u=[s,l,1],h=e.adjoint([],c),[d,p,f]=e.transformMat3(u,u,e.transpose(h,h));return e.multiply$1(c,[d,0,0,0,p,0,0,0,f],c)}class ke extends e.Evented{constructor(e,t,i,n){super(),this.id=e,this.dispatcher=i,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(n),this.options=t,this._dirty=!1}load(t,i){this._loaded=i||!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=e.getImage(this.map._requestManager.transformRequest(this.url,e.ResourceType.Image),((i,n)=>{if(this._imageRequest=null,this._loaded=!0,i)this.fire(new e.ErrorEvent(i));else if(n){const{HTMLImageElement:i}=e.window;this.image=n instanceof i?e.exported.getImageData(n):n,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}}))}loaded(){return this._loaded}updateImage(e){return this.image&&e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(t){this.coordinates=t,this._boundsArray=void 0;const i=t.map(e.MercatorCoordinate.fromLngLat);return this.tileID=function(t){let i=1/0,n=1/0,r=-1/0,o=-1/0;for(const e of t)i=Math.min(i,e.x),n=Math.min(n,e.y),r=Math.max(r,e.x),o=Math.max(o,e.y);const a=Math.max(r-i,o-n),s=Math.max(0,Math.floor(-Math.log(a)/Math.LN2)),l=Math.pow(2,s);return new e.CanonicalTileID(s,Math.floor((i+r)/2*l),Math.floor((n+o)/2*l))}(i),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}if(this._boundsArray)return;const i=e.tileTransform(this.tileID,this.map.transform.projection),[n,r,o,a]=this.coordinates.map((t=>{const n=i.projection.project(t[0],t[1]);return e.getTilePoint(i,n)._round()}));this.perspectiveTransform=function(t,i,n,r,o,a,s,l,c,u){const h=Ie(0,0,t,0,0,i,t,i),d=Ie(n,r,o,a,s,l,c,u);return e.multiply$1(d,e.adjoint(h,h),d),[d[6]/d[8]*t/e.EXTENT,d[7]/d[8]*i/e.EXTENT]}(this.width,this.height,n.x,n.y,r.x,r.y,a.x,a.y,o.x,o.y);const s=this._boundsArray=new e.StructArrayLayout4i8;s.emplaceBack(n.x,n.y,0,0),s.emplaceBack(r.x,r.y,e.EXTENT,0),s.emplaceBack(a.x,a.y,0,e.EXTENT),s.emplaceBack(o.x,o.y,e.EXTENT,e.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(s,e.boundsAttributes.members),this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context,i=t.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new e.Texture(t,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ze={vector:Ce,raster:Ae,"raster-dem":class extends Ae{constructor(t,i,n,r){super(t,i,n,r),this.type="raster-dem",this.maxzoom=22,this._options=e.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(t,i){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(e,n){e&&(t.state="errored",i(e)),n&&(t.dem=n,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",i(null))}t.request=e.getImage(this.map._requestManager.transformRequest(n,e.ResourceType.Tile),function(n,o,a,s){if(delete t.request,t.aborted)t.state="unloaded",i(null);else if(n)t.state="errored",i(n);else if(o){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:a,expires:s});const i=e.window.ImageBitmap&&o instanceof e.window.ImageBitmap&&(null==Pe&&(Pe=e.window.OffscreenCanvas&&new e.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof e.window.createImageBitmap),Pe),n=1-(o.width-e.prevPowerOfTwo(o.width))/2;n<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const l=i?o:e.exported.getImageData(o,n),c={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:l,encoding:this.encoding,padding:n};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",c,r.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(t){const i=t.canonical,n=Math.pow(2,i.z),r=(i.x-1+n)%n,o=0===i.x?t.wrap-1:t.wrap,a=(i.x+1+n)%n,s=i.x+1===n?t.wrap+1:t.wrap,l={};return l[new e.OverscaledTileID(t.overscaledZ,o,i.z,r,i.y).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,i.z,a,i.y).key]={backfilled:!1},i.y>0&&(l[new e.OverscaledTileID(t.overscaledZ,o,i.z,r,i.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,i.z,a,i.y-1).key]={backfilled:!1}),i.y+1<n&&(l[new e.OverscaledTileID(t.overscaledZ,o,i.z,r,i.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,i.z,a,i.y+1).key]={backfilled:!1}),l}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded"}},geojson:class extends e.Evented{constructor(t,i,n,r){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(r),this._data=i.data,this._options=e.extend({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const o=e.EXTENT/this.tileSize;this.workerOptions=e.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*o,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*o,extent:e.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:e.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*o,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},t),this}getClusterLeaves(e,t,i,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:t,offset:i},n),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.Event("dataloading",{dataType:"source"})),this._loaded=!1;const t=e.extend({},this.workerOptions),i=this._data;"string"==typeof i?(t.request=this.map._requestManager.transformRequest(e.exported.resolveURL(i),e.ResourceType.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((t,i)=>{if(this._loaded=!0,this._pendingLoad=null,t)this.fire(new e.ErrorEvent(t));else{const t={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&i&&i.resourceTiming&&i.resourceTiming[this.id]&&(t.resourceTiming=i.resourceTiming[this.id]),this.fire(new e.Event("data",t)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(t,i){const n=t.actor?"reloadTile":"loadTile";t.actor=this.actor,t.request=this.actor.send(n,{type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},((e,r)=>(delete t.request,t.unloadVectorData(),t.aborted?i(null):e?i(e):(t.loadVectorData(r,this.map.painter,"reloadTile"===n),i(null)))),void 0,"loadTile"===n)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return e.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ke{constructor(e,t,i,n){super(e,t,i,n),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const i of t.urls)this.urls.push(this.map._requestManager.transformRequest(i,e.ResourceType.Source).url);e.getVideo(this.urls,((t,i)=>{this._loaded=!0,t?this.fire(new e.ErrorEvent(t)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const i=this.video.seekable;t<i.start(0)||t>i.end(0)?this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,i=t.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new e.Texture(t,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ke,canvas:class extends ke{constructor(t,i,n,r){super(t,i,n,r),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof e.window.HTMLCanvasElement||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof e.window.HTMLCanvasElement?this.options.canvas:e.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends e.Evented{constructor(t,i,n,r){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=i,this.setEventedParent(r),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new e.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new e.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new N(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),e.extend(this,e.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return e.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this._map=t,this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:i,z:n}=e.canonical;return this._implementation.hasTile({x:t,y:i,z:n})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,i){const{x:n,y:r,z:o}=t.tileID.canonical,a=new e.window.AbortController;t.request=Promise.resolve(this._implementation.loadTile({x:n,y:r,z:o},{signal:a.signal})).then(function(n){return delete t.request,t.aborted?(t.state="unloaded",i(null)):void 0===n?(t.state="errored",i(null)):null===n?(this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",i(null)):function(t){return t instanceof e.window.ImageData||t instanceof e.window.HTMLCanvasElement||t instanceof e.window.ImageBitmap||t instanceof e.window.HTMLImageElement}(n)?(this.loadTileData(t,n),t.state="loaded",void i(null)):(t.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch((e=>{20!==e.code&&(t.state="errored",i(e))})),t.request.cancel=()=>a.abort()}loadTileData(e,t){Ae.loadTileData(e,t,this._map.painter)}unloadTileData(e){Ae.unloadTileData(e,this._map.painter)}unloadTile(e,t){if(this.unloadTileData(e),this._implementation.unloadTile){const{x:t,y:i,z:n}=e.tileID.canonical;this._implementation.unloadTile({x:t,y:i,z:n})}t()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z})))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))}}},De=function(t,i,n,r){const o=new ze[i.type](t,i,n,r);if(o.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${o.id}`);return e.bindAll(["load","abort","unload","serialize","prepare"],o),o};function Le(t,i){const n=e.identity([]);return e.scale(n,n,[.5*t.width,.5*-t.height,1]),e.translate(n,n,[1,-1,0]),e.multiply(n,n,t.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(n)}function Re(e,t,i,n,r,o,a,s=!1){const l=e.tilesIn(n,a,s);l.sort(Be);const c=[];for(const n of l)c.push({wrappedTileID:n.tile.tileID.wrapped().key,queryResults:n.tile.queryRenderedFeatures(t,i,e._state,n,r,o,Le(e.transform,n.tile.tileID),s)});const u=function(e){const t={},i={};for(const n of e){const e=n.queryResults,r=n.wrappedTileID,o=i[r]=i[r]||{};for(const i in e){const n=e[i],r=o[i]=o[i]||{},a=t[i]=t[i]||[];for(const e of n)r[e.featureIndex]||(r[e.featureIndex]=!0,a.push(e))}}return t}(c);for(const t in u)u[t].forEach((t=>{const i=t.feature,n=i.layer;n&&"background"!==n.type&&"sky"!==n.type&&(i.source=n.source,n["source-layer"]&&(i.sourceLayer=n["source-layer"]),i.state=void 0!==i.id?e.getFeatureState(n["source-layer"],i.id):{})}));return u}function Oe(e,t){const i=e.getRenderableIds().map((t=>e.getTileByID(t))),n=[],r={};for(let e=0;e<i.length;e++){const o=i[e],a=o.tileID.canonical.key;r[a]||(r[a]=!0,o.querySourceFeatures(n,t))}return n}function Be(e,t){const i=e.tileID,n=t.tileID;return i.overscaledZ-n.overscaledZ||i.canonical.y-n.canonical.y||i.wrap-n.wrap||i.canonical.x-n.canonical.x}function Fe(){return null!=go.workerClass?new go.workerClass:new e.window.Worker(go.workerUrl)}const Ne="mapboxgl_preloaded_worker_pool";class Ue{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Ue.workerCount;)this.workers.push(new Fe);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Ne]}numActive(){return Object.keys(this.active).length}}let Ve;function Ge(){return Ve||(Ve=new Ue),Ve}function je(t,i){const n={};for(const e in t)"ref"!==e&&(n[e]=t[e]);return e.refProperties.forEach((e=>{e in i&&(n[e]=i[e])})),n}function We(e){e=e.slice();const t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i].id]=e[i];for(let i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=je(e[i],t[e[i].ref]));return e}Ue.workerCount=2;const $e={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function qe(e,t,i){i.push({command:$e.addSource,args:[e,t[e]]})}function Ze(e,t,i){t.push({command:$e.removeSource,args:[e]}),i[e]=!0}function He(e,t,i,n){Ze(e,i,n),qe(e,t,i)}function Xe(e,i,n){let r;for(r in e[n])if(e[n].hasOwnProperty(r)&&"data"!==r&&!t(e[n][r],i[n][r]))return!1;for(r in i[n])if(i[n].hasOwnProperty(r)&&"data"!==r&&!t(e[n][r],i[n][r]))return!1;return!0}function Ye(e,i,n,r,o,a){let s;for(s in i=i||{},e=e||{})e.hasOwnProperty(s)&&(t(e[s],i[s])||n.push({command:a,args:[r,s,i[s],o]}));for(s in i)i.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t(e[s],i[s])||n.push({command:a,args:[r,s,i[s],o]}))}function Je(e){return e.id}function Ke(e,t){return e[t.id]=t,e}class Qe{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.clamp(t,0,1);let i=1,n=this._distances[i];const r=t*this.paddedLength+this.padding;for(;n<r&&i<this._distances.length;)n=this._distances[++i];const o=i-1,a=this._distances[o],s=n-a,l=s>0?(r-a)/s:0;return this.points[o].mult(1-l).add(this.points[i].mult(l))}}class et{constructor(e,t,i){const n=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(let e=0;e<this.xCellCount*this.yCellCount;e++)n.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,i,n,r){this._forEachCell(t,i,n,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)}insertCircle(e,t,i,n){this._forEachCell(t-n,i-n,t+n,i+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(n)}_insertBoxCell(e,t,i,n,r,o){this.boxCells[r].push(o)}_insertCircleCell(e,t,i,n,r,o){this.circleCells[r].push(o)}_query(e,t,i,n,r,o){if(i<0||e>this.width||n<0||t>this.height)return!r&&[];const a=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=n){if(r)return!0;for(let e=0;e<this.boxKeys.length;e++)a.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],i=this.circles[3*e+1],n=this.circles[3*e+2];a.push({key:this.circleKeys[e],x1:t-n,y1:i-n,x2:t+n,y2:i+n})}return o?a.filter(o):a}return this._forEachCell(e,t,i,n,this._queryCell,a,{hitTest:r,seenUids:{box:{},circle:{}}},o),r?a.length>0:a}_queryCircle(e,t,i,n,r){const o=e-i,a=e+i,s=t-i,l=t+i;if(a<0||o>this.width||l<0||s>this.height)return!n&&[];const c=[];return this._forEachCell(o,s,a,l,this._queryCellCircle,c,{hitTest:n,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}},r),n?c.length>0:c}query(e,t,i,n,r){return this._query(e,t,i,n,!1,r)}hitTest(e,t,i,n,r){return this._query(e,t,i,n,!0,r)}hitTestCircle(e,t,i,n){return this._queryCircle(e,t,i,!0,n)}_queryCell(e,t,i,n,r,o,a,s){const l=a.seenUids,c=this.boxCells[r];if(null!==c){const r=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(e<=r[c+2]&&t<=r[c+3]&&i>=r[c+0]&&n>=r[c+1]&&(!s||s(this.boxKeys[u]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:r[c],y1:r[c+1],x2:r[c+2],y2:r[c+3]})}}}const u=this.circleCells[r];if(null!==u){const r=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(r[u],r[u+1],r[u+2],e,t,i,n)&&(!s||s(this.circleKeys[c]))){if(a.hitTest)return o.push(!0),!0;{const e=r[u],t=r[u+1],i=r[u+2];o.push({key:this.circleKeys[c],x1:e-i,y1:t-i,x2:e+i,y2:t+i})}}}}}_queryCellCircle(e,t,i,n,r,o,a,s){const l=a.circle,c=a.seenUids,u=this.boxCells[r];if(null!==u){const e=this.bboxes;for(const t of u)if(!c.box[t]){c.box[t]=!0;const i=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[i+0],e[i+1],e[i+2],e[i+3])&&(!s||s(this.boxKeys[t])))return o.push(!0),!0}}const h=this.circleCells[r];if(null!==h){const e=this.circles;for(const t of h)if(!c.circle[t]){c.circle[t]=!0;const i=3*t;if(this._circlesCollide(e[i],e[i+1],e[i+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[t])))return o.push(!0),!0}}}_forEachCell(e,t,i,n,r,o,a,s){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(n);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(r.call(this,e,t,i,n,this.xCellCount*l+d,o,a,s))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,i,n,r,o){const a=n-e,s=r-t,l=i+o;return l*l>a*a+s*s}_circleAndRectCollide(e,t,i,n,r,o,a){const s=(o-n)/2,l=Math.abs(e-(n+s));if(l>s+i)return!1;const c=(a-r)/2,u=Math.abs(t-(r+c));if(u>c+i)return!1;if(l<=s||u<=c)return!0;const h=l-s,d=u-c;return h*h+d*d<=i*i}}const tt=Math.tan(85*Math.PI/180);function it(t,i,n,r,o,a,s){const l=e.create();if(n)if("globe"===a.name){const t=e.calculateGlobeLabelMatrix(o,i);e.multiply(l,l,t)}else{const t=y([],s);l[0]=t[0],l[1]=t[1],l[4]=t[2],l[5]=t[3],r||e.rotateZ(l,l,o.angle)}else e.multiply(l,o.labelPlaneMatrix,t);return l}function nt(e,t,i,n,r,o,a){const s=it(e,t,i,n,r,o,a);return"globe"===o.name&&i||(s[2]=s[6]=s[10]=s[14]=0),s}function rt(t,i,n,r,o,a,s){if(n){if("globe"===a.name){const l=it(t,i,n,r,o,a,s);return e.invert(l,l),e.multiply(l,t,l),l}{const i=e.clone(t),n=e.identity([]);return n[0]=s[0],n[1]=s[1],n[4]=s[2],n[5]=s[3],e.multiply(i,i,n),r||e.rotateZ(i,i,-o.angle),i}}return o.glCoordMatrix}function ot(t,i,n,r){const o=[t,i,n,1];n?e.transformMat4$1(o,o,r):gt(o,o,r);const a=o[3];return o[0]/=a,o[1]/=a,o[2]/=a,o}function at(e,t){return Math.min(.5+e/t*.5,1.5)}function st(e,t){const i=e[0]/e[3],n=e[1]/e[3];return i>=-t[0]&&i<=t[0]&&n>=-t[1]&&n<=t[1]}function lt(t,i,n,r,o,a,s,l,c,u){const h=n.transform,d=r?t.textSizeData:t.iconSizeData,p=e.evaluateSizeForZoom(d,n.transform.zoom),f="globe"===h.projection.name,m=[256/n.width*2+1,256/n.height*2+1],g=r?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;g.clear();let _=null;f&&(_=r?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const y=t.lineVertexArray,x=r?t.text.placedSymbolArray:t.icon.placedSymbolArray,v=n.transform.width/n.transform.height;let b,w=!1;for(let r=0;r<x.length;r++){const f=x.get(r),{numGlyphs:M,writingMode:T}=f;if(T!==e.WritingMode.vertical||w||b===e.WritingMode.horizontal||(w=!0),b=T,(f.hidden||T===e.WritingMode.vertical)&&!w){mt(M,g);continue}w=!1;const S=new e.pointGeometry(f.tileAnchorX,f.tileAnchorY);let{x:E,y:C,z:A}=h.projection.projectTilePoint(S.x,S.y,u.canonical);if(c){const[e,t,i]=c(S);E+=e,C+=t,A+=i}const P=[E,C,A,1];if(e.transformMat4$1(P,P,i),!st(P,m)){mt(M,g);continue}const I=at(n.transform.cameraToCenterDistance,P[3]),k=e.evaluateSizeForFeature(d,p,f),z=s?k/I:k*I,D=ot(E,C,A,o);if(D[3]<=0){mt(M,g);continue}let L={};const R=s?null:c,O=ht(f,z,!1,l,i,o,a,t.glyphOffsetArray,y,g,_,D,S,L,v,R,h.projection,u,s);w=O.useVertical,R&&O.needsFlipping&&(L={}),(O.notEnoughRoom||w||O.needsFlipping&&ht(f,z,!0,l,i,o,a,t.glyphOffsetArray,y,g,_,D,S,L,v,R,h.projection,u,s).notEnoughRoom)&&mt(M,g)}r?(t.text.dynamicLayoutVertexBuffer.updateData(g),_&&t.text.globeExtVertexBuffer.updateData(_)):(t.icon.dynamicLayoutVertexBuffer.updateData(g),_&&t.icon.globeExtVertexBuffer.updateData(_))}function ct(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m){const{lineStartIndex:g,glyphStartIndex:_,segment:y}=s,x=_+s.numGlyphs,v=g+s.lineLength,b=t.getoffsetX(_),w=t.getoffsetX(x-1),M=ft(e*b,i,n,r,o,a,y,g,v,l,c,u,h,d,!0,p,f,m);if(!M)return null;const T=ft(e*w,i,n,r,o,a,y,g,v,l,c,u,h,d,!0,p,f,m);return T?{first:M,last:T}:null}function ut(t,i,n,r){return t===e.WritingMode.horizontal&&Math.abs(r)>Math.abs(n)?{useVertical:!0}:t===e.WritingMode.vertical?r>0?{needsFlipping:!0}:null:0!==i&&function(e,t){return 0===e||Math.abs(t/e)>tt}(n,r)?1===i?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function ht(t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,g,_,y,x){const v=i/24,b=t.lineOffsetX*v,w=t.lineOffsetY*v,{lineStartIndex:M,glyphStartIndex:T,numGlyphs:S,segment:E,writingMode:C,flipState:A}=t,P=M+t.lineLength,I=t=>{if(h){const[i,n,r]=t.up,o=u.length;e.updateGlobeVertexNormal(h,o+0,i,n,r),e.updateGlobeVertexNormal(h,o+1,i,n,r),e.updateGlobeVertexNormal(h,o+2,i,n,r),e.updateGlobeVertexNormal(h,o+3,i,n,r)}const[i,n,r]=t.point;e.addDynamicAttributes(u,i,n,r,t.angle)};if(S>1){const e=ct(v,l,b,w,n,d,p,t,c,a,f,g,!1,_,y,x);if(!e)return{notEnoughRoom:!0};if(r&&!n){let[i,n,r]=e.first.point,[o,a,l]=e.last.point;[i,n]=ot(i,n,r,s),[o,a]=ot(o,a,l,s);const c=ut(C,A,(o-i)*m,a-n);if(t.flipState=c&&c.needsFlipping?1:2,c)return c}I(e.first);for(let e=T+1;e<T+S-1;e++){const t=ft(v*l.getoffsetX(e),b,w,n,d,p,E,M,P,c,a,f,g,!1,!1,_,y,x);if(!t)return u.length-=4*(e-T),{notEnoughRoom:!0};I(t)}I(e.last)}else{if(r&&!n){const i=ot(p.x,p.y,0,o),n=M+E+1,r=new e.pointGeometry(c.getx(n),c.gety(n)),a=ot(r.x,r.y,0,o),s=a[3]>0?a:pt(p,r,i,1,o,void 0,_,y.canonical),l=ut(C,A,(s[0]-i[0])*m,s[1]-i[1]);if(t.flipState=l&&l.needsFlipping?1:2,l)return l}const i=ft(v*l.getoffsetX(T),b,w,n,d,p,E,M,P,c,a,f,g,!1,!1,_,y,x);if(!i)return{notEnoughRoom:!0};I(i)}return{}}function dt(e,t,i,n,r){const{x:o,y:a,z:s}=n.projectTilePoint(e.x,e.y,t);if(!r)return ot(o,a,s,i);const[l,c,u]=r(e);return ot(o+l,a+c,s+u,i)}function pt(t,i,n,r,o,a,s,l){const c=dt(t.sub(i)._unit()._add(t),l,o,s,a);return e.sub(c,n,c),e.normalize(c,c),e.scaleAndAdd(c,n,c,r)}function ft(t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,g,_,y){const x=r?t-i:t+i;let v=x>0?1:-1,b=0;r&&(v*=-1,b=Math.PI),v<0&&(b+=Math.PI);let w=l+s+(v>0?0:1)|0,M=o,T=o,S=0,E=0;const C=Math.abs(x),A=[],P=[];let I=a,k=I;const z=()=>pt(k,I,T,C-S+1,h,p,g,_.canonical);for(;S+E<=C;){if(w+=v,w<l||w>=c)return null;if(T=M,k=I,A.push(T),f&&P.push(k),I=new e.pointGeometry(u.getx(w),u.gety(w)),M=d[w],!M){const e=dt(I,_.canonical,h,g,p);M=e[3]>0?d[w]=e:z()}S+=E,E=e.distance(T,M)}m&&p&&(d[w]&&(M=z(),E=e.distance(T,M)),d[w]=M);const D=(C-S)/E,L=I.sub(k)._mult(D)._add(k),R=e.sub([],M,T),O=e.scaleAndAdd([],T,R,D);let B=[0,0,1],F=R[0],N=R[1];if(y&&(B=g.upVector(_.canonical,L.x,L.y),0!==B[0]||0!==B[1]||1!==B[2])){const t=[B[2],0,-B[0]],i=e.cross([],B,t);e.normalize(t,t),e.normalize(i,i),F=e.dot(R,t),N=e.dot(R,i)}if(n){const t=e.cross([],B,R);e.normalize(t,t),e.scaleAndAdd(O,O,t,n*v)}const U=b+Math.atan2(N,F);return A.push(O),f&&P.push(L),{point:O,angle:U,path:A,tilePath:P,up:B}}function mt(e,t){const i=t.length,n=i+4*e;t.resize(n),t.float32.fill(-1/0,4*i,4*n)}function gt(e,t,i){const n=t[0],r=t[1];return e[0]=i[0]*n+i[4]*r+i[12],e[1]=i[1]*n+i[5]*r+i[13],e[3]=i[3]*n+i[7]*r+i[15],e}const _t=100;class yt{constructor(e,t,i=new et(e.width+200,e.height+200,25),n=new et(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=n,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+_t,this.screenBottomBoundary=e.height+_t,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,i,n,r,o,a,s){let l=i.projectedAnchorX,c=i.projectedAnchorY,u=i.projectedAnchorZ;const h=i.elevation,d=i.tileID,p=e.getProjection();if(h&&d){const[e,t,n]=p.upVector(d.canonical,i.tileAnchorX,i.tileAnchorY),r=p.upVectorScale(d.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=e*h*r,c+=t*h*r,u+=n*h*r}const f=this.projectAndGetPerspectiveRatio(a,l,c,u,i.tileID,"globe"===p.name||!!h||this.transform.pitch>0,p),m=o*f.perspectiveRatio,g=(i.x1*t+n.x-i.padding)*m+f.point.x,_=(i.y1*t+n.y-i.padding)*m+f.point.y,y=(i.x2*t+n.x+i.padding)*m+f.point.x,x=(i.y2*t+n.y+i.padding)*m+f.point.y,v=f.perspectiveRatio<=.55||f.occluded;return!this.isInsideGrid(g,_,y,x)||!r&&this.grid.hitTest(g,_,y,x,s)||v?{box:[],offscreen:!1,occluded:f.occluded}:{box:[g,_,y,x],offscreen:this.isOffscreen(g,_,y,x),occluded:!1}}placeCollisionCircles(t,i,n,r,o,a,s,l,c,u,h,d,p,f,m){const g=[],_=this.transform.elevation,y=t.getProjection(),x=_?_.getAtTileOffsetFunc(m,this.transform.center.lat,this.transform.worldSize,y):null,v=new e.pointGeometry(n.tileAnchorX,n.tileAnchorY);let{x:b,y:w,z:M}=y.projectTilePoint(v.x,v.y,m.canonical);if(x){const[e,t,i]=x(v);b+=e,w+=t,M+=i}const T="globe"===y.name,S=this.projectAndGetPerspectiveRatio(s,b,w,M,m,T||!!_||this.transform.pitch>0,y),{perspectiveRatio:E}=S,C=(h?a/E:a*E)/e.ONE_EM,A=ot(b,w,M,l),P=S.signedDistanceFromCamera>0?ct(C,o,n.lineOffsetX*C,n.lineOffsetY*C,!1,A,v,n,r,l,{},_&&!h?x:null,h&&!!_,y,m,h):null;let I=!1,k=!1,z=!0;if(P&&!S.occluded){const t=.5*p*E+f,n=new e.pointGeometry(-100,-100),r=new e.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),o=new Qe,{first:a,last:s}=P,l=a.path.length;let h=[];for(let e=l-1;e>=1;e--)h.push(a.path[e]);for(let e=1;e<s.path.length;e++)h.push(s.path[e]);const m=2.5*t;c&&(h=h.map((([e,t,i],n)=>(x&&!T&&(i=x(n<l-1?a.tilePath[l-1-n]:s.tilePath[n-l+2])[2]),ot(e,t,i,c)))),h.some((e=>e[3]<=0))&&(h=[]));let _=[];if(h.length>0){let t=1/0,i=-1/0,o=1/0,a=-1/0;for(const e of h)t=Math.min(t,e[0]),o=Math.min(o,e[1]),i=Math.max(i,e[0]),a=Math.max(a,e[1]);i>=n.x&&t<=r.x&&a>=n.y&&o<=r.y&&(_=[h.map((t=>new e.pointGeometry(t[0],t[1])))],(t<n.x||i>r.x||o<n.y||a>r.y)&&(_=e.clipLine(_,n.x,n.y,r.x,r.y)))}for(const e of _){o.reset(e,.25*t);let n=0;n=o.length<=.5*t?1:Math.ceil(o.paddedLength/m)+1;for(let e=0;e<n;e++){const r=e/Math.max(n-1,1),a=o.lerp(r),s=a.x+_t,l=a.y+_t;g.push(s,l,t,0);const c=s-t,h=l-t,p=s+t,f=l+t;if(z=z&&this.isOffscreen(c,h,p,f),k=k||this.isInsideGrid(c,h,p,f),!i&&this.grid.hitTestCircle(s,l,t,d)&&(I=!0,!u))return{circles:[],offscreen:!1,collisionDetected:I,occluded:!1}}}}return{circles:!u&&I||!k?[]:g,offscreen:z,collisionDetected:I,occluded:S.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let n=1/0,r=1/0,o=-1/0,a=-1/0;for(const s of t){const t=new e.pointGeometry(s.x+_t,s.y+_t);n=Math.min(n,t.x),r=Math.min(r,t.y),o=Math.max(o,t.x),a=Math.max(a,t.y),i.push(t)}const s=this.grid.query(n,r,o,a).concat(this.ignoredGrid.query(n,r,o,a)),l={},c={};for(const t of s){const n=t.key;if(void 0===l[n.bucketInstanceId]&&(l[n.bucketInstanceId]={}),l[n.bucketInstanceId][n.featureIndex])continue;const r=[new e.pointGeometry(t.x1,t.y1),new e.pointGeometry(t.x2,t.y1),new e.pointGeometry(t.x2,t.y2),new e.pointGeometry(t.x1,t.y2)];e.polygonIntersectsPolygon(i,r)&&(l[n.bucketInstanceId][n.featureIndex]=!0,void 0===c[n.bucketInstanceId]&&(c[n.bucketInstanceId]=[]),c[n.bucketInstanceId].push(n.featureIndex))}return c}insertCollisionBox(e,t,i,n,r){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:n,collisionGroupID:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,i,n,r){const o=t?this.ignoredGrid:this.grid,a={bucketInstanceId:i,featureIndex:n,collisionGroupID:r};for(let t=0;t<e.length;t+=4)o.insertCircle(a,e[t],e[t+1],e[t+2])}projectAndGetPerspectiveRatio(t,i,n,r,o,a,s){const l=[i,n,r,1];let c=!1;if(r||this.transform.pitch>0){e.transformMat4$1(l,l,t);const a="globe"===s.name;if(this.fogState&&o&&!a){const t=function(t,i,n,r,o,a){const s=a.calculateFogTileMatrix(o),l=[i,n,r];return e.transformMat4(l,l,s),C(t,l,a.pitch,a._fov)}(this.fogState,i,n,r,o.toUnwrapped(),this.transform);c=t>.9}}else gt(l,l,t);const u=l[3];return{point:new e.pointGeometry((l[0]/u+1)/2*this.transform.width+_t,(-l[1]/u+1)/2*this.transform.height+_t),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(s)/u*.5,1.5),signedDistanceFromCamera:u,occluded:a&&l[2]>u||c}}isOffscreen(e,t,i,n){return i<_t||e>=this.screenRightBoundary||n<_t||t>this.screenBottomBoundary}isInsideGrid(e,t,i,n){return i>=0&&e<this.gridRightBoundary&&n>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.identity([]);return e.translate(t,t,[-100,-100,0]),t}}function xt(t,i,n){const r=i.createTileMatrix(t,t.worldSize,n.toUnwrapped());return e.multiply(new Float32Array(16),t.projMatrix,r)}function vt(e,t,i){if(t.projection.name===i.projection.name)return e.projMatrix;const n=i.clone();return n.setProjection(t.projection),xt(n,t.getProjection(),e)}function bt(e,t,i){return t.name===i.projection.name?e.projMatrix:xt(i,t,e)}class wt{constructor(e,t,i,n){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):n&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class Mt{constructor(e,t,i,n,r,o=!1){this.text=new wt(e?e.text:null,t,i,r),this.icon=new wt(e?e.icon:null,t,n,r),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Tt{constructor(e,t,i,n=!1){this.text=e,this.icon=t,this.skipFade=i,this.clipped=n}}class St{constructor(){this.invProjMatrix=e.create(),this.viewportMatrix=e.create(),this.circles=[]}}class Et{constructor(e,t,i,n,r){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=i,this.bucketIndex=n,this.tileID=r}}class Ct{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function At(t,i,n,r,o){const{horizontalAlign:a,verticalAlign:s}=e.getAnchorAlignment(t),l=-(a-.5)*i,c=-(s-.5)*n,u=e.evaluateVariableOffset(t,r);return new e.pointGeometry(l+u[0]*o,c+u[1]*o)}function Pt(t,i,n,r,o){const a=new e.pointGeometry(t,i);return n&&a._rotate(r?o:-o),a}class It{constructor(e,t,i,n,r){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new yt(this.transform,r),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new Ct(i),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,i,n,r){const o=n.getBucket(i),a=n.latestFeatureIndex;if(!o||!a||i.id!==o.layerIds[0])return;const s=o.layers[0].layout,l=n.collisionBoxArray,c=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),u=n.tileSize/e.EXTENT,h=n.tileID.toUnwrapped();this.transform.setProjection(o.projection);const d=(p=n.tileID,f=o.getProjection(),m=this.transform,f.name===this.projection?m.calculateProjMatrix(p.toUnwrapped()):xt(m,f,p));var p,f,m;const g="map"===s.get("text-pitch-alignment"),_="map"===s.get("text-rotation-alignment");i.compileFilter();const y=i.dynamicFilter(),x=i.dynamicFilterNeedsFeature(),v=this.transform.calculatePixelsToTileUnitsMatrix(n),b=nt(d,n.tileID.canonical,g,_,this.transform,o.getProjection(),v);let w=null;if(g){const t=rt(d,n.tileID.canonical,g,_,this.transform,o.getProjection(),v);w=e.multiply([],this.transform.labelPlaneMatrix,t)}let M=null;y&&n.latestFeatureIndex&&(M={unwrappedTileID:h,dynamicFilter:y,dynamicFilterNeedsFeature:x,featureIndex:n.latestFeatureIndex}),this.retainedQueryData[o.bucketInstanceId]=new Et(o.bucketInstanceId,a,o.sourceLayerIndex,o.index,n.tileID);const T={bucket:o,layout:s,posMatrix:d,textLabelPlaneMatrix:b,labelToScreenMatrix:w,clippingData:M,scale:c,textPixelRatio:u,holdingForFade:n.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:e.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:e.evaluateSizeForZoom(o.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(r)for(const e of o.sortKeyRanges){const{sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:r}=e;t.push({sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:r,parameters:T})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:T})}attemptAnchorPlacement(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,g,_){const{textOffset0:y,textOffset1:x,crossTileID:v}=h,b=[y,x],w=At(e,i,n,b,r),M=this.collisionIndex.placeCollisionBox(p,r,t,Pt(w.x,w.y,o,a,this.transform.angle),u,s,l,c.predicate);if(m){const e=p.getSymbolInstanceIconSize(_,this.transform.zoom,h.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(p,e,m,Pt(w.x,w.y,o,a,this.transform.angle),u,s,l,c.predicate).box.length)return}if(M.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[v]&&this.prevPlacement.placements[v]&&this.prevPlacement.placements[v].text&&(t=this.prevPlacement.variableOffsets[v].anchor),this.variableOffsets[v]={textOffset:b,width:i,height:n,anchor:e,textScale:r,prevAnchor:t},this.markUsedJustification(p,e,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[v]=f),{shift:w,placedGlyphBoxes:M}}}placeLayerBucketPart(t,i,n,r){const{bucket:o,layout:a,posMatrix:s,textLabelPlaneMatrix:l,labelToScreenMatrix:c,clippingData:u,textPixelRatio:h,holdingForFade:d,collisionBoxArray:p,partiallyEvaluatedTextSize:f,partiallyEvaluatedIconSize:m,collisionGroup:g}=t.parameters,_=a.get("text-optional"),y=a.get("icon-optional"),x=a.get("text-allow-overlap"),v=a.get("icon-allow-overlap"),b="map"===a.get("text-rotation-alignment"),w="map"===a.get("text-pitch-alignment"),M="none"!==a.get("icon-text-fit"),T="viewport-y"===a.get("symbol-z-order");this.transform.setProjection(o.projection);let S=x&&(v||!o.hasIconData()||y),E=v&&(x||!o.hasTextData()||_);!o.collisionArrays&&p&&o.deserializeCollisionBoxes(p),n&&r&&o.updateCollisionDebugBuffers(this.transform.zoom,p);const C=(t,r,p)=>{const{crossTileID:T,numVerticalGlyphVertices:C}=t;if(u){const n={zoom:this.transform.zoom,pitch:this.transform.pitch};let r=null;if(u.dynamicFilterNeedsFeature){const e=this.retainedQueryData[o.bucketInstanceId];r=u.featureIndex.loadFeature({featureIndex:t.featureIndex,bucketIndex:e.bucketIndex,sourceLayerIndex:e.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,u.dynamicFilter)(n,r,this.retainedQueryData[o.bucketInstanceId].tileID.canonical,new e.pointGeometry(t.tileAnchorX,t.tileAnchorY),this.transform.calculateDistanceTileData(u.unwrappedTileID)))return this.placements[T]=new Tt(!1,!1,!1,!0),void(i[T]=!0)}if(i[T])return;if(d)return void(this.placements[T]=new Tt(!1,!1,!1));let A=!1,P=!1,I=!0,k=!1,z=!1,D=null,L={box:null,offscreen:null,occluded:null},R={box:null,offscreen:null,occluded:null},O=null,B=null,F=null,N=0,U=0,V=0;p.textFeatureIndex?N=p.textFeatureIndex:t.useRuntimeCollisionCircles&&(N=t.featureIndex),p.verticalTextFeatureIndex&&(U=p.verticalTextFeatureIndex);const G=e=>{e.tileID=this.retainedQueryData[o.bucketInstanceId].tileID;const t=this.transform.elevation;(t||e.elevation)&&(e.elevation=t?t.getAtTileOffset(e.tileID,e.tileAnchorX,e.tileAnchorY):0)},j=p.textBox;if(j){G(j);const i=i=>{let n=e.WritingMode.horizontal;if(o.allowVerticalPlacement&&!i&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[T];e&&(this.placedOrientations[T]=e,n=e,this.markUsedOrientation(o,n,t))}return n},n=(t,i)=>{if(o.allowVerticalPlacement&&C>0&&p.verticalTextBox){for(const n of o.writingModes)if(n===e.WritingMode.vertical?(L=i(),R=L):L=t(),L&&L.box&&L.box.length)break}else L=t()};if(a.get("text-variable-anchor")){let l=a.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[T]){const e=this.prevPlacement.variableOffsets[T];l.indexOf(e.anchor)>0&&(l=l.filter((t=>t!==e.anchor)),l.unshift(e.anchor))}const c=(e,i,n)=>{const a=o.getSymbolInstanceTextSize(f,t,this.transform.zoom,r),c=(e.x2-e.x1)*a+2*e.padding,u=(e.y2-e.y1)*a+2*e.padding,d=M&&!v?i:null;d&&G(d);let p={box:[],offscreen:!1,occluded:!1};const _=x?2*l.length:l.length;for(let i=0;i<_;++i){const _=this.attemptAnchorPlacement(l[i%l.length],e,c,u,a,b,w,h,s,g,i>=l.length,t,r,o,n,d,f,m);if(_&&(p=_.placedGlyphBoxes,p&&p.box&&p.box.length)){A=!0,D=_.shift;break}}return p};n((()=>c(j,p.iconBox,e.WritingMode.horizontal)),(()=>{const t=p.verticalTextBox;return t&&G(t),o.allowVerticalPlacement&&!(L&&L.box&&L.box.length)&&C>0&&t?c(t,p.verticalIconBox,e.WritingMode.vertical):{box:null,offscreen:null,occluded:null}})),L&&(A=L.box,I=L.offscreen,k=L.occluded);const u=i(L&&L.box);if(!A&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[T];e&&(this.variableOffsets[T]=e,this.markUsedJustification(o,e.anchor,t,u))}}else{const a=(i,n)=>{const a=o.getSymbolInstanceTextSize(f,t,this.transform.zoom,r),l=this.collisionIndex.placeCollisionBox(o,a,i,new e.pointGeometry(0,0),x,h,s,g.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(o,n,t),this.placedOrientations[T]=n),l};n((()=>a(j,e.WritingMode.horizontal)),(()=>{const t=p.verticalTextBox;return o.allowVerticalPlacement&&C>0&&t?(G(t),a(t,e.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}})),i(L&&L.box&&L.box.length)}}if(O=L,A=O&&O.box&&O.box.length>0,I=O&&O.offscreen,k=O&&O.occluded,t.useRuntimeCollisionCircles){const i=o.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex),r=e.evaluateSizeForFeature(o.textSizeData,f,i),u=a.get("text-padding");B=this.collisionIndex.placeCollisionCircles(o,x,i,o.lineVertexArray,o.glyphOffsetArray,r,s,l,c,n,w,g.predicate,t.collisionCircleDiameter*r/e.ONE_EM,u,this.retainedQueryData[o.bucketInstanceId].tileID),A=x||B.circles.length>0&&!B.collisionDetected,I=I&&B.offscreen,k=B.occluded}if(p.iconFeatureIndex&&(V=p.iconFeatureIndex),p.iconBox){const i=i=>{G(i);const n=M&&D?Pt(D.x,D.y,b,w,this.transform.angle):new e.pointGeometry(0,0),r=o.getSymbolInstanceIconSize(m,this.transform.zoom,t.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(o,r,i,n,v,h,s,g.predicate)};R&&R.box&&R.box.length&&p.verticalIconBox?(F=i(p.verticalIconBox),P=F.box.length>0):(F=i(p.iconBox),P=F.box.length>0),I=I&&F.offscreen,z=F.occluded}const W=_||0===t.numHorizontalGlyphVertices&&0===C,$=y||0===t.numIconVertices;if(W||$?$?W||(P=P&&A):A=P&&A:P=A=P&&A,A&&O&&O.box&&this.collisionIndex.insertCollisionBox(O.box,a.get("text-ignore-placement"),o.bucketInstanceId,R&&R.box&&U?U:N,g.ID),P&&F&&this.collisionIndex.insertCollisionBox(F.box,a.get("icon-ignore-placement"),o.bucketInstanceId,V,g.ID),B&&(A&&this.collisionIndex.insertCollisionCircles(B.circles,a.get("text-ignore-placement"),o.bucketInstanceId,N,g.ID),n)){const e=o.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new St);for(let e=0;e<B.circles.length;e+=4)t.circles.push(B.circles[e+0]),t.circles.push(B.circles[e+1]),t.circles.push(B.circles[e+2]),t.circles.push(B.collisionDetected?1:0)}const q="globe"!==o.projection.name;S=S&&(q||!k),E=E&&(q||!z),this.placements[T]=new Tt(A||S,P||E,I||o.justReloaded),i[T]=!0};if(T){const e=o.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){const i=e[t];C(o.symbolInstances.get(i),i,o.collisionArrays[i])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)C(o.symbolInstances.get(e),e,o.collisionArrays[e]);if(n&&o.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[o.bucketInstanceId];e.invert(t.invProjMatrix,s),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}markUsedJustification(t,i,n,r){const{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:l,crossTileID:c}=n,u=e.getAnchorJustification(i),h=r===e.WritingMode.vertical?l:"left"===u?o:"center"===u?a:"right"===u?s:-1;o>=0&&(t.text.placedSymbolArray.get(o).crossTileID=h>=0&&o!==h?0:c),a>=0&&(t.text.placedSymbolArray.get(a).crossTileID=h>=0&&a!==h?0:c),s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=h>=0&&s!==h?0:c),l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=h>=0&&l!==h?0:c)}markUsedOrientation(t,i,n){const r=i===e.WritingMode.horizontal||i===e.WritingMode.horizontalOnly?i:0,o=i===e.WritingMode.vertical?i:0,{leftJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=n,u=t.text.placedSymbolArray;a>=0&&(u.get(a).placedOrientation=r),s>=0&&(u.get(s).placedOrientation=r),l>=0&&(u.get(l).placedOrientation=r),c>=0&&(u.get(c).placedOrientation=o)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let i=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const n=t?t.symbolFadeChange(e):1,r=t?t.opacities:{},o=t?t.variableOffsets:{},a=t?t.placedOrientations:{};for(const e in this.placements){const t=this.placements[e],o=r[e];o?(this.opacities[e]=new Mt(o,n,t.text,t.icon,null,t.clipped),i=i||t.text!==o.text.placed||t.icon!==o.icon.placed):(this.opacities[e]=new Mt(null,n,t.text,t.icon,t.skipFade,t.clipped),i=i||t.text||t.icon)}for(const e in r){const t=r[e];if(!this.opacities[e]){const r=new Mt(t,n,!1,!1);r.isHidden()||(this.opacities[e]=r,i=i||t.text.placed||t.icon.placed)}}for(const e in o)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=o[e]);for(const e in a)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=a[e]);i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const i={};for(const n of t){const t=n.getBucket(e);t&&n.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,i,n.collisionBoxArray)}}updateBucketOpacities(t,i,n){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const r=t.layers[0].layout,o=!!t.layers[0].dynamicFilter(),a=new Mt(null,0,!1,!1,!0),s=r.get("text-allow-overlap"),l=r.get("icon-allow-overlap"),c=r.get("text-variable-anchor"),u="map"===r.get("text-rotation-alignment"),h="map"===r.get("text-pitch-alignment"),d="none"!==r.get("icon-text-fit"),p=new Mt(null,0,s&&(l||!t.hasIconData()||r.get("icon-optional")),l&&(s||!t.hasTextData()||r.get("text-optional")),!0);!t.collisionArrays&&n&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(n);const f=(e,t,i)=>{for(let n=0;n<t/4;n++)e.opacityVertexArray.emplaceBack(i)};let m=0;for(let n=0;n<t.symbolInstances.length;n++){const r=t.symbolInstances.get(n),{numHorizontalGlyphVertices:s,numVerticalGlyphVertices:l,crossTileID:g,numIconVertices:_}=r;let y=this.opacities[g];i[g]?y=a:y||(y=p,this.opacities[g]=y),i[g]=!0;const x=s>0||l>0,v=_>0,b=this.placedOrientations[g],w=b===e.WritingMode.vertical,M=b===e.WritingMode.horizontal||b===e.WritingMode.horizontalOnly;if(!x&&!v||y.isHidden()||m++,x){const e=Nt(y.text);f(t.text,s,w?Ut:e),f(t.text,l,M?Ut:e);const i=y.text.isHidden(),{leftJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:c}=r,u=t.text.placedSymbolArray,h=i||w?1:0;n>=0&&(u.get(n).hidden=h),o>=0&&(u.get(o).hidden=h),a>=0&&(u.get(a).hidden=h),c>=0&&(u.get(c).hidden=i||M?1:0);const d=this.variableOffsets[g];d&&this.markUsedJustification(t,d.anchor,r,b);const p=this.placedOrientations[g];p&&(this.markUsedJustification(t,"left",r,p),this.markUsedOrientation(t,p,r))}if(v){const e=Nt(y.icon),{placedIconSymbolIndex:i,verticalPlacedIconSymbolIndex:n}=r,o=t.icon.placedSymbolArray,a=y.icon.isHidden()?1:0;i>=0&&(f(t.icon,_,w?Ut:e),o.get(i).hidden=a),n>=0&&(f(t.icon,r.numVerticalIconVertices,M?Ut:e),o.get(n).hidden=a)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const i=t.collisionArrays[n];if(i){let n=new e.pointGeometry(0,0),r=!0;if(i.textBox||i.verticalTextBox){if(c){const e=this.variableOffsets[g];e?(n=At(e.anchor,e.width,e.height,e.textOffset,e.textScale),u&&n._rotate(h?this.transform.angle:-this.transform.angle)):r=!1}o&&(r=!y.clipped),i.textBox&&kt(t.textCollisionBox.collisionVertexArray,y.text.placed,!r||w,n.x,n.y),i.verticalTextBox&&kt(t.textCollisionBox.collisionVertexArray,y.text.placed,!r||M,n.x,n.y)}const a=r&&Boolean(!M&&i.verticalIconBox);i.iconBox&&kt(t.iconCollisionBox.collisionVertexArray,y.icon.placed,a,d?n.x:0,d?n.y:0),i.verticalIconBox&&kt(t.iconCollisionBox.collisionVertexArray,y.icon.placed,!a,d?n.x:0,d?n.y:0)}}}if(t.fullyClipped=0===m,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const i=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*i>e}setStale(){this.stale=!0}}function kt(e,t,i,n,r){e.emplaceBack(t?1:0,i?1:0,n||0,r||0),e.emplaceBack(t?1:0,i?1:0,n||0,r||0),e.emplaceBack(t?1:0,i?1:0,n||0,r||0),e.emplaceBack(t?1:0,i?1:0,n||0,r||0)}const zt=Math.pow(2,25),Dt=Math.pow(2,24),Lt=Math.pow(2,17),Rt=Math.pow(2,16),Ot=Math.pow(2,9),Bt=Math.pow(2,8),Ft=Math.pow(2,1);function Nt(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*zt+t*Dt+i*Lt+t*Rt+i*Ot+t*Bt+i*Ft+t}const Ut=0;class Vt{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,t,i,n,r){const o=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(o,n,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<o.length;){const e=o[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,i,0===e.symbolInstanceStart),this._currentPartIndex++,r())return!0}return!1}}class Gt{constructor(e,t,i,n,r,o,a,s){this.placement=new It(e,r,o,a,s),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(t,i,n){const r=e.exported.now(),o=()=>{const t=e.exported.now()-r;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const e=i[t[this._currentPlacementIndex]],r=this.placement.collisionIndex.transform.zoom;if("symbol"===e.type&&(!e.minzoom||e.minzoom<=r)&&(!e.maxzoom||e.maxzoom>r)){if(this._inProgressLayer||(this._inProgressLayer=new Vt(e)),this._inProgressLayer.continuePlacement(n[e.source],this.placement,this._showCollisionBoxes,e,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const jt=512/e.EXTENT/2;class Wt{constructor(e,t,i){this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(let i=0;i<t.length;i++){const n=t.get(i),r=n.key;this.indexedSymbolInstances[r]||(this.indexedSymbolInstances[r]=[]),this.indexedSymbolInstances[r].push({crossTileID:n.crossTileID,coord:this.getScaledCoordinates(n,e)})}}getScaledCoordinates(t,i){const n=jt/Math.pow(2,i.canonical.z-this.tileID.canonical.z);return{x:Math.floor((i.canonical.x*e.EXTENT+t.tileAnchorX)*n),y:Math.floor((i.canonical.y*e.EXTENT+t.tileAnchorY)*n)}}findMatches(e,t,i){const n=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z);for(let r=0;r<e.length;r++){const o=e.get(r);if(o.crossTileID)continue;const a=this.indexedSymbolInstances[o.key];if(!a)continue;const s=this.getScaledCoordinates(o,t);for(const e of a)if(Math.abs(e.coord.x-s.x)<=n&&Math.abs(e.coord.y-s.y)<=n&&!i[e.crossTileID]){i[e.crossTileID]=!0,o.crossTileID=e.crossTileID;break}}}}class $t{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class qt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){const i=this.indexes[e],n={};for(const e in i){const r=i[e];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),n[r.tileID.key]=r}this.indexes[e]=n}this.lng=e}addBucket(e,t,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const n=this.usedCrossTileIDs[e.overscaledZ];for(const i in this.indexes){const r=this.indexes[i];if(Number(i)>e.overscaledZ)for(const i in r){const o=r[i];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,n)}else{const o=r[e.scaledTo(Number(i)).key];o&&o.findMatches(t.symbolInstances,e,n)}}for(let e=0;e<t.symbolInstances.length;e++){const r=t.symbolInstances.get(e);r.crossTileID||(r.crossTileID=i.generate(),n[r.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Wt(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const i in t.indexedSymbolInstances)for(const n of t.indexedSymbolInstances[i])delete this.usedCrossTileIDs[e][n.crossTileID]}removeStaleBuckets(e){let t=!1;for(const i in this.indexes){const n=this.indexes[i];for(const r in n)e[n[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,n[r]),delete n[r],t=!0)}return t}}class Zt{constructor(){this.layerIndexes={},this.crossTileIDs=new $t,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,i,n){let r=this.layerIndexes[e.id];void 0===r&&(r=this.layerIndexes[e.id]=new qt);let o=!1;const a={};"globe"!==n.name&&r.handleWrapJump(i);for(const i of t){const t=i.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(i.tileID,t,this.crossTileIDs)&&(o=!0),a[t.bucketInstanceId]=!0)}return r.removeStaleBuckets(a)&&(o=!0),o}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e]}}const Ht=(t,i)=>e.emitValidationErrors(t,i&&i.filter((e=>"source.canvas"!==e.identifier))),Xt=e.pick($e,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Yt=e.pick($e,["setCenter","setZoom","setBearing","setPitch"]),Jt={version:8,layers:[],sources:{}},Kt={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Qt extends e.Evented{constructor(t,i={}){super(),this.map=t,this.dispatcher=new z(Ge(),this),this.imageManager=new v,this.imageManager.setEventedParent(this),this.glyphManager=new e.GlyphManager(t._requestManager,i.localFontFamily?e.LocalGlyphMode.all:i.localIdeographFontFamily?e.LocalGlyphMode.ideographs:e.LocalGlyphMode.none,i.localFontFamily||i.localIdeographFontFamily),this.crossTileSymbolIndex=new Zt,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",e.getReferrer());const n=this;this._rtlTextPluginCallback=Qt.registerForPluginStateChange((t=>{n.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},((t,i)=>{if(e.triggerPluginCompletionEvent(t),i&&i.every((e=>e)))for(const e in n._sourceCaches){const t=n._sourceCaches[e],i=t.getSource().type;"vector"!==i&&"geojson"!==i||t.reload()}}))})),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getSource(e.sourceId);if(t&&t.vectorLayerIds)for(const e in this._layers){const i=this._layers[e];i.source===t.id&&this._validateLayer(i)}}))}loadURL(t,i={}){this.fire(new e.Event("dataloading",{dataType:"style"}));const n="boolean"==typeof i.validate?i.validate:!e.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,i.accessToken);const r=this.map._requestManager.transformRequest(t,e.ResourceType.Style);this._request=e.getJSON(r,((t,i)=>{this._request=null,t?this.fire(new e.ErrorEvent(t)):i&&this._load(i,n)}))}loadJSON(t,i={}){this.fire(new e.Event("dataloading",{dataType:"style"})),this._request=e.exported.frame((()=>{this._request=null,this._load(t,!1!==i.validate)}))}loadEmpty(){this.fire(new e.Event("dataloading",{dataType:"style"})),this._load(Jt,!1)}_updateLayerCount(e,t){const i=t?1:-1;e.is3D()&&(this._num3DLayers+=i),"circle"===e.type&&(this._numCircleLayers+=i),"symbol"===e.type&&(this._numSymbolLayers+=i)}_load(t,i){if(i&&Ht(this,e.validateStyle(t)))return;this._loaded=!0,this.stylesheet=e.clone$1(t),this._updateMapProjection();for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const n=We(this.stylesheet.layers);this._order=n.map((e=>e.id)),this._layers={},this._serializedLayers={};for(let t of n)t=e.createStyleLayer(t),t.setEventedParent(this,{layer:{id:t.id}}),this._layers[t.id]=t,this._serializedLayers[t.id]=t.serialize(),this._updateLayerCount(t,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new M(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new e.Event("data",{dataType:"style"})),this.fire(new e.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(t){this._spriteRequest=function(t,i,n){let r,o,a;const s=e.exported.devicePixelRatio>1?"@2x":"";let l=e.getJSON(i.transformRequest(i.normalizeSpriteURL(t,s,".json"),e.ResourceType.SpriteJSON),((e,t)=>{l=null,a||(a=e,r=t,u())})),c=e.getImage(i.transformRequest(i.normalizeSpriteURL(t,s,".png"),e.ResourceType.SpriteImage),((e,t)=>{c=null,a||(a=e,o=t,u())}));function u(){if(a)n(a);else if(r&&o){const t=e.exported.getImageData(o),i={};for(const n in r){const{width:o,height:a,x:s,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p}=r[n],f=new e.RGBAImage({width:o,height:a});e.RGBAImage.copy(t,f,{x:s,y:l},{x:0,y:0},{width:o,height:a}),i[n]={data:f,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p}}n(null,i)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,((t,i)=>{if(this._spriteRequest=null,t)this.fire(new e.ErrorEvent(t));else if(i)for(const e in i)this.imageManager.addImage(e,i[e]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new e.Event("data",{dataType:"style"}))}))}_validateLayer(t){const i=this.getSource(t.source);if(!i)return;const n=t.sourceLayer;n&&("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(n))&&this.fire(new e.ErrorEvent(new Error(`Source layer "${n}" does not exist on source "${i.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(e){const t=[];for(const i of e){const e=this._layers[i];"custom"!==e.type&&t.push(e.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;if(this.fog&&this.fog.hasTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(e){return!!this.terrain&&("function"==typeof e.isLayerDraped?e.isLayerDraped():Kt[e.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const i=this._changed;if(this._changed){const e=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);(e.length||i.length)&&this._updateWorkerLayers(e,i);for(const e in this._updatedSources){const t=this._updatedSources[e];"reload"===t?this._reloadSource(e):"clear"===t&&this._clearSource(e)}this._updateTilesForChangedImages();for(const e in this._updatedPaintProps)this._layers[e].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const n={};for(const e in this._sourceCaches){const t=this._sourceCaches[e];n[e]=t.used,t.used=!1}for(const e of this._order){const i=this._layers[e];if(i.recalculate(t,this._availableImages),!i.isHidden(t.zoom)){const e=this._getLayerSourceCache(i);e&&(e.used=!0)}const n=this.map.painter;if(n){const e=i.getProgramIds();if(!e)continue;const r=i.getProgramConfiguration(t.zoom);for(const t of e)n.useProgram(t,r)}}for(const t in n){const i=this._sourceCaches[t];n[t]!==i.used&&i.getSource().fire(new e.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:i.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),i&&this.fire(new e.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateWorkerLayers(e,t){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),Ht(this,e.validateStyle(i)))return!1;(i=e.clone$1(i)).layers=We(i.layers);const n=function(e,i){if(!e)return[{command:$e.setStyle,args:[i]}];let n=[];try{if(!t(e.version,i.version))return[{command:$e.setStyle,args:[i]}];t(e.center,i.center)||n.push({command:$e.setCenter,args:[i.center]}),t(e.zoom,i.zoom)||n.push({command:$e.setZoom,args:[i.zoom]}),t(e.bearing,i.bearing)||n.push({command:$e.setBearing,args:[i.bearing]}),t(e.pitch,i.pitch)||n.push({command:$e.setPitch,args:[i.pitch]}),t(e.sprite,i.sprite)||n.push({command:$e.setSprite,args:[i.sprite]}),t(e.glyphs,i.glyphs)||n.push({command:$e.setGlyphs,args:[i.glyphs]}),t(e.transition,i.transition)||n.push({command:$e.setTransition,args:[i.transition]}),t(e.light,i.light)||n.push({command:$e.setLight,args:[i.light]}),t(e.fog,i.fog)||n.push({command:$e.setFog,args:[i.fog]}),t(e.projection,i.projection)||n.push({command:$e.setProjection,args:[i.projection]});const r={},o=[];!function(e,i,n,r){let o;for(o in i=i||{},e=e||{})e.hasOwnProperty(o)&&(i.hasOwnProperty(o)||Ze(o,n,r));for(o in i)i.hasOwnProperty(o)&&(e.hasOwnProperty(o)?t(e[o],i[o])||("geojson"===e[o].type&&"geojson"===i[o].type&&Xe(e,i,o)?n.push({command:$e.setGeoJSONSourceData,args:[o,i[o].data]}):He(o,i,n,r)):qe(o,i,n))}(e.sources,i.sources,o,r);const a=[];e.layers&&e.layers.forEach((e=>{e.source&&r[e.source]?n.push({command:$e.removeLayer,args:[e.id]}):a.push(e)}));let s=e.terrain;s&&r[s.source]&&(n.push({command:$e.setTerrain,args:[void 0]}),s=void 0),n=n.concat(o),t(s,i.terrain)||n.push({command:$e.setTerrain,args:[i.terrain]}),function(e,i,n){i=i||[];const r=(e=e||[]).map(Je),o=i.map(Je),a=e.reduce(Ke,{}),s=i.reduce(Ke,{}),l=r.slice(),c=Object.create(null);let u,h,d,p,f,m,g;for(u=0,h=0;u<r.length;u++)d=r[u],s.hasOwnProperty(d)?h++:(n.push({command:$e.removeLayer,args:[d]}),l.splice(l.indexOf(d,h),1));for(u=0,h=0;u<o.length;u++)d=o[o.length-1-u],l[l.length-1-u]!==d&&(a.hasOwnProperty(d)?(n.push({command:$e.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-h),1)):h++,m=l[l.length-u],n.push({command:$e.addLayer,args:[s[d],m]}),l.splice(l.length-u,0,d),c[d]=!0);for(u=0;u<o.length;u++)if(d=o[u],p=a[d],f=s[d],!c[d]&&!t(p,f))if(t(p.source,f.source)&&t(p["source-layer"],f["source-layer"])&&t(p.type,f.type)){for(g in Ye(p.layout,f.layout,n,d,null,$e.setLayoutProperty),Ye(p.paint,f.paint,n,d,null,$e.setPaintProperty),t(p.filter,f.filter)||n.push({command:$e.setFilter,args:[d,f.filter]}),t(p.minzoom,f.minzoom)&&t(p.maxzoom,f.maxzoom)||n.push({command:$e.setLayerZoomRange,args:[d,f.minzoom,f.maxzoom]}),p)p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Ye(p[g],f[g],n,d,g.slice(6),$e.setPaintProperty):t(p[g],f[g])||n.push({command:$e.setLayerProperty,args:[d,g,f[g]]}));for(g in f)f.hasOwnProperty(g)&&!p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Ye(p[g],f[g],n,d,g.slice(6),$e.setPaintProperty):t(p[g],f[g])||n.push({command:$e.setLayerProperty,args:[d,g,f[g]]}))}else n.push({command:$e.removeLayer,args:[d]}),m=l[l.lastIndexOf(d)+1],n.push({command:$e.addLayer,args:[f,m]})}(a,i.layers,n)}catch(e){console.warn("Unable to compute style diff:",e),n=[{command:$e.setStyle,args:[i]}]}return n}(this.serialize(),i).filter((e=>!(e.command in Yt)));if(0===n.length)return!1;const r=n.filter((e=>!(e.command in Xt)));if(r.length>0)throw new Error(`Unimplemented: ${r.map((e=>e.command)).join(", ")}.`);return n.forEach((e=>{"setTransition"!==e.command&&"setProjection"!==e.command&&this[e.command].apply(this,e.args)})),this.stylesheet=i,this._updateMapProjection(),!0}addImage(t,i){return this.getImage(t)?this.fire(new e.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,i),this._afterImageUpdated(t),this)}updateImage(e,t){this.imageManager.updateImage(e,t)}getImage(e){return this.imageManager.getImage(e)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t),this._afterImageUpdated(t),this):this.fire(new e.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new e.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(t,i,n={}){if(this._checkLoaded(),void 0!==this.getSource(t))throw new Error("There is already a source with this ID");if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(e.validateSource,`sources.${t}`,i,null,n))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const r=De(t,i,this.dispatcher,this);r.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(t),source:r.serialize(),sourceId:t})));const o=i=>{const n=(i?"symbol:":"other:")+t,o=this._sourceCaches[n]=new e.SourceCache(n,r,i);(i?this._symbolSourceCaches:this._otherSourceCaches)[t]=o,o.style=this,o.onAdd(this.map)};o(!1),"vector"!==i.type&&"geojson"!==i.type||o(!0),r.onAdd&&r.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const i=this.getSource(t);if(!i)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new e.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${i}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new e.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const n=this._getSourceCaches(t);for(const t of n)delete this._sourceCaches[t.id],delete this._updatedSources[t.id],t.fire(new e.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t.getSource().id})),t.setEventedParent(null),t.clearTiles();return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getSource(e).setData(t),this._changed=!0}getSource(e){const t=this._getSourceCache(e);return t&&t.getSource()}_getSources(){const e=[];for(const t in this._otherSourceCaches){const i=this._getSourceCache(t);i&&e.push(i.getSource())}return e}addLayer(t,i,n={}){this._checkLoaded();const r=t.id;if(this.getLayer(r))return void this.fire(new e.ErrorEvent(new Error(`Layer with id "${r}" already exists on this map`)));let o;if("custom"===t.type){if(Ht(this,e.validateCustomStyleLayer(t)))return;o=e.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(r,t.source),t=e.clone$1(t),t=e.extend(t,{source:r})),this._validate(e.validateLayer,`layers.${r}`,t,{arrayIndex:-1},n))return;o=e.createStyleLayer(t),this._validateLayer(o),o.setEventedParent(this,{layer:{id:r}}),this._serializedLayers[o.id]=o.serialize(),this._updateLayerCount(o,!0)}const a=i?this._order.indexOf(i):this._order.length;if(i&&-1===a)return void this.fire(new e.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`)));this._order.splice(a,0,r),this._layerOrderChanged=!0,this._layers[r]=o;const s=this._getLayerSourceCache(o);if(this._removedLayers[r]&&o.source&&s&&"custom"!==o.type){const e=this._removedLayers[r];delete this._removedLayers[r],e.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",s.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,i){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===i)return;const n=this._order.indexOf(t);this._order.splice(n,1);const r=i?this._order.indexOf(i):this._order.length;i&&-1===r?this.fire(new e.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`))):(this._order.splice(r,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const i=this._layers[t];if(!i)return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));i.setEventedParent(null),this._updateLayerCount(i,!1);const n=this._order.indexOf(t);this._order.splice(n,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=i,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],i.onRemove&&i.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(e){return this._layers[e]}hasLayer(e){return e in this._layers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(t,i,n){this._checkLoaded();const r=this.getLayer(t);r?r.minzoom===i&&r.maxzoom===n||(null!=i&&(r.minzoom=i),null!=n&&(r.maxzoom=n),this._updateLayer(r)):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,n,r={}){this._checkLoaded();const o=this.getLayer(i);if(o){if(!t(o.filter,n))return null==n?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(e.validateFilter,`layers.${o.id}.filter`,n,{layerType:o.type},r)||(o.filter=e.clone$1(n),this._updateLayer(o)))}else this.fire(new e.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){const i=this.getLayer(t);return i&&e.clone$1(i.filter)}setLayoutProperty(i,n,r,o={}){this._checkLoaded();const a=this.getLayer(i);a?t(a.getLayoutProperty(n),r)||(a.setLayoutProperty(n,r,o),this._updateLayer(a)):this.fire(new e.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,i){const n=this.getLayer(t);if(n)return n.getLayoutProperty(i);this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(i,n,r,o={}){this._checkLoaded();const a=this.getLayer(i);a?t(a.getPaintProperty(n),r)||(a.setPaintProperty(n,r,o)&&this._updateLayer(a),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new e.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(e,t){const i=this.getLayer(e);return i&&i.getPaintProperty(t)}setFeatureState(t,i){this._checkLoaded();const n=t.source,r=t.sourceLayer,o=this.getSource(n);if(!o)return void this.fire(new e.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)));const a=o.type;if("geojson"===a&&r)return void this.fire(new e.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===a&&!r)return void this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided.")));const s=this._getSourceCaches(n);for(const e of s)e.setFeatureState(r,t.id,i)}removeFeatureState(t,i){this._checkLoaded();const n=t.source,r=this.getSource(n);if(!r)return void this.fire(new e.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)));const o=r.type,a="vector"===o?t.sourceLayer:void 0;if("vector"===o&&!a)return void this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const s=this._getSourceCaches(n);for(const e of s)e.removeFeatureState(a,t.id,i)}getFeatureState(t){this._checkLoaded();const i=t.source,n=t.sourceLayer,r=this.getSource(i);if(r){if("vector"!==r.type||n)return void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(i)[0].getFeatureState(n,t.id);this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new e.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return e.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const e in this._sourceCaches){const i=this._sourceCaches[e].getSource();t[i.id]||(t[i.id]=i.serialize())}return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateLayer(e){this._updatedLayers[e.id]=!0;const t=this._getLayerSourceCache(e);e.source&&!this._updatedSources[e.source]&&t&&"raster"!==t.getSource().type&&(this._updatedSources[e.source]="reload",t.pause()),this._changed=!0,e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._layers[e].type,i={},n=[];for(let r=this._order.length-1;r>=0;r--){const o=this._order[r];if(t(o)){i[o]=r;for(const t of e){const e=t[o];if(e)for(const t of e)n.push(t)}}}n.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const r=[];for(let o=this._order.length-1;o>=0;o--){const a=this._order[o];if(t(a))for(let e=n.length-1;e>=0;e--){const t=n[e].feature;if(i[t.layer.id]<o)break;r.push(t),n.pop()}else for(const t of e){const e=t[a];if(e)for(const t of e)r.push(t.feature)}}return r}queryRenderedFeatures(t,i,n){i&&i.filter&&this._validate(e.validateFilter,"queryRenderedFeatures.filter",i.filter,null,i);const r={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new e.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const t of i.layers){const i=this._layers[t];if(!i)return this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];r[i.source]=!0}}const o=[];i.availableImages=this._availableImages;const a=i&&i.layers?i.layers.some((e=>{const t=this.getLayer(e);return t&&t.is3D()})):this.has3DLayers(),s=L.createFromScreenPoints(t,n);for(const e in this._sourceCaches){const t=this._sourceCaches[e].getSource().id;i.layers&&!r[t]||o.push(Re(this._sourceCaches[e],this._layers,this._serializedLayers,s,i,n,a,!!this.map._showQueryGeometry))}return this.placement&&o.push(function(e,t,i,n,r,o,a){const s={},l=o.queryRenderedSymbols(n),c=[];for(const e of Object.keys(l).map(Number))c.push(a[e]);c.sort(Be);for(const i of c){const n=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],t,i.bucketIndex,i.sourceLayerIndex,r.filter,r.layers,r.availableImages,e);for(const e in n){const t=s[e]=s[e]||[],r=n[e];r.sort(((e,t)=>{const n=i.featureSortOrder;if(n){const i=n.indexOf(e.featureIndex);return n.indexOf(t.featureIndex)-i}return t.featureIndex-e.featureIndex}));for(const e of r)t.push(e)}}for(const t in s)s[t].forEach((n=>{const r=n.feature,o=i(e[t]).getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=o}));return s}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),s.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(t,i){i&&i.filter&&this._validate(e.validateFilter,"querySourceFeatures.filter",i.filter,null,i);const n=this._getSourceCaches(t);let r=[];for(const e of n)r=r.concat(Oe(e,i));return r}addSourceType(e,t,i){return Qt.getSourceType(e)?i(new Error(`A source type called "${e}" already exists.`)):(Qt.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},i):i(null,null))}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const n=this.light.getLight();let r=!1;for(const i in e)if(!t(e[i],n[i])){r=!0;break}if(!r)return;const o=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(e,i),this.light.updateTransitions(o)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,n=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===n){if("object"==typeof i.source){const t="terrain-dem-src";this.addSource(t,i.source),i=e.clone$1(i),i=e.extend(i,{source:t})}if(this._validate(e.validateTerrain,"terrain",i))return}if(!this.terrain||this.terrain&&n!==this.terrain.drapeRenderMode)this._createTerrain(i,n);else{const n=this.terrain,r=n.get();for(const t of Object.keys(e.spec.terrain))!i.hasOwnProperty(t)&&e.spec.terrain[t].default&&(i[t]=e.spec.terrain[t].default);for(const e in i)if(!t(i[e],r[e])){n.set(i),this.stylesheet.terrain=i;const e=this._setTransitionParameters({duration:0});n.updateTransitions(e);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new k(e,this.map.transform);this.stylesheet.fog=e;const i=this._setTransitionParameters({duration:0});t.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const e of this.map._markers)e._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog,n=i.get();0===Object.keys(e).length&&i.set(e);for(const r in e)if(!t(e[r],n[r])){i.set(e),this.stylesheet.fog=e;const t=this._setTransitionParameters({duration:0});i.updateTransitions(t);break}}else this._createFog(e);this._markersNeedUpdate=!0}_setTransitionParameters(t){return{now:e.exported.now(),transition:e.extend(t,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const e=this._order.filter((e=>this.isLayerDraped(this._layers[e]))),t=this._order.filter((e=>!this.isLayerDraped(this._layers[e])));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const i=this.terrain=new E(e,t);this.stylesheet.terrain=e,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const n=this._setTransitionParameters({duration:0});i.updateTransitions(n)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(t,i,n,r,o={}){return(!o||!1!==o.validate)&&Ht(this,t.call(e.validateStyle,e.extend({key:i,style:this.serialize(),value:n,styleSpec:e.spec},r)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._layers)this._layers[e].setEventedParent(null);for(const e in this._sourceCaches)this._sourceCaches[e].clearTiles(),this._sourceCaches[e].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(e){const t=this._getSourceCaches(e);for(const e of t)e.clearTiles()}_reloadSource(e){const t=this._getSourceCaches(e);for(const e of t)e.resume(),e.reload()}_reloadSources(){for(const e of this._getSources())e.reload&&e.reload()}_updateSources(e){for(const t in this._sourceCaches)this._sourceCaches[t].update(e)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(t,i,n,r,o=!1){let a=!1,s=!1;const l={};for(const e of this._order){const i=this._layers[e];if("symbol"!==i.type)continue;if(!l[i.source]){const e=this._getLayerSourceCache(i);if(!e)continue;l[i.source]=e.getRenderableIds(!0).map((t=>e.getTileByID(t))).sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const n=this.crossTileSymbolIndex.addLayer(i,l[i.source],t.center.lng,t.projection);a=a||n}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),o=o||this._layerOrderChanged||0===n,this._layerOrderChanged&&this.fire(new e.Event("neworder")),(o||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.exported.now(),t.zoom))&&(this.pauseablePlacement=new Gt(t,this._order,o,i,n,r,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.exported.now()),s=!0),a&&this.pauseablePlacement.placement.setStale()),s||a)for(const e of this._order){const t=this._layers[e];"symbol"===t.type&&this.placement.updateLayerOpacities(t,l[t.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.exported.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,t,i){this.imageManager.getImages(t.icons,i),this._updateTilesForChangedImages();const n=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};n(this._otherSourceCaches[t.source]),n(this._symbolSourceCaches[t.source])}getGlyphs(e,t,i){this.glyphManager.getGlyphs(t.stacks,i)}getResource(t,i,n){return e.makeRequest(i,n)}_getSourceCache(e){return this._otherSourceCaches[e]}_getLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}_getSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(t){const i=this._getSourceCaches(t);return 0===i.length?(this.fire(new e.ErrorEvent(new Error(`There is no source with ID '${t}'`))),!1):i.every((e=>e.loaded()))}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Qt.getSourceType=function(e){return ze[e]},Qt.setSourceType=function(e,t){ze[e]=t},Qt.registerForPluginStateChange=e.registerForPluginStateChange;var ei="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",ti="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ii="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",ni="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",ri="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let oi={},ai={};const si=[];di(ei,si),di(ii,si),di(ni,si),di(ri,si),oi=pi("",ii),ai=pi(ri,ni);const li=pi("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ci=ei,ui="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var hi={background:pi("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:pi("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:pi("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:pi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:pi("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:pi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:pi("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:pi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:pi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:pi("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:pi("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:pi("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:pi("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:pi("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:pi("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:pi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:pi("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:pi("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:pi("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:pi("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:pi("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:pi("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:pi("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:pi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:pi("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:pi("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ti),skyboxGradient:pi("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ti),skyboxCapture:pi("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:pi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:pi("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function di(e,t){const i=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let e of i)if(e=e.trim(),"#"===e[0]&&e.includes("if")&&!e.includes("endif")){e=e.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const i=e.split(" ");for(const e of i)t.includes(e)||t.push(e)}}function pi(e,t){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,n=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),r={},o=[...si];return di(e,o),di(t,o),{fragmentSource:e=e.replace(i,((e,t,i,n,o)=>(r[o]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${o}\nvarying ${i} ${n} ${o};\n#else\nuniform ${i} ${n} u_${o};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${o}\n    ${i} ${n} ${o} = u_${o};\n#endif\n`))),vertexSource:t=t.replace(i,((e,t,i,n,o)=>{const a="float"===n?"vec2":"vec4",s=o.match(/color/)?"color":a;return r[o]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${o}\nuniform lowp float u_${o}_t;\nattribute ${i} ${a} a_${o};\nvarying ${i} ${n} ${o};\n#else\nuniform ${i} ${n} u_${o};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${o}\n    ${o} = a_${o};\n#else\n    ${i} ${n} ${o} = u_${o};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${o}\n    ${o} = unpack_mix_${s}(a_${o}, u_${o}_t);\n#else\n    ${i} ${n} ${o} = u_${o};\n#endif\n`:"define"===t?`\n#ifndef HAS_UNIFORM_u_${o}\nuniform lowp float u_${o}_t;\nattribute ${i} ${a} a_${o};\n#else\nuniform ${i} ${n} u_${o};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${o}\n    ${i} ${n} ${o} = a_${o};\n#else\n    ${i} ${n} ${o} = u_${o};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${o}\n    ${i} ${n} ${o} = unpack_mix_${s}(a_${o}, u_${o}_t);\n#else\n    ${i} ${n} ${o} = u_${o};\n#endif\n`})),staticAttributes:n,usedDefines:o}}class fi{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,t,i,n,r,o,a){this.context=e;let s=this.boundPaintVertexBuffers.length!==n.length;for(let e=0;!s&&e<n.length;e++)this.boundPaintVertexBuffers[e]!==n[e]&&(s=!0);let l=this.boundDynamicVertexBuffers.length!==a.length;for(let e=0;!l&&e<a.length;e++)this.boundDynamicVertexBuffers[e]!==a[e]&&(l=!0);if(!e.extVertexArrayObject||!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==i||s||l||this.boundIndexBuffer!==r||this.boundVertexOffset!==o)this.freshBind(t,i,n,r,o,a);else{e.bindVertexArrayOES.set(this.vao);for(const e of a)e&&e.bind();r&&r.dynamicDraw&&r.bind()}}freshBind(e,t,i,n,r,o){let a;const s=e.numAttributes,l=this.context,c=l.gl;if(l.extVertexArrayObject)this.vao&&this.destroy(),this.vao=l.extVertexArrayObject.createVertexArrayOES(),l.bindVertexArrayOES.set(this.vao),a=0,this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=n,this.boundVertexOffset=r,this.boundDynamicVertexBuffers=o;else{a=l.currentNumAttributes||0;for(let e=s;e<a;e++)c.disableVertexAttribArray(e)}t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,r);for(const t of i)t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,r);for(const t of o)t&&(t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,r));n&&n.bind(),l.currentNumAttributes=s}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function mi(t,i){const n=Math.pow(2,i.canonical.z),r=i.canonical.y;return[new e.MercatorCoordinate(0,r/n).toLngLat().lat,new e.MercatorCoordinate(0,(r+1)/n).toLngLat().lat]}function gi(t,i,n,r,o,a,s){const l=t.context,c=l.gl,u=n.fbo;if(!u)return;t.prepareDrawTile();const h=t.useProgram("hillshade");l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const d=((e,t,i,n)=>{const r=i.paint.get("hillshade-shadow-color"),o=i.paint.get("hillshade-highlight-color"),a=i.paint.get("hillshade-accent-color");let s=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===i.paint.get("hillshade-illumination-anchor")&&(s-=e.transform.angle);const l=!e.options.moving;return{u_matrix:n||e.transform.calculateProjMatrix(t.tileID.toUnwrapped(),l),u_image:0,u_latrange:mi(0,t.tileID),u_light:[i.paint.get("hillshade-exaggeration"),s],u_shadow:r,u_highlight:o,u_accent:a}})(t,n,r,t.terrain?i.projMatrix:null);t.prepareDrawProgram(l,h,i.toUnwrapped());const{tileBoundsBuffer:p,tileBoundsIndexBuffer:f,tileBoundsSegments:m}=t.getTileBoundsBuffers(n);h.draw(l,c.TRIANGLES,o,a,s,e.CullFaceMode.disabled,d,r.id,p,f,m)}function _i(t,i,n){if(!i.needsDEMTextureUpload)return;const r=t.context,o=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||t.getTileTexture(n.stride);const a=n.getPixels();i.demTexture?i.demTexture.update(a,{premultiply:!1}):i.demTexture=new e.Texture(r,a,o.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function yi(t,i,n,r,o,a){const s=t.context,l=s.gl;if(!i.dem)return;const c=i.dem;if(s.activeTexture.set(l.TEXTURE1),_i(t,i,c),!i.demTexture)return;i.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);const u=c.dim;s.activeTexture.set(l.TEXTURE0);let h=i.fbo;if(!h){const t=new e.Texture(s,{width:u,height:u,data:null},l.RGBA);t.bind(l.LINEAR,l.CLAMP_TO_EDGE),h=i.fbo=s.createFramebuffer(u,u,!0),h.colorAttachment.set(t.texture)}s.bindFramebuffer.set(h.framebuffer),s.viewport.set([0,0,u,u]);const{tileBoundsBuffer:d,tileBoundsIndexBuffer:p,tileBoundsSegments:f}=t.getMercatorTileBoundsBuffers();t.useProgram("hillshadePrepare").draw(s,l.TRIANGLES,r,o,a,e.CullFaceMode.disabled,((t,i)=>{const n=i.stride,r=e.create();return e.ortho(r,0,e.EXTENT,-e.EXTENT,0,0,1),e.translate(r,r,[0,-e.EXTENT,0]),{u_matrix:r,u_image:1,u_dimension:[n,n],u_zoom:t.overscaledZ,u_unpack:i.unpackVector}})(i.tileID,c),n.id,d,p,f),i.needsHillshadePrepare=!1}const xi=t=>({u_matrix:new e.UniformMatrix4f(t),u_image0:new e.Uniform1i(t),u_skirt_height:new e.Uniform1f(t)}),vi=(e,t)=>({u_matrix:e,u_image0:0,u_skirt_height:t}),bi=(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(n),u_merc_matrix:i,u_zoom_transition:r,u_merc_center:o,u_image0:0,u_frustum_tl:a,u_frustum_tr:s,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:h,u_viewport:d,u_grid_matrix:f?Float32Array.from(f):new Float32Array(9),u_skirt_height:p});function wi(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const Mi=new class{constructor(){this.operations={}}newMorphing(e,t,i,n,r){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==i.tileID.key&&(t.queued=i)}else this.operations[e]={startTime:n,phase:0,duration:r,from:t,to:i,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const i=this.operations[t];for(i.phase=(e-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},Ti={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Si(e){return 6*Math.pow(1.5,22-e)}function Ei(e,t){const i=1<<e.z;return!t&&(0===e.x||e.x===i-1)||0===e.y||e.y===i-1}const Ci=e=>({u_matrix:e});function Ai(t,i,n,r,o){if(o>0){const a=e.exported.now(),s=(a-t.timeAdded)/o,l=i?(a-i.timeAdded)/o:-1,c=n.getSource(),u=r.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!i||Math.abs(i.tileID.overscaledZ-u)>Math.abs(t.tileID.overscaledZ-u),d=h&&t.refreshedUponExpiration?1:e.clamp(h?s:1-l,0,1);return t.refreshedUponExpiration&&s>=1&&(t.refreshedUponExpiration=!1),i?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class Pi extends e.SourceCache{constructor(e){const t={type:"raster-dem",maxzoom:e.transform.maxZoom},i=new z(Ge(),null),n=De("mock-dem",t,i,e.style);super("mock-dem",n,!1),n.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class Ii extends e.SourceCache{constructor(e){const t=De("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new z(Ge(),null),e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,i,n){if(t.freezeTileCoverage)return;this.transform=t;const r=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((i,n)=>{if(i[n.key]="",!this._tiles[n.key]){const i=new e.Tile(n,this._source.tileSize*n.overscaleFactor(),t.tileZoom);i.state="loaded",this._tiles[n.key]=i}return i}),{});for(const e in this._tiles)e in r||(this.freeFBO(e),this._tiles[e].unloadVectorData(),delete this._tiles[e])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const i=Object.values(t);this.renderCachePool.push(...i),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach((e=>e.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ki extends e.OverscaledTileID{constructor(e,t,i){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=i}}class zi extends e.Elevation{constructor(t,i){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[n,r,o]=function(t){const i=new e.StructArrayLayout2i4,n=new e.StructArrayLayout3ui6,r=131;i.reserve(17161),n.reserve(33800);const o=e.EXTENT/128,a=e.EXTENT+o/2,s=a+o;for(let t=-o;t<s;t+=o)for(let n=-o;n<s;n+=o){const r=n<0||n>a||t<0||t>a?24575:0,o=e.clamp(Math.round(n),0,e.EXTENT),s=e.clamp(Math.round(t),0,e.EXTENT);i.emplaceBack(o+r,s)}const l=(e,t)=>{const i=t*r+e;n.emplaceBack(i+1,i,i+r),n.emplaceBack(i+r,i+r+1,i+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)l(t,e);return[0,129].forEach((e=>{for(let t=0;t<130;t++)l(t,e),l(e,t)})),[i,n,32768]}(),a=t.context;this.gridBuffer=a.createVertexBuffer(n,e.posAttributes.members),this.gridIndexBuffer=a.createIndexBuffer(r),this.gridSegments=e.SegmentVector.simpleSegment(0,0,n.length,r.length),this.gridNoSkirtSegments=e.SegmentVector.simpleSegment(0,0,n.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ii(i.map),this.orthoMatrix=e.create(),e.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,e.EXTENT,0,e.EXTENT,0,1);const s=a.gl;this._overlapStencilMode=new e.StencilMode({func:s.GEQUAL,mask:255},0,255,s.KEEP,s.KEEP,s.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Pi(i.map)}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),e.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=e,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,i,n){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const r=t.terrain.properties;this.sourceCache=0===t.terrain.drapeRenderMode?this._mockSourceCache:t._getSourceCache(r.get("source")),this._exaggeration=r.get("exaggeration");const o=()=>{this.sourceCache.used&&e.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const t=this.getScaledDemTileSize();this.sourceCache.update(i,t,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,o(),this._initializing=!0),o(),i.updateElevation(!0,n),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==t.efficiency&&e.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._sourceCaches)this._style._sourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((e=>e.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,n=this.painter.transform;this._initializing&&(this._initializing=0===n._centerAltitude&&-1===this.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(n.center),-1),this._emptyDEMTextureDirty=!this._initializing);const r=this.proxyCoords=i.getIds().map((e=>{const t=i.getTileByID(e).tileID;return t.projMatrix=n.calculateProjMatrix(t.toUnwrapped()),t}));!function(t,i){const n=i.transform.pointCoordinate(i.transform.getCameraPoint()),r=new e.pointGeometry(n.x,n.y);t.sort(((t,i)=>{if(i.overscaledZ-t.overscaledZ)return i.overscaledZ-t.overscaledZ;const n=new e.pointGeometry(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),o=new e.pointGeometry(i.canonical.x+(1<<i.canonical.z)*i.wrap,i.canonical.y),a=r.mult(1<<t.canonical.z);return a.x-=.5,a.y-=.5,a.distSqr(n)-a.distSqr(o)}))}(r,this.painter),this._previousZoom=n.zoom;const o=this.proxyToSource||{};this.proxyToSource={},r.forEach((e=>{this.proxyToSource[e.key]={}})),this.terrainTileForTile={};const a=this._style._sourceCaches;for(const e in a){const i=a[e];if(!i.used)continue;if(i!==this.sourceCache&&this.resetTileLookupCache(i.id),this._setupProxiedCoordsForOrtho(i,t[e],o),i.usedForTerrain)continue;const n=t[e];i.getSource().reparseOverscaled&&this._assignTerrainTiles(n)}this.proxiedCoords[i.id]=r.map((e=>new ki(e,e.key,this.orthoMatrix))),this._assignTerrainTiles(r),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1,this._updateTimestamp=e.exported.now();const s={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const i=t.tileID.key;i in s||(this._visibleDemTiles.push(t),s[i]=i)}}_assignTerrainTiles(e){this._initializing||e.forEach((e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)}))}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const i in this.terrainTileForTile){const n=this.terrainTileForTile[i],r=n.dem;!r||n.demTexture&&!n.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),_i(this.painter,n,r))}}_prepareDemTileUniforms(e,t,i,n){if(!t||null==t.demTexture)return!1;const r=e.tileID.canonical,o=Math.pow(2,t.tileID.canonical.z-r.z),a=n||"";return i[`u_dem_tl${a}`]=[r.x*o%1,r.y*o%1],i[`u_dem_scale${a}`]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,i=t.gl;if(!this._emptyDepthBufferTexture){const n=new e.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new e.Texture(t,n,i.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0;const t=this._visibleDemTiles.reduce(((t,i)=>{if(!i.dem)return t;const n=i.dem.tree.minimums[0];return n>0&&e++,t+n}),0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,i=t.gl;t.activeTexture.set(i.TEXTURE2);const n=this._getLoadedAreaMinimum(),r=new e.RGBAImage({width:1,height:1},new Uint8Array(e.DEMData.pack(n,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(r,{premultiply:!1}):o=this._emptyDEMTexture=new e.Texture(t,r,i.RGBA,{premultiply:!1}),o}setupElevationDraw(t,i,n){const r=this.painter.context,o=r.gl,a=(s=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:e.DEMData.getUnpackVector(s),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var s;a.u_dem_size=this.sourceCache.getSource().tileSize,a.u_exaggeration=this.exaggeration();let l=null,c=null,u=1;if(n&&n.morphing&&this._useVertexMorphing){const e=n.morphing.srcDemTile,i=n.morphing.dstDemTile;u=n.morphing.phase,e&&i&&(this._prepareDemTileUniforms(t,e,a,"_prev")&&(c=e),this._prepareDemTileUniforms(t,i,a)&&(l=i))}if(c&&l?(r.activeTexture.set(o.TEXTURE2),l.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),r.activeTexture.set(o.TEXTURE4),c.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),a.u_dem_lerp=u):(l=this.terrainTileForTile[t.tileID.key],r.activeTexture.set(o.TEXTURE2),(this._prepareDemTileUniforms(t,l,a)?l.demTexture:this.emptyDEMTexture).bind(o.NEAREST,o.CLAMP_TO_EDGE)),r.activeTexture.set(o.TEXTURE3),n&&n.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),this._depthFBO&&(a.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),a.u_depth_size_inv=[1,1]),n&&n.useMeterToDem&&l){const t=(1<<l.tileID.canonical.z)*e.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;a.u_meter_to_dem=t}if(n&&n.labelPlaneMatrixInv&&(a.u_label_plane_matrix_inv=n.labelPlaneMatrixInv),i.setTerrainUniformValues(r,a),"globe"===this.painter.transform.projection.name){const e=this.globeUniformValues(this.painter.transform,t.tileID.canonical,n&&n.useDenormalizedUpVectorScale);i.setGlobeUniformValues(r,e)}}globeUniformValues(t,i,n){const r=t.projection;return{u_tile_tl_up:r.upVector(i,0,0),u_tile_tr_up:r.upVector(i,e.EXTENT,0),u_tile_br_up:r.upVector(i,e.EXTENT,e.EXTENT),u_tile_bl_up:r.upVector(i,0,e.EXTENT),u_tile_up_scale:n?e.globeMetersToEcef(1):r.upVectorScale(i,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const i=this.painter,n=this.painter.context;0!==t.length&&(n.bindFramebuffer.set(null),n.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(t,i,n,r,o){if("globe"===t.transform.projection.name)!function(t,i,n,r,o){const a=t.context,s=a.gl;let l,c;const u=t.options.showTerrainWireframe?2:0,h=t.transform,d=e.globeUseCustomAntiAliasing(t,a,h),p=(e,i)=>{if(c===e)return;const n=[Ti[e],"PROJECTION_GLOBE_VIEW"];d&&n.push("CUSTOM_ANTIALIASING"),i&&n.push(Ti[u]),l=t.useProgram("globeRaster",null,n),c=e},f=t.colorModeForRenderPass(),m=new e.DepthMode(s.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);Mi.update(o);const g=e.calculateGlobeMercatorMatrix(h),_=[e.mercatorXfromLng(h.center.lng),e.mercatorYfromLat(h.center.lat)],y=u?[!1,!0]:[!1],x=t.globeSharedBuffers,v=[h.width*e.exported.devicePixelRatio,h.height*e.exported.devicePixelRatio],b=Float32Array.from(h.globeMatrix),w={useDenormalizedUpVectorScale:!0};if(y.forEach((u=>{const h=t.transform,d=Si(h.zoom)*i.exaggeration();c=-1;const y=u?s.LINES:s.TRIANGLES;for(const c of r){const r=n.getTile(c),M=e.StencilMode.disabled,T=i.prevTerrainTileForTile[c.key],S=i.terrainTileForTile[c.key];wi(T,S)&&Mi.newMorphing(c.key,T,S,o,250),a.activeTexture.set(s.TEXTURE0),r.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const E=Mi.getMorphValuesForProxy(c.key),C=E?1:0;E&&e.extend$1(w,{morphing:{srcDemTile:E.from,dstDemTile:E.to,phase:e.easeCubicInOut(E.phase)}});const A=e.tileCornersToBounds(c.canonical),P=e.getLatitudinalLod(A.getCenter().lat),I=e.getGridMatrix(c.canonical,A,P,h.worldSize/h._pixelsPerMercatorPixel),k=e.globeNormalizeECEF(e.globeTileBounds(c.canonical)),z=bi(h.projMatrix,b,g,k,e.globeToMercatorTransition(h.zoom),_,h.frustumCorners.TL,h.frustumCorners.TR,h.frustumCorners.BR,h.frustumCorners.BL,h.globeCenterInViewSpace,h.globeRadius,v,d,I);if(p(C,u),i.setupElevationDraw(r,l,w),t.prepareDrawProgram(a,l,c.toUnwrapped()),x){const[i,n,r]=u?x.getWirefameBuffers(t.context,P):x.getGridBuffers(P,0!==d);l.draw(a,y,m,M,f,e.CullFaceMode.backCCW,z,"globe_raster",i,n,r)}}})),x){const o=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];d&&o.push("CUSTOM_ANTIALIASING"),l=t.useProgram("globeRaster",null,o);for(const o of r){const{x:r,y:c,z:u}=o.canonical,d=0===c,p=c===(1<<u)-1,[g,y,b,M]=x.getPoleBuffers(u);if(M&&(d||p)){const c=n.getTile(o);a.activeTexture.set(s.TEXTURE0),c.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);let x=e.globePoleMatrixForTile(u,r,h);const T=e.globeNormalizeECEF(e.globeTileBounds(o.canonical)),S=(t,i)=>t.draw(a,s.TRIANGLES,m,e.StencilMode.disabled,f,e.CullFaceMode.disabled,bi(h.projMatrix,x,x,T,0,_,h.frustumCorners.TL,h.frustumCorners.TR,h.frustumCorners.BR,h.frustumCorners.BL,h.globeCenterInViewSpace,h.globeRadius,v,0),"globe_pole_raster",i,b,M);i.setupElevationDraw(c,l,w),t.prepareDrawProgram(a,l,o.toUnwrapped()),d&&S(l,g),p&&(x=e.scale(e.create(),x,[1,-1,1]),S(l,y))}}}}(t,i,n,r,o);else{const a=t.context,s=a.gl;let l,c;const u=t.options.showTerrainWireframe?2:0,h=(e,i)=>{if(c===e)return;const n=[Ti[e]];i&&n.push(Ti[u]),l=t.useProgram("terrainRaster",null,n),c=e},d=t.colorModeForRenderPass(),p=new e.DepthMode(s.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);Mi.update(o);const f=t.transform,m=Si(f.zoom)*i.exaggeration();(u?[!1,!0]:[!1]).forEach((u=>{c=-1;const g=u?s.LINES:s.TRIANGLES,[_,y]=u?i.getWirefameBuffer():[i.gridIndexBuffer,i.gridSegments];for(const c of r){const r=n.getTile(c),x=e.StencilMode.disabled,v=i.prevTerrainTileForTile[c.key],b=i.terrainTileForTile[c.key];wi(v,b)&&Mi.newMorphing(c.key,v,b,o,250),a.activeTexture.set(s.TEXTURE0),r.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST);const w=Mi.getMorphValuesForProxy(c.key),M=w?1:0;let T;w&&(T={morphing:{srcDemTile:w.from,dstDemTile:w.to,phase:e.easeCubicInOut(w.phase)}});const S=vi(c.projMatrix,Ei(c.canonical,f.renderWorldCopies)?m/10:m);h(M,u),i.setupElevationDraw(r,l,T),t.prepareDrawProgram(a,l,c.toUnwrapped()),l.draw(a,g,p,x,d,e.CullFaceMode.backCCW,S,"terrain_raster",i.gridBuffer,_,y)}}))}}(i,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const i=this.painter,n=this.painter.context,r=this.proxySourceCache,o=this.proxiedCoords[r.id],a=this._drapedRenderBatches.shift(),s=[],l=i.style.order;let c=0;for(const u of o){const o=r.getTileByID(u.proxyTileKey),h=r.proxyCachedFBO[u.key]?r.proxyCachedFBO[u.key][t]:void 0,d=void 0!==h?r.renderCache[h]:this.pool[c++],p=void 0!==h;if(o.texture=d.tex,p&&!d.dirty){s.push(o.tileID);continue}let f;n.bindFramebuffer.set(d.fb.framebuffer),this.renderedToTile=!1,d.dirty&&(n.clear({color:e.Color.transparent,stencil:0}),d.dirty=!1);for(let e=a.start;e<=a.end;++e){const t=i.style._layers[l[e]];if(t.isHidden(i.transform.zoom))continue;const r=i.style._getLayerSourceCache(t),o=r?this.proxyToSource[u.key][r.id]:[u];if(!o)continue;const a=o;n.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(r?r.id:null)&&(this._setupStencil(d,o,t,r),f=r?r.id:null),i.renderLayer(i,r,t,a)}this.renderedToTile?(d.dirty=!0,s.push(o.tileID)):p||--c,5===c&&(c=0,this.renderToBackBuffer(s))}return this.renderToBackBuffer(s),this.renderingToTexture=!1,n.bindFramebuffer.set(null),n.viewport.set([0,0,i.width,i.height]),a.end+1}postRender(){}renderCacheEfficiency(e){const t=e.order.length;if(0===t)return{efficiency:100};let i,n=0,r=0,o=!1;for(let a=0;a<t;++a){const t=e._layers[e.order[a]];this._style.isLayerDraped(t)?(o&&++n,++r):o||(o=!0,i=t.id)}return 0===r?{efficiency:100}:{efficiency:100*(1-n/r),firstUndrapedLayer:i}}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter((e=>e.dem)).forEach((t=>{e=Math.min(e,t.dem.tree.minimums[0])})),0===e?e:(e-30)*this._exaggeration}raycast(e,t,i){if(!this._visibleDemTiles)return null;const n=this._visibleDemTiles.filter((e=>e.dem)).map((n=>{const r=n.tileID,o=1<<r.overscaledZ,{x:a,y:s}=r.canonical,l=a/o,c=(a+1)/o,u=s/o,h=(s+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:n.dem.tree.raycastRoot(l,u,c,h,e,t,i),tile:n}}));n.sort(((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)));for(const r of n){if(null==r.t)return null;const n=r.tile.dem.tree.raycast(r.minx,r.miny,r.maxx,r.maxy,e,t,i);if(null!=n)return n}return null}_createFBO(){const t=this.painter.context,i=t.gl,n=this.drapeBufferSize;t.activeTexture.set(i.TEXTURE0);const r=new e.Texture(t,{width:n[0],height:n[1],data:null},i.RGBA);r.bind(i.LINEAR,i.CLAMP_TO_EDGE);const o=t.createFramebuffer(n[0],n[1],!1);return o.colorAttachment.set(r.texture),o.depthAttachment=new Te(t,o.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,n[0],n[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&i.texParameterf(i.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:o,tex:r,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const e in this._style._sourceCaches)if(this._style._sourceCaches[e].hasTransition())return!0;return this._style.order.some((e=>{const t=this._style._layers[e],i=t.isHidden(this.painter.transform.zoom);return"custom"===t.type?!i&&t.shouldRedrape():!i&&t.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const e of this._style._getSources())if(e instanceof Ce){t=!0;break}if(!t)return;const i={};for(let t=0;t<this._style.order.length;++t){const n=this._style._layers[this._style.order[t]],r=this._style._getLayerSourceCache(n);if(r&&!i[r.id]&&!n.isHidden(this.painter.transform.zoom)&&"line"===n.type&&n.widthExpression()instanceof e.ZoomDependentExpression){i[r.id]=!0;for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][r.id];if(t)for(const e of t)this._clearRenderCacheForTile(r.id,e)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t]._source instanceof Ae){e=!0;break}if(!e)return;const t={};for(let e=0;e<this._style.order.length;++e){const i=this._style._layers[this._style.order[e]],n=this._style._getLayerSourceCache(i);if(!n||t[n.id])continue;if(i.isHidden(this.painter.transform.zoom)||"raster"!==i.type)continue;const r=i.paint.get("raster-fade-duration");for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][n.id];if(t)for(const e of t){const t=Ai(n.getTile(e),n.findLoadedParent(e,0),n,this.painter.transform,r);(1!==t.opacity||0!==t.mix)&&this._clearRenderCacheForTile(n.id,e)}}}}_setupDrapedRenderBatches(){const e=this._style.order,t=e.length;if(0===t)return;const i=[];let n,r=0,o=this._style._layers[e[r]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++r<t;)o=this._style._layers[e[r]];for(;r<t;++r){const t=this._style._layers[e[r]];t.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(t)?void 0===n&&(n=r):void 0!==n&&(i.push({start:n,end:r-1}),n=void 0))}void 0!==n&&i.push({start:n,end:r-1}),this._drapedRenderBatches=i}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let i=0;i<e.length;++i){const n=Object.values(e[i]);t.renderCachePool.push(...n)}}return}this._clearRasterLayersFromRenderCache();const i=this.proxyCoords,n=this._tilesDirty;for(let r=i.length-1;r>=0;r--){const o=i[r];if(t.getTileByID(o.key),void 0!==t.proxyCachedFBO[o.key]){const i=e[o.key],r=this.proxyToSource[o.key];let a=0;for(const e in r){const t=r[e],o=i[e];if(!o||o.length!==t.length||t.some(((t,i)=>t!==o[i]||n[e]&&n[e].hasOwnProperty(t.key)))){a=-1;break}++a}for(const e in t.proxyCachedFBO[o.key])t.renderCache[t.proxyCachedFBO[o.key][e]].dirty=a<0||a!==Object.values(i).length}}const r=[...this._drapedRenderBatches];r.sort(((e,t)=>t.end-t.start-(e.end-e.start)));for(const e of r)for(const n of i){if(t.proxyCachedFBO[n.key])continue;let i=t.renderCachePool.pop();void 0===i&&t.renderCache.length<50&&(i=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==i&&(t.proxyCachedFBO[n.key]={},t.proxyCachedFBO[n.key][e.start]=i,t.renderCache[i].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,i,n){if(!n||!this._sourceTilesOverlap[n.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const r=this.painter.context,o=r.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let a;if(i.isTileClipped())a=t.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);a=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+a>255&&(r.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=a,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):e.StencilMode.disabled}_renderTileClippingMasks(t,i){const n=this.painter,r=this.painter.context,o=r.gl;n._tileClippingMaskIDs={},r.setColorMode(e.ColorMode.disabled),r.setDepthMode(e.DepthMode.disabled);const a=n.useProgram("clippingMask");for(const s of t){const t=n._tileClippingMaskIDs[s.key]=--i;a.draw(r,o.TRIANGLES,e.DepthMode.disabled,new e.StencilMode({func:o.ALWAYS,mask:0},t,255,o.KEEP,o.KEEP,o.REPLACE),e.ColorMode.disabled,e.CullFaceMode.disabled,Ci(s.projMatrix),"$clipping",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}pointCoordinate(t){const i=this.painter.transform;if(t.x<0||t.x>i.width||t.y<0||t.y>i.height)return null;const n=[t.x,t.y,1,1];e.transformMat4$1(n,n,i.pixelMatrixInverse),e.scale$1(n,n,1/n[3]),n[0]/=i.worldSize,n[1]/=i.worldSize;const r=i._camera.position,o=e.mercatorZfromAltitude(1,i.center.lat),a=[r[0],r[1],r[2]/o,0],s=e.subtract([],n.slice(0,3),a);e.normalize(s,s);const l=this.raycast(a,s,this._exaggeration);return null!==l&&l?(e.scaleAndAdd(a,a,s,l),a[3]=a[2],a[2]*=o,a):null}drawDepth(){const t=this.painter,i=t.context,n=this.proxySourceCache,r=Math.ceil(t.width),o=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===r&&this._depthFBO.height===o||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const t=i.gl,n=i.createFramebuffer(r,o,!0);i.activeTexture.set(t.TEXTURE0);const a=new e.Texture(i,{width:r,height:o,data:null},t.RGBA);a.bind(t.NEAREST,t.CLAMP_TO_EDGE),n.colorAttachment.set(a.texture);const s=i.createRenderbuffer(i.gl.DEPTH_COMPONENT16,r,o);n.depthAttachment.set(s),this._depthFBO=n,this._depthTexture=a}i.bindFramebuffer.set(this._depthFBO.framebuffer),i.viewport.set([0,0,r,o]),function(t,i,n,r){if("globe"===t.transform.projection.name)return;const o=t.context,a=o.gl;o.clear({depth:1});const s=t.useProgram("terrainDepth"),l=new e.DepthMode(a.LESS,e.DepthMode.ReadWrite,t.depthRangeFor3D);for(const t of r){const r=n.getTile(t),c=vi(t.projMatrix,0);i.setupElevationDraw(r,s),s.draw(o,a.TRIANGLES,l,e.StencilMode.disabled,e.ColorMode.unblended,e.CullFaceMode.backCCW,c,"terrain_depth",i.gridBuffer,i.gridIndexBuffer,i.gridNoSkirtSegments)}}(t,this,n,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,t,i){if(e.getSource()instanceof ke)return this._setupProxiedCoordsForImageSource(e,t,i);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const n=this.proxiedCoords[e.id]=[],r=this.proxyCoords;for(let t=0;t<r.length;t++){const o=r[t],a=this._findTileCoveringTileID(o,e);if(a){const t=this._createProxiedId(o,a,i[o.key]&&i[o.key][e.id]);n.push(t),this.proxyToSource[o.key][e.id]=[t]}}let o=!1;for(let r=0;r<t.length;r++){const a=e.getTile(t[r]);if(!a||!a.hasData())continue;const s=this._findTileCoveringTileID(a.tileID,this.proxySourceCache);if(s&&s.tileID.canonical.z!==a.tileID.canonical.z){const t=this.proxyToSource[s.tileID.key][e.id],r=this._createProxiedId(s.tileID,a,i[s.tileID.key]&&i[s.tileID.key][e.id]);t?t.splice(t.length-1,0,r):this.proxyToSource[s.tileID.key][e.id]=[r],n.push(r),o=!0}}this._sourceTilesOverlap[e.id]=o}_setupProxiedCoordsForImageSource(t,i,n){if(!t.getSource().loaded())return;const r=this.proxiedCoords[t.id]=[],o=this.proxyCoords,a=t.getSource(),s=new e.pointGeometry(a.tileID.x,a.tileID.y)._div(1<<a.tileID.z),l=a.coordinates.map(e.MercatorCoordinate.fromLngLat).reduce(((e,t)=>(e.min.x=Math.min(e.min.x,t.x-s.x),e.min.y=Math.min(e.min.y,t.y-s.y),e.max.x=Math.max(e.max.x,t.x-s.x),e.max.y=Math.max(e.max.y,t.y-s.y),e)),{min:new e.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(t,i)=>{const n=t.wrap+t.canonical.x/(1<<t.canonical.z),r=t.canonical.y/(1<<t.canonical.z),o=e.EXTENT/(1<<t.canonical.z),a=i.wrap+i.canonical.x/(1<<i.canonical.z),s=i.canonical.y/(1<<i.canonical.z);return n+o<a+l.min.x||n>a+l.max.x||r+o<s+l.min.y||r>s+l.max.y};for(let e=0;e<o.length;e++){const a=o[e];for(let e=0;e<i.length;e++){const o=t.getTile(i[e]);if(!o||!o.hasData())continue;if(c(a,o.tileID))continue;const s=this._createProxiedId(a,o,n[a.key]&&n[a.key][t.id]),l=this.proxyToSource[a.key][t.id];l?l.push(s):this.proxyToSource[a.key][t.id]=[s],r.push(s)}}}_createProxiedId(t,i,n){let r=this.orthoMatrix;if(n){const e=n.find((e=>e.key===i.tileID.key));if(e)return e}if(i.tileID.key!==t.key){const n=t.canonical.z-i.tileID.canonical.z;let o,a,s;r=e.create();const l=i.tileID.wrap-t.wrap<<t.overscaledZ;n>0?(o=e.EXTENT>>n,a=o*((i.tileID.canonical.x<<n)-t.canonical.x+l),s=o*((i.tileID.canonical.y<<n)-t.canonical.y)):(o=e.EXTENT<<-n,a=e.EXTENT*(i.tileID.canonical.x-(t.canonical.x+l<<-n)),s=e.EXTENT*(i.tileID.canonical.y-(t.canonical.y<<-n))),e.ortho(r,0,o,0,o,0,1),e.translate(r,r,[a,s,0])}return new ki(i.tileID,t.key,r)}_findTileCoveringTileID(t,i){let n=i.getTile(t);if(n&&n.hasData())return n;const r=this._findCoveringTileCache[i.id],o=r[t.key];if(n=o?i.getTileByID(o):null,n&&n.hasData()||null===o)return n;let a=n?n.tileID:t,s=a.overscaledZ;const l=i.getSource().minzoom,c=[];if(!o){const r=i.getSource().maxzoom;if(t.canonical.z>=r){const n=t.canonical.z-r;i.getSource().reparseOverscaled?(s=Math.max(t.canonical.z+2,i.transform.tileZoom),a=new e.OverscaledTileID(s,t.wrap,r,t.canonical.x>>n,t.canonical.y>>n)):0!==n&&(s=r,a=new e.OverscaledTileID(s,t.wrap,r,t.canonical.x>>n,t.canonical.y>>n))}a.key!==t.key&&(c.push(a.key),n=i.getTile(a))}const u=e=>{c.forEach((t=>{r[t]=e})),c.length=0};for(s-=1;s>=l&&(!n||!n.hasData());s--){n&&u(n.tileID.key);const e=a.calculateScaledKey(s);if(n=i.getTileByID(e),n&&n.hasData())break;const t=r[e];if(null===t)break;void 0===t?c.push(e):n=i.getTileByID(t)}return u(n?n.tileID.key:null),n&&n.hasData()?n:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let i=this._tilesDirty[e];i||(i=this._tilesDirty[e]={}),i[t.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(t){let i=0;const n=new e.StructArrayLayout2ui4,r=131;for(let e=1;e<129;e++){for(let t=1;t<129;t++)i=e*r+t,n.emplaceBack(i,i+1),n.emplaceBack(i,i+r),n.emplaceBack(i+1,i+r),128===e&&n.emplaceBack(i+r,i+r+1);n.emplaceBack(i+1,i+1+r)}return n}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=e.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Di{static cacheKey(e,t,i,n){let r=`${t}${n?n.cacheKey:""}`;for(const t of i)e.usedDefines.includes(t)&&(r+=`/${t}`);return r}constructor(t,i,n,r,o,a){const s=t.gl;this.program=s.createProgram();const l=function(e){const t=[];for(let i=0;i<e.length;i++){if(null===e[i])continue;const n=e[i].split(" ");t.push(n.pop())}return t}(n.staticAttributes),c=r?r.getBinderAttributes():[],u=l.concat(c);let h=r?r.defines():[];h=h.concat(a.map((e=>`#define ${e}`)));const d=t.isWebGL2?"#version 300 es\n":"",p=d+h.concat(t.extStandardDerivatives&&0===d.length?"#extension GL_OES_standard_derivatives : enable\n".concat(ui):ui,ui,ci,li.fragmentSource,ai.fragmentSource,n.fragmentSource).join("\n"),f=d+h.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ci,li.vertexSource,ai.vertexSource,oi.vertexSource,n.vertexSource).join("\n"),m=s.createShader(s.FRAGMENT_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);s.shaderSource(m,p),s.compileShader(m),s.attachShader(this.program,m);const g=s.createShader(s.VERTEX_SHADER);if(s.isContextLost())this.failedToCreate=!0;else{s.shaderSource(g,f),s.compileShader(g),s.attachShader(this.program,g),this.attributes={},this.numAttributes=u.length;for(let e=0;e<this.numAttributes;e++)u[e]&&(s.bindAttribLocation(this.program,e,u[e]),this.attributes[u[e]]=e);s.linkProgram(this.program),s.deleteShader(g),s.deleteShader(m),this.fixedUniforms=o(t),this.binderUniforms=r?r.getUniforms(t):[],a.includes("TERRAIN")&&(this.terrainUniforms=(t=>({u_dem:new e.Uniform1i(t),u_dem_prev:new e.Uniform1i(t),u_dem_unpack:new e.Uniform4f(t),u_dem_tl:new e.Uniform2f(t),u_dem_scale:new e.Uniform1f(t),u_dem_tl_prev:new e.Uniform2f(t),u_dem_scale_prev:new e.Uniform1f(t),u_dem_size:new e.Uniform1f(t),u_dem_lerp:new e.Uniform1f(t),u_exaggeration:new e.Uniform1f(t),u_depth:new e.Uniform1i(t),u_depth_size_inv:new e.Uniform2f(t),u_meter_to_dem:new e.Uniform1f(t),u_label_plane_matrix_inv:new e.UniformMatrix4f(t)}))(t)),a.includes("GLOBE")&&(this.globeUniforms=(t=>({u_tile_tl_up:new e.Uniform3f(t),u_tile_tr_up:new e.Uniform3f(t),u_tile_br_up:new e.Uniform3f(t),u_tile_bl_up:new e.Uniform3f(t),u_tile_up_scale:new e.Uniform1f(t)}))(t)),a.includes("FOG")&&(this.fogUniforms=(t=>({u_fog_matrix:new e.UniformMatrix4f(t),u_fog_range:new e.Uniform2f(t),u_fog_color:new e.Uniform4f(t),u_fog_horizon_blend:new e.Uniform1f(t),u_fog_temporal_offset:new e.Uniform1f(t),u_frustum_tl:new e.Uniform3f(t),u_frustum_tr:new e.Uniform3f(t),u_frustum_br:new e.Uniform3f(t),u_frustum_bl:new e.Uniform3f(t),u_globe_pos:new e.Uniform3f(t),u_globe_radius:new e.Uniform1f(t),u_globe_transition:new e.Uniform1f(t),u_is_globe:new e.Uniform1i(t),u_viewport:new e.Uniform2f(t)}))(t))}}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e]&&i[e].set(this.program,e,t[e])}}setGlobeUniformValues(e,t){if(!this.globeUniforms)return;const i=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e]&&i[e].set(this.program,e,t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e])}}draw(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f){const m=e.gl;if(this.failedToCreate)return;e.program.set(this.program),e.setDepthMode(i),e.setStencilMode(n),e.setColorMode(r),e.setCullFace(o);for(const e of Object.keys(this.fixedUniforms))this.fixedUniforms[e].set(this.program,e,a[e]);p&&p.setUniforms(this.program,e,this.binderUniforms,h,{zoom:d});const g={[m.LINES]:2,[m.TRIANGLES]:3,[m.LINE_STRIP]:1}[t];for(const i of u.get()){const n=i.vaos||(i.vaos={});(n[s]||(n[s]=new fi)).bind(e,this,l,p?p.getPaintVertexBuffers():[],c,i.vertexOffset,f||[]),m.drawElements(t,i.primitiveLength*g,m.UNSIGNED_SHORT,i.primitiveOffset*g*2)}}}function Li(e,t){const i=Math.pow(2,t.tileID.overscaledZ),n=t.tileSize*Math.pow(2,e.transform.tileZoom)/i,r=n*(t.tileID.canonical.x+t.tileID.wrap*i),o=n*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture.size,u_tile_units_to_pixels:1/D(t,1,e.transform.tileZoom),u_pixel_coord_upper:[r>>16,o>>16],u_pixel_coord_lower:[65535&r,65535&o]}}const Ri=e.create(),Oi=(t,i,n,r,o,a,s,l,c,u,h)=>{const d=i.style.light,p=d.properties.get("position"),f=[p.x,p.y,p.z],m=e.create$1();"viewport"===d.properties.get("anchor")&&(e.fromRotation(m,-i.transform.angle),e.transformMat3(f,f,m));const g=d.properties.get("color"),_=i.transform,y={u_matrix:t,u_lightpos:f,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[g.r,g.g,g.b],u_vertical_gradient:+n,u_opacity:r,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ri,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:o,u_edge_radius:a};return"globe"===_.projection.name&&(y.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],y.u_zoom_transition=c,y.u_inv_rot_matrix=h,y.u_merc_center=u,y.u_up_dir=_.projection.upVector(new e.CanonicalTileID(0,0,0),u[0]*e.EXTENT,u[1]*e.EXTENT),y.u_height_lift=l),y},Bi=(t,i,n,r,o,a,s,l,c,u,h,d)=>{const p=Oi(t,i,n,r,o,a,s,c,u,h,d),f={u_height_factor:-Math.pow(2,s.overscaledZ)/l.tileSize/8};return e.extend(p,Li(i,l),f)},Fi=e=>({u_matrix:e}),Ni=(t,i,n)=>e.extend(Fi(t),Li(i,n)),Ui=(e,t)=>({u_matrix:e,u_world:t}),Vi=(t,i,n,r)=>e.extend(Ni(t,i,n),{u_world:r}),Gi=e.create(),ji=(t,i,n,r,o,a)=>{const s=t.transform,l="globe"===s.projection.name;let c;if("map"===a.paint.get("circle-pitch-alignment"))if(l){const t=e.globePixelsToTileUnits(s.zoom,i.canonical)*s._pixelsPerMercatorPixel;c=Float32Array.from([t,0,0,t])}else c=s.calculatePixelsToTileUnitsMatrix(n);else c=new Float32Array([s.pixelsToGLUnits[0],0,0,s.pixelsToGLUnits[1]]);const u={u_camera_to_center_distance:s.cameraToCenterDistance,u_matrix:t.translatePosMatrix(i.projMatrix,n,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_device_pixel_ratio:e.exported.devicePixelRatio,u_extrude_scale:c,u_inv_rot_matrix:Gi,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(l){u.u_inv_rot_matrix=r,u.u_merc_center=o,u.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],u.u_zoom_transition=e.globeToMercatorTransition(s.zoom);const t=o[0]*e.EXTENT,n=o[1]*e.EXTENT;u.u_up_dir=s.projection.upVector(new e.CanonicalTileID(0,0,0),t,n)}return u},Wi=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t},$i=(t,i,n,r)=>{const o=e.EXTENT/n.tileSize;return{u_matrix:t,u_camera_to_center_distance:i.getCameraToCenterDistance(r),u_extrude_scale:[i.pixelsToGLUnits[0]/o,i.pixelsToGLUnits[1]/o]}},qi=(e,t,i=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:i}),Zi=e.create(),Hi=(t,i,n,r,o,a,s)=>{const l=t.transform,c="globe"===l.projection.name,u=c?e.globePixelsToTileUnits(l.zoom,i.canonical)*l._pixelsPerMercatorPixel:D(n,1,a),h={u_matrix:i.projMatrix,u_extrude_scale:u,u_intensity:s,u_inv_rot_matrix:Zi,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){h.u_inv_rot_matrix=r,h.u_merc_center=o,h.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],h.u_zoom_transition=e.globeToMercatorTransition(l.zoom);const t=o[0]*e.EXTENT,n=o[1]*e.EXTENT;h.u_up_dir=l.projection.upVector(new e.CanonicalTileID(0,0,0),t,n)}return h},Xi=(e,t,i,n,r,o,a)=>{const s=e.transform,l=s.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:Ki(e,t,i,n),u_pixels_to_tile_units:l,u_device_pixel_ratio:o,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:r,u_texsize:Qi(i)?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Ji(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:a}},Yi=(e,t,i,n,r)=>{const o=e.transform;return{u_matrix:Ki(e,t,i,n),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:o.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:r,u_image:0,u_tile_units_to_pixels:Ji(t,o),u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Ji(e,t){return 1/D(e,1,t.tileZoom)}function Ki(e,t,i,n){return e.translatePosMatrix(n||t.tileID.projMatrix,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}function Qi(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const en=(e,t,i,n,r,o)=>{return{u_matrix:e,u_tl_parent:t,u_scale_parent:i,u_fade_t:n.mix,u_opacity:n.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(s=r.paint.get("raster-saturation"),s>0?1-1/(1.001-s):-s),u_contrast_factor:(a=r.paint.get("raster-contrast"),a>0?1/(1-a):1+a),u_spin_weights:tn(r.paint.get("raster-hue-rotate")),u_perspective_transform:o};var a,s};function tn(e){e*=Math.PI/180;const t=Math.sin(e),i=Math.cos(e);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}const nn=e.create(),rn=(t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,g)=>{const _=o.transform,y={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:_.cameraToCenterDistance,u_rotate_symbol:+n,u_aspect_ratio:_.width/_.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:s,u_coord_matrix:l,u_is_text:+c,u_pitch_with_map:+r,u_texsize:u,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:nn,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:nn,u_up_vector:[0,-1,0]};return"globe"===g.name&&(y.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],y.u_zoom_transition=d,y.u_inv_rot_matrix=f,y.u_merc_center=p,y.u_camera_forward=_._camera.forward(),y.u_ecef_origin=e.globeECEFOrigin(_.globeMatrix,h.toUnwrapped()),y.u_tile_matrix=Float32Array.from(_.globeMatrix),y.u_up_vector=m),y},on=(t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,g,_)=>e.extend(rn(t,i,n,r,o,a,s,l,c,u,d,p,f,m,g,_),{u_gamma_scale:r?o.transform.cameraToCenterDistance*Math.cos(o.terrain?0:o.transform._pitch):1,u_device_pixel_ratio:e.exported.devicePixelRatio,u_is_halo:+h}),an=(t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,g)=>e.extend(on(t,i,n,r,o,a,s,l,!0,c,!0,h,d,p,f,m,g),{u_texsize_icon:u,u_texture_icon:1}),sn=(e,t,i)=>({u_matrix:e,u_opacity:t,u_color:i}),ln=(t,i,n,r,o)=>e.extend(function(e,t,i){const n=t.imageManager.getPattern(e.toString()),{width:r,height:o}=t.imageManager.getPixelSize(),a=Math.pow(2,i.tileID.overscaledZ),s=i.tileSize*Math.pow(2,t.transform.tileZoom)/a,l=s*(i.tileID.canonical.x+i.tileID.wrap*a),c=s*i.tileID.canonical.y;return{u_image:0,u_pattern_tl:n.tl,u_pattern_br:n.br,u_texsize:[r,o],u_pattern_size:n.displaySize,u_tile_units_to_pixels:1/D(i,1,t.transform.tileZoom),u_pixel_coord_upper:[l>>16,c>>16],u_pixel_coord_lower:[65535&l,65535&c]}}(r,n,o),{u_matrix:t,u_opacity:i}),cn={fillExtrusion:t=>({u_matrix:new e.UniformMatrix4f(t),u_lightpos:new e.Uniform3f(t),u_lightintensity:new e.Uniform1f(t),u_lightcolor:new e.Uniform3f(t),u_vertical_gradient:new e.Uniform1f(t),u_opacity:new e.Uniform1f(t),u_edge_radius:new e.Uniform1f(t),u_ao:new e.Uniform2f(t),u_tile_id:new e.Uniform3f(t),u_zoom_transition:new e.Uniform1f(t),u_inv_rot_matrix:new e.UniformMatrix4f(t),u_merc_center:new e.Uniform2f(t),u_up_dir:new e.Uniform3f(t),u_height_lift:new e.Uniform1f(t)}),fillExtrusionPattern:t=>({u_matrix:new e.UniformMatrix4f(t),u_lightpos:new e.Uniform3f(t),u_lightintensity:new e.Uniform1f(t),u_lightcolor:new e.Uniform3f(t),u_vertical_gradient:new e.Uniform1f(t),u_height_factor:new e.Uniform1f(t),u_edge_radius:new e.Uniform1f(t),u_ao:new e.Uniform2f(t),u_tile_id:new e.Uniform3f(t),u_zoom_transition:new e.Uniform1f(t),u_inv_rot_matrix:new e.UniformMatrix4f(t),u_merc_center:new e.Uniform2f(t),u_up_dir:new e.Uniform3f(t),u_height_lift:new e.Uniform1f(t),u_image:new e.Uniform1i(t),u_texsize:new e.Uniform2f(t),u_pixel_coord_upper:new e.Uniform2f(t),u_pixel_coord_lower:new e.Uniform2f(t),u_tile_units_to_pixels:new e.Uniform1f(t),u_opacity:new e.Uniform1f(t)}),fill:t=>({u_matrix:new e.UniformMatrix4f(t)}),fillPattern:t=>({u_matrix:new e.UniformMatrix4f(t),u_image:new e.Uniform1i(t),u_texsize:new e.Uniform2f(t),u_pixel_coord_upper:new e.Uniform2f(t),u_pixel_coord_lower:new e.Uniform2f(t),u_tile_units_to_pixels:new e.Uniform1f(t)}),fillOutline:t=>({u_matrix:new e.UniformMatrix4f(t),u_world:new e.Uniform2f(t)}),fillOutlinePattern:t=>({u_matrix:new e.UniformMatrix4f(t),u_world:new e.Uniform2f(t),u_image:new e.Uniform1i(t),u_texsize:new e.Uniform2f(t),u_pixel_coord_upper:new e.Uniform2f(t),u_pixel_coord_lower:new e.Uniform2f(t),u_tile_units_to_pixels:new e.Uniform1f(t)}),circle:t=>({u_camera_to_center_distance:new e.Uniform1f(t),u_extrude_scale:new e.UniformMatrix2f(t),u_device_pixel_ratio:new e.Uniform1f(t),u_matrix:new e.UniformMatrix4f(t),u_inv_rot_matrix:new e.UniformMatrix4f(t),u_merc_center:new e.Uniform2f(t),u_tile_id:new e.Uniform3f(t),u_zoom_transition:new e.Uniform1f(t),u_up_dir:new e.Uniform3f(t)}),collisionBox:t=>({u_matrix:new e.UniformMatrix4f(t),u_camera_to_center_distance:new e.Uniform1f(t),u_extrude_scale:new e.Uniform2f(t)}),collisionCircle:t=>({u_matrix:new e.UniformMatrix4f(t),u_inv_matrix:new e.UniformMatrix4f(t),u_camera_to_center_distance:new e.Uniform1f(t),u_viewport_size:new e.Uniform2f(t)}),debug:t=>({u_color:new e.UniformColor(t),u_matrix:new e.UniformMatrix4f(t),u_overlay:new e.Uniform1i(t),u_overlay_scale:new e.Uniform1f(t)}),clippingMask:t=>({u_matrix:new e.UniformMatrix4f(t)}),heatmap:t=>({u_extrude_scale:new e.Uniform1f(t),u_intensity:new e.Uniform1f(t),u_matrix:new e.UniformMatrix4f(t),u_inv_rot_matrix:new e.UniformMatrix4f(t),u_merc_center:new e.Uniform2f(t),u_tile_id:new e.Uniform3f(t),u_zoom_transition:new e.Uniform1f(t),u_up_dir:new e.Uniform3f(t)}),heatmapTexture:t=>({u_image:new e.Uniform1i(t),u_color_ramp:new e.Uniform1i(t),u_opacity:new e.Uniform1f(t)}),hillshade:t=>({u_matrix:new e.UniformMatrix4f(t),u_image:new e.Uniform1i(t),u_latrange:new e.Uniform2f(t),u_light:new e.Uniform2f(t),u_shadow:new e.UniformColor(t),u_highlight:new e.UniformColor(t),u_accent:new e.UniformColor(t)}),hillshadePrepare:t=>({u_matrix:new e.UniformMatrix4f(t),u_image:new e.Uniform1i(t),u_dimension:new e.Uniform2f(t),u_zoom:new e.Uniform1f(t),u_unpack:new e.Uniform4f(t)}),line:t=>({u_matrix:new e.UniformMatrix4f(t),u_pixels_to_tile_units:new e.UniformMatrix2f(t),u_device_pixel_ratio:new e.Uniform1f(t),u_units_to_pixels:new e.Uniform2f(t),u_dash_image:new e.Uniform1i(t),u_gradient_image:new e.Uniform1i(t),u_image_height:new e.Uniform1f(t),u_texsize:new e.Uniform2f(t),u_tile_units_to_pixels:new e.Uniform1f(t),u_alpha_discard_threshold:new e.Uniform1f(t),u_trim_offset:new e.Uniform2f(t)}),linePattern:t=>({u_matrix:new e.UniformMatrix4f(t),u_texsize:new e.Uniform2f(t),u_pixels_to_tile_units:new e.UniformMatrix2f(t),u_device_pixel_ratio:new e.Uniform1f(t),u_image:new e.Uniform1i(t),u_units_to_pixels:new e.Uniform2f(t),u_tile_units_to_pixels:new e.Uniform1f(t),u_alpha_discard_threshold:new e.Uniform1f(t)}),raster:t=>({u_matrix:new e.UniformMatrix4f(t),u_tl_parent:new e.Uniform2f(t),u_scale_parent:new e.Uniform1f(t),u_fade_t:new e.Uniform1f(t),u_opacity:new e.Uniform1f(t),u_image0:new e.Uniform1i(t),u_image1:new e.Uniform1i(t),u_brightness_low:new e.Uniform1f(t),u_brightness_high:new e.Uniform1f(t),u_saturation_factor:new e.Uniform1f(t),u_contrast_factor:new e.Uniform1f(t),u_spin_weights:new e.Uniform3f(t),u_perspective_transform:new e.Uniform2f(t)}),symbolIcon:t=>({u_is_size_zoom_constant:new e.Uniform1i(t),u_is_size_feature_constant:new e.Uniform1i(t),u_size_t:new e.Uniform1f(t),u_size:new e.Uniform1f(t),u_camera_to_center_distance:new e.Uniform1f(t),u_rotate_symbol:new e.Uniform1i(t),u_aspect_ratio:new e.Uniform1f(t),u_fade_change:new e.Uniform1f(t),u_matrix:new e.UniformMatrix4f(t),u_label_plane_matrix:new e.UniformMatrix4f(t),u_coord_matrix:new e.UniformMatrix4f(t),u_is_text:new e.Uniform1i(t),u_pitch_with_map:new e.Uniform1i(t),u_texsize:new e.Uniform2f(t),u_tile_id:new e.Uniform3f(t),u_zoom_transition:new e.Uniform1f(t),u_inv_rot_matrix:new e.UniformMatrix4f(t),u_merc_center:new e.Uniform2f(t),u_camera_forward:new e.Uniform3f(t),u_tile_matrix:new e.UniformMatrix4f(t),u_up_vector:new e.Uniform3f(t),u_ecef_origin:new e.Uniform3f(t),u_texture:new e.Uniform1i(t)}),symbolSDF:t=>({u_is_size_zoom_constant:new e.Uniform1i(t),u_is_size_feature_constant:new e.Uniform1i(t),u_size_t:new e.Uniform1f(t),u_size:new e.Uniform1f(t),u_camera_to_center_distance:new e.Uniform1f(t),u_rotate_symbol:new e.Uniform1i(t),u_aspect_ratio:new e.Uniform1f(t),u_fade_change:new e.Uniform1f(t),u_matrix:new e.UniformMatrix4f(t),u_label_plane_matrix:new e.UniformMatrix4f(t),u_coord_matrix:new e.UniformMatrix4f(t),u_is_text:new e.Uniform1i(t),u_pitch_with_map:new e.Uniform1i(t),u_texsize:new e.Uniform2f(t),u_texture:new e.Uniform1i(t),u_gamma_scale:new e.Uniform1f(t),u_device_pixel_ratio:new e.Uniform1f(t),u_tile_id:new e.Uniform3f(t),u_zoom_transition:new e.Uniform1f(t),u_inv_rot_matrix:new e.UniformMatrix4f(t),u_merc_center:new e.Uniform2f(t),u_camera_forward:new e.Uniform3f(t),u_tile_matrix:new e.UniformMatrix4f(t),u_up_vector:new e.Uniform3f(t),u_ecef_origin:new e.Uniform3f(t),u_is_halo:new e.Uniform1i(t)}),symbolTextAndIcon:t=>({u_is_size_zoom_constant:new e.Uniform1i(t),u_is_size_feature_constant:new e.Uniform1i(t),u_size_t:new e.Uniform1f(t),u_size:new e.Uniform1f(t),u_camera_to_center_distance:new e.Uniform1f(t),u_rotate_symbol:new e.Uniform1i(t),u_aspect_ratio:new e.Uniform1f(t),u_fade_change:new e.Uniform1f(t),u_matrix:new e.UniformMatrix4f(t),u_label_plane_matrix:new e.UniformMatrix4f(t),u_coord_matrix:new e.UniformMatrix4f(t),u_is_text:new e.Uniform1i(t),u_pitch_with_map:new e.Uniform1i(t),u_texsize:new e.Uniform2f(t),u_texsize_icon:new e.Uniform2f(t),u_texture:new e.Uniform1i(t),u_texture_icon:new e.Uniform1i(t),u_gamma_scale:new e.Uniform1f(t),u_device_pixel_ratio:new e.Uniform1f(t),u_is_halo:new e.Uniform1i(t)}),background:t=>({u_matrix:new e.UniformMatrix4f(t),u_opacity:new e.Uniform1f(t),u_color:new e.UniformColor(t)}),backgroundPattern:t=>({u_matrix:new e.UniformMatrix4f(t),u_opacity:new e.Uniform1f(t),u_image:new e.Uniform1i(t),u_pattern_tl:new e.Uniform2f(t),u_pattern_br:new e.Uniform2f(t),u_texsize:new e.Uniform2f(t),u_pattern_size:new e.Uniform2f(t),u_pixel_coord_upper:new e.Uniform2f(t),u_pixel_coord_lower:new e.Uniform2f(t),u_tile_units_to_pixels:new e.Uniform1f(t)}),terrainRaster:xi,terrainDepth:xi,skybox:t=>({u_matrix:new e.UniformMatrix4f(t),u_sun_direction:new e.Uniform3f(t),u_cubemap:new e.Uniform1i(t),u_opacity:new e.Uniform1f(t),u_temporal_offset:new e.Uniform1f(t)}),skyboxGradient:t=>({u_matrix:new e.UniformMatrix4f(t),u_color_ramp:new e.Uniform1i(t),u_center_direction:new e.Uniform3f(t),u_radius:new e.Uniform1f(t),u_opacity:new e.Uniform1f(t),u_temporal_offset:new e.Uniform1f(t)}),skyboxCapture:t=>({u_matrix_3f:new e.UniformMatrix3f(t),u_sun_direction:new e.Uniform3f(t),u_sun_intensity:new e.Uniform1f(t),u_color_tint_r:new e.Uniform4f(t),u_color_tint_m:new e.Uniform4f(t),u_luminance:new e.Uniform1f(t)}),globeRaster:t=>({u_proj_matrix:new e.UniformMatrix4f(t),u_globe_matrix:new e.UniformMatrix4f(t),u_normalize_matrix:new e.UniformMatrix4f(t),u_merc_matrix:new e.UniformMatrix4f(t),u_zoom_transition:new e.Uniform1f(t),u_merc_center:new e.Uniform2f(t),u_image0:new e.Uniform1i(t),u_grid_matrix:new e.UniformMatrix3f(t),u_skirt_height:new e.Uniform1f(t),u_frustum_tl:new e.Uniform3f(t),u_frustum_tr:new e.Uniform3f(t),u_frustum_br:new e.Uniform3f(t),u_frustum_bl:new e.Uniform3f(t),u_globe_pos:new e.Uniform3f(t),u_globe_radius:new e.Uniform1f(t),u_viewport:new e.Uniform2f(t)}),globeAtmosphere:t=>({u_frustum_tl:new e.Uniform3f(t),u_frustum_tr:new e.Uniform3f(t),u_frustum_br:new e.Uniform3f(t),u_frustum_bl:new e.Uniform3f(t),u_horizon:new e.Uniform1f(t),u_transition:new e.Uniform1f(t),u_fadeout_range:new e.Uniform1f(t),u_color:new e.Uniform4f(t),u_high_color:new e.Uniform4f(t),u_space_color:new e.Uniform4f(t),u_star_intensity:new e.Uniform1f(t),u_star_density:new e.Uniform1f(t),u_star_size:new e.Uniform1f(t),u_temporal_offset:new e.Uniform1f(t),u_horizon_angle:new e.Uniform1f(t),u_rotation_matrix:new e.UniformMatrix4f(t)})};let un;function hn(t,i,n,r,o,a,s){const l=t.context,c=l.gl,u=t.transform,h=t.useProgram("collisionBox"),d=[];let p=0,f=0;for(let m=0;m<r.length;m++){const g=r[m],_=i.getTile(g),y=_.getBucket(n);if(!y)continue;const x=vt(g,y,u);let v=x;0===o[0]&&0===o[1]||(v=t.translatePosMatrix(x,_,o,a));const b=s?y.textCollisionBox:y.iconCollisionBox,w=y.collisionCircleArray;if(w.length>0){const t=e.create(),i=v;e.mul(t,y.placementInvProjMatrix,u.glCoordMatrix),e.mul(t,t,y.placementViewportMatrix),d.push({circleArray:w,circleOffset:f,transform:i,invTransform:t,projection:y.getProjection()}),p+=w.length/4,f=p}b&&(t.terrain&&t.terrain.setupElevationDraw(_,h),h.draw(l,c.LINES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,$i(v,u,_,y.getProjection()),n.id,b.layoutVertexBuffer,b.indexBuffer,b.segments,null,u.zoom,null,[b.collisionVertexBuffer,b.collisionVertexBufferExt]))}if(!s||!d.length)return;const m=t.useProgram("collisionCircle"),g=new e.StructArrayLayout2f1f2i16;g.resize(4*p),g._trim();let _=0;for(const e of d)for(let t=0;t<e.circleArray.length/4;t++){const i=4*t,n=e.circleArray[i+0],r=e.circleArray[i+1],o=e.circleArray[i+2],a=e.circleArray[i+3];g.emplace(_++,n,r,o,a,0),g.emplace(_++,n,r,o,a,1),g.emplace(_++,n,r,o,a,2),g.emplace(_++,n,r,o,a,3)}(!un||un.length<2*p)&&(un=function(t){const i=2*t,n=new e.StructArrayLayout3ui6;n.resize(i),n._trim();for(let e=0;e<i;e++){const t=6*e;n.uint16[t+0]=4*e+0,n.uint16[t+1]=4*e+1,n.uint16[t+2]=4*e+2,n.uint16[t+3]=4*e+2,n.uint16[t+4]=4*e+3,n.uint16[t+5]=4*e+0}return n}(p));const y=l.createIndexBuffer(un,!0),x=l.createVertexBuffer(g,e.collisionCircleLayout.members,!0);for(const i of d){const r={u_matrix:i.transform,u_inv_matrix:i.invTransform,u_camera_to_center_distance:(v=u).getCameraToCenterDistance(i.projection),u_viewport_size:[v.width,v.height]};m.draw(l,c.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,r,n.id,x,y,e.SegmentVector.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,u.zoom)}var v;x.destroy(),y.destroy()}const dn=e.create();function pn({width:t,height:i,anchor:n,textOffset:r,textScale:o},a){const{horizontalAlign:s,verticalAlign:l}=e.getAnchorAlignment(n),c=-(s-.5)*t,u=-(l-.5)*i,h=e.evaluateVariableOffset(n,r);return new e.pointGeometry((c/o+h[0])*a,(u/o+h[1])*a)}function fn(t,i,n,r,o,a,s,l,c,u,h){const d=t.text.placedSymbolArray,p=t.text.dynamicLayoutVertexArray,f=t.icon.dynamicLayoutVertexArray,m={},g=t.getProjection(),_=bt(l,g,a),y=a.elevation,x=g.upVectorScale(l.canonical,a.center.lat,a.worldSize).metersToTile;p.clear();for(let f=0;f<d.length;f++){const v=d.get(f),{tileAnchorX:b,tileAnchorY:w,numGlyphs:M}=v,T=t.allowVerticalPlacement&&!v.placedOrientation,S=v.hidden||!v.crossTileID||T?null:r[v.crossTileID];if(S){let r=0,d=0,f=0;if(y){const e=y?y.getAtTileOffset(l,b,w):0,[t,i,n]=g.upVector(l.canonical,b,w);r=e*t*x,d=e*i*x,f=e*n*x}let[T,E,C,A]=ot(v.projectedAnchorX+r,v.projectedAnchorY+d,v.projectedAnchorZ+f,n?_:s);const P=at(a.getCameraToCenterDistance(g),A);let I=o.evaluateSizeForFeature(t.textSizeData,u,v)*P/e.ONE_EM;n&&(I*=t.tilePixelRatio/c);const k=pn(S,I);n?(({x:T,y:E,z:C}=g.projectTilePoint(b+k.x,w+k.y,l.canonical)),[T,E,C]=ot(T+r,E+d,C+f,s)):(i&&k._rotate(-a.angle),T+=k.x,E+=k.y,C=0);const z=t.allowVerticalPlacement&&v.placedOrientation===e.WritingMode.vertical?Math.PI/2:0;for(let t=0;t<M;t++)e.addDynamicAttributes(p,T,E,C,z);h&&v.associatedIconIndex>=0&&(m[v.associatedIconIndex]={x:T,y:E,z:C,angle:z})}else mt(M,p)}if(h){f.clear();const i=t.icon.placedSymbolArray;for(let t=0;t<i.length;t++){const n=i.get(t),{numGlyphs:r}=n,o=m[t];if(n.hidden||!o)mt(r,f);else{const{x:t,y:i,z:n,angle:a}=o;for(let o=0;o<r;o++)e.addDynamicAttributes(f,t,i,n,a)}}t.icon.dynamicLayoutVertexBuffer.updateData(f)}t.text.dynamicLayoutVertexBuffer.updateData(p)}function mn(e,t,i){return i.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function gn(t,i,n,r,o,a,s,l,c,u,h,d){const p=t.context,f=p.gl,m=t.transform,g="map"===l,_="map"===c,y=g&&"point"!==n.layout.get("symbol-placement"),x=g&&!_&&!y,v=void 0!==n.layout.get("symbol-sort-key").constantOr(1);let b=!1;const w=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),M=[e.mercatorXfromLng(m.center.lng),e.mercatorYfromLat(m.center.lat)],T=n.layout.get("text-variable-anchor"),S="globe"===m.projection.name,E=[],C=[0,-1,0];let A=C;!S&&!m.mercatorFromTransition||g||(A=function(t){const i=t._camera.getWorldToCamera(t.worldSize,1),n=e.multiply([],i,t.globeMatrix);e.invert(n,n);const r=[0,0,0],o=[0,1,0,0];return e.transformMat4$1(o,o,n),r[0]=o[0],r[1]=o[1],r[2]=o[2],e.normalize(r,r),r}(m));for(const l of r){const r=i.getTile(l),c=r.getBucket(n);if(!c)continue;if("mercator"===c.projection.name&&S)continue;const h=o?c.text:c.icon;if(!h||c.fullyClipped||!h.segments.get().length)continue;const d=h.programConfigurations.get(n.id),p=o||c.sdfIcons,w=o?c.textSizeData:c.iconSizeData,P=_||0!==m.pitch,I=e.evaluateSizeForZoom(w,m.zoom);let k,z,D,L,R=[0,0],O=null;if(o){if(z=r.glyphAtlasTexture,D=f.LINEAR,k=r.glyphAtlasTexture.size,c.iconsInText){R=r.imageAtlasTexture.size,O=r.imageAtlasTexture;const e="composite"===w.kind||"camera"===w.kind;L=P||t.options.rotating||t.options.zooming||e?f.LINEAR:f.NEAREST}}else{const e=1!==n.layout.get("icon-size").constantOr(0)||c.iconsNeedLinear;z=r.imageAtlasTexture,D=p||t.options.rotating||t.options.zooming||e||P?f.LINEAR:f.NEAREST,k=r.imageAtlasTexture.size}const B="globe"===c.projection.name,F=B?A:C,N=B?e.globeToMercatorTransition(m.zoom):0,U=bt(l,c.getProjection(),m),V=m.calculatePixelsToTileUnitsMatrix(r),G=it(U,r.tileID.canonical,_,g,m,c.getProjection(),V),j=t.terrain&&_&&y?e.invert(e.create(),G):dn,W=rt(U,r.tileID.canonical,_,g,m,c.getProjection(),V),$=T&&c.hasTextData(),q="none"!==n.layout.get("icon-text-fit")&&$&&c.hasIconData();if(y){const e=m.elevation,i=e?e.getAtTileOffsetFunc(l,m.center.lat,m.worldSize,c.getProjection()):null,n=nt(U,r.tileID.canonical,_,g,m,c.getProjection(),V);lt(c,U,t,o,n,W,_,u,i,l)}const Z=y||o&&T||q,H=t.translatePosMatrix(U,r,a,s),X=Z?dn:G,Y=t.translatePosMatrix(W,r,a,s,!0),J=c.getProjection().createInversionMatrix(m,l.canonical),K=[];t.terrainRenderModeElevated()&&_&&K.push("PITCH_WITH_MAP_TERRAIN"),B&&K.push("PROJECTION_GLOBE_VIEW"),Z&&K.push("PROJECTED_POS_ON_VIEWPORT");const Q=p&&0!==n.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let ee;ee=p?c.iconsInText?an(w.kind,I,x,_,t,H,X,Y,k,R,l,N,M,J,F,c.getProjection()):on(w.kind,I,x,_,t,H,X,Y,o,k,!0,l,N,M,J,F,c.getProjection()):rn(w.kind,I,x,_,t,H,X,Y,o,k,l,N,M,J,F,c.getProjection());const te={program:t.useProgram(mn(p,o,c),d,K),buffers:h,uniformValues:ee,atlasTexture:z,atlasTextureIcon:O,atlasInterpolation:D,atlasInterpolationIcon:L,isSDF:p,hasHalo:Q,tile:r,labelPlaneMatrixInv:j};if(v&&c.canOverlap){b=!0;const t=h.segments.get();for(const i of t)E.push({segments:new e.SegmentVector([i]),sortKey:i.sortKey,state:te})}else E.push({segments:h.segments,sortKey:0,state:te})}b&&E.sort(((e,t)=>e.sortKey-t.sortKey));for(const e of E){const i=e.state;if(t.terrain&&t.terrain.setupElevationDraw(i.tile,i.program,{useDepthForOcclusion:!S,labelPlaneMatrixInv:i.labelPlaneMatrixInv}),p.activeTexture.set(f.TEXTURE0),i.atlasTexture.bind(i.atlasInterpolation,f.CLAMP_TO_EDGE),i.atlasTextureIcon&&(p.activeTexture.set(f.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),i.isSDF){const r=i.uniformValues;i.hasHalo&&(r.u_is_halo=1,_n(i.buffers,e.segments,n,t,i.program,w,h,d,r)),r.u_is_halo=0}_n(i.buffers,e.segments,n,t,i.program,w,h,d,i.uniformValues)}}function _n(t,i,n,r,o,a,s,l,c){const u=r.context,h=[t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer,t.globeExtVertexBuffer];o.draw(u,u.gl.TRIANGLES,a,s,l,e.CullFaceMode.disabled,c,n.id,t.layoutVertexBuffer,t.indexBuffer,i,n.paint,r.transform.zoom,t.programConfigurations.get(n.id),h)}function yn(t,i,n,r,o,a,s){const l=t.context.gl,c=n.paint.get("fill-pattern"),u=c&&c.constantOr(1);let h,d,p,f,m;s?(d=u&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",h=l.LINES):(d=u?"fillPattern":"fill",h=l.TRIANGLES);for(const g of r){const r=i.getTile(g);if(u&&!r.patternsLoaded())continue;const _=r.getBucket(n);if(!_)continue;t.prepareDrawTile();const y=_.programConfigurations.get(n.id),x=t.useProgram(d,y);u&&(t.context.activeTexture.set(l.TEXTURE0),r.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),y.updatePaintBuffers());const v=c.constantOr(null);if(v&&r.imageAtlas){const e=r.imageAtlas.patternPositions[v.toString()];e&&y.setConstantPatternPositions(e)}const b=t.translatePosMatrix(g.projMatrix,r,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(s){f=_.indexBuffer2,m=_.segments2;const e=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[l.drawingBufferWidth,l.drawingBufferHeight];p="fillOutlinePattern"===d&&u?Vi(b,t,r,e):Ui(b,e)}else f=_.indexBuffer,m=_.segments,p=u?Ni(b,t,r):Fi(b);t.prepareDrawProgram(t.context,x,g.toUnwrapped()),x.draw(t.context,h,o,t.stencilModeForClipping(g),a,e.CullFaceMode.disabled,p,n.id,_.layoutVertexBuffer,f,m,n.paint,t.transform.zoom,y)}}function xn(t,i,n,r,o,a,s){const l=t.context,c=l.gl,u=t.transform,h=n.paint.get("fill-extrusion-pattern"),d=h.constantOr(1),p=n.paint.get("fill-extrusion-opacity"),f=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),n.paint.get("fill-extrusion-ambient-occlusion-radius")],m=n.layout.get("fill-extrusion-edge-radius"),g="globe"===u.projection.name?e.fillExtrusionHeightLift():0,_="globe"===u.projection.name,y=_?e.globeToMercatorTransition(u.zoom):0,x=[e.mercatorXfromLng(u.center.lng),e.mercatorYfromLat(u.center.lat)],v=[];_&&v.push("PROJECTION_GLOBE_VIEW"),f[0]>0&&v.push("FAUX_AO");for(const b of r){const r=i.getTile(b),w=r.getBucket(n);if(!w||w.projection.name!==u.projection.name)continue;const M=w.programConfigurations.get(n.id),T=t.useProgram(d?"fillExtrusionPattern":"fillExtrusion",M,v);if(t.terrain){const e=t.terrain;if(t.style.terrainSetForDrapingOnly())e.setupElevationDraw(r,T,{useMeterToDem:!0});else{if(!w.enableTerrain)continue;if(e.setupElevationDraw(r,T,{useMeterToDem:!0}),vn(l,i,b,w,n,e),!w.centroidVertexBuffer){const e=T.attributes.a_centroid_pos;void 0!==e&&c.vertexAttrib2f(e,0,0)}}}d&&(t.context.activeTexture.set(c.TEXTURE0),r.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),M.updatePaintBuffers());const S=h.constantOr(null);if(S&&r.imageAtlas){const e=r.imageAtlas.patternPositions[S.toString()];e&&M.setConstantPatternPositions(e)}const E=t.translatePosMatrix(b.projMatrix,r,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),C=u.projection.createInversionMatrix(u,b.canonical),A=n.paint.get("fill-extrusion-vertical-gradient"),P=d?Bi(E,t,A,p,f,m,b,r,g,y,x,C):Oi(E,t,A,p,f,m,b,g,y,x,C);t.prepareDrawProgram(l,T,b.toUnwrapped());const I=[];t.terrain&&I.push(w.centroidVertexBuffer),_&&I.push(w.layoutVertexExtBuffer),T.draw(l,l.gl.TRIANGLES,o,a,s,e.CullFaceMode.backCCW,P,n.id,w.layoutVertexBuffer,w.indexBuffer,w.segments,n.paint,t.transform.zoom,M,I)}}function vn(t,i,n,r,o,a){const s=[t=>{let i=t.canonical.x-1,n=t.wrap;return i<0&&(i=(1<<t.canonical.z)-1,n--),new e.OverscaledTileID(t.overscaledZ,n,t.canonical.z,i,t.canonical.y)},t=>{let i=t.canonical.x+1,n=t.wrap;return i===1<<t.canonical.z&&(i=0,n++),new e.OverscaledTileID(t.overscaledZ,n,t.canonical.z,i,t.canonical.y)},t=>new e.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new e.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)],l=e=>{const t=i.getSource().minzoom,n=e=>{const t=i.getTileByID(e);if(t&&t.hasData())return t.getBucket(o)},r=[0,-1,1];for(const i of r){if(e.overscaledZ+i<t)continue;const r=n(e.calculateScaledKey(e.overscaledZ+i));if(r)return r}},c=[0,0,0],u=(t,i)=>(c[0]=Math.min(t.min.y,i.min.y),c[1]=Math.max(t.max.y,i.max.y),c[2]=e.EXTENT-i.min.x>t.max.x?i.min.x-e.EXTENT:t.max.x,c),h=(t,i)=>(c[0]=Math.min(t.min.x,i.min.x),c[1]=Math.max(t.max.x,i.max.x),c[2]=e.EXTENT-i.min.y>t.max.y?i.min.y-e.EXTENT:t.max.y,c),d=[(e,t)=>u(e,t),(e,t)=>u(t,e),(e,t)=>h(e,t),(e,t)=>h(t,e)],p=new e.pointGeometry(0,0);let f,m,g;const _=(t,i,r,o,s)=>{const l=[[o?r:t,o?t:r,0],[o?r:i,o?i:r,0]],c=s<0?e.EXTENT+s:s,u=[o?c:(t+i)/2,o?(t+i)/2:c,0];return 0===r&&s<0||0!==r&&s>0?a.getForTilePoints(g,[u],!0,m):l.push(u),a.getForTilePoints(n,l,!0,f),Math.max(l[0][2],l[1][2],u[2])/a.exaggeration()};for(let t=0;t<4;t++){const i=(t<2?1:5)-t,o=r.borders[t];if(0===o.length)continue;const c=g=s[t](n),u=l(c);if(!(u&&u instanceof e.FillExtrusionBucket&&u.enableTerrain))continue;if(r.borderDoneWithNeighborZ[t]===u.canonical.z&&u.borderDoneWithNeighborZ[i]===r.canonical.z)continue;if(m=a.findDEMTileFor(c),!m||!m.dem)continue;if(!f){const e=a.findDEMTileFor(n);if(!e||!e.dem)return;f=e}const h=u.borders[i];let y=0;const x=u.borderDoneWithNeighborZ[i]!==r.canonical.z;if(r.canonical.z===u.canonical.z){for(let n=0;n<o.length;n++){const a=r.featuresOnBorder[o[n]],s=a.borders[t];let l;for(;y<h.length&&(l=u.featuresOnBorder[h[y]],!(l.borders[i][1]>s[0]+3));)x&&u.encodeCentroid(void 0,l,!1),y++;if(l&&y<h.length){const n=y;let o=0;for(;!(l.borders[i][0]>s[1]-3)&&(o++,++y!==h.length);)l=u.featuresOnBorder[h[y]];if(l=u.featuresOnBorder[h[n]],a.intersectsCount()>1||l.intersectsCount()>1||1!==o){1!==o&&(y=n),r.encodeCentroid(void 0,a,!1),x&&u.encodeCentroid(void 0,l,!1);continue}const c=d[t](a,l),f=t%2?e.EXTENT-1:0;p.x=_(c[0],Math.min(e.EXTENT-1,c[1]),f,t<2,c[2]),p.y=0,r.encodeCentroid(p,a,!1),x&&u.encodeCentroid(p,l,!1)}else r.encodeCentroid(void 0,a,!1)}r.borderDoneWithNeighborZ[t]=u.canonical.z,r.needsCentroidUpdate=!0,x&&(u.borderDoneWithNeighborZ[i]=r.canonical.z,u.needsCentroidUpdate=!0)}else{for(const e of o)r.encodeCentroid(void 0,r.featuresOnBorder[e],!1);if(x){for(const e of h)u.encodeCentroid(void 0,u.featuresOnBorder[e],!1);u.borderDoneWithNeighborZ[i]=r.canonical.z,u.needsCentroidUpdate=!0}r.borderDoneWithNeighborZ[t]=u.canonical.z,r.needsCentroidUpdate=!0}}(r.needsCentroidUpdate||!r.centroidVertexBuffer&&0!==r.centroidVertexArray.length)&&r.uploadCentroid(t)}const bn=new e.Color(1,0,0,1),wn=new e.Color(0,1,0,1),Mn=new e.Color(0,0,1,1),Tn=new e.Color(1,0,1,1),Sn=new e.Color(0,1,1,1);function En(t,i,n){const r=t.context,o=t.transform,a=r.gl,s="globe"===o.projection.name,l=s?["PROJECTION_GLOBE_VIEW"]:null;let c=n.projMatrix;if(s&&e.globeToMercatorTransition(o.zoom)>0){const t=e.transitionTileAABBinECEF(n.canonical,o),i=e.globeDenormalizeECEF(t);c=e.multiply(new Float32Array(16),o.globeMatrix,i),e.multiply(c,o.projMatrix,c)}const u=t.useProgram("debug",null,l),h=i.getTileByID(n.key);t.terrain&&t.terrain.setupElevationDraw(h,u);const d=e.DepthMode.disabled,p=e.StencilMode.disabled,f=t.colorModeForRenderPass(),m="$debug";r.activeTexture.set(a.TEXTURE0),t.emptyTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),s?h._makeGlobeTileDebugBuffers(t.context,o):h._makeDebugTileBoundsBuffers(t.context,o.projection);const g=h._tileDebugBuffer||t.debugBuffer,_=h._tileDebugIndexBuffer||t.debugIndexBuffer,y=h._tileDebugSegments||t.debugSegments;u.draw(r,a.LINE_STRIP,d,p,f,e.CullFaceMode.disabled,qi(c,e.Color.red),m,g,_,y,null,null,null,[h._globeTileDebugBorderBuffer]);const x=h.latestRawTileData,v=Math.floor((x&&x.byteLength||0)/1024),b=i.getTile(n).tileSize,w=512/Math.min(b,512)*(n.overscaledZ/o.zoom)*.5;let M=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(M+=` => ${n.overscaledZ}`),M+=` ${v}kb`,function(e,t){e.initDebugOverlayCanvas();const i=e.debugOverlayCanvas,n=e.context.gl,r=e.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,i.width,i.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(t,5,5),r.strokeText(t,5,5),e.debugOverlayTexture.update(i),e.debugOverlayTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}(t,M);const T=h._tileDebugTextBuffer||t.debugBuffer,S=h._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,E=h._tileDebugTextSegments||t.debugSegments;u.draw(r,a.TRIANGLES,d,p,e.ColorMode.alphaBlended,e.CullFaceMode.disabled,qi(c,e.Color.transparent,w),m,T,S,E,null,null,null,[h._globeTileDebugTextBuffer])}function Cn(e,t,i,n){Pn(e,0,t+i/2,e.transform.width,i,n)}function An(e,t,i,n){Pn(e,t-i/2,0,i,e.transform.height,n)}function Pn(t,i,n,r,o,a){const s=t.context,l=s.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*e.exported.devicePixelRatio,n*e.exported.devicePixelRatio,r*e.exported.devicePixelRatio,o*e.exported.devicePixelRatio),s.clear({color:a}),l.disable(l.SCISSOR_TEST)}const In=e.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:kn}=In;function zn(e,t,i,n){e.emplaceBack(t,i,n)}class Dn{constructor(t){this.vertexArray=new e.StructArrayLayout3f12,this.indices=new e.StructArrayLayout3ui6,zn(this.vertexArray,-1,-1,1),zn(this.vertexArray,1,-1,1),zn(this.vertexArray,-1,1,1),zn(this.vertexArray,1,1,1),zn(this.vertexArray,-1,-1,-1),zn(this.vertexArray,1,-1,-1),zn(this.vertexArray,-1,1,-1),zn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,kn),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.SegmentVector.simpleSegment(0,0,36,12)}}function Ln(t,i,n,r,o,a){const s=t.gl,l=i.paint.get("sky-atmosphere-color"),c=i.paint.get("sky-atmosphere-halo-color"),u=i.paint.get("sky-atmosphere-sun-intensity"),h=((e,t,i,n,r)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:i,u_color_tint_r:[n.r,n.g,n.b,n.a],u_color_tint_m:[r.r,r.g,r.b,r.a],u_luminance:5e-5}))(e.fromMat4(e.create$1(),r),o,u,l,c);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+a,i.skyboxTexture,0),n.draw(t,s.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,e.ColorMode.unblended,e.CullFaceMode.frontCW,h,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Rn=e.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class On{constructor(t){const i=new e.StructArrayLayout5f20;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const n=new e.StructArrayLayout3ui6;n.emplaceBack(0,1,2),n.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(i,Rn.members),this.indexBuffer=t.createIndexBuffer(n),this.segments=e.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Bn={symbol:function(t,i,n,r,o){if("translucent"!==t.renderPass)return;const a=e.StencilMode.disabled,s=t.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(t,i,n,r,o,a,s){const l=i.transform,c="map"===o,u="map"===a;for(const i of t){const t=r.getTile(i),o=t.getBucket(n);if(!o||!o.text||!o.text.segments.get().length)continue;const a=e.evaluateSizeForZoom(o.textSizeData,l.zoom),h=bt(i,o.getProjection(),l),d=l.calculatePixelsToTileUnitsMatrix(t),p=it(h,t.tileID.canonical,u,c,l,o.getProjection(),d),f="none"!==n.layout.get("icon-text-fit")&&o.hasIconData();if(a){const n=Math.pow(2,l.zoom-t.tileID.overscaledZ);fn(o,c,u,s,e.symbolSize,l,p,i,n,a,f)}}}(r,t,n,i,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),o),0!==n.paint.get("icon-opacity").constantOr(1)&&gn(t,i,n,r,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),a,s),0!==n.paint.get("text-opacity").constantOr(1)&&gn(t,i,n,r,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),a,s),i.map.showCollisionBoxes&&(hn(t,i,n,r,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),hn(t,i,n,r,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(t,i,n,r){if("translucent"!==t.renderPass)return;const o=n.paint.get("circle-opacity"),a=n.paint.get("circle-stroke-width"),s=n.paint.get("circle-stroke-opacity"),l=void 0!==n.layout.get("circle-sort-key").constantOr(1);if(0===o.constantOr(1)&&(0===a.constantOr(1)||0===s.constantOr(1)))return;const c=t.context,u=c.gl,h=t.transform,d=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),p=e.StencilMode.disabled,f=t.colorModeForRenderPass(),m="globe"===h.projection.name,g=[e.mercatorXfromLng(h.center.lng),e.mercatorYfromLat(h.center.lat)],_=[];for(let o=0;o<r.length;o++){const a=r[o],s=i.getTile(a),c=s.getBucket(n);if(!c||c.projection.name!==h.projection.name)continue;const u=c.programConfigurations.get(n.id),d=Wi(n);m&&d.push("PROJECTION_GLOBE_VIEW");const p=t.useProgram("circle",u,d),f=c.layoutVertexBuffer,y=c.globeExtVertexBuffer,x=c.indexBuffer,v=h.projection.createInversionMatrix(h,a.canonical),b={programConfiguration:u,program:p,layoutVertexBuffer:f,globeExtVertexBuffer:y,indexBuffer:x,uniformValues:ji(t,a,s,v,g,n),tile:s};if(l){const t=c.segments.get();for(const i of t)_.push({segments:new e.SegmentVector([i]),sortKey:i.sortKey,state:b})}else _.push({segments:c.segments,sortKey:0,state:b})}l&&_.sort(((e,t)=>e.sortKey-t.sortKey));const y={useDepthForOcclusion:!m};for(const i of _){const{programConfiguration:r,program:o,layoutVertexBuffer:a,globeExtVertexBuffer:s,indexBuffer:l,uniformValues:m,tile:g}=i.state,_=i.segments;t.terrain&&t.terrain.setupElevationDraw(g,o,y),t.prepareDrawProgram(c,o,g.tileID.toUnwrapped()),o.draw(c,u.TRIANGLES,d,p,f,e.CullFaceMode.disabled,m,n.id,a,l,_,n.paint,h.zoom,r,[s])}},heatmap:function(t,i,n,r){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const o=t.context,a=o.gl,s=e.StencilMode.disabled,l=new e.ColorMode([a.ONE,a.ONE],e.Color.transparent,[!0,!0,!0,!0]);!function(e,t,i,n){const r=e.gl,o=t.width*n,a=t.height*n;e.activeTexture.set(r.TEXTURE1),e.viewport.set([0,0,o,a]);let s=i.heatmapFbo;if(!s||s&&(s.width!==o||s.height!==a)){s&&s.destroy();const t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),s=i.heatmapFbo=e.createFramebuffer(o,a,!1),function(e,t,i,n,r,o){const a=e.gl;a.texImage2D(a.TEXTURE_2D,0,e.isWebGL2&&e.extRenderToTextureHalfFloat?a.RGBA16F:a.RGBA,r,o,0,a.RGBA,e.extRenderToTextureHalfFloat?e.isWebGL2?a.HALF_FLOAT:e.extTextureHalfFloat.HALF_FLOAT_OES:a.UNSIGNED_BYTE,null),n.colorAttachment.set(i)}(e,0,t,s,o,a)}else r.bindTexture(r.TEXTURE_2D,s.colorAttachment.get()),e.bindFramebuffer.set(s.framebuffer)}(o,t,n,"globe"===t.transform.projection.name?.5:.25),o.clear({color:e.Color.transparent});const c=t.transform,u="globe"===c.projection.name,h=u?["PROJECTION_GLOBE_VIEW"]:null,d=u?e.CullFaceMode.frontCCW:e.CullFaceMode.disabled,p=[e.mercatorXfromLng(c.center.lng),e.mercatorYfromLat(c.center.lat)];for(let f=0;f<r.length;f++){const m=r[f];if(i.hasRenderableParent(m))continue;const g=i.getTile(m),_=g.getBucket(n);if(!_||_.projection.name!==c.projection.name)continue;const y=_.programConfigurations.get(n.id),x=t.useProgram("heatmap",y,h),{zoom:v}=t.transform;t.terrain&&t.terrain.setupElevationDraw(g,x),t.prepareDrawProgram(o,x,m.toUnwrapped());const b=c.projection.createInversionMatrix(c,m.canonical);x.draw(o,a.TRIANGLES,e.DepthMode.disabled,s,l,d,Hi(t,m,g,b,p,v,n.paint.get("heatmap-intensity")),n.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,n.paint,t.transform.zoom,y,u?[_.globeExtVertexBuffer]:null)}o.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,i){const n=t.context,r=n.gl,o=i.heatmapFbo;if(!o)return;n.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,o.colorAttachment.get()),n.activeTexture.set(r.TEXTURE1);let a=i.colorRampTexture;a||(a=i.colorRampTexture=new e.Texture(n,i.colorRamp,r.RGBA)),a.bind(r.LINEAR,r.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(n,r.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,((e,t,i,n)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,i),i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,i.paint,t.transform.zoom)}(t,n))},line:function(t,i,n,r){if("translucent"!==t.renderPass)return;const o=n.paint.get("line-opacity"),a=n.paint.get("line-width");if(0===o.constantOr(1)||0===a.constantOr(1))return;const s=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),l=t.colorModeForRenderPass(),c=t.terrain&&t.terrain.renderingToTexture?1:e.exported.devicePixelRatio,u=n.paint.get("line-dasharray"),h=u.constantOr(1),d=n.layout.get("line-cap"),p=n.paint.get("line-pattern"),f=p.constantOr(1),m=n.paint.get("line-gradient"),g=f?"linePattern":"line",_=t.context,y=_.gl,x=(e=>{const t=[];Qi(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const i=e.paint.get("line-trim-offset");0===i[0]&&0===i[1]||t.push("RENDER_LINE_TRIM_OFFSET");const n=e.paint.get("line-pattern").constantOr(1),r=1!==e.paint.get("line-opacity").constantOr(1);return!n&&r&&t.push("RENDER_LINE_ALPHA_DISCARD"),t})(n);let v=x.includes("RENDER_LINE_ALPHA_DISCARD");t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(v=!1);for(const o of r){const r=i.getTile(o);if(f&&!r.patternsLoaded())continue;const a=r.getBucket(n);if(!a)continue;t.prepareDrawTile();const b=a.programConfigurations.get(n.id),w=t.useProgram(g,b,x),M=p.constantOr(null);if(M&&r.imageAtlas){const e=r.imageAtlas.patternPositions[M.toString()];e&&b.setConstantPatternPositions(e)}const T=u.constantOr(null),S=d.constantOr(null);if(!f&&T&&S&&r.lineAtlas){const e=r.lineAtlas.getDash(T,S);e&&b.setConstantPatternPositions(e)}let[E,C]=n.paint.get("line-trim-offset");if("round"===S||"square"===S){const e=1;E!==C&&(0===E&&(E-=e),1===C&&(C+=e))}const A=t.terrain?o.projMatrix:null,P=f?Yi(t,r,n,A,c):Xi(t,r,n,A,a.lineClipsArray.length,c,[E,C]);if(m){const r=a.gradients[n.id];let s=r.texture;if(n.gradientVersion!==r.version){let l=256;if(n.stepInterpolant){const n=i.getSource().maxzoom,r=o.canonical.z===n?Math.ceil(1<<t.transform.maxZoom-o.canonical.z):1;l=e.clamp(e.nextPowerOfTwo(a.maxLineLength/e.EXTENT*1024*r),256,_.maxTextureSize)}r.gradient=e.renderColorRamp({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:r.gradient||void 0,clips:a.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new e.Texture(_,r.gradient,y.RGBA),r.version=n.gradientVersion,s=r.texture}_.activeTexture.set(y.TEXTURE1),s.bind(n.stepInterpolant?y.NEAREST:y.LINEAR,y.CLAMP_TO_EDGE)}h&&(_.activeTexture.set(y.TEXTURE0),r.lineAtlasTexture.bind(y.LINEAR,y.REPEAT),b.updatePaintBuffers()),f&&(_.activeTexture.set(y.TEXTURE0),r.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),b.updatePaintBuffers()),t.prepareDrawProgram(_,w,o.toUnwrapped());const I=i=>{w.draw(_,y.TRIANGLES,s,i,l,e.CullFaceMode.disabled,P,n.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,n.paint,t.transform.zoom,b,[a.layoutVertexBuffer2])};if(v){const i=t.stencilModeForClipping(o).ref;0===i&&t.terrain&&_.clear({stencil:0});const n={func:y.EQUAL,mask:255};P.u_alpha_discard_threshold=.8,I(new e.StencilMode(n,i,255,y.KEEP,y.KEEP,y.INVERT)),P.u_alpha_discard_threshold=0,I(new e.StencilMode(n,i,255,y.KEEP,y.KEEP,y.KEEP))}else I(t.stencilModeForClipping(o))}v&&(t.resetStencilClippingMasks(),t.terrain&&_.clear({stencil:0}))},fill:function(t,i,n,r){const o=n.paint.get("fill-color"),a=n.paint.get("fill-opacity");if(0===a.constantOr(1))return;const s=t.colorModeForRenderPass(),l=n.paint.get("fill-pattern"),c=t.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===o.constantOr(e.Color.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(t.renderPass===c){const o=t.depthModeForSublayer(1,"opaque"===t.renderPass?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly);yn(t,i,n,r,o,s,!1)}if("translucent"===t.renderPass&&n.paint.get("fill-antialias")){const o=t.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,e.DepthMode.ReadOnly);yn(t,i,n,r,o,s,!0)}},"fill-extrusion":function(t,i,n,r){const o=n.paint.get("fill-extrusion-opacity");if(0!==o&&"translucent"===t.renderPass){const a=new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);if(1!==o||n.paint.get("fill-extrusion-pattern").constantOr(1))xn(t,i,n,r,a,e.StencilMode.disabled,e.ColorMode.disabled),xn(t,i,n,r,a,t.stencilModeFor3D(),t.colorModeForRenderPass()),t.resetStencilClippingMasks();else{const o=t.colorModeForRenderPass();xn(t,i,n,r,a,e.StencilMode.disabled,o)}}},hillshade:function(t,i,n,r){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;const o=t.context,a=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),s=t.colorModeForRenderPass(),l=t.terrain&&t.terrain.renderingToTexture,[c,u]="translucent"!==t.renderPass||l?[{},r]:t.stencilConfigForOverlap(r);for(const r of u){const o=i.getTile(r);if(o.needsHillshadePrepare&&"offscreen"===t.renderPass)yi(t,o,n,a,e.StencilMode.disabled,s);else if("translucent"===t.renderPass){const e=l&&t.terrain?t.terrain.stencilModeForRTTOverlap(r):c[r.overscaledZ];gi(t,r,o,n,a,e,s)}}o.viewport.set([0,0,t.width,t.height]),t.resetStencilClippingMasks()},raster:function(t,i,n,r,o,a){if("translucent"!==t.renderPass)return;if(0===n.paint.get("raster-opacity"))return;if(!r.length)return;const s=t.context,l=s.gl,c=i.getSource(),u=t.useProgram("raster"),h=t.colorModeForRenderPass(),d=t.terrain&&t.terrain.renderingToTexture,[p,f]=c instanceof ke||d?[{},r]:t.stencilConfigForOverlap(r),m=f[f.length-1].overscaledZ,g=!t.options.moving;for(const r of f){const o=d?e.DepthMode.disabled:t.depthModeForSublayer(r.overscaledZ-m,1===n.paint.get("raster-opacity")?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly,l.LESS),f=r.toUnwrapped(),_=i.getTile(r);if(d&&(!_||!_.hasData()))continue;const y=d?r.projMatrix:t.transform.calculateProjMatrix(f,g),x=t.terrain&&d?t.terrain.stencilModeForRTTOverlap(r):p[r.overscaledZ],v=a?0:n.paint.get("raster-fade-duration");_.registerFadeDuration(v);const b=i.findLoadedParent(r,0),w=Ai(_,b,i,t.transform,v);let M,T;t.terrain&&t.terrain.prepareDrawTile();const S="nearest"===n.paint.get("raster-resampling")?l.NEAREST:l.LINEAR;s.activeTexture.set(l.TEXTURE0),_.texture.bind(S,l.CLAMP_TO_EDGE),s.activeTexture.set(l.TEXTURE1),b?(b.texture.bind(S,l.CLAMP_TO_EDGE),M=Math.pow(2,b.tileID.overscaledZ-_.tileID.overscaledZ),T=[_.tileID.canonical.x*M%1,_.tileID.canonical.y*M%1]):_.texture.bind(S,l.CLAMP_TO_EDGE);const E=en(y,T||[0,0],M||1,w,n,c instanceof ke?c.perspectiveTransform:[0,0]);if(t.prepareDrawProgram(s,u,f),c instanceof ke)c.boundsBuffer&&c.boundsSegments&&u.draw(s,l.TRIANGLES,o,e.StencilMode.disabled,h,e.CullFaceMode.disabled,E,n.id,c.boundsBuffer,t.quadTriangleIndexBuffer,c.boundsSegments);else{const{tileBoundsBuffer:i,tileBoundsIndexBuffer:r,tileBoundsSegments:a}=t.getTileBoundsBuffers(_);u.draw(s,l.TRIANGLES,o,x,h,e.CullFaceMode.disabled,E,n.id,i,r,a)}}t.resetStencilClippingMasks()},background:function(t,i,n,r){const o=n.paint.get("background-color"),a=n.paint.get("background-opacity");if(0===a)return;const s=t.context,l=s.gl,c=t.transform,u=c.tileSize,h=n.paint.get("background-pattern");if(t.isPatternMissing(h))return;const d=!h&&1===o.a&&1===a&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==d)return;const p=e.StencilMode.disabled,f=t.depthModeForSublayer(0,"opaque"===d?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly),m=t.colorModeForRenderPass(),g=t.useProgram(h?"backgroundPattern":"background");let _,y=r;y||(_=t.getBackgroundTiles(),y=Object.values(_).map((e=>e.tileID))),h&&(s.activeTexture.set(l.TEXTURE0),t.imageManager.bind(t.context));for(const d of y){const y=d.toUnwrapped(),x=r?d.projMatrix:t.transform.calculateProjMatrix(y);t.prepareDrawTile();const v=i?i.getTile(d):_?_[d.key]:new e.Tile(d,u,c.zoom,t),b=h?ln(x,a,t,h,{tileID:d,tileSize:u}):sn(x,a,o);t.prepareDrawProgram(s,g,y);const{tileBoundsBuffer:w,tileBoundsIndexBuffer:M,tileBoundsSegments:T}=t.getTileBoundsBuffers(v);g.draw(s,l.TRIANGLES,f,p,m,e.CullFaceMode.disabled,b,n.id,w,M,T)}},sky:function(t,i,n){const r=t.transform,o="mercator"===r.projection.name||"globe"===r.projection.name?1:e.smoothstep(7,8,r.zoom),a=n.paint.get("sky-opacity")*o;if(0===a)return;const s=t.context,l=n.paint.get("sky-type"),c=new e.DepthMode(s.gl.LEQUAL,e.DepthMode.ReadOnly,[0,1]),u=t.frameCounter/1e3%1;"atmosphere"===l?"offscreen"===t.renderPass?n.needsSkyboxCapture(t)&&(function(t,i,n,r){const o=t.context,a=o.gl;let s=i.skyboxFbo;if(!s){s=i.skyboxFbo=o.createFramebuffer(32,32,!1),i.skyboxGeometry=new Dn(o),i.skyboxTexture=o.gl.createTexture(),a.bindTexture(a.TEXTURE_CUBE_MAP,i.skyboxTexture),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR);for(let e=0;e<6;++e)a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,a.RGBA,32,32,0,a.RGBA,a.UNSIGNED_BYTE,null)}o.bindFramebuffer.set(s.framebuffer),o.viewport.set([0,0,32,32]);const l=i.getCenter(t,!0),c=t.useProgram("skyboxCapture"),u=new Float64Array(16);e.identity(u),e.rotateY(u,u,.5*-Math.PI),Ln(o,i,c,u,l,0),e.identity(u),e.rotateY(u,u,.5*Math.PI),Ln(o,i,c,u,l,1),e.identity(u),e.rotateX(u,u,.5*-Math.PI),Ln(o,i,c,u,l,2),e.identity(u),e.rotateX(u,u,.5*Math.PI),Ln(o,i,c,u,l,3),e.identity(u),Ln(o,i,c,u,l,4),e.identity(u),e.rotateY(u,u,Math.PI),Ln(o,i,c,u,l,5),o.viewport.set([0,0,t.width,t.height])}(t,n),n.markSkyboxValid(t)):"sky"===t.renderPass&&function(t,i,n,r,o){const a=t.context,s=a.gl,l=t.transform,c=t.useProgram("skybox");a.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,i.skyboxTexture);const u=((e,t,i,n,r)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:n,u_temporal_offset:r}))(l.skyboxMatrix,i.getCenter(t,!1),0,r,o);t.prepareDrawProgram(a,c),c.draw(a,s.TRIANGLES,n,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.backCW,u,"skybox",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(t,n,c,a,u):"gradient"===l&&"sky"===t.renderPass&&function(t,i,n,r,o){const a=t.context,s=a.gl,l=t.transform,c=t.useProgram("skyboxGradient");i.skyboxGeometry||(i.skyboxGeometry=new Dn(a)),a.activeTexture.set(s.TEXTURE0);let u=i.colorRampTexture;u||(u=i.colorRampTexture=new e.Texture(a,i.colorRamp,s.RGBA)),u.bind(s.LINEAR,s.CLAMP_TO_EDGE);const h=((t,i,n,r,o)=>({u_matrix:t,u_color_ramp:0,u_center_direction:i,u_radius:e.degToRad(n),u_opacity:r,u_temporal_offset:o}))(l.skyboxMatrix,i.getCenter(t,!1),i.paint.get("sky-gradient-radius"),r,o);t.prepareDrawProgram(a,c),c.draw(a,s.TRIANGLES,n,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.backCW,h,"skyboxGradient",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(t,n,c,a,u)},debug:function(e,t,i){for(let n=0;n<i.length;n++)En(e,t,i[n])},custom:function(t,i,n,r){const o=t.context,a=n.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||"offscreen"===t.renderPass)&&n.isLayerDraped()){if("offscreen"===t.renderPass){const i=a.prerender;if(i){if(t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),"globe"===t.transform.projection.name){const n=t.transform.pointMerc;i.call(a,o.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.globeToMercatorTransition(t.transform.zoom),[n.x,n.y],t.transform.pixelsPerMeterRatio)}else i.call(a,o.gl,t.transform.customLayerMatrix());o.setDirty(),t.setBaseState()}}else if("translucent"===t.renderPass){if(t.terrain&&t.terrain.renderingToTexture){const i=a.renderToTile;if(i){const n=r[0].canonical,s=new e.MercatorCoordinate(n.x+r[0].wrap*(1<<n.z),n.y,n.z);o.setDepthMode(e.DepthMode.disabled),o.setStencilMode(e.StencilMode.disabled),o.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),i.call(a,o.gl,s),o.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),o.setStencilMode(e.StencilMode.disabled);const i="3d"===a.renderingMode?new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,e.DepthMode.ReadOnly);if(o.setDepthMode(i),"globe"===t.transform.projection.name){const i=t.transform.pointMerc;a.render(o.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.globeToMercatorTransition(t.transform.zoom),[i.x,i.y],t.transform.pixelsPerMeterRatio)}else a.render(o.gl,t.transform.customLayerMatrix());o.setDirty(),t.setBaseState(),o.bindFramebuffer.set(null)}}else e.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Fn{constructor(t,i,n=!1){this.context=new Ee(t,n),this.transform=i,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=e.SourceCache.maxUnderzooming+e.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Zt,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(e,t){const i=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new zi(this,e));const n=this._terrain;this.transform.elevation=i?n:null,n.update(e,this.transform,t)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,n]=t.getFovAdjustedRange(this.transform._fov);if(i>n)return void(this.transform.fogCullDistSq=null);const r=i+.78*(n-i);this.transform.fogCullDistSq=r*r}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,i){if(this.width=t*e.exported.devicePixelRatio,this.height=i*e.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._layers[e].resize()}setup(){const t=this.context,i=new e.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(e.EXTENT,0),i.emplaceBack(0,e.EXTENT),i.emplaceBack(e.EXTENT,e.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(i,e.posAttributes.members),this.tileExtentSegments=e.SegmentVector.simpleSegment(0,0,4,2);const n=new e.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(e.EXTENT,0),n.emplaceBack(0,e.EXTENT),n.emplaceBack(e.EXTENT,e.EXTENT),this.debugBuffer=t.createVertexBuffer(n,e.posAttributes.members),this.debugSegments=e.SegmentVector.simpleSegment(0,0,4,5);const r=new e.StructArrayLayout2i4;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(-1,1),r.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(r,e.posAttributes.members),this.viewportSegments=e.SegmentVector.simpleSegment(0,0,4,2);const o=new e.StructArrayLayout4i8;o.emplaceBack(0,0,0,0),o.emplaceBack(e.EXTENT,0,e.EXTENT,0),o.emplaceBack(0,e.EXTENT,0,e.EXTENT),o.emplaceBack(e.EXTENT,e.EXTENT,e.EXTENT,e.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(o,e.boundsAttributes.members),this.mercatorBoundsSegments=e.SegmentVector.simpleSegment(0,0,4,2);const a=new e.StructArrayLayout3ui6;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(a);const s=new e.StructArrayLayout1ui2;for(const e of[0,1,3,2,0])s.emplaceBack(e);this.debugIndexBuffer=t.createIndexBuffer(s),this.emptyTexture=new e.Texture(t,new e.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=e.create();const l=this.context.gl;this.stencilClearMode=new e.StencilMode({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(e.window.performance.now()),this.atmosphereBuffer=new On(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context,i=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(t,i.TRIANGLES,e.DepthMode.disabled,this.stencilClearMode,e.ColorMode.disabled,e.CullFaceMode.disabled,Ci(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,i,n){if(!i||this.currentStencilSource===i.id||!t.isTileClipped()||!n||0===n.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of n)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=i.id;const r=this.context,o=r.gl;this.nextStencilID+n.length>256&&this.clearStencil(),r.setColorMode(e.ColorMode.disabled),r.setDepthMode(e.DepthMode.disabled);const a=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const t of n){const n=i.getTile(t),s=this._tileClippingMaskIDs[t.key]=this.nextStencilID++,{tileBoundsBuffer:l,tileBoundsIndexBuffer:c,tileBoundsSegments:u}=this.getTileBoundsBuffers(n);a.draw(r,o.TRIANGLES,e.DepthMode.disabled,new e.StencilMode({func:o.ALWAYS,mask:0},s,255,o.KEEP,o.KEEP,o.REPLACE),e.ColorMode.disabled,e.CullFaceMode.disabled,Ci(t.projMatrix),"$clipping",l,c,u)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,i=this.context.gl;return new e.StencilMode({func:i.NOTEQUAL,mask:255},t,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const i=this.context.gl;return new e.StencilMode({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(t){const i=this.context.gl,n=t.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),r=n[n.length-1].overscaledZ,o=n[0].overscaledZ-r+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();const t={};for(let n=0;n<o;n++)t[n+r]=new e.StencilMode({func:i.GEQUAL,mask:255},n+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=o,[t,n]}return[{[r]:e.StencilMode.disabled},n]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new e.ColorMode([t.CONSTANT_COLOR,t.ONE],new e.Color(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?e.ColorMode.unblended:e.ColorMode.alphaBlended}depthModeForSublayer(t,i,n){if(!this.opaquePassEnabledForLayer())return e.DepthMode.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new e.DepthMode(n||this.context.gl.LEQUAL,i,[r,r])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,i){this.style=t,this.options=i,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.exported.now()),this.imageManager.beginFrame();const n=this.style.order,r=this.style._sourceCaches;for(const e in r){const t=r[e];t.used&&t.prepare(this.context)}const o={},a={},s={};for(const e in r){const t=r[e];o[e]=t.getVisibleCoordinates(),a[e]=o[e].slice().reverse(),s[e]=t.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let e=0;e<n.length;e++)if(this.style._layers[n[e]].is3D()){this.opaquePassCutoff=e;break}if(this.terrain&&(this.terrain.updateTileBinding(s),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new e.GlobeSharedBuffers(this.context)),e.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const e of n){const i=this.style._layers[e],n=t._getLayerSourceCache(i);if(!i.hasOffscreenPass()||i.isHidden(this.transform.zoom))continue;const r=n?a[n.id]:void 0;("custom"===i.type||i.isSky()||r&&r.length)&&this.renderLayer(this,n,i,r)}if(this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:i.showOverdrawInspector?e.Color.black:e.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=n.length-1;this.currentLayer>=0;this.currentLayer--){const e=this.style._layers[n[this.currentLayer]],i=t._getLayerSourceCache(e);if(e.isSky())continue;const r=i?a[i.id]:void 0;this._renderTileClippingMasks(e,i,r),this.renderLayer(this,i,e,r)}if(this.style.fog&&this.transform.projection.supportsFog&&function(t,i){const n=t.context,r=n.gl,o=t.transform,a=new e.DepthMode(r.LEQUAL,e.DepthMode.ReadOnly,[0,1]),s=t.useProgram("globeAtmosphere",null,"globe"===o.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),l=e.globeToMercatorTransition(o.zoom),c=i.properties.get("color").toArray01(),u=i.properties.get("high-color").toArray01(),h=i.properties.get("space-color").toArray01PremultipliedAlpha(),d=e.identity$1([]);e.rotateY$1(d,d,-e.degToRad(o._center.lng)),e.rotateX$1(d,d,e.degToRad(o._center.lat)),e.rotateZ$1(d,d,o.angle),e.rotateX$1(d,d,-o._pitch);const p=e.fromQuat(new Float32Array(16),d),f=e.mapValue(i.properties.get("star-intensity"),0,1,0,.25),m=5e-4,g=e.mapValue(i.properties.get("horizon-blend"),0,1,m,.25),_=e.globeUseCustomAntiAliasing(t,n,o)&&g===m?o.worldSize/(2*Math.PI*1.025)-1:o.globeRadius,y=t.frameCounter/1e3%1,x=e.length(o.globeCenterInViewSpace),v=Math.sqrt(Math.pow(x,2)-Math.pow(_,2)),b=Math.acos(v/x),w=((t,i,n,r,o,a,s,l,c,u,h,d,p,f)=>({u_frustum_tl:t,u_frustum_tr:i,u_frustum_br:n,u_frustum_bl:r,u_horizon:o,u_transition:a,u_fadeout_range:s,u_color:l,u_high_color:c,u_space_color:u,u_star_intensity:h,u_star_size:5*e.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:d,u_horizon_angle:p,u_rotation_matrix:f}))(o.frustumCorners.TL,o.frustumCorners.TR,o.frustumCorners.BR,o.frustumCorners.BL,o.frustumCorners.horizon,l,g,c,u,h,f,y,b,p);t.prepareDrawProgram(n,s);const M=t.atmosphereBuffer;M&&s.draw(n,r.TRIANGLES,a,e.StencilMode.disabled,e.ColorMode.alphaBlended,e.CullFaceMode.backCW,w,"skybox",M.vertexBuffer,M.indexBuffer,M.segments)}(this,this.style.fog),this.renderPass="sky",(e.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){const e=this.style._layers[n[this.currentLayer]],i=t._getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,i,e,i?a[i.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<n.length;){const e=this.style._layers[n[this.currentLayer]],i=t._getLayerSourceCache(e);if(e.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const r=i?("symbol"===e.type?s:a)[i.id]:void 0;this._renderTileClippingMasks(e,i,i?o[i.id]:void 0),this.renderLayer(this,i,e,r),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let i=null;e.values(this.style._layers).forEach((e=>{const n=t._getLayerSourceCache(e);n&&!e.isHidden(this.transform.zoom)&&(!i||i.getSource().maxzoom<n.getSource().maxzoom)&&(i=n)})),i&&this.options.showTileBoundaries&&Bn.debug(this,i,i.getVisibleCoordinates())}this.options.showPadding&&function(e){const t=e.transform.padding;Cn(e,e.transform.height-(t.top||0),3,bn),Cn(e,t.bottom||0,3,wn),An(e,t.left||0,3,Mn),An(e,e.transform.width-(t.right||0),3,Tn);const i=e.transform.centerPoint;!function(e,t,i,n){Pn(e,t-1,i-10,2,20,n),Pn(e,t-10,i-1,20,2,n)}(e,i.x,e.transform.height-i.y,Sn)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(e.window.performance.now()),this.saveCanvasCopy())}}renderLayer(e,t,i,n){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||n&&n.length)&&(this.id=i.id,this.gpuTimingStart(i),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(i.type)||e.terrain&&"custom"===i.type)&&Bn[i.type](e,t,i,n,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;let i=this.gpuTimers[e.id];i||(i=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:t.createQueryEXT()}),i.calls++,t.beginQueryEXT(t.TIME_ELAPSED_EXT,i.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=e.createQueryEXT();this.deferredRenderGpuTimeQueries.push(t),e.beginQueryEXT(e.TIME_ELAPSED_EXT,t)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const i in e){const n=e[i],r=this.context.extTimerQuery,o=r.getQueryObjectEXT(n.query,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(n.query),t[i]=o}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.extTimerQuery;let i=0;for(const n of e)i+=t.getQueryObjectEXT(n,t.QUERY_RESULT_EXT)/1e6,t.deleteQueryEXT(n);return i}translatePosMatrix(t,i,n,r,o){if(!n[0]&&!n[1])return t;const a=o?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(a){const e=Math.sin(a),t=Math.cos(a);n=[n[0]*t-n[1]*e,n[0]*e+n[1]*t]}const s=[o?n[0]:D(i,n[0],this.transform.zoom),o?n[1]:D(i,n[1],this.transform.zoom),0],l=new Float32Array(16);return e.translate(l,t,s),l}saveTileTexture(e){const t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e){return null===e||void 0!==e&&!this.imageManager.getPattern(e.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const e=this.terrain&&this.terrain.renderingToTexture,t=this.terrain&&0===this.terrain.exaggeration(),i=this.style&&this.style.fog,n=[];return this.terrainRenderModeElevated()&&n.push("TERRAIN"),"globe"===this.transform.projection.name&&n.push("GLOBE"),t&&n.push("ZERO_EXAGGERATION"),i&&!e&&0!==i.getOpacity(this.transform.pitch)&&n.push("FOG"),e&&n.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&n.push("OVERDRAW_INSPECTOR"),n}useProgram(e,t,i){this.cache=this.cache||{};const n=i||[],r=this.currentGlobalDefines().concat(n),o=Di.cacheKey(hi[e],e,r,t);return this.cache[o]||(this.cache[o]=new Di(this.context,e,hi[e],t,cn[e],r)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=e.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(t,i,n){if(this.terrain&&this.terrain.renderingToTexture)return;const r=this.style.fog;if(r){const o=r.getOpacity(this.transform.pitch),a=((t,i,n,r,o,a,s,l,c,u,h)=>{const d=t.transform,p=i.properties.get("color").toArray01();p[3]=r;const f=t.frameCounter/1e3%1;return{u_fog_matrix:n?d.calculateFogTileMatrix(n):t.identityMat,u_fog_range:i.getFovAdjustedRange(d._fov),u_fog_color:p,u_fog_horizon_blend:i.properties.get("horizon-blend"),u_fog_temporal_offset:f,u_frustum_tl:o,u_frustum_tr:a,u_frustum_br:s,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:u,u_viewport:h,u_globe_transition:e.globeToMercatorTransition(d.zoom),u_is_globe:+("globe"===d.projection.name)}})(this,r,n,o,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*e.exported.devicePixelRatio,this.transform.height*e.exported.devicePixelRatio]);i.setFogUniformValues(t,a)}}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,i=this._backgroundTiles={},n=this.transform.coveringTiles({tileSize:512});for(const r of n)i[r.key]=t[r.key]||new e.Tile(r,512,this.transform.tileZoom,this);return i}clearBackgroundTiles(){this._backgroundTiles={}}}class Nn{constructor(e=0,t=0,i=0,n=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(i)||i<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=i,this.right=n}interpolate(t,i,n){return null!=i.top&&null!=t.top&&(this.top=e.number(t.top,i.top,n)),null!=i.bottom&&null!=t.bottom&&(this.bottom=e.number(t.bottom,i.bottom,n)),null!=i.left&&null!=t.left&&(this.left=e.number(t.left,i.left,n)),null!=i.right&&null!=t.right&&(this.right=e.number(t.right,i.right,n)),this}getCenter(t,i){const n=e.clamp((this.left+t-this.right)/2,0,t),r=e.clamp((this.top+i-this.bottom)/2,0,i);return new e.pointGeometry(n,r)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Nn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Un(t,i){const n=e.getColumn(t,3);e.fromQuat(t,i),e.setColumn(t,3,n)}function Vn(t,i){const n=e.identity$1([]);return e.rotateZ$1(n,n,-i),e.rotateX$1(n,n,-t),n}function Gn(t,i){const n=[t[0],t[1],0],r=[i[0],i[1],0];if(e.length(n)>=1e-15){const t=e.normalize([],n);e.scale$2(r,t,e.dot(r,t)),i[0]=r[0],i[1]=r[1]}const o=e.cross([],i,t);if(e.len(o)<1e-15)return null;const a=Math.atan2(-o[1],o[0]);return Vn(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),a)}class jn{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(t){if(t){const i=t instanceof e.MercatorCoordinate?t:new e.MercatorCoordinate(t[0],t[1],t[2]);this._renderWorldCopies&&(i.x=e.wrap(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(t,i){if(this.orientation=null,!this.position)return;const n=this._elevation?this._elevation.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(t)):0,r=this.position,o=e.MercatorCoordinate.fromLngLat(t,n),a=[o.x-r.x,o.y-r.y,o.z-r.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=Gn(a,i)}setPitchBearing(t,i){this.orientation=Vn(e.degToRad(t),e.degToRad(-i))}}class Wn{constructor(t,i){this._transform=e.identity([]),this.orientation=i,this.position=t}get mercatorPosition(){const t=this.position;return new e.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=e.getColumn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var i;t&&e.setColumn(this._transform,3,[(i=t)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||e.identity$1([]),t&&Un(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=Vn(e,t),Un(this._transform,this._orientation)}forward(){const t=e.getColumn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=e.getColumn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=e.getColumn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,i){const n=new Float64Array(16);return e.invert(n,this.getWorldToCamera(t,i)),n}getWorldToCameraPosition(t,i,n){const r=this.position;e.scale$2(r,r,-t);const o=new Float64Array(16);return e.fromScaling(o,[n,n,n]),e.translate(o,o,r),o[10]*=i,o}getWorldToCamera(t,i){const n=new Float64Array(16),r=new Float64Array(4),o=this.position;return e.conjugate(r,this._orientation),e.scale$2(o,o,-t),e.fromQuat(n,r),e.translate(n,n,o),n[1]*=-1,n[5]*=-1,n[9]*=-1,n[13]*=-1,n[8]*=i,n[9]*=i,n[10]*=i,n[11]*=i,n}getCameraToClipPerspective(t,i,n,r){const o=new Float64Array(16);return e.perspective(o,t,i,n,r),o}getDistanceToElevation(t,i=!1){const n=0===t?0:e.mercatorZfromAltitude(t,i?e.latFromMercatorY(this.position[1]):this.position[1]),r=this.forward();return(n-this.position[2])/r[2]}clone(){return new Wn([...this.position],[...this.orientation])}}function $n(t,i){const n=Zn(t.projection,t.zoom,t.width,t.height),r=function(t,i,n,r,o){const a=new e.LngLat(n.lng-180*Hn,n.lat),s=new e.LngLat(n.lng+180*Hn,n.lat),l=t.project(a.lng,a.lat),c=t.project(s.lng,s.lat),u=-Math.atan2(c.y-l.y,c.x-l.x),h=e.MercatorCoordinate.fromLngLat(n);h.y=e.clamp(h.y,-.999975,.999975);const d=h.toLngLat(),p=t.project(d.lng,d.lat),f=e.MercatorCoordinate.fromLngLat(d);f.x+=Hn;const m=f.toLngLat(),g=t.project(m.lng,m.lat),_=Yn(g.x-p.x,g.y-p.y,u),y=e.MercatorCoordinate.fromLngLat(d);y.y+=Hn;const x=y.toLngLat(),v=t.project(x.lng,x.lat),b=Yn(v.x-p.x,v.y-p.y,u),w=Math.abs(_.x)/Math.abs(b.y),M=e.identity([]);e.rotateZ(M,M,-u*(1-(o?0:r)));const T=e.identity([]);return e.scale(T,T,[1,1-(1-w)*r,1]),T[4]=-b.x/b.y*r,e.rotateZ(T,T,u),e.multiply(T,M,T),T}(t.projection,0,t.center,n,i),o=qn(t);return e.scale(r,r,[o,o,1]),r}function qn(t){const i=t.projection,n=Zn(t.projection,t.zoom,t.width,t.height),r=Xn(i,t.center),o=Xn(i,e.LngLat.convert(i.center));return Math.pow(2,r*n+(1-n)*o)}function Zn(t,i,n,r,o=1/0){const a=t.range;if(!a)return 0;const s=Math.min(o,Math.max(n,r)),l=Math.log(s/1024)/Math.LN2;return e.smoothstep(a[0]+l,a[1]+l,i)}const Hn=1/4e4;function Xn(t,i){const n=e.clamp(i.lat,-e.MAX_MERCATOR_LATITUDE,e.MAX_MERCATOR_LATITUDE),r=new e.LngLat(i.lng-180*Hn,n),o=new e.LngLat(i.lng+180*Hn,n),a=t.project(r.lng,n),s=t.project(o.lng,n),l=e.MercatorCoordinate.fromLngLat(r),c=e.MercatorCoordinate.fromLngLat(o),u=s.x-a.x,h=s.y-a.y,d=c.x-l.x,p=c.y-l.y,f=Math.sqrt((d*d+p*p)/(u*u+h*h));return Math.log(f)/Math.LN2}function Yn(e,t,i){const n=Math.cos(i),r=Math.sin(i);return{x:e*n-t*r,y:e*r+t*n}}class Jn{constructor(t,i,n,r,o,a,s){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=null==n?0:n,this._maxPitch=null==r?60:r,this.setProjection(a),this.setMaxBounds(s),this.width=0,this.height=0,this._center=new e.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Nn,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Wn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const e=new Jn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(e,t=!1){const i=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||i)&&this._updateCameraOnTerrain(),(e||i)&&this._constrainCamera(t),this._calcMatrices()}getProjection(){return e.pick(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=e.getProjection(this.projectionOptions);const r=!t(n,this.getProjection());return r&&this._calcMatrices(),this.mercatorFromTransition=!1,r}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=e.getProjection({name:"mercator"});const i=t!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return e.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.pointGeometry(this.width,this.height)}get bearing(){return e.wrap(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const i=-t*Math.PI/180;var n;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=(n=new e.ARRAY_TYPE(4),e.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n),function(e,t,i){var n=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(i),l=Math.cos(i);e[0]=n*l+o*s,e[1]=r*l+a*s,e[2]=n*-s+o*l,e[3]=r*-s+a*l}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const i=e.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=e.degToRad(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const e=this._elevation;this._centerAltitude=e.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=e.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],n=this.horizonLineFromTop();let r=0,o=0;for(let a=0;a<i.length;a++){const s=new e.pointGeometry(i[a][0]*this.width,n+i[a][1]*(this.height-n)),l=t.pointCoordinate(s);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);r+=l[3]*c,o+=c}return 0===o?NaN:r/o}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*t,n=this._mercatorZfromZoom(e),r=this._mercatorZfromZoom(this._maxZoom),o=Math.max(n-i,r);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(t){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let n;n=t.z<this._camera.position[2]?[i.x,i.y,i.z]:[t.x,t.y,t.z];const r=e.length(e.sub([],this._camera.position,n));return e.clamp(this._zoomFromMercatorZ(r),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let i=!1;if(t.orientation&&!e.exactEquals(t.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(t.orientation)),t.position){const n=[t.position.x,t.position.y,t.position.z];e.exactEquals$1(n,this._camera.position)||(this._setCameraPosition(n),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,i=new jn;return i.position=new e.MercatorCoordinate(t[0],t[1],t[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(t){if(!e.length$1(t))return!1;e.normalize$1(t,t);const i=e.transformQuat([],[0,0,-1],t),n=e.transformQuat([],[0,-1,0],t);if(n[2]<0)return!1;const r=Gn(i,n);return!!r&&(this._camera.orientation=r,!0)}_setCameraPosition(t){const i=this.zoomScale(this.minZoom)*this.tileSize,n=this.zoomScale(this.maxZoom)*this.tileSize,r=this.cameraToCenterDistance;t[2]=e.clamp(t[2],r/n,r/i),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,i){this._unmodified=!1,this._edgeInsets.interpolate(e,t,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const i=[new e.UnwrappedTileID(0,t)];if(this.renderWorldCopies){const n=this.pointCoordinate(new e.pointGeometry(0,0)),r=this.pointCoordinate(new e.pointGeometry(this.width,0)),o=this.pointCoordinate(new e.pointGeometry(this.width,this.height)),a=this.pointCoordinate(new e.pointGeometry(0,this.height)),s=Math.floor(Math.min(n.x,r.x,o.x,a.x)),l=Math.floor(Math.max(n.x,r.x,o.x,a.x)),c=1;for(let n=s-c;n<=l+c;n++)0!==n&&i.push(new e.UnwrappedTileID(n,t))}return i}coveringTiles(t){let i=this.coveringZoomLevel(t);const n=i,r=this.elevation&&!t.isTerrainDEM,o="mercator"===this.projection.name;if(void 0!==t.minzoom&&i<t.minzoom)return[];void 0!==t.maxzoom&&i>t.maxzoom&&(i=t.maxzoom);const a=this.locationCoordinate(this.center),s=this.center.lat,l=1<<i,c=[l*a.x,l*a.y,0],u="globe"===this.projection.name,h=!u,d=e.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,h),p=u?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),f=l*e.mercatorZfromAltitude(1,this.center.lat),m=this._camera.position[2]/e.mercatorZfromAltitude(1,this.center.lat),g=[l*p.x,l*p.y,m*(h?1:f)],_=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),y=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?i:0,x=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,v=t.isTerrainDEM?-x:this._elevation?this._elevation.getMinElevationBelowMSL():0,b=this.projection.isReprojectedInTileSpace?qn(this):1,w=t=>{const i=1/4e4,n=new e.MercatorCoordinate(t.x+i,t.y,t.z),r=new e.MercatorCoordinate(t.x,t.y+i,t.z),o=t.toLngLat(),a=n.toLngLat(),s=r.toLngLat(),l=this.locationCoordinate(o),c=this.locationCoordinate(a),u=this.locationCoordinate(s),h=Math.hypot(c.x-l.x,c.y-l.y),d=Math.hypot(u.x-l.x,u.y-l.y);return Math.sqrt(h*d)*b/i},M=t=>{const i=x,n=v;return{aabb:e.tileAABB(this,l,0,0,0,t,n,i,this.projection),zoom:0,x:0,y:0,minZ:n,maxZ:i,wrap:t,fullyVisible:!1}},T=[];let S=[];const E=i,C=t.reparseOverscaled?n:i,A=e=>e*e,P=A((m-this._centerAltitude)*f),I=e=>{if(!this._elevation||!e.tileID||!o)return;const t=this._elevation.getMinMaxForTile(e.tileID),i=e.aabb;t?(i.min[2]=t.min,i.max[2]=t.max,i.center[2]=(i.min[2]+i.max[2])/2):(e.shouldSplit=k(e),e.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=this._centerAltitude))},k=t=>{if(t.zoom<y)return!0;if(t.zoom===E)return!1;if(null!=t.shouldSplit)return t.shouldSplit;const i=t.aabb.distanceX(g),o=t.aabb.distanceY(g);let a=P,l=1;if(u){a=A(t.aabb.distanceZ(g));const i=Math.pow(2,t.zoom),n=e.latFromMercatorY((t.y+1)/i),r=e.latFromMercatorY(t.y/i),o=Math.min(Math.max(s,n),r),c=e.circumferenceAtLatitude(o)/e.circumferenceAtLatitude(s);if(l=o===s?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,c/this._mercatorScaleRatio),this.zoom<=e.GLOBE_ZOOM_THRESHOLD_MIN&&t.zoom===E-1&&c>=.9)return!0}else if(r&&(a=A(t.aabb.distanceZ(g)*f)),this.projection.isReprojectedInTileSpace&&n<=5){const i=Math.pow(2,t.zoom),n=w(new e.MercatorCoordinate((t.x+.5)/i,(t.y+.5)/i));l=n>.85?1:n}const c=i*i+o*o+a,h=A((1<<E-t.zoom)*_*l*((e,t)=>{if(t*A(.707)<e)return 1;const i=Math.sqrt(t/e);return i/(1.4144271570014144+(Math.pow(1.1,i-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(a,P),c));return c<h};if(this.renderWorldCopies)for(let e=1;e<=3;e++)T.push(M(-e)),T.push(M(e));for(T.push(M(0));T.length>0;){const n=T.pop(),a=n.x,s=n.y;let h=n.fullyVisible;if(!h){const e=n.aabb.intersects(d);if(0===e)continue;h=2===e}if(n.zoom!==E&&k(n))for(let t=0;t<4;t++){const i=(a<<1)+t%2,c=(s<<1)+(t>>1),d={aabb:o?n.aabb.quadrant(t):e.tileAABB(this,l,n.zoom+1,i,c,n.wrap,n.minZ,n.maxZ,this.projection),zoom:n.zoom+1,x:i,y:c,wrap:n.wrap,fullyVisible:h,tileID:void 0,shouldSplit:void 0,minZ:n.minZ,maxZ:n.maxZ};r&&!u&&(d.tileID=new e.OverscaledTileID(n.zoom+1===E?C:n.zoom+1,n.wrap,n.zoom+1,i,c),I(d)),T.push(d)}else{const r=n.zoom===E?C:n.zoom;if(t.minzoom&&t.minzoom>r)continue;const o=c[0]-(.5+a+(n.wrap<<n.zoom))*(1<<i-n.zoom),l=c[1]-.5-s,u=n.tileID?n.tileID:new e.OverscaledTileID(r,n.wrap,n.zoom,a,s);S.push({tileID:u,distanceSq:o*o+l*l})}}if(this.fogCullDistSq){const i=this.fogCullDistSq,n=this.horizonLineFromTop();S=S.filter((r=>{const o=[0,0,0,1],a=[e.EXTENT,e.EXTENT,0,1],s=this.calculateFogTileMatrix(r.tileID.toUnwrapped());e.transformMat4$1(o,o,s),e.transformMat4$1(a,a,s);const l=e.getAABBPointSquareDist(o,a);if(0===l)return!0;let c=!1;const u=this._elevation;if(u&&l>i&&0!==n){const i=this.calculateProjMatrix(r.tileID.toUnwrapped());let o;t.isTerrainDEM||(o=u.getMinMaxForTile(r.tileID)),o||(o={min:v,max:x});const a=e.furthestTileCorner(this.rotation),s=[a[0]*e.EXTENT,a[1]*e.EXTENT,o.max];e.transformMat4(s,s,i),c=(1-s[1])*this.height*.5<n}return l<i||c}))}return S.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){const i=e.clamp(t.lat,-e.MAX_MERCATOR_LATITUDE,e.MAX_MERCATOR_LATITUDE),n=this.projection.project(t.lng,i);return new e.pointGeometry(n.x*this.worldSize,n.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/e.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,i){let n,r;const o=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;n=(i.x-o.x)/e,r=(i.y-o.y)/e}else{const e=this.pointCoordinate(i),t=this.pointCoordinate(o);n=e.x-t.x,r=e.y-t.y}const a=this.locationCoordinate(t);this.setLocation(new e.MercatorCoordinate(a.x-n,a.y-r))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(t,i){const n=i?e.mercatorZfromAltitude(i,t.lat):void 0,r=this.projection.project(t.lng,t.lat);return new e.MercatorCoordinate(r.x,r.y,n)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(t,i){const n=null!=i?i:this._centerAltitude,r=[t.x,t.y,0,1],o=[t.x,t.y,1,1];e.transformMat4$1(r,r,this.pixelMatrixInverse),e.transformMat4$1(o,o,this.pixelMatrixInverse);const a=o[3];e.scale$1(r,r,1/r[3]),e.scale$1(o,o,1/a);const s=r[2],l=o[2];return{p0:r,p1:o,t:s===l?0:(n-s)/(l-s)}}screenPointToMercatorRay(t){const i=[t.x,t.y,0,1],n=[t.x,t.y,1,1];return e.transformMat4$1(i,i,this.pixelMatrixInverse),e.transformMat4$1(n,n,this.pixelMatrixInverse),e.scale$1(i,i,1/i[3]),e.scale$1(n,n,1/n[3]),i[2]=e.mercatorZfromAltitude(i[2],this._center.lat)*this.worldSize,n[2]=e.mercatorZfromAltitude(n[2],this._center.lat)*this.worldSize,e.scale$1(i,i,1/this.worldSize),e.scale$1(n,n,1/this.worldSize),new e.Ray([i[0],i[1],i[2]],e.normalize([],e.sub([],n,i)))}rayIntersectionCoordinate(t){const{p0:i,p1:n,t:r}=t,o=e.mercatorZfromAltitude(i[2],this._center.lat),a=e.mercatorZfromAltitude(n[2],this._center.lat);return new e.MercatorCoordinate(e.number(i[0],n[0],r)/this.worldSize,e.number(i[1],n[1],r)/this.worldSize,e.number(o,a,r))}pointCoordinate(e,t=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let i=this.projection.pointCoordinate3D(this,t.x,t.y);if(i)return new e.MercatorCoordinate(i[0],i[1],i[2]);let n=0,r=this.horizonLineFromTop();if(t.y>r)return this.pointCoordinate(t);const o=.02*r,a=t.clone();for(let t=0;t<10&&r-n>o;t++){a.y=e.number(n,r,.66);const t=this.projection.pointCoordinate3D(this,a.x,a.y);t?(r=a.y,i=t):n=a.y}return i?new e.MercatorCoordinate(i[0],i[1],i[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}_coordinatePoint(t,i){const n=i&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,r=[t.x*this.worldSize,t.y*this.worldSize,n+t.toAltitude(),1];return e.transformMat4$1(r,r,this.pixelMatrix),r[3]>0?new e.pointGeometry(r[0]/r[3],r[1]/r[3]):new e.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:i}=this._edgeInsets,n=this.height-this._edgeInsets.bottom,r=this.width-this._edgeInsets.right,o=this.pointLocation3D(new e.pointGeometry(i,t)),a=this.pointLocation3D(new e.pointGeometry(r,t)),s=this.pointLocation3D(new e.pointGeometry(r,n)),l=this.pointLocation3D(new e.pointGeometry(i,n));let c=Math.min(o.lng,a.lng,s.lng,l.lng),u=Math.max(o.lng,a.lng,s.lng,l.lng),h=Math.min(o.lat,a.lat,s.lat,l.lat),d=Math.max(o.lat,a.lat,s.lat,l.lat);const p=Math.pow(2,-this.zoom)/16*270,f="globe"===this.projection.name?1:4,m=(t,i,n,r,o)=>{const a=(t+n)/2,s=(i+r)/2,l=new e.pointGeometry(a,s),{lng:g,lat:_}=this.pointLocation3D(l),y=Math.max(0,c-g,h-_,g-u,_-d);c=Math.min(c,g),u=Math.max(u,g),h=Math.min(h,_),d=Math.max(d,_),(o<f||y>p)&&(m(t,i,a,s,o+1),m(a,s,n,r,o+1))};if(m(i,t,r,t,1),m(r,t,r,n,1),m(r,n,i,n,1),m(i,n,i,t,1),"globe"===this.projection.name){const[t,i]=e.polesInViewport(this);t?(d=90,u=180,c=-180):i&&(h=-90,u=180,c=-180)}return new e.LngLatBounds(new e.LngLat(c,h),new e.LngLat(u,d))}_getBoundsRectangular(t,i){const{top:n,left:r}=this._edgeInsets,o=this.height-this._edgeInsets.bottom,a=this.width-this._edgeInsets.right,s=new e.pointGeometry(r,n),l=new e.pointGeometry(a,n),c=new e.pointGeometry(a,o),u=new e.pointGeometry(r,o);let h=this.pointCoordinate(s,t),d=this.pointCoordinate(l,t);const p=this.pointCoordinate(c,i),f=this.pointCoordinate(u,i),m=(e,t)=>(t.y-e.y)/(t.x-e.x);return h.y>1&&d.y>=0?h=new e.MercatorCoordinate((1-f.y)/m(f,h)+f.x,1):h.y<0&&d.y<=1&&(h=new e.MercatorCoordinate(-f.y/m(f,h)+f.x,0)),d.y>1&&h.y>=0?d=new e.MercatorCoordinate((1-p.y)/m(p,d)+p.x,1):d.y<0&&h.y<=1&&(d=new e.MercatorCoordinate(-p.y/m(p,d)+p.x,0)),(new e.LngLatBounds).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(d)).extend(this.coordinateLocation(f)).extend(this.coordinateLocation(p))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const t=e.visibleDemTiles.reduce(((e,t)=>{if(t.dem){const i=t.dem.tree;e.min=Math.min(e.min,i.minimums[0]),e.max=Math.max(e.max,i.maximums[0])}return e}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(e=!0){const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,i=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-e.MAX_MERCATOR_LATITUDE,this.maxLat=e.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=e.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=e.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=e.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=e.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(t){const i=t.key,n=this._distanceTileDataCache;if(n[i])return n[i];const r=t.canonical,o=1/this.height,a=this.cameraWorldSize,s=a/this.zoomScale(r.z),l=(r.x+Math.pow(2,r.z)*t.wrap)*s,c=r.y*s,u=this.point;u.x*=a/this.worldSize,u.y*=a/this.worldSize;const h=this.angle,d=Math.sin(-h),p=-Math.cos(-h);return n[i]={bearing:[d,p],center:[(u.x-l)*o,(u.y-c)*o],scale:s/e.EXTENT*o},n[i]}calculateFogTileMatrix(t){const i=t.key,n=this._fogTileMatrixCache;if(n[i])return n[i];const r=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return e.multiply(r,this.worldToFogMatrix,r),n[i]=new Float32Array(r),n[i]}calculateProjMatrix(t,i=!1){const n=t.key,r=i?this._alignedProjMatrixCache:this._projMatrixCache;if(r[n])return r[n];const o=this.calculatePosMatrix(t,this.worldSize);return e.multiply(o,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:i?this.alignedProjMatrix:this.projMatrix,o),r[n]=new Float32Array(o),r[n]}calculatePixelsToTileUnitsMatrix(t){const i=t.tileID.key,n=this._pixelsToTileUnitsCache;if(n[i])return n[i];const r=function(t,i){const{scale:n}=t.tileTransform,r=n*e.EXTENT/(t.tileSize*Math.pow(2,i.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return o=new Float32Array(4),l=(a=i.inverseAdjustmentMatrix)[1],c=a[2],u=a[3],d=(s=[r,r])[1],o[0]=a[0]*(h=s[0]),o[1]=l*h,o[2]=c*d,o[3]=u*d,o;var o,a,s,l,c,u,h,d}(t,this);return n[i]=r,n[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,i=e.fromScaling([],[t,t,t]);return e.multiply(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const i=e.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(i),r=this._camera.forward(),o=e.mercatorZfromAltitude(1,this._center.lat);n[2]/=o,r[2]/=o,e.normalize(r,r);const a=t.raycast(n,r,t.exaggeration());if(a){const t=e.scaleAndAdd([],n,r,a),i=new e.MercatorCoordinate(t[0],t[1],e.mercatorZfromAltitude(t[2],e.latFromMercatorY(t[1]))),s=(i.z+e.length([i.x-n[0],i.y-n[1],i.z-n[2]*o]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(s),this._centerAltitude=i.toAltitude(),this._center=this.coordinateLocation(i),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const i=this._elevation,n=e.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(n),o=i.getAtPointOrZero(new e.MercatorCoordinate(...r)),a=this.pixelsPerMeter/this.worldSize*o,s=this._minimumHeightOverTerrain(),l=r[2]-a;if(l<=s)if(l<0||t){const t=this.locationCoordinate(this._center,this._centerAltitude),i=[r[0],r[1],t.z-r[2]],n=e.length(i);i[2]-=(s-l)/this._pixelsPerMercatorPixel;const o=e.length(i);if(0===o)return;e.scale$2(i,i,n/o*this._pixelsPerMercatorPixel),this._camera.position=[r[0],r[1],t.z*this._pixelsPerMercatorPixel-i[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const i=this.center;return i.lat=e.clamp(i.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(i.lng=e.clamp(i.lng,this.minLng,this.maxLng)),this.center=i,void(this._constraining=!1)}const i=this._unmodified,{x:n,y:r}=this.point;let o=0,a=n,s=r;const l=this.width/2,c=this.height/2,u=this.worldMinY*this.scale,h=this.worldMaxY*this.scale;if(r-c<u&&(s=u+c),r+c>h&&(s=h-c),h-u<this.height&&(o=Math.max(o,this.height/(h-u)),s=(h+u)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,i=this.worldSize/2-(e+t)/2;a=(n+i+this.worldSize)%this.worldSize-i,a-l<e&&(a=e+l),a+l>t&&(a=t-l),t-e<this.width&&(o=Math.max(o,this.width/(t-e)),a=(t+e)/2)}a===n&&s===r||(this.center=this.unproject(new e.pointGeometry(a,s))),o&&(this.zoom+=this.scaleZoom(o)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,i=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=e.mercatorZfromAltitude(1,this.center.lat)/e.mercatorZfromAltitude(1,e.GLOBE_SCALE_MATCH_LATITUDE));const n=Zn(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,n),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const r="meters"===this.projection.zAxisUnit?i:1,o=this._camera.getWorldToCamera(this.worldSize,r),a=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);a[8]=2*-t.x/this.width,a[9]=2*t.y/this.height;let s=e.mul([],a,o);if(this.projection.isReprojectedInTileSpace){const t=this.locationCoordinate(this.center),i=e.identity([]);e.translate(i,i,[t.x*this.worldSize,t.y*this.worldSize,0]),e.multiply(i,i,$n(this)),e.translate(i,i,[-t.x*this.worldSize,-t.y*this.worldSize,0]),e.multiply(s,s,i),this.inverseAdjustmentMatrix=function(e){const t=$n(e,!0);return y([],[t[0],t[1],t[4],t[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=e.scale([],s,[this.worldSize,this.worldSize,this.worldSize/r,1]),this.projMatrix=s,this.invProjMatrix=e.invert(new Float64Array(16),this.projMatrix);const l=e.invert([],a);this.frustumCorners=e.FrustumCorners.fromInvProjectionMatrix(l,this.horizonLineFromTop(),this.height);const c=new Float32Array(16);e.identity(c),e.scale(c,c,[1,-1,1]),e.rotateX(c,c,this._pitch),e.rotateZ(c,c,this.angle);const u=e.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),h=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;u[8]=2*-t.x/this.width,u[9]=2*(t.y+h)/this.height,this.skyboxMatrix=e.multiply(c,u,c);const d=this.point,p=d.x,f=d.y,m=this.width%2/2,g=this.height%2/2,_=Math.cos(this.angle),x=Math.sin(this.angle),v=p-Math.round(p)+_*m+x*g,b=f-Math.round(f)+_*g+x*m,w=new Float64Array(s);if(e.translate(w,w,[v>.5?v-1:v,b>.5?b-1:b,0]),this.alignedProjMatrix=w,s=e.create(),e.scale(s,s,[this.width/2,-this.height/2,1]),e.translate(s,s,[1,-1,0]),this.labelPlaneMatrix=s,s=e.create(),e.scale(s,s,[1,-1,1]),e.translate(s,s,[-1,-1,0]),e.scale(s,s,[2/this.width,2/this.height,1]),this.glCoordMatrix=s,this.pixelMatrix=e.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},s=e.invert(new Float64Array(16),this.pixelMatrix),!s)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=s,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=e.calculateGlobeMatrix(this);const t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=e.transformMat4(t,t,o),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=s;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,n=this._camera.position,r=1/this.height/this._pixelsPerMercatorPixel,o=[t,t,i];e.scale$2(o,o,r),e.scale$2(n,n,-1),e.multiply$2(n,n,o);const a=e.create();e.translate(a,a,n),e.scale(a,a,o),this.mercatorFogMatrix=a,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,i,r)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),n=this.point,r=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[n.x/this.worldSize-i[0]*r,n.y/this.worldSize-i[1]*r,e/this.worldSize*this._centerAltitude-i[2]*r]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),n=this._camera.position[2],r=t[2];let o=1;this.projection.wrap&&(this.center=this.center.wrap()),r>0&&(o=Math.min((i-n)/r,1)),this._camera.position=e.scaleAndAdd([],this._camera.position,t,o),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,i=this._camera.forward(),{pitch:n,bearing:r}=this._camera.getPitchBearing(),o=e.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,a=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.degToRad(this._maxPitch)),s=Math.max((t[2]-o)/Math.cos(n),a),l=this._zoomFromMercatorZ(s);e.scaleAndAdd(t,t,i,s),this._pitch=e.clamp(n,e.degToRad(this.minPitch),e.degToRad(this.maxPitch)),this.angle=e.wrap(r,-Math.PI,Math.PI),this._setZoom(e.clamp(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new e.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(t){let i=0,n=e.GLOBE_ZOOM_THRESHOLD_MAX,r=0,o=1/0;for(;n-i>1e-6&&n>i;){const e=i+.5*(n-i),a=this.tileSize*Math.pow(2,e),s=this.getCameraToCenterDistance(this.projection,e,a),l=this.scaleZoom(s/(t*this.tileSize)),c=Math.abs(e-l);c<o&&(o=c,r=e),e<l?i=e:n=e}return r}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(e.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,i){const n=Math.min(t.x,i.x),r=Math.max(t.x,i.x),o=Math.min(t.y,i.y),a=Math.max(t.y,i.y);if(o<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const s=[new e.pointGeometry(n,o),new e.pointGeometry(r,a),new e.pointGeometry(n,a),new e.pointGeometry(r,o)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const e of s){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const i=this.rayIntersectionCoordinate(t);if(i.x<l||i.y<0||i.x>c||i.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new e.pointGeometry(0,0),new e.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,i){const n=e.length(e.sub([],this._camera.position,t)),r=this._zoomFromMercatorZ(n)+i;return n-this._mercatorZfromZoom(r)}getCameraPoint(){if("globe"===this.projection.name){const t=function([t,i,n],r){const o=[t,i,n,1];e.transformMat4$1(o,o,r);const a=o[3]=Math.max(o[3],1e-6);return o[0]/=a,o[1]/=a,o[2]/=a,o}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new e.pointGeometry(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.pointGeometry(0,t))}}getCameraToCenterDistance(e,t=this.zoom,i=this.worldSize){const n=Zn(e,t,this.width,this.height,1024),r=e.pixelSpaceConversion(this.center.lat,i,n);return.5/Math.tan(.5*this._fov)*this.height*r}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&e.multiply(t,t,this.globeMatrix),t}}function Kn(e,t){let i=!1,n=null;const r=()=>{n=null,i&&(e(),n=setTimeout(r,t),i=!1)};return()=>(i=!0,n||r(),n)}class Qn{constructor(t){this._hashName=t&&encodeURIComponent(t),e.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Kn(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,e.window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),e.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const i=er(t);if(this._hashName){const t=this._hashName;let n=!1;const r=e.window.location.hash.slice(1).split("&").map((e=>{const r=e.split("=")[0];return r===t?(n=!0,`${r}=${i}`):e})).filter((e=>e));return n||r.push(`${t}=${i}`),`#${r.join("&")}`}return`#${i}`}_getCurrentHash(){const t=e.window.location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map((e=>e.split("="))).forEach((t=>{t[0]===this._hashName&&(e=t)})),(e&&e[1]||"").split("/")}return t.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some((e=>isNaN(e)))){const i=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:i,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=e.window.location.href.replace(/(#.+)?$/,this.getHashString());e.window.history.replaceState(e.window.history.state,null,t)}}function er(e,t){const i=e.getCenter(),n=Math.round(100*e.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,r),a=Math.round(i.lng*o)/o,s=Math.round(i.lat*o)/o,l=e.getBearing(),c=e.getPitch();let u=t?`/${a}/${s}/${n}`:`${n}/${s}/${a}`;return(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+=`/${Math.round(c)}`),u}const tr={linearity:.3,easing:e.bezier(0,0,.3,1)},ir=e.extend({deceleration:2500,maxSpeed:1400},tr),nr=e.extend({deceleration:20,maxSpeed:1400},tr),rr=e.extend({deceleration:1e3,maxSpeed:360},tr),or=e.extend({deceleration:1e3,maxSpeed:90},tr);class ar{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,i=e.exported.now();for(;t.length>0&&i-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new e.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)i.zoom+=e.zoomDelta||0,i.bearing+=e.bearingDelta||0,i.pitch+=e.pitchDelta||0,e.panDelta&&i.pan._add(e.panDelta),e.around&&(i.around=e.around),e.pinchAround&&(i.pinchAround=e.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(i.pan.mag()){const o=lr(i.pan.mag(),n,e.extend({},ir,t||{}));r.offset=i.pan.mult(o.amount/i.pan.mag()),r.center=this._map.transform.center,sr(r,o)}if(i.zoom){const e=lr(i.zoom,n,nr);r.zoom=this._map.transform.zoom+e.amount,sr(r,e)}if(i.bearing){const t=lr(i.bearing,n,rr);r.bearing=this._map.transform.bearing+e.clamp(t.amount,-179,179),sr(r,t)}if(i.pitch){const e=lr(i.pitch,n,or);r.pitch=this._map.transform.pitch+e.amount,sr(r,e)}if(r.zoom||r.bearing){const e=void 0===i.pinchAround?i.around:i.pinchAround;r.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),r.noMoveStart=!0,r}}function sr(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function lr(t,i,n){const{maxSpeed:r,linearity:o,deceleration:a}=n,s=e.clamp(t*o/(i/1e3),-r,r),l=Math.abs(s)/(a*o);return{easing:n.easing,duration:1e3*l,amount:s*(l/2)}}class cr extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,n,r={}){const o=f(i.getCanvasContainer(),n),a=i.unproject(o);super(t,e.extend({point:o,lngLat:a,originalEvent:n},r)),this._defaultPrevented=!1,this.target=i}}class ur extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,n){const r="touchend"===t?n.changedTouches:n.touches,o=m(i.getCanvasContainer(),r),a=o.map((e=>i.unproject(e))),s=o.reduce(((e,t,i,n)=>e.add(t.div(n.length))),new e.pointGeometry(0,0));super(t,{points:o,point:s,lngLats:a,lngLat:i.unproject(s),originalEvent:n}),this._defaultPrevented=!1}}class hr extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,i){super(e,{originalEvent:i}),this._defaultPrevented=!1}}class dr{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new hr(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new cr(e.type,this._map,e))}mouseup(e){this._map.fire(new cr(e.type,this._map,e))}preclick(t){const i=e.extend({},t);i.type="preclick",this._map.fire(new cr(i.type,this._map,i))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new cr(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new cr(e.type,this._map,e))}mouseover(e){this._map.fire(new cr(e.type,this._map,e))}mouseout(e){this._map.fire(new cr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new ur(e.type,this._map,e))}touchmove(e){this._map.fire(new ur(e.type,this._map,e))}touchend(e){this._map.fire(new ur(e.type,this._map,e))}touchcancel(e){this._map.fire(new ur(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class pr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new cr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new cr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new cr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fr{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(u(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const i=t,n=this._startPos,r=this._lastPos;if(!n||!r||r.equals(i)||!this._box&&i.dist(n)<this._clickTolerance)return;this._lastPos=i,this._box||(this._box=o("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const a=Math.min(n.x,i.x),s=Math.max(n.x,i.x),l=Math.min(n.y,i.y),c=Math.max(n.y,i.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${a}px,${l}px)`,this._box.style.width=s-a+"px",this._box.style.height=c-l+"px")}))}mouseupWindow(t,i){if(!this._active)return;const n=this._startPos,r=i;if(n&&0===t.button){if(this.reset(),p(),n.x!==r.x||n.y!==r.y)return this._map.fire(new e.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(n,r,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),h(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new e.Event(t,{originalEvent:i}))}}function mr(e,t){const i={};for(let n=0;n<e.length;n++)i[e[n].identifier]=t[n];return i}class gr{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,i,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),n.length===this.numTouches&&(this.centroid=function(t){const i=new e.pointGeometry(0,0);for(const e of t)i._add(e);return i.div(t.length)}(i),this.touches=mr(n,i)))}touchmove(e,t,i){if(this.aborted||!this.centroid)return;const n=mr(i,t);for(const e in this.touches){const t=this.touches[e],i=n[e];(!i||i.dist(t)>30)&&(this.aborted=!0)}}touchend(e,t,i){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class _r{constructor(e){this.singleTap=new gr(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,i){this.singleTap.touchstart(e,t,i)}touchmove(e,t,i){this.singleTap.touchmove(e,t,i)}touchend(e,t,i){const n=this.singleTap.touchend(e,t,i);if(n){const t=e.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(n)<30;if(t&&i||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class yr{constructor(){this._zoomIn=new _r({numTouches:1,numTaps:2}),this._zoomOut=new _r({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,i){this._zoomIn.touchstart(e,t,i),this._zoomOut.touchstart(e,t,i)}touchmove(e,t,i){this._zoomIn.touchmove(e,t,i),this._zoomOut.touchmove(e,t,i)}touchend(e,t,i){const n=this._zoomIn.touchend(e,t,i),r=this._zoomOut.touchend(e,t,i);return n?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(n)},{originalEvent:e})}):r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(r)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const xr={0:1,2:2};class vr{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const i=g(e);this._correctButton(e,i)&&(this._lastPoint=t,this._eventButton=i)}mousemoveWindow(e,t){const i=this._lastPoint;if(i)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const i=xr[t];return void 0===e.buttons||(e.buttons&i)!==i}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(i,t)}mouseupWindow(e){this._lastPoint&&g(e)===this._eventButton&&(this._moved&&p(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class br extends vr{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class wr extends vr{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=.8*(t.x-e.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(e){e.preventDefault()}}class Mr extends vr{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=-.5*(t.y-e.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(e){e.preventDefault()}}class Tr{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),e.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new e.pointGeometry(0,0)}touchstart(e,t,i){return this._calculateTransform(e,t,i)}touchmove(t,i,n){if(this._active&&!(n.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===n.length&&!e.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,i,n)}}touchend(e,t,i){this._calculateTransform(e,t,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,n){n.length>0&&(this._active=!0);const r=mr(n,i),o=new e.pointGeometry(0,0),a=new e.pointGeometry(0,0);let s=0;for(const e in r){const t=r[e],i=this._touches[e];i&&(o._add(t),a._add(t.sub(i)),s++,r[e]=t)}if(this._touches=r,s<this._minTouches||!a.mag())return;const l=a.div(s);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(s),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")}),500)}}class Sr{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,i){return{}}touchstart(e,t,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,i){const n=this._firstTwoTouches;if(!n)return;e.preventDefault();const[r,o]=n,a=Er(i,t,r),s=Er(i,t,o);if(!a||!s)return;const l=this._aroundCenter?null:a.add(s).div(2);return this._move([a,s],l,e)}touchend(e,t,i){if(!this._firstTwoTouches)return;const[n,r]=this._firstTwoTouches,o=Er(i,t,n),a=Er(i,t,r);o&&a||(this._active&&p(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Er(e,t,i){for(let n=0;n<e.length;n++)if(e[n].identifier===i)return t[n]}function Cr(e,t){return Math.log(e/t)/Math.LN2}class Ar extends Sr{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const i=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Cr(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Cr(this._distance,i),pinchAround:t}}}function Pr(e,t){return 180*e.angleWith(t)/Math.PI}class Ir extends Sr{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const i=this._vector;if(this._vector=e[0].sub(e[1]),i&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Pr(this._vector,i),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,i=this._startVector;if(!i)return!1;const n=Pr(e,i);return Math.abs(n)<t}}function kr(e){return Math.abs(e.y)>Math.abs(e.x)}class zr extends Sr{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,kr(e[0].sub(e[1]))&&(this._valid=!1)}_move(t,i,n){const r=this._lastPoints;if(!r)return;const o=t[0].sub(r[0]),a=t[1].sub(r[1]);return this._map._cooperativeGestures&&!e.isFullscreen()&&n.touches.length<3||(this._valid=this.gestureBeginsVertically(o,a,n.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(o.y+a.y)/2*-.5})}gestureBeginsVertically(e,t,i){if(void 0!==this._valid)return this._valid;const n=e.mag()>=2,r=t.mag()>=2;if(!n&&!r)return;if(!n||!r)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const o=e.y>0==t.y>0;return kr(e)&&kr(t)&&o}}const Dr={panStep:100,bearingStep:15,pitchStep:10};class Lr{constructor(){const e=Dr;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,i=0,n=0,r=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?i=-1:(e.preventDefault(),r=-1);break;case 39:e.shiftKey?i=1:(e.preventDefault(),r=1);break;case 38:e.shiftKey?n=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?n=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,n=0),{cameraAnimation:a=>{const s=a.getZoom();a.easeTo({duration:300,easeId:"keyboardHandler",easing:Rr,zoom:t?Math.round(s)+t*(e.shiftKey?2:1):s,bearing:a.getBearing()+i*this._bearingStep,pitch:a.getPitch()+n*this._pitchStep,offset:[-r*this._panStep,-o*this._panStep],center:a.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Rr(e){return e*(2-e)}const Or=4.000244140625;class Br{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,e.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||e.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=t.deltaMode===e.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const n=e.exported.now(),r=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==i&&i%Or==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(r*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=f(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const i=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>Or?this._wheelZoomRate:this._defaultZoomRate;let n=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==n&&(n=1/n);const r=i(),o=Math.pow(2,r),a="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(a*n))),"wheel"===this._type&&(this._startZoom=r,this._easing=this._smoothOutEasing(200)),this._delta=0}const n="number"==typeof this._targetZoom?this._targetZoom:i(),r=this._startZoom,o=this._easing;let a,s=!1;if("wheel"===this._type&&r&&o){const t=Math.min((e.exported.now()-this._lastWheelEventTime)/200,1),i=o(t);a=e.number(r,n,i),t<1?this._frameId||(this._frameId=!0):s=!0}else a=n,s=!0;return this._active=!0,s&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!s,zoomDelta:a-i(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=e.ease;if(this._prevEase){const t=this._prevEase,n=(e.exported.now()-t.start)/t.duration,r=t.easing(n+.01)-t.easing(n),o=.27/Math.sqrt(r*r+1e-4)*.01,a=Math.sqrt(.0729-o*o);i=e.bezier(o,a,.25,1)}return this._prevEase={start:e.exported.now(),duration:t,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(e.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")}),200)}}class Fr{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Nr{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(e.shiftKey?-1:1),around:i.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ur{constructor(){this._tap=new _r({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,i){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=t[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(e,t,i))}touchmove(e,t,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const n=t[0],r=n.y-this._swipePoint.y;return this._swipePoint=n,e.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(e,t,i)}touchend(e,t,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(e,t,i)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vr{constructor(e,t,i){this._el=e,this._mousePan=t,this._touchPan=i}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gr{constructor(e,t,i){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class jr{constructor(e,t,i,n){this._el=e,this._touchZoom=t,this._touchRotate=i,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Wr=e=>e.zoom||e.drag||e.pitch||e.rotate;class $r extends e.Event{}class qr{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,i){const n=e.sub([],i,t);this.radius=e.length(n[2]<0?e.div([],n,this.constants):[n[0],n[1],0])}projectRay(t){e.div(t,t,this.constants),e.normalize(t,t),e.mul$1(t,t,this.constants);const i=e.scale$2([],t,this.radius);if(i[2]>0){const t=e.scale$2([],[0,0,1],e.dot(i,[0,0,1])),n=e.scale$2([],e.normalize([],[i[0],i[1],0]),this.radius),r=e.add([],i,e.scale$2([],e.sub([],e.add([],n,t),i),2));i[0]=r[0],i[1]=r[1]}return i}}function Zr(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class Hr{constructor(t,i){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ar(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new qr,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),e.bindAll(["handleEvent","handleWindowEvent"],this);const n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[e.window.document,"mousemove",{capture:!0}],[e.window.document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[e.window,"blur",void 0]];for(const[t,i,n]of this._listeners)t.addEventListener(i,t===e.window.document?this.handleWindowEvent:this.handleEvent,n)}destroy(){for(const[t,i,n]of this._listeners)t.removeEventListener(i,t===e.window.document?this.handleWindowEvent:this.handleEvent,n)}_addDefaultHandlers(e){const t=this._map,i=t.getCanvasContainer();this._add("mapEvent",new dr(t,e));const n=t.boxZoom=new fr(t,e);this._add("boxZoom",n);const r=new yr,o=new Nr;t.doubleClickZoom=new Fr(o,r),this._add("tapZoom",r),this._add("clickZoom",o);const a=new Ur;this._add("tapDragZoom",a);const s=t.touchPitch=new zr(t);this._add("touchPitch",s);const l=new wr(e),c=new Mr(e);t.dragRotate=new Gr(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new br(e),h=new Tr(t,e);t.dragPan=new Vr(i,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new Ir,p=new Ar;t.touchZoomRotate=new jr(i,p,d,a),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new pr(t));const f=t.scrollZoom=new Br(t,this);this._add("scrollZoom",f,["mousePan"]);const m=t.keyboard=new Lr;this._add("keyboard",m);for(const i of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[i]&&t[i].enable(e[i])}_add(e,t,i){this._handlers.push({handlerName:e,handler:t,allowed:i}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Wr(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,t,i){for(const n in e)if(n!==i&&(!t||t.indexOf(n)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const t=[];for(const i of e)this._el.contains(i.target)&&t.push(i);return t}handleEvent(e,t){this._updatingCamera=!0;const i="renderFrame"===e.type,n=i?void 0:e,r={needsRenderFrame:!1},o={},a={},s=e.touches?this._getMapTouches(e.touches):void 0,l=s?m(this._el,s):i?void 0:f(this._el,e);for(const{handlerName:i,handler:c,allowed:u}of this._handlers){if(!c.isEnabled())continue;let h;this._blockedByActive(a,u,i)?c.reset():c[t||e.type]&&(h=c[t||e.type](e,l,s),this.mergeHandlerResult(r,o,h,i,n),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||c.isActive())&&(a[i]=c)}const c={};for(const e in this._previousActiveHandlers)a[e]||(c[e]=n);this._previousActiveHandlers=a,(Object.keys(c).length||Zr(r))&&(this._changes.push([r,o,c]),this._triggerRenderFrame()),(Object.keys(a).length||Zr(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=r;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(t,i,n,r,o){if(!n)return;e.extend(t,n);const a={handlerName:r,originalEvent:n.originalEvent||o};void 0!==n.zoomDelta&&(i.zoom=a),void 0!==n.panDelta&&(i.drag=a),void 0!==n.pitchDelta&&(i.pitch=a),void 0!==n.bearingDelta&&(i.rotate=a)}_applyChanges(){const t={},i={},n={};for(const[r,o,a]of this._changes)r.panDelta&&(t.panDelta=(t.panDelta||new e.pointGeometry(0,0))._add(r.panDelta)),r.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+r.pitchDelta),void 0!==r.around&&(t.around=r.around),void 0!==r.aroundCoord&&(t.aroundCoord=r.aroundCoord),void 0!==r.pinchAround&&(t.pinchAround=r.pinchAround),r.noInertia&&(t.noInertia=r.noInertia),e.extend(i,o),e.extend(n,a);this._updateMapTransform(t,i,n),this._changes=[]}_updateMapTransform(t,i,n){const r=this._map,o=r.transform,a=e=>[e.x,e.y,e.z];if((e=>{const t=this._eventsInProgress.drag;return t&&!this._handlersById[t.handlerName].isActive()})()&&!Zr(t)){const e=o.zoom;o.cameraElevationReference="sea",o.recenterOnTerrain(),o.cameraElevationReference="ground",e!==o.zoom&&this._map._update(!0)}if(o._isCameraConstrained&&r._stop(!0),!Zr(t))return void this._fireEvents(i,n,!0);let{panDelta:s,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:h,aroundCoord:d,pinchAround:p}=t;o._isCameraConstrained&&(l>0&&(l=0),o._isCameraConstrained=!1),void 0!==p&&(h=p),(l||(e=>i.drag&&!this._eventsInProgress.drag)())&&h&&(this._dragOrigin=a(o.pointCoordinate3D(h)),this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",r._stop(!0),h=h||r.transform.centerPoint,c&&(o.bearing+=c),u&&(o.pitch+=u),o._updateCameraState();const f=[0,0,0];if(s)if("mercator"===o.projection.name){const e=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h).dir),t=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h.sub(s)).dir);f[0]=t[0]-e[0],f[1]=t[1]-e[1]}else{const t=o.pointCoordinate(h);if("globe"===o.projection.name){s=s.rotate(-o.angle);const i=o._pixelsPerMercatorPixel/o.worldSize;f[0]=-s.x*e.mercatorScale(e.latFromMercatorY(t.y))*i,f[1]=-s.y*e.mercatorScale(o.center.lat)*i}else{const e=o.pointCoordinate(h.sub(s));t&&e&&(f[0]=e.x-t.x,f[1]=e.y-t.y)}}const m=o.zoom,g=[0,0,0];if(l){const t=a(d||o.pointCoordinate3D(h)),i={dir:e.normalize([],e.sub([],t,o._camera.position))};if(i.dir[2]<0){const n=o.zoomDeltaToMovement(t,l);e.scale$2(g,i.dir,n)}}const _=e.add(f,f,g);o._translateCameraConstrained(_),l&&Math.abs(o.zoom-m)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(i,n,!0)}_fireEvents(t,i,n){const r=Wr(this._eventsInProgress),o=Wr(t),a={};for(const e in t){const{originalEvent:i}=t[e];this._eventsInProgress[e]||(a[`${e}start`]=i),this._eventsInProgress[e]=t[e]}!r&&o&&this._fireEvent("movestart",o.originalEvent);for(const e in a)this._fireEvent(e,a[e]);o&&this._fireEvent("move",o.originalEvent);for(const e in t){const{originalEvent:i}=t[e];this._fireEvent(e,i)}const s={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:n}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=i[t]||n,s[`${e}end`]=l)}for(const e in s)this._fireEvent(e,s[e]);const c=Wr(this._eventsInProgress);if(n&&(r||o)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(i(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.Event("moveend",{originalEvent:l})),i(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new e.Event(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{this._frameId=void 0,this.handleEvent(new $r("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Xr="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Yr extends e.Evented{constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,e.bindAll(["_renderFrameCallback"],this)}getCenter(){return new e.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,i,n){return t=e.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,e.extend({offset:t},i),n)}panTo(t,i,n){return this.easeTo(e.extend({center:t},i),n)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,i,n){return this.easeTo(e.extend({zoom:t},i),n)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,i,n){return this.easeTo(e.extend({bearing:t},i),n)}resetNorth(t,i){return this.rotateTo(0,e.extend({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(e.extend({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,i){t=e.LngLatBounds.convert(t);const n=i&&i.bearing||0,r=i&&i.pitch||0,o=t.getNorthWest(),a=t.getSouthEast();return this._cameraForBounds(this.transform,o,a,n,r,i)}_extendCameraOptions(t){const i={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=e.extend({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const e=t.padding;t.padding={top:e,bottom:e,right:e,left:e}}return t.padding=e.extend(i,t.padding),t}_minimumAABBFrustumDistance(e,t){const i=t.max[0]-t.min[0],n=t.max[1]-t.min[1];return i/n>e.aspect?i/(2*Math.tan(.5*e.fovX)*e.aspect):n/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(t,i,n,r,o,a){const s=t.clone(),l=this._extendCameraOptions(a);s.bearing=r,s.pitch=o;const c=e.LngLat.convert(i),u=e.LngLat.convert(n),h=.5*(c.lat+u.lat),d=.5*(c.lng+u.lng),p=e.latLngToECEF(h,d),f=e.normalize([],p),m=e.normalize([],e.cross([],f,[0,1,0])),g=e.cross([],m,f),_=[m[0],m[1],m[2],0,g[0],g[1],g[2],0,f[0],f[1],f[2],0,0,0,0,1],y=[p,e.latLngToECEF(c.lat,c.lng),e.latLngToECEF(u.lat,c.lng),e.latLngToECEF(u.lat,u.lng),e.latLngToECEF(c.lat,u.lng),e.latLngToECEF(h,c.lng),e.latLngToECEF(h,u.lng),e.latLngToECEF(c.lat,d),e.latLngToECEF(u.lat,d)];let x=e.Aabb.fromPoints(y.map((t=>[e.dot(m,t),e.dot(g,t),e.dot(f,t)])));const v=e.transformMat4([],x.center,_);0===e.squaredLength(v)&&e.set(v,0,0,1),e.normalize(v,v),e.scale$2(v,v,e.GLOBE_RADIUS),s.center=e.ecefToLatLng(v);const b=s.getWorldToCameraMatrix(),w=e.invert(new Float64Array(16),b);x=e.Aabb.applyTransform(x,e.multiply([],b,_)),e.transformMat4(v,v,b);const M=.5*(x.max[2]-x.min[2]),T=this._minimumAABBFrustumDistance(s,x),S=e.scale$2([],[0,0,1],M),E=e.add(S,v,S),C=T+(0===s.pitch?0:e.distance(v,E)),A=s.globeCenterInViewSpace,P=e.sub([],v,[A[0],A[1],A[2]]);e.normalize(P,P),e.scale$2(P,P,C);const I=e.add([],v,P);e.transformMat4(I,I,w);const k=e.earthRadius/e.GLOBE_RADIUS,z=e.length(I),D=e.mercatorZfromAltitude(Math.max(z*k-e.earthRadius,Number.EPSILON),0),L=Math.min(s.zoomFromMercatorZAdjusted(D),l.maxZoom);return L>.5*(e.GLOBE_ZOOM_THRESHOLD_MIN+e.GLOBE_ZOOM_THRESHOLD_MAX)?(s.setProjection({name:"mercator"}),s.zoom=L,this._cameraForBounds(s,i,n,r,o,a)):{center:s.center,zoom:L,bearing:r,pitch:o}}queryTerrainElevation(t,i){const n=this.transform.elevation;return n?(i=e.extend({},{exaggerated:!0},i),n.getAtPoint(e.MercatorCoordinate.fromLngLat(t),null,i.exaggerated)):null}_cameraForBounds(t,i,n,r,o,a){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,i,n,r,o,a);const s=t.clone(),l=this._extendCameraOptions(a),c=s.padding;s.bearing=r,s.pitch=o;const u=e.LngLat.convert(i),h=e.LngLat.convert(n),d=new e.LngLat(u.lng,h.lat),p=new e.LngLat(h.lng,u.lat),f=s.project(u),m=s.project(h),g=this.queryTerrainElevation(u),_=this.queryTerrainElevation(h),y=this.queryTerrainElevation(d),x=this.queryTerrainElevation(p),v=[[f.x,f.y,Math.min(g||0,_||0,y||0,x||0)],[m.x,m.y,Math.max(g||0,_||0,y||0,x||0)]];let b=e.Aabb.fromPoints(v);const w=s.getWorldToCameraMatrix(),M=e.invert(new Float64Array(16),w);b=e.Aabb.applyTransform(b,w);const T=e.sub([],b.max,b.min),S=c.left||0,E=c.right||0,C=c.bottom||0,A=c.top||0,{left:P,right:I,top:k,bottom:z}=l.padding,D=.5*(S+E),L=.5*(A+C),R=Math.min(s.scaleZoom(s.scale*Math.min((s.width-(S+E+P+I))/T[0],(s.height-(C+A+z+k))/T[1])),l.maxZoom),O=s.scale/s.zoomScale(R);b=new e.Aabb([b.min[0]-(P+D)*O,b.min[1]-(z+L)*O,b.min[2]],[b.max[0]+(I+D)*O,b.max[1]+(k+L)*O,b.max[2]]);const B=.5*T[2],F=this._minimumAABBFrustumDistance(s,b),N=[0,0,1,0];e.transformMat4$1(N,N,w),e.normalize$2(N,N);const U=e.scale$2([],N,F+B),V=e.add([],b.center,U),G=("number"==typeof l.offset.x&&"number"==typeof l.offset.y?new e.pointGeometry(l.offset.x,l.offset.y):e.pointGeometry.convert(l.offset)).rotate(-e.degToRad(r));b.center[0]-=G.x*O,b.center[1]+=G.y*O,e.transformMat4(b.center,b.center,M),e.transformMat4(V,V,M);const j=[b.center[0],b.center[1],V[2]*s.pixelsPerMeter];e.scale$2(j,j,1/s.worldSize);const W=e.lngFromMercatorX(j[0]),$=e.latFromMercatorY(j[1]),q=Math.min(s._zoomFromMercatorZ(j[2]),l.maxZoom),Z=new e.LngLat(W,$);return s.mercatorFromTransition&&q<.5*(e.GLOBE_ZOOM_THRESHOLD_MIN+e.GLOBE_ZOOM_THRESHOLD_MAX)?(s.setProjection({name:"globe"}),s.zoom=q,this._cameraForBounds(s,i,n,r,o,a)):{center:Z,zoom:q,bearing:r,pitch:o}}fitBounds(e,t,i){const n=this.cameraForBounds(e,t);return this._fitInternal(n,t,i)}fitScreenCoordinates(t,i,n,r,o){const a=e.pointGeometry.convert(t),s=e.pointGeometry.convert(i),l=new e.pointGeometry(Math.min(a.x,s.x),Math.min(a.y,s.y)),c=new e.pointGeometry(Math.max(a.x,s.x),Math.max(a.y,s.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(a,s))return this;const u=this.transform.pointLocation3D(l),h=this.transform.pointLocation3D(c),d=this.transform.pointLocation3D(new e.pointGeometry(l.x,c.y)),p=this.transform.pointLocation3D(new e.pointGeometry(c.x,l.y)),f=[Math.min(u.lng,h.lng,d.lng,p.lng),Math.min(u.lat,h.lat,d.lat,p.lat)],m=[Math.max(u.lng,h.lng,d.lng,p.lng),Math.max(u.lat,h.lat,d.lat,p.lat)],g=r&&r.pitch?r.pitch:this.getPitch(),_=this._cameraForBounds(this.transform,f,m,n,g,r);return this._fitInternal(_,r,o)}_fitInternal(t,i,n){return t?(delete(i=e.extend(t,i)).padding,i.linear?this.easeTo(i,n):this.flyTo(i,n)):this}jumpTo(t,i){this.stop();const n=t.preloadOnly?this.transform.clone():this.transform;let r=!1,o=!1,a=!1;return"zoom"in t&&n.zoom!==+t.zoom&&(r=!0,n.zoom=+t.zoom),void 0!==t.center&&(n.center=e.LngLat.convert(t.center)),"bearing"in t&&n.bearing!==+t.bearing&&(o=!0,n.bearing=+t.bearing),"pitch"in t&&n.pitch!==+t.pitch&&(a=!0,n.pitch=+t.pitch),null==t.padding||n.isPaddingEqual(t.padding)||(n.padding=t.padding),t.preloadOnly?(this._preloadTiles(n),this):(this.fire(new e.Event("movestart",i)).fire(new e.Event("move",i)),r&&this.fire(new e.Event("zoomstart",i)).fire(new e.Event("zoom",i)).fire(new e.Event("zoomend",i)),o&&this.fire(new e.Event("rotatestart",i)).fire(new e.Event("rotate",i)).fire(new e.Event("rotateend",i)),a&&this.fire(new e.Event("pitchstart",i)).fire(new e.Event("pitch",i)).fire(new e.Event("pitchend",i)),this.fire(new e.Event("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||e.warnOnce(Xr),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,i){const n=this.transform;if(!n.projection.supportsFreeCamera)return e.warnOnce(Xr),this;this.stop();const r=n.zoom,o=n.pitch,a=n.bearing;n.setFreeCameraOptions(t);const s=r!==n.zoom,l=o!==n.pitch,c=a!==n.bearing;return this.fire(new e.Event("movestart",i)).fire(new e.Event("move",i)),s&&this.fire(new e.Event("zoomstart",i)).fire(new e.Event("zoom",i)).fire(new e.Event("zoomend",i)),c&&this.fire(new e.Event("rotatestart",i)).fire(new e.Event("rotate",i)).fire(new e.Event("rotateend",i)),l&&this.fire(new e.Event("pitchstart",i)).fire(new e.Event("pitch",i)).fire(new e.Event("pitchend",i)),this.fire(new e.Event("moveend",i)),this}easeTo(t,i){this._stop(!1,t.easeId),(!1===(t=e.extend({offset:[0,0],duration:500,easing:e.ease},t)).animate||!t.essential&&e.exported.prefersReducedMotion)&&(t.duration=0);const n=this.transform,r=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),l="zoom"in t?+t.zoom:r,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:a,h="padding"in t?t.padding:n.padding,d=e.pointGeometry.convert(t.offset);let p,f,m;if("globe"===n.projection.name){const i=e.MercatorCoordinate.fromLngLat(n.center),r=d.rotate(-n.angle);i.x+=r.x/n.worldSize,i.y+=r.y/n.worldSize;const o=i.toLngLat(),a=e.LngLat.convert(t.center||o);this._normalizeCenter(a),p=n.centerPoint.add(r),f=new e.pointGeometry(i.x,i.y).mult(n.worldSize),m=new e.pointGeometry(e.mercatorXfromLng(a.lng),e.mercatorYfromLat(a.lat)).mult(n.worldSize).sub(f)}else{p=n.centerPoint.add(d);const i=n.pointLocation(p),r=e.LngLat.convert(t.center||i);this._normalizeCenter(r),f=n.project(i),m=n.project(r).sub(f)}const g=n.zoomScale(l-r);let _,y;t.around&&(_=e.LngLat.convert(t.around),y=n.locationPoint(_));const x=this._zooming||l!==r,v=this._rotating||o!==c,b=this._pitching||u!==a,w=!n.isPaddingEqual(h),M=n=>M=>{if(x&&(n.zoom=e.number(r,l,M)),v&&(n.bearing=e.number(o,c,M)),b&&(n.pitch=e.number(a,u,M)),w&&(n.interpolatePadding(s,h,M),p=n.centerPoint.add(d)),_)n.setLocationAtPoint(_,y);else{const e=n.zoomScale(n.zoom-r),t=l>r?Math.min(2,g):Math.max(.5,g),i=Math.pow(t,1-M),o=n.unproject(f.add(m.mult(M*i)).mult(e));n.setLocationAtPoint(n.renderWorldCopies?o.wrap():o,p)}return t.preloadOnly||this._fireMoveEvents(i),n};if(t.preloadOnly){const e=this._emulate(M,t.duration,n);return this._preloadTiles(e),this}const T={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=x,this._rotating=v,this._pitching=b,this._padding=w,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,T),this._ease(M(n),(e=>{n.recenterOnTerrain(),this._afterEase(i,e)}),t),this}_prepareEase(t,i,n={}){this._moving=!0,this.transform.cameraElevationReference="sea",i||n.moving||this.fire(new e.Event("movestart",t)),this._zooming&&!n.zooming&&this.fire(new e.Event("zoomstart",t)),this._rotating&&!n.rotating&&this.fire(new e.Event("rotatestart",t)),this._pitching&&!n.pitching&&this.fire(new e.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new e.Event("move",t)),this._zooming&&this.fire(new e.Event("zoom",t)),this._rotating&&this.fire(new e.Event("rotate",t)),this._pitching&&this.fire(new e.Event("pitch",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const n=this._zooming,r=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new e.Event("zoomend",t)),r&&this.fire(new e.Event("rotateend",t)),o&&this.fire(new e.Event("pitchend",t)),this.fire(new e.Event("moveend",t))}flyTo(t,i){if(!t.essential&&e.exported.prefersReducedMotion){const n=e.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(n,i)}this.stop(),t=e.extend({offset:[0,0],speed:1.2,curve:1.42,easing:e.ease},t);const n=this.transform,r=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),l="zoom"in t?e.clamp(+t.zoom,n.minZoom,n.maxZoom):r,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:a,h="padding"in t?t.padding:n.padding,d=n.zoomScale(l-r),p=e.pointGeometry.convert(t.offset);let f=n.centerPoint.add(p);const m=n.pointLocation(f),g=e.LngLat.convert(t.center||m);this._normalizeCenter(g);const _=n.project(m),y=n.project(g).sub(_);let x=t.curve;const v=Math.max(n.width,n.height),b=v/d,w=y.mag();if("minZoom"in t){const i=e.clamp(Math.min(t.minZoom,r,l),n.minZoom,n.maxZoom),o=v/n.zoomScale(i-r);x=Math.sqrt(o/w*2)}const M=x*x;function T(e){const t=(b*b-v*v+(e?-1:1)*M*M*w*w)/(2*(e?b:v)*M*w);return Math.log(Math.sqrt(t*t+1)-t)}function S(e){return(Math.exp(e)-Math.exp(-e))/2}function E(e){return(Math.exp(e)+Math.exp(-e))/2}const C=T(0);let A=function(e){return E(C)/E(C+x*e)},P=function(e){return v*((E(C)*(S(t=C+x*e)/E(t))-S(C))/M)/w;var t},I=(T(1)-C)/x;if(Math.abs(w)<1e-6||!isFinite(I)){if(Math.abs(v-b)<1e-6)return this.easeTo(t,i);const e=b<v?-1:1;I=Math.abs(Math.log(b/v))/x,P=function(){return 0},A=function(t){return Math.exp(e*x*t)}}t.duration="duration"in t?+t.duration:1e3*I/("screenSpeed"in t?+t.screenSpeed/x:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const k=o!==c,z=u!==a,D=!n.isPaddingEqual(h),L=n=>d=>{const m=d*I,x=1/A(m);n.zoom=1===d?l:r+n.scaleZoom(x),k&&(n.bearing=e.number(o,c,d)),z&&(n.pitch=e.number(a,u,d)),D&&(n.interpolatePadding(s,h,d),f=n.centerPoint.add(p));const v=1===d?g:n.unproject(_.add(y.mult(P(m))).mult(x));return n.setLocationAtPoint(n.renderWorldCopies?v.wrap():v,f),n._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(i),n};if(t.preloadOnly){const e=this._emulate(L,t.duration,n);return this._preloadTiles(e),this}return this._zooming=!0,this._rotating=k,this._pitching=z,this._padding=D,this._prepareEase(i,!1),this._ease(L(n),(()=>this._afterEase(i)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(t,i,n){!1===n.animate||0===n.duration?(t(1),i()):(this._easeStart=e.exported.now(),this._easeOptions=n,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((e.exported.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,i){t=e.wrap(t,-180,180);const n=Math.abs(t-i);return Math.abs(t-360-i)<n&&(t-=360),Math.abs(t+360-i)<n&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(!t.renderWorldCopies||t.maxBounds)return;const i=e.lng-t.center.lng;e.lng+=i>180?-360:i<-180?360:0}_emulate(e,t,i){const n=Math.ceil(15*t/1e3),r=[],o=e(i.clone());for(let e=0;e<=n;e++){const t=o(e/n);r.push(t.clone())}return r}}class Jr{constructor(t={}){this.options=t,e.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact;return this._map=e,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=o("button","mapboxgl-ctrl-attrib-button",this._container),o("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=o("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const i=this._map._getUIString(`AttributionControl.${t}`);e.setAttribute("aria-label",i),e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.config.ACCESS_TOKEN}];if(t){const n=i.reduce(((e,t,n)=>(t.value&&(e+=`${t.key}=${t.value}${n<i.length-1?"&":""}`),e)),"?");t.href=`${e.config.FEEDBACK_URL}/${n}#${er(this._map,!0)}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._sourceCaches;for(const i in t){const n=t[i];if(n.used){const t=n.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,i)=>{for(let n=i+1;n<e.length;n++)if(e[n].indexOf(t)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const i=e.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,e.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Kr{constructor(){e.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=o("div","mapboxgl-ctrl");const t=o("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const i=e[t].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class Qr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,i=t?this._queue.concat(t):this._queue;for(const t of i)if(t.id===e)return void(t.cancelled=!0)}run(e=0){const t=this._currentlyRunning=this._queue;this._queue=[];for(const i of t)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function eo(t,i,n){if(t=new e.LngLat(t.lng,t.lat),i){const r=new e.LngLat(t.lng-360,t.lat),o=new e.LngLat(t.lng+360,t.lat),a=360*Math.ceil(Math.abs(t.lng-n.center.lng)/360),s=n.locationPoint(t).distSqr(i),l=i.x<0||i.y<0||i.x>n.width||i.y>n.height;n.locationPoint(r).distSqr(i)<s&&(l||Math.abs(r.lng-n.center.lng)<a)?t=r:n.locationPoint(o).distSqr(i)<s&&(l||Math.abs(o.lng-n.center.lng)<a)&&(t=o)}for(;Math.abs(t.lng-n.center.lng)>180;){const e=n.locationPoint(t);if(e.x>=0&&e.y>=0&&e.x<=n.width&&e.y<=n.height)break;t.lng>n.center.lng?t.lng-=360:t.lng+=360}return t}const to={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class io extends e.Evented{constructor(t,i){if(super(),(t instanceof e.window.HTMLElement||i)&&(t=e.extend({element:t},i)),e.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=e.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=o("div");const i=41,n=27,r=a("svg",{display:"block",height:i*this._scale+"px",width:n*this._scale+"px",viewBox:`0 0 ${n} ${i}`},this._element),s=a("radialGradient",{id:"shadowGradient"},a("defs",{},r));a("stop",{offset:"10%","stop-opacity":.4},s),a("stop",{offset:"100%","stop-opacity":.05},s),a("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},r),a("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},r),a("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},r),a("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},r),this._offset=e.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()}));const n=this._element.classList;for(const e in to)n.remove(`mapboxgl-marker-anchor-${e}`);n.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,i=13.5,n=Math.sqrt(Math.pow(i,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[n,-1*(t-i+n)],"bottom-right":[-n,-1*(t-i+n)],left:[i,-1*(t-i)],right:[-i,-1*(t-i)]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,i=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==i&&13!==i||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,i=this._element;this._popup&&(t===i||i.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,t=this._pos;if(!e||!t)return!1;const i=e.unproject(t),n=e.getFreeCameraOptions();if(!n.position)return!1;const r=n.position.toLngLat();return r.distanceTo(i)<.9*r.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const i=this._pos;if(!i||i.x<0||i.x>t.transform.width||i.y<0||i.y>t.transform.height)return void this._clearFadeTimer();const n=t.unproject(i);let r;t._showingGlobe()&&e.isLngLatBehindGlobe(t.transform,this._lngLat)?r=0:(r=1-t._queryFogOpacity(n),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(r*=this._occludedOpacity)),this._element.style.opacity=`${r}`,this._element.style.pointerEvents=r>0?"auto":"none",this._popup&&this._popup._setOpacity(r),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${e.x}px,${e.y}px)\n            ${to[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${t.x}px,${t.y}px)\n        `}_calculateXYTransform(){const t=this._pos,i=this._map,n=this.getPitchAlignment();if(!i||!t||"map"!==n)return"";if(!i._showingGlobe()){const e=i.getPitch();return e?`rotateX(${e}deg)`:""}const r=e.radToDeg(e.globeTiltAtLngLat(i.transform,this._lngLat)),o=t.sub(e.globeCenterToScreenPoint(i.transform)),a=Math.abs(o.x)+Math.abs(o.y);if(0===a)return"";const s=r/a;return`rotateX(${-o.y*s}deg) rotateY(${o.x*s}deg)`}_calculateZTransform(){const t=this._pos,i=this._map;if(!i||!t)return"";let n=0;const r=this.getRotationAlignment();if("map"===r)if(i._showingGlobe()){const t=i.project(new e.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),r=i.project(new e.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(t);n=e.radToDeg(Math.atan2(r.y,r.x))-90}else n=-i.getBearing();else if("horizon"===r){const r=e.smoothstep(4,6,i.getZoom()),o=e.globeCenterToScreenPoint(i.transform);o.y+=r*i.transform.height;const a=t.sub(o),s=e.radToDeg(Math.atan2(a.y,a.x));n=(s>90?s-270:s+90)*(1-r)}return n+=this._rotation,n?`rotateZ(${n}deg)`:""}_update(t){e.window.cancelAnimationFrame(this._updateFrameId);const i=this._map;i&&(i.transform.renderWorldCopies&&(this._lngLat=eo(this._lngLat,this._pos,i.transform)),this._pos=i.project(this._lngLat),!0===t?this._updateFrameId=e.window.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),i._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(i._showingGlobe()||i.getTerrain()||i.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=e.pointGeometry.convert(t),this._update(),this}_onMove(t){const i=this._map;if(!i)return;const n=this._pointerdownPos,r=this._positionDelta;if(n&&r){if(!this._isDragging){const e=this._clickTolerance||i._clickTolerance;if(t.point.dist(n)<e)return;this._isDragging=!0}this._pos=t.point.sub(r),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.Event("dragstart"))),this.fire(new e.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new e.Event("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map,i=this._pos;t&&i&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(i),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const no={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ro=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function oo(t=new e.pointGeometry(0,0),i="bottom"){if("number"==typeof t){const n=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(i){case"top":return new e.pointGeometry(0,t);case"top-left":return new e.pointGeometry(n,n);case"top-right":return new e.pointGeometry(-n,n);case"bottom":return new e.pointGeometry(0,-t);case"bottom-left":return new e.pointGeometry(n,-n);case"bottom-right":return new e.pointGeometry(-n,-n);case"left":return new e.pointGeometry(t,0);case"right":return new e.pointGeometry(-t,0)}return new e.pointGeometry(0,0)}return t instanceof e.pointGeometry||Array.isArray(t)?e.pointGeometry.convert(t):e.pointGeometry.convert(t[i]||[0,0])}class ao{constructor(e){this.jumpTo(e)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const i=e.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,i){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+i}}const so={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},lo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},co={showCompass:!0,showZoom:!0,visualizePitch:!1};class uo{constructor(t,i,n=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new wr({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,n&&(this.mousePitch=new Mr({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),u()}move(e,t){const i=this.map,n=this.mouseRotate.mousemoveWindow(e,t),r=n&&n.bearingDelta;if(r&&i.setBearing(i.getBearing()+r),this.mousePitch){const n=this.mousePitch.mousemoveWindow(e,t),r=n&&n.pitchDelta;r&&i.setPitch(i.getPitch()+r)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){h(),e.window.removeEventListener("mousemove",this.mousemove),e.window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(e.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),f(this.element,t)),e.window.addEventListener("mousemove",this.mousemove),e.window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,f(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=m(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=m(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ho={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},po={maxWidth:100,unit:"metric"};function fo(e,t,i){const n=mo(t),r=n/t,o={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[i];this._map._requestDomTask((()=>{this._container.style.width=e*r+"px",this._container.innerHTML=`${n}&nbsp;${o}`}))}function mo(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let i=e/t;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(i),t*i}const go={version:e.version,supported:i,setRTLTextPlugin:e.setRTLTextPlugin,getRTLTextPluginStatus:e.getRTLTextPluginStatus,Map:class extends Yr{constructor(t){if(e.LivePerformanceUtils.mark(e.PerformanceMarkers.create),null!=(t=e.extend({},lo,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&e.isSafariWithAntialiasingBug(e.window)&&(t.antialias=!1,e.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Jn(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._useWebGL2=t.useWebGL2,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._optimizeForTerrain=t.optimizeForTerrain,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new Qr,this._domRenderTaskQueue=new Qr,this._controls=[],this._markers=[],this._popups=[],this._mapId=e.uniqueId(),this._locale=e.extend({},so,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ao(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new e.RequestManager(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,"string"==typeof t.container){if(this._container=e.window.document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container}' not found.`)}else{if(!(t.container instanceof e.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&e.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),e.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),void 0!==e.window&&(e.window.addEventListener("online",this._onWindowOnline,!1),e.window.addEventListener("resize",this._onWindowResize,!1),e.window.addEventListener("orientationchange",this._onWindowResize,!1),e.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),e.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Hr(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,t.style&&this.setStyle(t.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),this._hash=t.hash&&new Qn("string"==typeof t.hash&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,e.extend({},t.fitBoundsOptions,{duration:0})))),this.resize(),t.attributionControl&&this.addControl(new Jr({customAttribution:t.customAttribution})),this._logoControl=new Kr,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(t=>{this._update("style"===t.dataType),this.fire(new e.Event(`${t.dataType}data`,t))})),this.on("dataloading",(t=>{this.fire(new e.Event(`${t.dataType}dataloading`,t))}))}_getMapId(){return this._mapId}addControl(t,i){if(void 0===i&&(i=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=t.onAdd(this);this._controls.push(t);const r=this._controlPositions[i];return-1!==i.indexOf("bottom")?r.insertBefore(n,r.firstChild):r.appendChild(n),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(t);return i>-1&&this._controls.splice(i,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new e.Event("movestart",t)).fire(new e.Event("move",t)),this.fire(new e.Event("resize",t)),i&&this.fire(new e.Event("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(e.LngLatBounds.convert(t)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new e.Event("zoomstart")).fire(new e.Event("zoom")).fire(new e.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new e.Event("zoomstart")).fire(new e.Event("zoom")).fire(new e.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new e.Event("pitchstart")).fire(new e.Event("pitch")).fire(new e.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?85:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new e.Event("pitchstart")).fire(new e.Event("pitch")).fire(new e.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(t){return"auto"===t?e.window.navigator.language:Array.isArray(t)?0===t.length?void 0:t.map((t=>"auto"===t?e.window.navigator.language:t)):t}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style._reloadSources();for(const e of this._controls)e._setLanguage&&e._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const t=this.transform,i=t.projection.name;let n;"globe"===i&&t.zoom>=e.GLOBE_ZOOM_THRESHOLD_MAX?(t.setMercatorFromTransition(),n=!0):"mercator"===i&&t.zoom<e.GLOBE_ZOOM_THRESHOLD_MAX&&(t.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(t){let i;if(i="globe"===t.name&&this.transform.zoom>=e.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),i){this.painter.clearBackgroundTiles();for(const e in this.style._sourceCaches)this.style._sourceCaches[e].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(t){return this.transform.locationPoint3D(e.LngLat.convert(t))}unproject(t){return this.transform.pointLocation3D(e.pointGeometry.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,i){if("mouseenter"===e||"mouseover"===e){let n=!1;const r=r=>{const o=t.filter((e=>this.getLayer(e))),a=o.length?this.queryRenderedFeatures(r.point,{layers:o}):[];a.length?n||(n=!0,i.call(this,new cr(e,this,r.originalEvent,{features:a}))):n=!1},o=()=>{n=!1};return{layers:new Set(t),listener:i,delegates:{mousemove:r,mouseout:o}}}if("mouseleave"===e||"mouseout"===e){let n=!1;const r=r=>{const o=t.filter((e=>this.getLayer(e)));(o.length?this.queryRenderedFeatures(r.point,{layers:o}):[]).length?n=!0:n&&(n=!1,i.call(this,new cr(e,this,r.originalEvent)))},o=t=>{n&&(n=!1,i.call(this,new cr(e,this,t.originalEvent)))};return{layers:new Set(t),listener:i,delegates:{mousemove:r,mouseout:o}}}{const n=e=>{const n=t.filter((e=>this.getLayer(e))),r=n.length?this.queryRenderedFeatures(e.point,{layers:n}):[];r.length&&(e.features=r,i.call(this,e),delete e.features)};return{layers:new Set(t),listener:i,delegates:{[e]:n}}}}on(e,t,i){if(void 0===i)return super.on(e,t);Array.isArray(t)||(t=[t]);const n=this._createDelegatedListener(e,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(n);for(const e in n.delegates)this.on(e,n.delegates[e]);return this}once(e,t,i){if(void 0===i)return super.once(e,t);Array.isArray(t)||(t=[t]);const n=this._createDelegatedListener(e,t,i);for(const e in n.delegates)this.once(e,n.delegates[e]);return this}off(e,t,i){if(void 0===i)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);const n=(e,t)=>{if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0},r=this._delegatedListeners?this._delegatedListeners[e]:void 0;return r&&(e=>{for(let r=0;r<e.length;r++){const o=e[r];if(o.listener===i&&n(o.layers,t)){for(const e in o.delegates)this.off(e,o.delegates[e]);return e.splice(r,1),this}}})(r),this}queryRenderedFeatures(t,i){return this.style?(void 0!==i||void 0===t||t instanceof e.pointGeometry||Array.isArray(t)||(i=t,t=void 0),this.style.queryRenderedFeatures(t=t||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}setStyle(t,i){return!1!==(i=e.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&t?(this._diffStyle(t,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(t,i))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new Qt(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Qt(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,i){if("string"==typeof t){const n=this._requestManager.normalizeStyleURL(t),r=this._requestManager.transformRequest(n,e.ResourceType.Style);e.getJSON(r,((t,n)=>{t?this.fire(new e.ErrorEvent(t)):n&&this._updateDiff(n,i)}))}else"object"==typeof t&&this._updateDiff(t,i)}_updateDiff(t,i){try{this.style.setState(t)&&this._update(!0)}catch(n){e.warnOnce(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(t,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(e.warnOnce("There is no style added to the map."),!1)}addSource(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)}isSourceLoaded(e){return!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){const e=this.style&&this.style._sourceCaches;for(const t in e){const i=e[t]._tiles;for(const e in i){const t=i[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}addSourceType(e,t,i){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,i)}removeSource(e){return this.style.removeSource(e),this._updateTerrain(),this._update(!0)}getSource(e){return this.style.getSource(e)}addImage(t,i,{pixelRatio:n=1,sdf:r=!1,stretchX:o,stretchY:a,content:s}={}){if(this._lazyInitEmptyStyle(),i instanceof e.window.HTMLImageElement||e.window.ImageBitmap&&i instanceof e.window.ImageBitmap){const{width:l,height:c,data:u}=e.exported.getImageData(i);this.style.addImage(t,{data:new e.RGBAImage({width:l,height:c},u),pixelRatio:n,stretchX:o,stretchY:a,content:s,sdf:r,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:l,height:c}=i,u=i;this.style.addImage(t,{data:new e.RGBAImage({width:l,height:c},new Uint8Array(u.data)),pixelRatio:n,stretchX:o,stretchY:a,content:s,sdf:r,version:0,userImage:u}),u.onAdd&&u.onAdd(this,t)}}updateImage(t,i){const n=this.style.getImage(t);if(!n)return void this.fire(new e.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=i instanceof e.window.HTMLImageElement||e.window.ImageBitmap&&i instanceof e.window.ImageBitmap?e.exported.getImageData(i):i,{width:o,height:a}=r;void 0!==o&&void 0!==a?o===n.data.width&&a===n.data.height?(n.data.replace(r.data,!(i instanceof e.window.HTMLImageElement||e.window.ImageBitmap&&i instanceof e.window.ImageBitmap)),this.style.updateImage(t,n)):this.fire(new e.ErrorEvent(new Error(`The width and height of the updated image (${o}, ${a})\n                must be that same as the previous version of the image\n                (${n.data.width}, ${n.data.height})`))):this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(t){return t?!!this.style.getImage(t):(this.fire(new e.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(t,i){e.getImage(this._requestManager.transformRequest(t,e.ResourceType.Image),((t,n)=>{i(t,n instanceof e.window.HTMLImageElement?e.exported.getImageData(n):n)}))}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0)}removeLayer(e){return this.style.removeLayer(e),this._update(!0)}getLayer(e){return this.style.getLayer(e)}setLayerZoomRange(e,t,i){return this.style.setLayerZoomRange(e,t,i),this._update(!0)}setFilter(e,t,i={}){return this.style.setFilter(e,t,i),this._update(!0)}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,i,n={}){return this.style.setPaintProperty(e,t,i,n),this._update(!0)}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,i,n={}){return this.style.setLayoutProperty(e,t,i,n),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setLight(e,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.LngLat.convert(t),this.transform):0}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}_updateContainerDimensions(){if(!this._container)return;const t=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let n,r,o,a=this._container;for(;a&&(!r||!o);){const t=e.window.getComputedStyle(a).transform;t&&"none"!==t&&(n=t.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&"0"!==n[0]&&"1"!==n[0]&&(r=n[0]),n[3]&&"0"!==n[3]&&"1"!==n[3]&&(o=n[3])),a=a.parentElement}this._containerWidth=r?Math.abs(t/r):t,this._containerHeight=o?Math.abs(i/o):i}_detectMissingCSS(){"rgb(250, 128, 114)"!==e.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=o("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=o("div","mapboxgl-canvas-container",e);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=o("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=o("div","mapboxgl-control-container",e),n=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{n[e]=o("div",`mapboxgl-ctrl-${e}`,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,i){const n=e.exported.devicePixelRatio||1;this._canvas.width=n*Math.ceil(t),this._canvas.height=n*Math.ceil(i),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${i}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const t=e.extend({},i.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._useWebGL2&&this._canvas.getContext("webgl2",t),r=n||this._canvas.getContext("webgl",t)||this._canvas.getContext("experimental-webgl",t);r?(this._useWebGL2&&!n&&e.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),e.storeAuthState(r,!0),this.painter=new Fn(r,this.transform,!!n),this.on("data",(e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)})),e.exported$1.testSupport(r)):this.fire(new e.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.Event("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.Event("webglcontextrestored",{originalEvent:t}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(t){let i;const n=this.painter.context.extTimerQuery,r=e.exported.now();if(this.listens("gpu-timing-frame")&&(i=n.createQueryEXT(),n.beginQueryEXT(n.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],e.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],e.window.performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const o=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,i=this.transform.pitch,n=e.exported.now(),r=new e.EvaluationParameters(t,{now:n,fadeDuration:o,pitch:i,transition:this.style.getTransition()});this.style.update(r)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let a=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),a=this._updateAverageElevation(r),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):a=this._updateAverageElevation(r),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const t=e.exported.now()-r;n.endQueryEXT(n.TIME_ELAPSED_EXT,i),setTimeout((()=>{const o=n.getQueryObjectEXT(i,n.QUERY_RESULT_EXT)/1e6;n.deleteQueryEXT(i),this.fire(new e.Event("gpu-timing-frame",{cpuTime:t,gpuTime:o})),e.window.performance.mark("frame-gpu",{startTime:r,detail:{gpuTime:o}})}),50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout((()=>{const i=this.painter.queryGpuTimers(t);this.fire(new e.Event("gpu-timing-layer",{layerTimes:i}))}),50)}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const i=this.painter.queryGpuTimeDeferredRender(t);this.fire(new e.Event("gpu-timing-deferred-render",{gpuTime:i}))}),50)}const s=this._sourcesDirty||this._styleDirty||this._placementDirty||a;if(s||this._repaint)this.triggerRepaint();else{const t=!this.isMoving()&&this.loaded();if(t&&(a=this._updateAverageElevation(r,!0)),a)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new e.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.Event("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||s||(this._fullyLoaded=!0,e.LivePerformanceUtils.mark(e.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&e.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e,t=!1){const i=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);if((t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let n=this.transform.sampleAverageElevation(),r=!1;this.transform.elevation&&(r=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(n)?n=0:this._averageElevationLastSampledAt=e;const o=Math.abs(t-n);if(o>1){if(this._isInitialLoad||r)return this._averageElevation.jumpTo(n),i(n);this._averageElevation.easeTo(n,e,300)}else if(o>1e-4)return this._averageElevation.jumpTo(n),i(n)}return!!this._averageElevation.isEasing(e)&&i(this._averageElevation.getValue(e))}_authenticate(){e.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(t=>{if(t&&(t.message===e.AUTH_ERR_MSG||401===t.status)){const t=this.painter.context.gl;e.storeAuthState(t,!1),this._logoControl instanceof Kr&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),e.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const i=this.painter.context.gl,n=i.createFramebuffer();function r(e){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0);const t=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,t),t}return i.bindFramebuffer(i.FRAMEBUFFER,n),this._canvasPixelComparison(r(e),t.canvasCopies.map(r),t.timeStamps)}_canvasPixelComparison(e,t,i){let n=i[1]-i[0];const r=e.length/4;for(let o=0;o<t.length;o++){const a=t[o];let s=0;for(let t=0;t<a.length;t+=4)a[t]===e[t]&&a[t+1]===e[t+1]&&a[t+2]===e[t+2]&&a[t+3]===e[t+3]&&(s+=1);n+=(i[o+2]-i[o+1])*(1-s/r)}return n}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==e.window&&(e.window.removeEventListener("resize",this._onWindowResize,!1),e.window.removeEventListener("orientationchange",this._onWindowResize,!1),e.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),e.window.removeEventListener("online",this._onWindowOnline,!1),e.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),e.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new e.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.exported.frame((e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)})))}_preloadTiles(t){const i=this.style?Object.values(this.style._sourceCaches):[];return e.asyncAll(i,((e,i)=>e._preloadTiles(t,i)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===e.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,e&&this._update())}_setCacheLimits(t,i){e.setCacheLimits(t,i)}get version(){return e.version}},NavigationControl:class{constructor(t){this.options=e.extend({},co,t),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(e.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(e=>{this._map&&this._map.zoomIn({},{originalEvent:e})})),o("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(e=>{this._map&&this._map.zoomOut({},{originalEvent:e})})),o("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(e.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))})),this._compassIcon=o("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),i=t===e.getMaxZoom(),n=t===e.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new uo(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const i=o("button",e,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(e,t){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",i),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends e.Evented{constructor(t){super(),this.options=e.extend({geolocation:e.window.navigator.geolocation},ho,t),e.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Kn(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(t){const i=(e=!!this.options.geolocation)=>{this._supportsGeolocation=e,t(e)};void 0!==this._supportsGeolocation?t(this._supportsGeolocation):void 0!==e.window.navigator.permissions?e.window.navigator.permissions.query({name:"geolocation"}).then((e=>i("denied"!==e.state))).catch((()=>i())):i()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),i=e.coords;return!!t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.Event("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("geolocate",t)),this._finish()}}_updateCamera(t){const i=new e.LngLat(t.coords.longitude,t.coords.latitude),n=t.coords.accuracy,r=this._map.getBearing(),o=e.extend({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(n),o,{geolocateSource:!0})}_updateMarker(t){if(t){const i=new e.LngLat(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,i=e.mercatorZfromAltitude(1,t._center.lat)*t.worldSize,n=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=o("button","mapboxgl-ctrl-geolocate",this._container),o("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=o("div","mapboxgl-user-location"),this._dotElement.appendChild(o("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(o("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new io({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=o("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new io({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.Event("trackuserlocationend")))}))}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return e.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const t=()=>{e.window.addEventListener("ondeviceorientationabsolute"in e.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==e.window.DeviceMotionEvent&&"function"==typeof e.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((e=>{"granted"===e&&t()})).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),e.window.removeEventListener("deviceorientation",this._onDeviceOrientation),e.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Jr,ScaleControl:class{constructor(t){this.options=e.extend({},po,t),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch(e){return!1}}()||(this._setScale=fo.bind(this)),e.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,i=t._containerHeight/2,n=t._containerWidth/2-e/2,r=t.unproject([n,i]),o=t.unproject([n+e,i]),a=r.distanceTo(o);if("imperial"===this.options.unit){const t=3.2808*a;t>5280?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,a/1852,"nautical-mile"):a>=1e3?this._setScale(e,a/1e3,"kilometer"):this._setScale(e,a,"meter")}_setScale(e,t,i){const n=mo(t),r=n/t;this._map._requestDomTask((()=>{this._container.style.width=e*r+"px",this._container.innerHTML="nautical-mile"!==i?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:i}).format(n):`${n}&nbsp;nm`}))}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof e.window.HTMLElement?this._container=t.container:e.warnOnce("Full screen control 'container' must be a DOM element.")),e.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in e.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in e.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,e.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!e.window.document.fullscreenEnabled&&!e.window.document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=o("button","mapboxgl-ctrl-fullscreen",this._controlContainer);o("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),e.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(e.window.document.fullscreenElement||e.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?e.window.document.exitFullscreen?e.window.document.exitFullscreen():e.window.document.webkitCancelFullScreen&&e.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends e.Evented{constructor(t){super(),this.options=e.extend(Object.create(no),t),e.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new e.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new e.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=e.LngLat.convert(t),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(e.window.document.createTextNode(t))}setHTML(t){const i=e.window.document.createDocumentFragment(),n=e.window.document.createElement("body");let r;for(n.innerHTML=t;r=n.firstChild,r;)i.appendChild(r);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=o("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=o("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.setAttribute("aria-hidden","true"),e.innerHTML="&#215;",e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,i=this._container,n=this._pos;if(!t||!i||!n)return"bottom";const r=i.offsetWidth,o=i.offsetHeight,a=n.x<r/2,s=n.x>t.transform.width-r/2;if(n.y+e<o)return a?"top-left":s?"top-right":"top";if(n.y>t.transform.height-o){if(a)return"bottom-left";if(s)return"bottom-right"}return a?"left":s?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(t){const i=this._map,n=this._content;if(!i||!this._lngLat&&!this._trackPointer||!n)return;let r=this._container;if(r||(r=this._container=o("div","mapboxgl-popup",i.getContainer()),this._tip=o("div","mapboxgl-popup-tip",r),r.appendChild(n)),this.options.maxWidth&&r.style.maxWidth!==this.options.maxWidth&&(r.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=eo(this._lngLat,this._pos,i.transform)),!this._trackPointer||t){const e=this._pos=this._trackPointer&&t?t:i.project(this._lngLat),n=oo(this.options.offset),r=this._anchor=this._getAnchor(n.y),o=oo(this.options.offset,r),a=e.add(o).round();i._requestDomTask((()=>{this._container&&r&&(this._container.style.transform=`${to[r]} translate(${a.x}px,${a.y}px)`)}))}if(!this._marker&&i._showingGlobe()){const t=e.isLngLatBehindGlobe(i.transform,this._lngLat)?0:1;this._setOpacity(t)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(ro);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:io,Style:Qt,LngLat:e.LngLat,LngLatBounds:e.LngLatBounds,Point:e.pointGeometry,MercatorCoordinate:e.MercatorCoordinate,FreeCameraOptions:jn,Evented:e.Evented,config:e.config,prewarm:function(){Ge().acquire(Ne)},clearPrewarmedResources:function(){const e=Ve;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Ne),Ve=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return e.config.ACCESS_TOKEN},set accessToken(t){e.config.ACCESS_TOKEN=t},get baseApiUrl(){return e.config.API_URL},set baseApiUrl(t){e.config.API_URL=t},get workerCount(){return Ue.workerCount},set workerCount(e){Ue.workerCount=e},get maxParallelImageRequests(){return e.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.config.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){e.clearTileCache(t)},workerUrl:"",workerClass:null,setNow:e.exported.setNow,restoreNow:e.exported.restoreNow};return go})),i}()},De(Le={exports:{}},Le.exports),Le.exports);function Oe(e,t,i){const n=e.slice();return n[12]=t[i],n}function Be(e,t,i){const n=e.slice();return n[15]=t[i],n}function Fe(e){let t,i,n,r=e[12].name+"";return{c(){t=T("div"),i=S(r),P(t,"slot","head"),P(t,"id",n="head-"+e[12].fips),P(t,"class","svelte-pmfz5t")},m(e,n){b(e,t,n),y(t,i)},p(e,o){1&o&&r!==(r=e[12].name+"")&&I(i,r),1&o&&n!==(n="head-"+e[12].fips)&&P(t,"id",n)},d(e){e&&w(t)}}}function Ne(e){let t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,g,_,x,v,M,C,k,D,L,R,O,B,F,N,U,V,G,j,W,$,q,Z,H,X=e[15].name+"",Y=e[15].city+"",J=e[15].address+"",K=e[15].EPAFacilityID+"",Q=e[15].sub_last.date_val+"",ee=(e[15].sub_last.num_accidents||"None")+"";function te(){return e[7](e[15])}let ie=e[15].names_prev.length&&Ue(e);return{c(){t=T("div"),i=T("p"),n=E(),r=T("button"),o=S(X),a=E(),s=T("a"),l=S("See more details"),u=E(),ie&&ie.c(),h=E(),d=T("p"),p=T("b"),p.textContent="City:",f=E(),m=S(Y),g=E(),_=T("p"),x=T("b"),x.textContent="Address:",v=E(),M=S(J),C=E(),k=T("p"),D=T("b"),D.textContent="EPA Facility ID:",L=E(),R=S(K),O=E(),B=T("p"),F=T("b"),F.textContent="Latest RMP validation:",N=E(),U=S(Q),V=E(),G=T("p"),j=T("b"),j.textContent="# Accidents in latest 5-year history:",W=E(),$=S(ee),P(i,"class","facility svelte-pmfz5t"),z(i,"deregistered",e[15].sub_last.date_dereg),P(r,"class","facility-name svelte-pmfz5t"),P(r,"id","show-facility"),P(s,"href",c="#/facility:"+e[15].EPAFacilityID),P(s,"class","facility-name svelte-pmfz5t"),P(p,"class","svelte-pmfz5t"),P(d,"class","svelte-pmfz5t"),P(x,"class","svelte-pmfz5t"),P(_,"class","svelte-pmfz5t"),P(D,"class","svelte-pmfz5t"),P(k,"class","svelte-pmfz5t"),P(F,"class","svelte-pmfz5t"),P(B,"class","svelte-pmfz5t"),P(j,"class","svelte-pmfz5t"),P(G,"class","svelte-pmfz5t"),P(t,"id",q="facility-"+e[15].EPAFacilityID),P(t,"class","item svelte-pmfz5t")},m(e,c){b(e,t,c),y(t,i),y(t,n),y(t,r),y(r,o),y(t,a),y(t,s),y(s,l),y(t,u),ie&&ie.m(t,null),y(t,h),y(t,d),y(d,p),y(d,f),y(d,m),y(t,g),y(t,_),y(_,x),y(_,v),y(_,M),y(t,C),y(t,k),y(k,D),y(k,L),y(k,R),y(t,O),y(t,B),y(B,F),y(B,N),y(B,U),y(t,V),y(t,G),y(G,j),y(G,W),y(G,$),Z||(H=A(r,"click",te),Z=!0)},p(n,r){e=n,1&r&&z(i,"deregistered",e[15].sub_last.date_dereg),1&r&&X!==(X=e[15].name+"")&&I(o,X),1&r&&c!==(c="#/facility:"+e[15].EPAFacilityID)&&P(s,"href",c),e[15].names_prev.length?ie?ie.p(e,r):(ie=Ue(e),ie.c(),ie.m(t,h)):ie&&(ie.d(1),ie=null),1&r&&Y!==(Y=e[15].city+"")&&I(m,Y),1&r&&J!==(J=e[15].address+"")&&I(M,J),1&r&&K!==(K=e[15].EPAFacilityID+"")&&I(R,K),1&r&&Q!==(Q=e[15].sub_last.date_val+"")&&I(U,Q),1&r&&ee!==(ee=(e[15].sub_last.num_accidents||"None")+"")&&I($,ee),1&r&&q!==(q="facility-"+e[15].EPAFacilityID)&&P(t,"id",q)},d(e){e&&w(t),ie&&ie.d(),Z=!1,H()}}}function Ue(e){let t,i,n,r,o=e[15].names_prev.join(" • ")+"";return{c(){t=T("p"),i=T("b"),i.textContent="Has also appeared as:",n=E(),r=S(o),P(i,"class","svelte-pmfz5t"),P(t,"class","svelte-pmfz5t")},m(e,o){b(e,t,o),y(t,i),y(t,n),y(t,r)},p(e,t){1&t&&o!==(o=e[15].names_prev.join(" • ")+"")&&I(r,o)},d(e){e&&w(t)}}}function Ve(e){let t,i=(e[2]||null===e[15].sub_last.date_dereg)&&Ne(e);return{c(){i&&i.c(),t=C()},m(e,n){i&&i.m(e,n),b(e,t,n)},p(e,n){e[2]||null===e[15].sub_last.date_dereg?i?i.p(e,n):(i=Ne(e),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null)},d(e){i&&i.d(e),e&&w(t)}}}function Ge(e){let t,i,n,r=e[12].facilities,o=[];for(let t=0;t<r.length;t+=1)o[t]=Ve(Be(e,r,t));return{c(){t=T("div");for(let e=0;e<o.length;e+=1)o[e].c();i=E(),P(t,"slot","details"),P(t,"id",n="details-"+e[12].fips),P(t,"class","svelte-pmfz5t")},m(e,n){b(e,t,n);for(let e=0;e<o.length;e+=1)o[e].m(t,null);y(t,i)},p(e,a){if(37&a){let n;for(r=e[12].facilities,n=0;n<r.length;n+=1){const s=Be(e,r,n);o[n]?o[n].p(s,a):(o[n]=Ve(s),o[n].c(),o[n].m(t,i))}for(;n<o.length;n+=1)o[n].d(1);o.length=r.length}1&a&&n!==(n="details-"+e[12].fips)&&P(t,"id",n)},d(e){e&&w(t),M(o,e)}}}function je(e){let t,i;return t=new ze({props:{key:"county-"+e[12].fips,id:e[12].fips,$$slots:{details:[Ge],head:[Fe]},$$scope:{ctx:e}}}),{c(){ce(t.$$.fragment)},m(e,n){ue(t,e,n),i=!0},p(e,i){const n={};1&i&&(n.key="county-"+e[12].fips),1&i&&(n.id=e[12].fips),262149&i&&(n.$$scope={dirty:i,ctx:e}),t.$set(n)},i(e){i||(oe(t.$$.fragment,e),i=!0)},o(e){ae(t.$$.fragment,e),i=!1},d(e){he(t,e)}}}function We(e){let t,i,n=e[0].counties,r=[];for(let t=0;t<n.length;t+=1)r[t]=je(Oe(e,n,t));const o=e=>ae(r[e],1,1,(()=>{r[e]=null}));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=C()},m(e,n){for(let t=0;t<r.length;t+=1)r[t].m(e,n);b(e,t,n),i=!0},p(e,i){if(37&i){let a;for(n=e[0].counties,a=0;a<n.length;a+=1){const o=Oe(e,n,a);r[a]?(r[a].p(o,i),oe(r[a],1)):(r[a]=je(o),r[a].c(),oe(r[a],1),r[a].m(t.parentNode,t))}for(ne(),a=n.length;a<r.length;a+=1)o(a);re()}},i(e){if(!i){for(let e=0;e<n.length;e+=1)oe(r[e]);i=!0}},o(e){r=r.filter(Boolean);for(let e=0;e<r.length;e+=1)ae(r[e]);i=!1},d(e){M(r,e),e&&w(t)}}}function $e(e){let t,i,n,o,a,s,l,c,u,h,d,p,f,m,g,_,x,v,M,C,k,D,L=e[1]?"Close":"Open",R=e[0].name+"",O=e[2]?"Hide Deregistered Facilities":"Show Deregistered Facilities";return M=new be({props:{$$slots:{default:[We]},$$scope:{ctx:e}}}),{c(){t=T("div"),i=T("button"),n=S("☰ "),o=S(L),a=S(" Sidebar"),s=E(),l=T("div"),c=E(),u=T("aside"),h=T("a"),h.textContent="⭠ View all states",d=E(),p=T("h1"),f=S("Facilities in "),m=S(R),g=E(),_=T("button"),x=S(O),v=E(),ce(M.$$.fragment),P(i,"class","openbtn svelte-pmfz5t"),P(l,"id","map"),P(l,"class","svelte-pmfz5t"),P(h,"href","#/list:states"),P(h,"class","svelte-pmfz5t"),P(p,"class","svelte-pmfz5t"),P(_,"class","svelte-pmfz5t"),P(u,"class","svelte-pmfz5t"),z(u,"active",e[1]),P(t,"id","main"),P(t,"class","svelte-pmfz5t")},m(r,w){b(r,t,w),y(t,i),y(i,n),y(i,o),y(i,a),y(t,s),y(t,l),y(t,c),y(t,u),y(u,h),y(u,d),y(u,p),y(p,f),y(p,m),y(u,g),y(u,_),y(_,x),y(u,v),ue(M,u,null),C=!0,k||(D=[A(i,"click",e[6]),A(_,"click",e[4])],k=!0)},p(e,[t]){(!C||2&t)&&L!==(L=e[1]?"Close":"Open")&&I(o,L),(!C||1&t)&&R!==(R=e[0].name+"")&&I(m,R),(!C||4&t)&&O!==(O=e[2]?"Hide Deregistered Facilities":"Show Deregistered Facilities")&&I(x,O);const i={};262149&t&&(i.$$scope={dirty:t,ctx:e}),M.$set(i),(!C||2&t)&&z(u,"active",e[1])},i(e){C||(oe(M.$$.fragment,e),C=!0)},o(e){ae(M.$$.fragment,e),C=!1},d(e){e&&w(t),he(M),k=!1,r(D)}}}function qe(e,t,i){let{item:n}=t;xe();let r=!1;function o(){i(1,r=!r);document.querySelector(".openbtn").style.left=r?"300px":"10px"}let a,s=!0;let l=null;function c(e){console.log("Clicked Facility ",e);let t=Number(e.sub_last.lon_sub),i=Number(e.sub_last.lat_sub);console.log([t,i]),a.flyTo({center:[t,i],zoom:10}),function(e,t,i){const n=document.getElementsByClassName("mapboxgl-popup");n[0]&&n[0].remove();new Re.Popup({closeOnClick:!1}).setLngLat([e,t]).setHTML(`<h3>${i.name}</h3><h4>${i.address}</h4>`).addTo(a)}(t,i,e)}fetch("./data/geo-administrative/states-center-coord.json").then((e=>e.json())).then((e=>{l=e,console.log("Center State Data",l),console.log("Item State",n),l.centerStates.forEach((e=>{e.abbr===n.abbr&&(console.log("Item state found in DB: ",e.abbr),a.flyTo({center:e.center,zoom:7}))}))})).catch((e=>{console.log(e)})),console.log("Selected State",n),function(e){V().$$.on_mount.push(e)}((()=>{Re.accessToken="pk.eyJ1IjoibWljYWVsYS1yb3NhZGlvIiwiYSI6ImNsZzlsN2s1eTBxZXIzZHJ2YTI1YjJ1ejkifQ.bT9A2q8RKkiKPfCMVh63jQ",a=new Re.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[Number(n.counties[0].facilities[0].sub_last.lon_sub),Number(n.counties[0].facilities[0].sub_last.lat_sub)],zoom:4}),a.addControl(new Re.NavigationControl,"top-right")}));return e.$$set=e=>{"item"in e&&i(0,n=e.item)},[n,r,s,o,function(){i(2,s=!s)},c,()=>o(),e=>c(e)]}class Ze extends fe{constructor(e){super(),pe(this,e,qe,$e,a,{item:0})}}function He(e,t,i){const n=e.slice();return n[1]=t[i],n}function Xe(e,t,i){const n=e.slice();return n[4]=t[i],n}function Ye(e){let t,i,n,r,o=e[0].submissions[0].date_dereg+"";return{c(){t=T("div"),i=T("a"),i.textContent="Deregistered",n=S(" from RMP on "),r=S(o),P(i,"href","https://www.epa.gov/rmp/how-deregister-facility-risk-management-program"),P(t,"class","warning")},m(e,o){b(e,t,o),y(t,i),y(t,n),y(t,r)},p(e,t){1&t&&o!==(o=e[0].submissions[0].date_dereg+"")&&I(r,o)},d(e){e&&w(t)}}}function Je(e){let t,i,n,r,o,a,s,l,c,u,h,d,p=(e[0].submissions[0].lat_sub||"")+"",f=(e[0].submissions[0].lon_sub||"")+"";return{c(){t=S(p),i=S(", "),n=S(f),r=S(" ("),o=T("a"),a=S("OSM"),l=S(" | "),c=T("a"),u=S("Google"),d=S(")"),P(o,"href",s="https://www.openstreetmap.org/?zoom=10&mlat="+e[0].submissions[0].lat_sub+"&mlon="+e[0].submissions[0].lon_sub),P(o,"target","_blank"),P(o,"rel","noreferrer"),P(c,"href",h="https://maps.google.com/maps?q=loc:"+e[0].submissions[0].lat_sub+","+e[0].submissions[0].lon_sub),P(c,"target","_blank"),P(c,"rel","noreferrer")},m(e,s){b(e,t,s),b(e,i,s),b(e,n,s),b(e,r,s),b(e,o,s),y(o,a),b(e,l,s),b(e,c,s),y(c,u),b(e,d,s)},p(e,i){1&i&&p!==(p=(e[0].submissions[0].lat_sub||"")+"")&&I(t,p),1&i&&f!==(f=(e[0].submissions[0].lon_sub||"")+"")&&I(n,f),1&i&&s!==(s="https://www.openstreetmap.org/?zoom=10&mlat="+e[0].submissions[0].lat_sub+"&mlon="+e[0].submissions[0].lon_sub)&&P(o,"href",s),1&i&&h!==(h="https://maps.google.com/maps?q=loc:"+e[0].submissions[0].lat_sub+","+e[0].submissions[0].lon_sub)&&P(c,"href",h)},d(e){e&&w(t),e&&w(i),e&&w(n),e&&w(r),e&&w(o),e&&w(l),e&&w(c),e&&w(d)}}}function Ke(e){let t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,g,_,x,v,M,C,A,z,D,L,R,O,B=e[4].id+"",F=e[4].date_rec+"",N=e[4].date_val+"",U=e[4].name+"",V=(e[4].company_1||"")+"",G=(e[4].company_2||"")+"",j=(e[4].operator||"")+"",W=(e[4].num_accidents||"")+"";return{c(){t=T("tr"),i=T("td"),n=T("a"),r=S(B),a=E(),s=T("td"),l=S(F),c=E(),u=T("td"),h=S(N),d=E(),p=T("td"),f=S(U),m=E(),g=T("td"),_=S(V),x=E(),v=T("td"),M=S(G),C=E(),A=T("td"),z=S(j),D=E(),L=T("td"),R=S(W),O=E(),P(n,"href",o="#/submission:"+e[4].id),P(i,"class","svelte-4fkb2z"),k(s,"white-space","nowrap"),P(s,"class","svelte-4fkb2z"),k(u,"white-space","nowrap"),P(u,"class","svelte-4fkb2z"),P(p,"class","svelte-4fkb2z"),P(g,"class","svelte-4fkb2z"),P(v,"class","svelte-4fkb2z"),P(A,"class","svelte-4fkb2z"),P(L,"class","svelte-4fkb2z")},m(e,o){b(e,t,o),y(t,i),y(i,n),y(n,r),y(t,a),y(t,s),y(s,l),y(t,c),y(t,u),y(u,h),y(t,d),y(t,p),y(p,f),y(t,m),y(t,g),y(g,_),y(t,x),y(t,v),y(v,M),y(t,C),y(t,A),y(A,z),y(t,D),y(t,L),y(L,R),y(t,O)},p(e,t){1&t&&B!==(B=e[4].id+"")&&I(r,B),1&t&&o!==(o="#/submission:"+e[4].id)&&P(n,"href",o),1&t&&F!==(F=e[4].date_rec+"")&&I(l,F),1&t&&N!==(N=e[4].date_val+"")&&I(h,N),1&t&&U!==(U=e[4].name+"")&&I(f,U),1&t&&V!==(V=(e[4].company_1||"")+"")&&I(_,V),1&t&&G!==(G=(e[4].company_2||"")+"")&&I(M,G),1&t&&j!==(j=(e[4].operator||"")+"")&&I(z,j),1&t&&W!==(W=(e[4].num_accidents||"")+"")&&I(R,W)},d(e){e&&w(t)}}}function Qe(t){let i;return{c(){i=T("p"),i.innerHTML="<i>None</i>"},m(e,t){b(e,i,t)},p:e,d(e){e&&w(i)}}}function et(e){let t,i,n,r,o,a=e[0].accidents,s=[];for(let t=0;t<a.length;t+=1)s[t]=tt(He(e,a,t));return{c(){t=T("table"),i=T("thead"),i.innerHTML="<tr><th>Latest Sub.</th> \n        <th>Date</th> \n        <th>Time</th> \n        <th>Chemicals</th> \n        <th>Deaths</th> \n        <th>Inj.</th> \n        <th>Ev./Shelt.</th> \n        <th>Prop. Dam.</th></tr>",n=E();for(let e=0;e<s.length;e+=1)s[e].c();r=E(),o=T("div"),o.innerHTML='<ul class="svelte-4fkb2z"><li class="svelte-4fkb2z"><b>Latest Sub.</b>: The most recent RMP submission containing information about this accident.</li> \n      <li class="svelte-4fkb2z"><b>Date</b>: The date of the accident.</li> \n      <li class="svelte-4fkb2z"><b>Time</b>: The HH:MM time of the accident, on a 24-hour clock.</li> \n      <li class="svelte-4fkb2z"><b>Chemicals</b>: The chemicals involved in the accident.</li> \n      <li class="svelte-4fkb2z"><b>Deaths</b>: The number of deaths reported; see linked submission for a breakdown of workers, public responders, public onsite, and public offsite.</li> \n      <li class="svelte-4fkb2z"><b>Inj.</b>: Injuries and hospitalizations.</li> \n      <li class="svelte-4fkb2z"><b>Ev./Shelt.</b>: The number of people evacuated + sheltered in place.</li> \n      <li class="svelte-4fkb2z"><b>Prop. Dam.</b>: Total cost of onsite and offsite property damage.</li></ul>',P(t,"id","accidents-list"),P(t,"class","svelte-4fkb2z"),P(o,"class","column-descriptions svelte-4fkb2z")},m(e,a){b(e,t,a),y(t,i),y(t,n);for(let e=0;e<s.length;e+=1)s[e].m(t,null);b(e,r,a),b(e,o,a)},p(e,i){if(1&i){let n;for(a=e[0].accidents,n=0;n<a.length;n+=1){const r=He(e,a,n);s[n]?s[n].p(r,i):(s[n]=tt(r),s[n].c(),s[n].m(t,null))}for(;n<s.length;n+=1)s[n].d(1);s.length=a.length}},d(e){e&&w(t),M(s,e),e&&w(r),e&&w(o)}}}function tt(e){let t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,g,_,x,v,M,C,A,z,D,L,R,O,B,F=e[1].sub_id+"",N=e[1].date+"",U=e[1].time+"",V=e[1].chem+"",G=e[1].deaths.toLocaleString()+"",j=e[1].inj.toLocaleString()+"",W=e[1].ev_shlt.toLocaleString()+"",$=e[1].damg.toLocaleString()+"";return{c(){t=T("tr"),i=T("td"),n=T("a"),r=S(F),a=E(),s=T("td"),l=S(N),c=E(),u=T("td"),h=S(U),d=E(),p=T("td"),f=S(V),m=E(),g=T("td"),_=S(G),x=E(),v=T("td"),M=S(j),C=E(),A=T("td"),z=S(W),D=E(),L=T("td"),R=S("$"),O=S($),B=E(),P(n,"href",o="#/submission:"+e[1].sub_id),P(i,"class","svelte-4fkb2z"),k(s,"white-space","nowrap"),P(s,"class","svelte-4fkb2z"),k(u,"white-space","nowrap"),P(u,"class","svelte-4fkb2z"),P(p,"class","svelte-4fkb2z"),P(g,"class","svelte-4fkb2z"),P(v,"class","svelte-4fkb2z"),P(A,"class","svelte-4fkb2z"),P(L,"class","svelte-4fkb2z")},m(e,o){b(e,t,o),y(t,i),y(i,n),y(n,r),y(t,a),y(t,s),y(s,l),y(t,c),y(t,u),y(u,h),y(t,d),y(t,p),y(p,f),y(t,m),y(t,g),y(g,_),y(t,x),y(t,v),y(v,M),y(t,C),y(t,A),y(A,z),y(t,D),y(t,L),y(L,R),y(L,O),y(t,B)},p(e,t){1&t&&F!==(F=e[1].sub_id+"")&&I(r,F),1&t&&o!==(o="#/submission:"+e[1].sub_id)&&P(n,"href",o),1&t&&N!==(N=e[1].date+"")&&I(l,N),1&t&&U!==(U=e[1].time+"")&&I(h,U),1&t&&V!==(V=e[1].chem+"")&&I(f,V),1&t&&G!==(G=e[1].deaths.toLocaleString()+"")&&I(_,G),1&t&&j!==(j=e[1].inj.toLocaleString()+"")&&I(M,j),1&t&&W!==(W=e[1].ev_shlt.toLocaleString()+"")&&I(z,W),1&t&&$!==($=e[1].damg.toLocaleString()+"")&&I(O,$)},d(e){e&&w(t)}}}function it(t){let i,n,r,o,a,s,l,c,u,h,d,p,f,m,g,_,x,v,C,A,k,z,D,L,R,O,B,F,N,U,V,G,j,W,$,q,Z,H,X,Y,J,K,Q,ee,te,ie,ne,re,oe,ae,se,le,ce,ue,he,de,pe,fe,me,ge,_e,ye,xe,ve,be,we,Me,Te,Se=t[0].name+"",Ee=t[0].EPAFacilityID+"",Ce=(t[0].state||"")+"",Ae=(t[0].city||"")+"",Pe=(t[0].zip||"")+"",Ie=(t[0].company_1||"")+"",ke=(t[0].company_2||"")+"",ze=(t[0].operator||"")+"",De=t[0].submissions[0].date_dereg&&Ye(t),Le=t[0].submissions[0].lon_sub&&Je(t),Re=t[0].submissions,Oe=[];for(let e=0;e<Re.length;e+=1)Oe[e]=Ke(Xe(t,Re,e));function Be(e,t){return e[0].accidents.length?et:Qe}let Fe=Be(t),Ne=Fe(t);return{c(){i=T("section"),n=T("h2"),r=S("Facility: "),o=S(Se),a=E(),De&&De.c(),s=E(),l=T("ul"),c=T("li"),u=T("b"),u.textContent="EPA Facility ID:",h=E(),d=T("span"),p=T("a"),f=S(Ee),g=E(),_=T("li"),x=T("b"),x.textContent="State:",v=E(),C=T("span"),A=T("a"),k=S(Ce),D=E(),L=T("li"),R=T("b"),R.textContent="City:",O=E(),B=T("span"),F=S(Ae),N=E(),U=T("li"),V=T("b"),V.textContent="ZIP Code:",G=E(),j=T("span"),W=S(Pe),$=E(),q=T("li"),Z=T("b"),Z.textContent="Coordinates:",H=E(),X=T("span"),Le&&Le.c(),Y=E(),J=T("li"),K=T("b"),K.textContent="Company 1:",Q=E(),ee=T("span"),te=S(Ie),ie=E(),ne=T("li"),re=T("b"),re.textContent="Company 2:",oe=E(),ae=T("span"),se=S(ke),le=E(),ce=T("li"),ue=T("b"),ue.textContent="Operator:",he=E(),de=T("span"),pe=S(ze),fe=E(),me=T("h3"),me.textContent="RMP Submissions (through October 2023)",ge=E(),_e=T("table"),ye=T("thead"),ye.innerHTML="<tr><th>Sub. #</th> \n        <th>EPA Received</th> \n        <th>EPA Last Validated</th> \n        <th>Fac. Name</th> \n        <th>Co. 1</th> \n        <th>Co. 2</th> \n        <th>Op.</th> \n        <th>Acc.</th></tr>",xe=E();for(let e=0;e<Oe.length;e+=1)Oe[e].c();ve=E(),be=T("div"),be.innerHTML='<ul class="svelte-4fkb2z"><li class="svelte-4fkb2z"><b>Sub. #</b>: The ID number the EPA assigned to this submission. (Technically, in the raw data, the misnomered <code>FacilityID</code> field.)</li> \n      <li class="svelte-4fkb2z"><b>EPA Received</b>: The date the EPA received the submission.</li> \n      <li class="svelte-4fkb2z"><b>EPA Last Validated</b>: The date of the EPA&#39;s latest completion/validation check for this submission, which may also include checks of corrections made after the initial submission.</li> \n      <li class="svelte-4fkb2z"><b>Fac. Name</b>: The facility name listed in the submission.</li> \n      <li class="svelte-4fkb2z"><b>Co. 1</b>: The first company listed in the submission.</li> \n      <li class="svelte-4fkb2z"><b>Co. 2</b>: The second company listed in the submission.</li> \n      <li class="svelte-4fkb2z"><b>Op.</b>: The operator listed in the submission.</li> \n      <li class="svelte-4fkb2z"><b>Acc.</b>: The number of accidents listed in the submission&#39;s five-year accident history. Note: Because of overlapping timeframes, some accidents may be duplicated across submissions. The total of this column is <b>often not</b> the total number of distinct accidents. See below for distinct accidents.</li></ul>',we=E(),Me=T("h3"),Me.textContent="Accidents Reported (through October 2023)",Te=E(),Ne.c(),P(p,"href",m="https://echo.epa.gov/detailed-facility-report?fid="+t[0].EPAFacilityID),P(p,"target","_blank"),P(p,"rel","noreferrer"),P(A,"href",z="#/state:"+t[0].state),P(l,"id","facility-details"),P(l,"class","svelte-4fkb2z"),P(me,"class","svelte-4fkb2z"),P(_e,"id","submission-list"),P(_e,"class","svelte-4fkb2z"),P(be,"class","column-descriptions svelte-4fkb2z"),P(Me,"class","svelte-4fkb2z"),P(i,"id","facility")},m(e,t){b(e,i,t),y(i,n),y(n,r),y(n,o),y(i,a),De&&De.m(i,null),y(i,s),y(i,l),y(l,c),y(c,u),y(c,h),y(c,d),y(d,p),y(p,f),y(l,g),y(l,_),y(_,x),y(_,v),y(_,C),y(C,A),y(A,k),y(l,D),y(l,L),y(L,R),y(L,O),y(L,B),y(B,F),y(l,N),y(l,U),y(U,V),y(U,G),y(U,j),y(j,W),y(l,$),y(l,q),y(q,Z),y(q,H),y(q,X),Le&&Le.m(X,null),y(l,Y),y(l,J),y(J,K),y(J,Q),y(J,ee),y(ee,te),y(l,ie),y(l,ne),y(ne,re),y(ne,oe),y(ne,ae),y(ae,se),y(l,le),y(l,ce),y(ce,ue),y(ce,he),y(ce,de),y(de,pe),y(i,fe),y(i,me),y(i,ge),y(i,_e),y(_e,ye),y(_e,xe);for(let e=0;e<Oe.length;e+=1)Oe[e].m(_e,null);y(i,ve),y(i,be),y(i,we),y(i,Me),y(i,Te),Ne.m(i,null)},p(e,[t]){if(1&t&&Se!==(Se=e[0].name+"")&&I(o,Se),e[0].submissions[0].date_dereg?De?De.p(e,t):(De=Ye(e),De.c(),De.m(i,s)):De&&(De.d(1),De=null),1&t&&Ee!==(Ee=e[0].EPAFacilityID+"")&&I(f,Ee),1&t&&m!==(m="https://echo.epa.gov/detailed-facility-report?fid="+e[0].EPAFacilityID)&&P(p,"href",m),1&t&&Ce!==(Ce=(e[0].state||"")+"")&&I(k,Ce),1&t&&z!==(z="#/state:"+e[0].state)&&P(A,"href",z),1&t&&Ae!==(Ae=(e[0].city||"")+"")&&I(F,Ae),1&t&&Pe!==(Pe=(e[0].zip||"")+"")&&I(W,Pe),e[0].submissions[0].lon_sub?Le?Le.p(e,t):(Le=Je(e),Le.c(),Le.m(X,null)):Le&&(Le.d(1),Le=null),1&t&&Ie!==(Ie=(e[0].company_1||"")+"")&&I(te,Ie),1&t&&ke!==(ke=(e[0].company_2||"")+"")&&I(se,ke),1&t&&ze!==(ze=(e[0].operator||"")+"")&&I(pe,ze),1&t){let i;for(Re=e[0].submissions,i=0;i<Re.length;i+=1){const n=Xe(e,Re,i);Oe[i]?Oe[i].p(n,t):(Oe[i]=Ke(n),Oe[i].c(),Oe[i].m(_e,null))}for(;i<Oe.length;i+=1)Oe[i].d(1);Oe.length=Re.length}Fe===(Fe=Be(e))&&Ne?Ne.p(e,t):(Ne.d(1),Ne=Fe(e),Ne&&(Ne.c(),Ne.m(i,null)))},i:e,o:e,d(e){e&&w(i),De&&De.d(),Le&&Le.d(),M(Oe,e),Ne.d()}}}function nt(e,t,i){let{item:n}=t;return e.$$set=e=>{"item"in e&&i(0,n=e.item)},[n]}class rt extends fe{constructor(e){super(),pe(this,e,nt,it,a,{item:0})}}var ot={ChemicalID:{1:"Formaldehyde (solution)",2:"1,1-Dimethylhydrazine  [Hydrazine, 1,1-dimethyl-]",3:"Methyl hydrazine  [Hydrazine, methyl-]",4:"Chloroform  [Methane, trichloro-]",5:"Methyl chloride  [Methane, chloro-]",6:"Hydrocyanic acid",7:"Methyl mercaptan  [Methanethiol]",8:"Carbon disulfide",9:"Ethylene oxide  [Oxirane]",10:"Phosgene  [Carbonic dichloride]",11:"Propyleneimine  [Aziridine, 2-methyl-]",12:"Propylene oxide  [Oxirane, methyl-]",13:"Tetramethyllead  [Plumbane, tetramethyl-]",14:"Trimethylchlorosilane  [Silane, chlorotrimethyl-]",15:"Dimethyldichlorosilane  [Silane, dichlorodimethyl-]",16:"Methyltrichlorosilane  [Silane, trichloromethyl-]",17:"Isobutyronitrile  [Propanenitrile, 2-methyl-]",18:"Peracetic acid  [Ethaneperoxoic acid]",19:"Methyl chloroformate  [Carbonochloridic acid, methylester]",20:"Toluene 2,6-diisocyanate  [Benzene, 1,3-diisocyanato-2-methyl-]",21:"Epichlorohydrin  [Oxirane, (chloromethyl)-]",22:"Acrolein  [2-Propenal]",23:"Allylamine  [2-Propen-1-amine]",24:"Propionitrile  [Propanenitrile]",25:"Acrylonitrile  [2-Propenenitrile]",26:"Ethylenediamine  [1,2-Ethanediamine]",27:"Allyl alcohol  [2-Propen-1-ol]",28:"Chloromethyl methyl ether  [Methane, chloromethoxy-]",29:"Vinyl acetate monomer  [Acetic acid ethenyl ester]",30:"Isopropyl chloroformate  [Carbonochloridic acid, 1-methylethy ester]",31:"Cyclohexylamine  [Cyclohexanamine]",32:"Propyl chloroformate  [Carbonochloridic acid, propylester]",33:"Furan",34:"Piperidine",35:"Crotonaldehyde, (E)-  [2-Butenal, (E)-]",36:"Methacrylonitrile  [2-Propenenitrile, 2-methyl-]",37:"Ethyleneimine  [Aziridine]",38:"Hydrazine",39:"Boron trifluoride compound with methyl ether (1:1)  [Boron, trifluoro[oxybis[metane]]-, T-4-",40:"Cyanogen chloride",41:"Tetranitromethane  [Methane, tetranitro-]",42:"Chloromethyl ether  [Methane, oxybis[chloro-]",43:"Methyl thiocyanate  [Thiocyanic acid, methyl ester]",44:"Toluene 2,4-diisocyanate  [Benzene, 2,4-diisocyanato-1-methyl-]",45:"Perchloromethylmercaptan [Methanesulfenyl chloride, trichloro-]",46:"Methyl isocyanate  [Methane, isocyanato-]",47:"Acrylyl chloride  [2-Propenoyl chloride]",48:"Crotonaldehyde  [2-Butenal]",49:"Sulfur dioxide (anhydrous)",50:"Sulfur trioxide",51:"Titanium tetrachloride  [Titanium chloride (TiCl4) (T-4)-]",52:"Boron trifluoride  [Borane, trifluoro-]",53:"Hydrochloric acid (conc 37% or greater)",54:"Hydrogen chloride (anhydrous) [Hydrochloric acid]",55:"Hydrogen fluoride/Hydrofluoric acid (conc 50% or greater) [Hydrofluoric acid]",56:"Ammonia (anhydrous)",57:"Ammonia (conc 20% or greater)",58:"Nitric acid (conc 80% or greater)",59:"Phosphorus trichloride  [Phosphorous trichloride]",60:"Bromine",61:"Fluorine",62:"Chlorine",63:"Hydrogen sulfide",64:"Hydrogen selenide",65:"Sulfur tetrafluoride  [Sulfur fluoride (SF4), (T-4)-]",66:"Arsenous trichloride",67:"Arsine",68:"Phosphine",69:"Oleum (Fuming Sulfuric acid)  [Sulfuric acid, mixture with sulfur trioxide]",70:"Phosphorus oxychloride  [Phosphoryl chloride]",71:"Chlorine dioxide  [Chlorine oxide (ClO2)]",72:"Nitric oxide  [Nitrogen oxide (NO)]",73:"Boron trichloride  [Borane, trichloro-]",74:"Nickel carbonyl",75:"Iron, pentacarbonyl-  [Iron carbonyl (Fe(CO)5), (TB-5-11)-]",76:"Diborane",77:"Toluene diisocyanate (unspecified isomer)  [Benzene, 1,3-diisocyanatomethyl-]",78:"CBI Acids",79:"CBI Amines, Ammonia, and Hydrazines",80:"CBI Arsenic and Phosphorus Compounds",81:"CBI Boron Compounds",82:"CBI Carbonyl Compounds",83:"CBI Cyanides and Nitriles",84:"CBI Esters, Alcohols, Aldehydes, and Furans",85:"CBI Halogenated Organic Compounds",86:"CBI Halogens and Halogen Oxides",87:"CBI Isocyanates and Isothiocyanates",88:"CBI Nitrogen Oxides and Organic Nitro Compounds",89:"CBI Organic Silanes",90:"CBI Oxiranes and Azirdines",91:"CBI Selenium and Sulfur Compounds",92:"Ethyl ether  [Ethane, 1,1'-oxybis-]",93:"Methane",94:"Ethane",95:"Ethylene  [Ethene]",96:"Acetylene  [Ethyne]",97:"Methylamine  [Methanamine]",98:"Propane",99:"Propyne  [1-Propyne]",100:"Ethyl chloride  [Ethane, chloro-]",101:"Vinyl chloride  [Ethene, chloro-]",102:"Vinyl fluoride  [Ethene, fluoro-]",103:"Ethylamine  [Ethanamine]",104:"Acetaldehyde",105:"Ethyl mercaptan [Ethanethiol]",106:"Cyclopropane",107:"Isobutane  [Propane, 2-methyl]",108:"Isopropyl chloride [Propane, 2-chloro-]",109:"Isopropylamine [2-Propanamine]",110:"Vinylidene chloride [Ethene, 1,1-dichloro-]",111:"Difluoroethane  [Ethane, 1,1-difluoro-]",112:"Vinylidene fluoride [Ethene, 1,1-difluoro-]",113:"Trimethylamine [Methanamine, N,N-dimethyl-]",114:"Tetramethylsilane  [Silane, tetramethyl-]",115:"Isopentane  [Butane, 2-methyl-]",116:"Isoprene  [1,3-Butadiene, 2-methyl-]",117:"Trifluorochloroethylene [Ethene, chlorotrifluoro-]",118:"Butane",119:"1-Butene",120:"1,3-Butadiene",121:"Ethyl acetylene  [1-Butyne]",122:"2-Butene",123:"Vinyl methyl ether  [Ethene, methoxy-]",124:"Methyl formate  [Formic acid, methyl ester]",125:"Pentane",126:"1-Pentene",127:"Vinyl ethyl ether  [Ethene, ethoxy-]",128:"Ethyl nitrite  [Nitrous acid, ethyl ester]",129:"Propylene  [1-Propene]",130:"Methyl ether  [Methane, oxybis-]",131:"2-Methylpropene  [1-Propene, 2-methyl-]",132:"Tetrafluoroethylene [Ethene, tetrafluoro-]",133:"Dimethylamine  [Methanamine, N-methyl-]",134:"Cyanogen  [Ethanedinitrile]",135:"Propadiene  [1,2-Propadiene]",136:"Carbon oxysulfide  [Carbon oxide sulfide (COS)]",137:"2,2-Dimethylpropane [Propane, 2,2-dimethyl-]",138:"1,3-Pentadiene",139:"2-Chloropropylene [1-Propene, 2-chloro-]",140:"3-Methyl-1-butene",141:"2-Methyl-1-butene",142:"2-Butene-cis",143:"1-Chloropropylene [1-Propene, 1-chloro-]",144:"Bromotrifluorethylene [Ethene, bromotrifluoro-]",145:"2-Butene-trans  [2-Butene, (E)]",146:"2-Pentene, (Z)-",147:"2-Pentene, (E)-",148:"Vinyl acetylene [1-Buten-3-yne]",149:"Hydrogen",150:"Dichlorosilane  [Silane, dichloro-]",151:"Chlorine monoxide  [Chlorine oxide]",152:"Silane",153:"Trichlorosilane  [Silane, trichloro-]",154:"Butene",155:"Flammable Mixture",156:"CBI Flammable Substance",157:"Hydrochloric acid (conc 30% or greater)",158:"Hydrogen fluoride/Hydrofluoric acid (conc 40% or greater)",159:"Nitric acid (conc 40% or greater)",160:"Nitrogen Tetroxide"},NAICSCode:{11:"Agriculture, Forestry, Fishing and Hunting",21:"Mining, Quarrying, and Oil and Gas Extraction",22:"Utilities",23:"Construction",31:"Manufacturing of Food, Textiles, Apparel, and Leather Products",32:"Manufacturing of Wood, Paper, Petroleum, Coal, Chemical, and Nonmetallic Minerals",33:"Manufacturing of Metal, Electronic, Computer, Furniture, and Other Products",42:"Wholesale Trade",44:"Retail Trade for Automotive, Food, Clothing, Home Furnishings, and Other Necessities",45:"Retail Trade for Sporting Goods, Hobbies, Books, Music, and General Merchandise",48:"Transportation and Warehousing",49:"Transportation and Warehousing",51:"Information",52:"Finance and Insurance",53:"Real Estate and Rental and Leasing",54:"Professional, Scientific, and Technical Services",55:"Management of Companies and Enterprises",56:"Administrative and Support and Waste Management and Remediation Services",61:"Educational Services",62:"Health Care and Social Assistance",71:"Arts, Entertainment, and Recreation",72:"Accommodation and Food Services",81:"Other Services (except Public Administration)",92:"Public Administration",99:"Unclassified Establishments",111:"Crop Production",112:"Animal Production and Aquaculture",113:"Forestry and Logging",114:"Fishing, Hunting and Trapping",115:"Support Activities for Agriculture and Forestry",211:"Oil and Gas Extraction",212:"Mining (except Oil and Gas)",213:"Support Activities for Mining",221:"Utilities",233:"Building, Developing and General Contracting",234:"Heavy Construction",235:"Special Trade Contractors",236:"Construction of Buildings",237:"Heavy and Civil Engineering Construction",238:"Specialty Trade Contractors",311:"Food Manufacturing",312:"Beverage and Tobacco Product Manufacturing",313:"Textile Mills",314:"Textile Product Mills",315:"Apparel Manufacturing",316:"Leather and Allied Product Manufacturing",321:"Wood Product Manufacturing",322:"Paper Manufacturing",323:"Printing and Related Support Activities",324:"Petroleum and Coal Products Manufacturing",325:"Chemical Manufacturing",326:"Plastics and Rubber Products Manufacturing",327:"Nonmetallic Mineral Product Manufacturing",331:"Primary Metal Manufacturing",332:"Fabricated Metal Product Manufacturing",333:"Machinery Manufacturing",334:"Computer and Electronic Product Manufacturing",335:"Electrical Equipment, Appliance, and Component Manufacturing",336:"Transportation Equipment Manufacturing",337:"Furniture and Related Product Manufacturing",339:"Miscellaneous Manufacturing",421:"Wholesale Trade, Durable Goods",422:"Wholesale Trade, Nondurable Goods",423:"Merchant Wholesalers, Durable Goods",424:"Merchant Wholesalers, Nondurable Goods",425:"Wholesale Electronic Markets and Agents and Brokers",441:"Motor Vehicle and Parts Dealers",442:"Furniture and Home Furnishings Stores",443:"Electronics and Appliance Stores",444:"Building Material and Garden Equipment and Supplies Dealers",445:"Food and Beverage Stores",446:"Health and Personal Care Stores",447:"Gasoline Stations",448:"Clothing and Clothing Accessories Stores",451:"Sporting Goods, Hobby, Musical Instrument, and Book Stores",452:"General Merchandise Stores",453:"Miscellaneous Store Retailers",454:"Nonstore Retailers",481:"Air Transportation",482:"Rail Transportation",483:"Water Transportation",484:"Truck Transportation",485:"Transit and Ground Passenger Transportation",486:"Pipeline Transportation",487:"Scenic and Sightseeing Transportation",488:"Support Activities for Transportation",491:"Postal Service",492:"Couriers and Messengers",493:"Warehousing and Storage",511:"Publishing Industries (except Internet)",512:"Motion Picture and Sound Recording Industries",513:"Broadcasting and Telecommunications",514:"Information Services and Data Processing Services",515:"Broadcasting (except Internet)",516:"Internet Publishing and Broadcasting",517:"Telecommunications",518:"Data Processing, Hosting, and Related Services",519:"Other Information Services",521:"Monetary Authorities - Central Bank",522:"Credit Intermediation and Related Activities",523:"Securities, Commodity Contracts, and Other Financial Investments and Related Activities",524:"Insurance Carriers and Related Activities",525:"Funds, Trusts, and Other Financial Vehicles",531:"Real Estate",532:"Rental and Leasing Services",533:"Lessors of Nonfinancial Intangible Assets (except Copyrighted Works)",541:"Professional, Scientific, and Technical Services",551:"Management of Companies and Enterprises",561:"Administrative and Support Services",562:"Waste Management and Remediation Services",611:"Educational Services",621:"Ambulatory Health Care Services",622:"Hospitals",623:"Nursing and Residential Care Facilities",624:"Social Assistance",711:"Performing Arts, Spectator Sports, and Related Industries",712:"Museums, Historical Sites, and Similar Institutions",713:"Amusement, Gambling, and Recreation Industries",721:"Accommodation",722:"Food Services and Drinking Places",811:"Repair and Maintenance",812:"Personal and Laundry Services",813:"Religious, Grantmaking, Civic, Professional, and Similar Organizations",814:"Private Households",921:"Executive, Legislative, and Other General Government Support",922:"Justice, Public Order, and Safety Activities",923:"Administration of Human Resource Programs",924:"Administration of Environmental Quality Programs",925:"Administration of Housing Programs, Urban Planning, and Community Development",926:"Administration of Economic Programs",927:"Space Research and Technology",928:"National Security and International Affairs",999:"Unclassified Establishments",1111:"Oilseed and Grain Farming",1112:"Vegetable and Melon Farming",1113:"Fruit and Tree Nut Farming",1114:"Greenhouse, Nursery, and Floriculture Production",1119:"Other Crop Farming",1121:"Cattle Ranching and Farming",1122:"Hog and Pig Farming",1123:"Poultry and Egg Production",1124:"Sheep and Goat Farming",1125:"Aquaculture",1129:"Other Animal Production",1131:"Timber Tract Operations",1132:"Forest Nurseries and Gathering of Forest Products",1133:"Logging",1141:"Fishing",1142:"Hunting and Trapping",1151:"Support Activities for Crop Production",1152:"Support Activities for Animal Production",1153:"Support Activities for Forestry",2111:"Oil and Gas Extraction",2121:"Coal Mining",2122:"Metal Ore Mining",2123:"Nonmetallic Mineral Mining and Quarrying",2131:"Support Activities for Mining",2211:"Electric Power Generation, Transmission and Distribution",2212:"Natural Gas Distribution",2213:"Water, Sewage and Other Systems",2331:"Land Subdivision and Land Development",2332:"Residential Building Construction",2333:"Nonresidential Building Construction",2341:"Highway, Street, Bridge and Tunnel Construction",2349:"Other Heavy Construction",2351:"Plumbing, Heating and Air-Conditioning Contractors",2352:"Painting and Wall Covering Contractors",2353:"Electrical Contractors",2354:"Masonry, Drywall, Insulation, and Tile Contractors",2355:"Carpentry and Floor Contractors",2356:"Roofing, Siding and Sheet Metal Contractors",2357:"Concrete Contractors",2358:"Water Well Drilling Contractors",2359:"Other Special Trade Contractors",2361:"Residential Building Construction",2362:"Nonresidential Building Construction",2371:"Utility System Construction",2372:"Land Subdivision",2373:"Highway, Street, and Bridge Construction",2379:"Other Heavy and Civil Engineering Construction",2381:"Foundation, Structure, and Building Exterior Contractors",2382:"Building Equipment Contractors",2383:"Building Finishing Contractors",2389:"Other Specialty Trade Contractors",3111:"Animal Food Manufacturing",3112:"Grain and Oilseed Milling",3113:"Sugar and Confectionery Product Manufacturing",3114:"Fruit and Vegetable Preserving and Specialty Food Manufacturing",3115:"Dairy Product Manufacturing",3116:"Animal Slaughtering and Processing",3117:"Seafood Product Preparation and Packaging",3118:"Bakeries and Tortilla Manufacturing",3119:"Other Food Manufacturing",3121:"Beverage Manufacturing",3122:"Tobacco Manufacturing",3131:"Fiber, Yarn, and Thread Mills",3132:"Fabric Mills",3133:"Textile and Fabric Finishing and Fabric Coating Mills",3141:"Textile Furnishings Mills",3149:"Other Textile Product Mills",3151:"Apparel Knitting Mills",3152:"Cut and Sew Apparel Manufacturing",3159:"Apparel Accessories and Other Apparel Manufacturing",3161:"Leather and Hide Tanning and Finishing",3162:"Footwear Manufacturing",3169:"Other Leather and Allied Product Manufacturing",3211:"Sawmills and Wood Preservation",3212:"Veneer, Plywood, and Engineered Wood Product Manufacturing",3219:"Other Wood Product Manufacturing",3221:"Pulp, Paper, and Paperboard Mills",3222:"Converted Paper Product Manufacturing",3231:"Printing and Related Support Activities",3241:"Petroleum and Coal Products Manufacturing",3251:"Basic Chemical Manufacturing",3252:"Resin, Synthetic Rubber, and Artificial Synthetic Fibers and Filaments Manufacturing",3253:"Pesticide, Fertilizer, and Other Agricultural Chemical Manufacturing",3254:"Pharmaceutical and Medicine Manufacturing",3255:"Paint, Coating, and Adhesive Manufacturing",3256:"Soap, Cleaning Compound, and Toilet Preparation Manufacturing",3259:"Other Chemical Product and Preparation Manufacturing",3261:"Plastics Product Manufacturing",3262:"Rubber Product Manufacturing",3271:"Clay Product and Refractory Manufacturing",3272:"Glass and Glass Product Manufacturing",3273:"Cement and Concrete Product Manufacturing",3274:"Lime and Gypsum Product Manufacturing",3279:"Other Nonmetallic Mineral Product Manufacturing",3311:"Iron and Steel Mills and Ferroalloy Manufacturing",3312:"Steel Product Manufacturing from Purchased Steel",3313:"Alumina and Aluminum Production and Processing",3314:"Nonferrous Metal (except Aluminum) Production and Processing",3315:"Foundries",3321:"Forging and Stamping",3322:"Cutlery and Handtool Manufacturing",3323:"Architectural and Structural Metals Manufacturing",3324:"Boiler, Tank, and Shipping Container Manufacturing",3325:"Hardware Manufacturing",3326:"Spring and Wire Product Manufacturing",3327:"Machine Shops; Turned Product; and Screw, Nut, and Bolt Manufacturing",3328:"Coating, Engraving, Heat Treating, and Allied Activities",3329:"Other Fabricated Metal Product Manufacturing",3331:"Agriculture, Construction, and Mining Machinery Manufacturing",3332:"Industrial Machinery Manufacturing",3333:"Commercial and Service Industry Machinery Manufacturing",3334:"Ventilation, Heating, Air-Conditioning, and Commercial Refrigeration Equipment Manufacturing",3335:"Metalworking Machinery Manufacturing",3336:"Engine, Turbine, and Power Transmission Equipment Manufacturing",3339:"Other General Purpose Machinery Manufacturing",3341:"Computer and Peripheral Equipment Manufacturing",3342:"Communications Equipment Manufacturing",3343:"Audio and Video Equipment Manufacturing",3344:"Semiconductor and Other Electronic Component Manufacturing",3345:"Navigational, Measuring, Electromedical, and Control Instruments Manufacturing",3346:"Manufacturing and Reproducing Magnetic and Optical Media",3351:"Electric Lighting Equipment Manufacturing",3352:"Household Appliance Manufacturing",3353:"Electrical Equipment Manufacturing",3359:"Other Electrical Equipment and Component Manufacturing",3361:"Motor Vehicle Manufacturing",3362:"Motor Vehicle Body and Trailer Manufacturing",3363:"Motor Vehicle Parts Manufacturing",3364:"Aerospace Product and Parts Manufacturing",3365:"Railroad Rolling Stock Manufacturing",3366:"Ship and Boat Building",3369:"Other Transportation Equipment Manufacturing",3371:"Household and Institutional Furniture and Kitchen Cabinet Manufacturing",3372:"Office Furniture (including Fixtures) Manufacturing",3379:"Other Furniture Related Product Manufacturing",3391:"Medical Equipment and Supplies Manufacturing",3399:"Other Miscellaneous Manufacturing",4211:"Motor Vehicle and Motor Vehicle Part and Supplies Wholesalers",4212:"Furniture and Home Furnishing Wholesalers",4213:"Lumber and Other Construction Materials Wholesalers",4214:"Professional and Commercial Equipment and Supplies Wholesalers",4215:"Metal and Mineral (except Petroleum) Wholesalers",4216:"Electrical Goods Wholesalers",4217:"Hardware, and Plumbing and Heating Equipment and Supplies Wholesalers",4218:"Machinery, Equipment and Supplies Wholesalers",4219:"Miscellaneous Durable Goods Wholesalers",4221:"Paper and Paper Product Wholesalers",4222:"Drug, Drug Proprietaries and Druggists' Sundries Wholesalers",4223:"Apparel, Piece Goods, and Notions Wholesalers",4224:"Grocery and Related Product Wholesalers",4225:"Farm Product Raw Material Wholesalers",4226:"Chemical and Allied Products Wholesalers",4227:"Petroleum and Petroleum Products Wholesalers",4228:"Beer, Wine, and Distilled Alcoholic Beverage Wholesalers",4229:"Miscellaneous Nondurable Goods Wholesalers",4231:"Motor Vehicle and Motor Vehicle Parts and Supplies Merchant Wholesalers",4232:"Furniture and Home Furnishing Merchant Wholesalers",4233:"Lumber and Other Construction Materials Merchant Wholesalers",4234:"Professional and Commercial Equipment and Supplies Merchant Wholesalers",4235:"Metal and Mineral (except Petroleum) Merchant Wholesalers",4236:"Household Appliances and Electrical and Electronic Goods Merchant Wholesalers",4237:"Hardware, and Plumbing and Heating Equipment and Supplies Merchant Wholesalers",4238:"Machinery, Equipment, and Supplies Merchant Wholesalers",4239:"Miscellaneous Durable Goods Merchant Wholesalers",4241:"Paper and Paper Product Merchant Wholesalers",4242:"Drugs and Druggists' Sundries Merchant Wholesalers",4243:"Apparel, Piece Goods, and Notions Merchant Wholesalers",4244:"Grocery and Related Product Merchant Wholesalers",4245:"Farm Product Raw Material Merchant Wholesalers",4246:"Chemical and Allied Products Merchant Wholesalers",4247:"Petroleum and Petroleum Products Merchant Wholesalers",4248:"Beer, Wine, and Distilled Alcoholic Beverage Merchant Wholesalers",4249:"Miscellaneous Nondurable Goods Merchant Wholesalers",4251:"Wholesale Electronic Markets and Agents and Brokers",4411:"Automobile Dealers",4412:"Other Motor Vehicle Dealers",4413:"Automotive Parts, Accessories, and Tire Stores",4421:"Furniture Stores",4422:"Home Furnishings Stores",4431:"Electronics and Appliance Stores",4441:"Building Material and Supplies Dealers",4442:"Lawn and Garden Equipment and Supplies Stores",4451:"Grocery Stores",4452:"Specialty Food Stores",4453:"Beer, Wine, and Liquor Stores",4461:"Health and Personal Care Stores",4471:"Gasoline Stations",4481:"Clothing Stores",4482:"Shoe Stores",4483:"Jewelry, Luggage, and Leather Goods Stores",4511:"Sporting Goods, Hobby, and Musical Instrument Stores",4512:"Book Stores and News Dealers",4521:"Department Stores",4522:"Department Stores",4523:"General Merchandise Stores, including Warehouse Clubs and Supercenters",4529:"Other General Merchandise Stores",4531:"Florists",4532:"Office Supplies, Stationery, and Gift Stores",4533:"Used Merchandise Stores",4539:"Other Miscellaneous Store Retailers",4541:"Electronic Shopping and Mail-Order Houses",4542:"Vending Machine Operators",4543:"Direct Selling Establishments",4811:"Scheduled Air Transportation",4812:"Nonscheduled Air Transportation",4821:"Rail Transportation",4831:"Deep Sea, Coastal, and Great Lakes Water Transportation",4832:"Inland Water Transportation",4841:"General Freight Trucking",4842:"Specialized Freight Trucking",4851:"Urban Transit Systems",4852:"Interurban and Rural Bus Transportation",4853:"Taxi and Limousine Service",4854:"School and Employee Bus Transportation",4855:"Charter Bus Industry",4859:"Other Transit and Ground Passenger Transportation",4861:"Pipeline Transportation of Crude Oil",4862:"Pipeline Transportation of Natural Gas",4869:"Other Pipeline Transportation",4871:"Scenic and Sightseeing Transportation, Land",4872:"Scenic and Sightseeing Transportation, Water",4879:"Scenic and Sightseeing Transportation, Other",4881:"Support Activities for Air Transportation",4882:"Support Activities for Rail Transportation",4883:"Support Activities for Water Transportation",4884:"Support Activities for Road Transportation",4885:"Freight Transportation Arrangement",4889:"Other Support Activities for Transportation",4911:"Postal Service",4921:"Couriers and Express Delivery Services",4922:"Local Messengers and Local Delivery",4931:"Warehousing and Storage",5111:"Newspaper, Periodical, Book, and Directory Publishers",5112:"Software Publishers",5121:"Motion Picture and Video Industries",5122:"Sound Recording Industries",5131:"Radio and Television Broadcasting",5132:"Cable Networks and Program Distribution",5133:"Telecommunications",5141:"Information Services",5142:"Data Processing Services",5151:"Radio and Television Broadcasting",5152:"Cable and Other Subscription Programming",5161:"Internet Publishing and Broadcasting",5171:"Wired Telecommunications Carriers",5172:"Wireless Telecommunications Carriers (except Satellite)",5173:"Wired and Wireless Telecommunications Carriers",5174:"Satellite Telecommunications",5175:"Cable and Other Program Distribution",5179:"Other Telecommunications",5181:"Internet Service Providers and Web Search Portals",5182:"Data Processing, Hosting, and Related Services",5191:"Other Information Services",5211:"Monetary Authorities - Central Bank",5221:"Depository Credit Intermediation",5222:"Nondepository Credit Intermediation",5223:"Activities Related to Credit Intermediation",5231:"Securities and Commodity Contracts Intermediation and Brokerage",5232:"Securities and Commodity Exchanges",5239:"Other Financial Investment Activities",5241:"Insurance Carriers",5242:"Agencies, Brokerages, and Other Insurance Related Activities",5251:"Insurance and Employee Benefit Funds",5259:"Other Investment Pools and Funds",5311:"Lessors of Real Estate",5312:"Offices of Real Estate Agents and Brokers",5313:"Activities Related to Real Estate",5321:"Automotive Equipment Rental and Leasing",5322:"Consumer Goods Rental",5323:"General Rental Centers",5324:"Commercial and Industrial Machinery and Equipment Rental and Leasing",5331:"Lessors of Nonfinancial Intangible Assets (except Copyrighted Works)",5411:"Legal Services",5412:"Accounting, Tax Preparation, Bookkeeping, and Payroll Services",5413:"Architectural, Engineering, and Related Services",5414:"Specialized Design Services",5415:"Computer Systems Design and Related Services",5416:"Management, Scientific, and Technical Consulting Services",5417:"Scientific Research and Development Services",5418:"Advertising, Public Relations, and Related Services",5419:"Other Professional, Scientific, and Technical Services",5511:"Management of Companies and Enterprises",5611:"Office Administrative Services",5612:"Facilities Support Services",5613:"Employment Services",5614:"Business Support Services",5615:"Travel Arrangement and Reservation Services",5616:"Investigation and Security Services",5617:"Services to Buildings and Dwellings",5619:"Other Support Services",5621:"Waste Collection",5622:"Waste Treatment and Disposal",5629:"Remediation and Other Waste Management Services",6111:"Elementary and Secondary Schools",6112:"Junior Colleges",6113:"Colleges, Universities, and Professional Schools",6114:"Business Schools and Computer and Management Training",6115:"Technical and Trade Schools",6116:"Other Schools and Instruction",6117:"Educational Support Services",6211:"Offices of Physicians",6212:"Offices of Dentists",6213:"Offices of Other Health Practitioners",6214:"Outpatient Care Centers",6215:"Medical and Diagnostic Laboratories",6216:"Home Health Care Services",6219:"Other Ambulatory Health Care Services",6221:"General Medical and Surgical Hospitals",6222:"Psychiatric and Substance Abuse Hospitals",6223:"Specialty (except Psychiatric and Substance Abuse) Hospitals",6231:"Nursing Care Facilities (Skilled Nursing Facilities)",6232:"Residential Intellectual and Developmental Disability, Mental Health, and Substance Abuse Facilities",6233:"Continuing Care Retirement Communities and Assisted Living Facilities for the Elderly",6239:"Other Residential Care Facilities",6241:"Individual and Family Services",6242:"Community Food and Housing, and Emergency and Other Relief Services",6243:"Vocational Rehabilitation Services",6244:"Child Day Care Services",7111:"Performing Arts Companies",7112:"Spectator Sports",7113:"Promoters of Performing Arts, Sports, and Similar Events",7114:"Agents and Managers for Artists, Athletes, Entertainers, and Other Public Figures",7115:"Independent Artists, Writers, and Performers",7121:"Museums, Historical Sites, and Similar Institutions",7131:"Amusement Parks and Arcades",7132:"Gambling Industries",7139:"Other Amusement and Recreation Industries",7211:"Traveler Accommodation",7212:"RV (Recreational Vehicle) Parks and Recreational Camps",7213:"Rooming and Boarding Houses, Dormitories, and Workers' Camps",7221:"Full-Service Restaurants",7222:"Limited-Service Eating Places",7223:"Special Food Services",7224:"Drinking Places (Alcoholic Beverages)",7225:"Restaurants and Other Eating Places",8111:"Automotive Repair and Maintenance",8112:"Electronic and Precision Equipment Repair and Maintenance",8113:"Commercial and Industrial Machinery and Equipment (except Automotive and Electronic) Repair and Maintenance",8114:"Personal and Household Goods Repair and Maintenance",8121:"Personal Care Services",8122:"Death Care Services",8123:"Drycleaning and Laundry Services",8129:"Other Personal Services",8131:"Religious Organizations",8132:"Grantmaking and Giving Services",8133:"Social Advocacy Organizations",8134:"Civic and Social Organizations",8139:"Business, Professional, Labor, Political, and Similar Organizations",8141:"Private Households",9211:"Executive, Legislative, and Other General Government Support",9221:"Justice, Public Order, and Safety Activities",9231:"Administration of Human Resource Programs",9241:"Administration of Environmental Quality Programs",9251:"Administration of Housing Programs, Urban Planning, and Community Development",9261:"Administration of Economic Programs",9271:"Space Research and Technology",9281:"National Security and International Affairs",9999:"Unclassified Establishments",11111:"Soybean Farming",11112:"Oilseed (except Soybean) Farming",11113:"Dry Pea and Bean Farming",11114:"Wheat Farming",11115:"Corn Farming",11116:"Rice Farming",11119:"Other Grain Farming",11121:"Vegetable and Melon Farming",11131:"Orange Groves",11132:"Citrus (except Orange) Groves",11133:"Noncitrus Fruit and Tree Nut Farming",11141:"Food Crops Grown Under Cover",11142:"Nursery and Floriculture Production",11191:"Tobacco Farming",11192:"Cotton Farming",11193:"Sugarcane Farming",11194:"Hay Farming",11199:"All Other Crop Farming",11211:"Beef Cattle Ranching and Farming, including Feedlots",11212:"Dairy Cattle and Milk Production",11213:"Dual-Purpose Cattle Ranching and Farming",11221:"Hog and Pig Farming",11231:"Chicken Egg Production",11232:"Broilers and Other Meat Type Chicken Production",11233:"Turkey Production",11234:"Poultry Hatcheries",11239:"Other Poultry Production",11241:"Sheep Farming",11242:"Goat Farming",11251:"Aquaculture",11291:"Apiculture",11292:"Horses and Other Equine Production",11293:"Fur-Bearing Animal and Rabbit Production",11299:"All Other Animal Production",11311:"Timber Tract Operations",11321:"Forest Nurseries and Gathering of Forest Products",11331:"Logging",11411:"Fishing",11421:"Hunting and Trapping",11511:"Support Activities for Crop Production",11521:"Support Activities for Animal Production",11531:"Support Activities for Forestry",21111:"Oil and Gas Extraction",21112:"Crude Petroleum Extraction",21113:"Natural Gas Extraction",21211:"Coal Mining",21221:"Iron Ore Mining",21222:"Gold Ore and Silver Ore Mining",21223:"Copper, Nickel, Lead, and Zinc Mining",21229:"Other Metal Ore Mining",21231:"Stone Mining and Quarrying",21232:"Sand, Gravel, Clay, and Ceramic and Refractory Minerals Mining and Quarrying",21239:"Other Nonmetallic Mineral Mining and Quarrying",21311:"Support Activities for Mining",22111:"Electric Power Generation",22112:"Electric Power Transmission, Control, and Distribution",22121:"Natural Gas Distribution",22131:"Water Supply and Irrigation Systems",22132:"Sewage Treatment Facilities",22133:"Steam and Air-Conditioning Supply",23311:"Land Subdivision and Land Development",23321:"Single Family Housing Construction",23322:"Multifamily Housing Construction",23331:"Manufacturing and Industrial Building Construction",23332:"Commercial and Institutional Building Construction",23411:"Highway and Street Construction",23412:"Bridge and Tunnel Construction",23491:"Water, Sewer, and Pipeline Construction",23492:"Power and Communication Transmission Line Construction",23493:"Industrial Nonbuilding Structure Construction",23499:"All Other Heavy Construction",23511:"Plumbing, Heating, and Air-conditioning Contractors",23521:"Painting and Wall Covering Contractors",23531:"Electrical Contractors",23541:"Masonry and Stone Contractors",23542:"Drywall, Plastering, Acoustical, and Insulation Contractors",23543:"Tile, Marble, Terrazzo, and Mosaic Contractors",23551:"Carpentry Contractors",23552:"Floor Laying and Other Floor Contractors",23561:"Roofing, Siding, and Sheet Metal Contractors",23571:"Concrete Contractors",23581:"Water Well Drilling Contractors",23591:"Structural Steel Erection Contractors",23592:"Glass and Glazing Contractors",23593:"Excavation Contractors",23594:"Wrecking and Demolition Contractors",23595:"Building Equipment and Other Machinery Installation Contractors",23599:"All Other Special Trade Contractors",23611:"Residential Building Construction",23621:"Industrial Building Construction",23622:"Commercial and Institutional Building Construction",23711:"Water and Sewer Line and Related Structures Construction",23712:"Oil and Gas Pipeline and Related Structures Construction",23713:"Power and Communication Line and Related Structures Construction",23721:"Land Subdivision",23731:"Highway, Street, and Bridge Construction",23799:"Other Heavy and Civil Engineering Construction",23811:"Poured Concrete Foundation and Structure Contractors",23812:"Structural Steel and Precast Concrete Contractors",23813:"Framing Contractors",23814:"Masonry Contractors",23815:"Glass and Glazing Contractors",23816:"Roofing Contractors",23817:"Siding Contractors",23819:"Other Foundation, Structure, and Building Exterior Contractors",23821:"Electrical Contractors and Other Wiring Installation Contractors",23822:"Plumbing, Heating, and Air-Conditioning Contractors",23829:"Other Building Equipment Contractors",23831:"Drywall and Insulation Contractors",23832:"Painting and Wall Covering Contractors",23833:"Flooring Contractors",23834:"Tile and Terrazzo Contractors",23835:"Finish Carpentry Contractors",23839:"Other Building Finishing Contractors",23891:"Site Preparation Contractors",23899:"All Other Specialty Trade Contractors",31111:"Animal Food Manufacturing",31121:"Flour Milling and Malt Manufacturing",31122:"Starch and Vegetable Fats and Oils Manufacturing",31123:"Breakfast Cereal Manufacturing",31131:"Sugar Manufacturing",31132:"Chocolate and Confectionery Manufacturing from Cacao Beans",31133:"Confectionery Manufacturing from Purchased Chocolate",31134:"Nonchocolate Confectionery Manufacturing",31135:"Chocolate and Confectionery Manufacturing",31141:"Frozen Food Manufacturing",31142:"Fruit and Vegetable Canning, Pickling, and Drying",31151:"Dairy Product (except Frozen) Manufacturing",31152:"Ice Cream and Frozen Dessert Manufacturing",31161:"Animal Slaughtering and Processing",31171:"Seafood Product Preparation and Packaging",31181:"Bread and Bakery Product Manufacturing",31182:"Cookie, Cracker, and Pasta Manufacturing",31183:"Tortilla Manufacturing",31191:"Snack Food Manufacturing",31192:"Coffee and Tea Manufacturing",31193:"Flavoring Syrup and Concentrate Manufacturing",31194:"Seasoning and Dressing Manufacturing",31199:"All Other Food Manufacturing",31211:"Soft Drink and Ice Manufacturing",31212:"Breweries",31213:"Wineries",31214:"Distilleries",31221:"Tobacco Stemming and Redrying",31222:"Tobacco Product Manufacturing",31223:"Tobacco Manufacturing",31311:"Fiber, Yarn, and Thread Mills",31321:"Broadwoven Fabric Mills",31322:"Narrow Fabric Mills and Schiffli Machine Embroidery",31323:"Nonwoven Fabric Mills",31324:"Knit Fabric Mills",31331:"Textile and Fabric Finishing Mills",31332:"Fabric Coating Mills",31411:"Carpet and Rug Mills",31412:"Curtain and Linen Mills",31491:"Textile Bag and Canvas Mills",31499:"All Other Textile Product Mills",31511:"Hosiery and Sock Mills",31519:"Other Apparel Knitting Mills",31521:"Cut and Sew Apparel Contractors",31522:"Men's and Boys' Cut and Sew Apparel Manufacturing",31523:"Women's and Girls' Cut and Sew Apparel Manufacturing",31524:"Women's, Girls', and Infants' Cut and Sew Apparel Manufacturing",31528:"Other Cut and Sew Apparel Manufacturing",31529:"Other Cut and Sew Apparel Manufacturing",31599:"Apparel Accessories and Other Apparel Manufacturing",31611:"Leather and Hide Tanning and Finishing",31621:"Footwear Manufacturing",31699:"Other Leather and Allied Product Manufacturing",32111:"Sawmills and Wood Preservation",32121:"Veneer, Plywood, and Engineered Wood Product Manufacturing",32191:"Millwork",32192:"Wood Container and Pallet Manufacturing",32199:"All Other Wood Product Manufacturing",32211:"Pulp Mills",32212:"Paper Mills",32213:"Paperboard Mills",32221:"Paperboard Container Manufacturing",32222:"Paper Bag and Coated and Treated Paper Manufacturing",32223:"Stationery Product Manufacturing",32229:"Other Converted Paper Product Manufacturing",32311:"Printing",32312:"Support Activities for Printing",32411:"Petroleum Refineries",32412:"Asphalt Paving, Roofing, and Saturated Materials Manufacturing",32419:"Other Petroleum and Coal Products Manufacturing",32511:"Petrochemical Manufacturing",32512:"Industrial Gas Manufacturing",32513:"Synthetic Dye and Pigment Manufacturing",32518:"Other Basic Inorganic Chemical Manufacturing",32519:"Other Basic Organic Chemical Manufacturing",32521:"Resin and Synthetic Rubber Manufacturing",32522:"Artificial and Synthetic Fibers and Filaments Manufacturing",32531:"Fertilizer Manufacturing",32532:"Pesticide and Other Agricultural Chemical Manufacturing",32541:"Pharmaceutical and Medicine Manufacturing",32551:"Paint and Coating Manufacturing",32552:"Adhesive Manufacturing",32561:"Soap and Cleaning Compound Manufacturing",32562:"Toilet Preparation Manufacturing",32591:"Printing Ink Manufacturing",32592:"Explosives Manufacturing",32599:"All Other Chemical Product and Preparation Manufacturing",32611:"Plastics Packaging Materials and Unlaminated Film and Sheet Manufacturing",32612:"Plastics Pipe, Pipe Fitting, and Unlaminated Profile Shape Manufacturing",32613:"Laminated Plastics Plate, Sheet (except Packaging), and Shape Manufacturing",32614:"Polystyrene Foam Product Manufacturing",32615:"Urethane and Other Foam Product (except Polystyrene) Manufacturing",32616:"Plastics Bottle Manufacturing",32619:"Other Plastics Product Manufacturing",32621:"Tire Manufacturing",32622:"Rubber and Plastics Hoses and Belting Manufacturing",32629:"Other Rubber Product Manufacturing",32711:"Pottery, Ceramics, and Plumbing Fixture Manufacturing",32712:"Clay Building Material and Refractories Manufacturing",32721:"Glass and Glass Product Manufacturing",32731:"Cement Manufacturing",32732:"Ready-Mix Concrete Manufacturing",32733:"Concrete Pipe, Brick, and Block Manufacturing",32739:"Other Concrete Product Manufacturing",32741:"Lime Manufacturing",32742:"Gypsum Product Manufacturing",32791:"Abrasive Product Manufacturing",32799:"All Other Nonmetallic Mineral Product Manufacturing",33111:"Iron and Steel Mills and Ferroalloy Manufacturing",33121:"Iron and Steel Pipe and Tube Manufacturing from Purchased Steel",33122:"Rolling and Drawing of Purchased Steel",33131:"Alumina and Aluminum Production and Processing",33141:"Nonferrous Metal (except Aluminum) Smelting and Refining",33142:"Copper Rolling, Drawing, Extruding, and Alloying",33149:"Nonferrous Metal (except Copper and Aluminum) Rolling, Drawing, Extruding, and Alloying",33151:"Ferrous Metal Foundries",33152:"Nonferrous Metal Foundries",33211:"Forging and Stamping",33221:"Cutlery and Handtool Manufacturing",33231:"Plate Work and Fabricated Structural Product Manufacturing",33232:"Ornamental and Architectural Metal Products Manufacturing",33241:"Power Boiler and Heat Exchanger Manufacturing",33242:"Metal Tank (Heavy Gauge) Manufacturing",33243:"Metal Can, Box, and Other Metal Container (Light Gauge) Manufacturing",33251:"Hardware Manufacturing",33261:"Spring and Wire Product Manufacturing",33271:"Machine Shops",33272:"Turned Product and Screw, Nut, and Bolt Manufacturing",33281:"Coating, Engraving, Heat Treating, and Allied Activities",33291:"Metal Valve Manufacturing",33299:"All Other Fabricated Metal Product Manufacturing",33311:"Agricultural Implement Manufacturing",33312:"Construction Machinery Manufacturing",33313:"Mining and Oil and Gas Field Machinery Manufacturing",33321:"Sawmill and Woodworking Machinery Manufacturing",33322:"Plastics and Rubber Industry Machinery Manufacturing",33324:"Industrial Machinery Manufacturing",33329:"Other Industrial Machinery Manufacturing",33331:"Commercial and Service Industry Machinery Manufacturing",33341:"Ventilation, Heating, Air-Conditioning, and Commercial Refrigeration Equipment Manufacturing",33351:"Metalworking Machinery Manufacturing",33361:"Engine, Turbine, and Power Transmission Equipment Manufacturing",33391:"Pump and Compressor Manufacturing",33392:"Material Handling Equipment Manufacturing",33399:"All Other General Purpose Machinery Manufacturing",33411:"Computer and Peripheral Equipment Manufacturing",33421:"Telephone Apparatus Manufacturing",33422:"Radio and Television Broadcasting and Wireless Communications Equipment Manufacturing",33429:"Other Communications Equipment Manufacturing",33431:"Audio and Video Equipment Manufacturing",33441:"Semiconductor and Other Electronic Component Manufacturing",33451:"Navigational, Measuring, Electromedical, and Control Instruments Manufacturing",33461:"Manufacturing and Reproducing Magnetic and Optical Media",33511:"Electric Lamp Bulb and Part Manufacturing",33512:"Lighting Fixture Manufacturing",33521:"Small Electrical Appliance Manufacturing",33522:"Major Household Appliance Manufacturing",33531:"Electrical Equipment Manufacturing",33591:"Battery Manufacturing",33592:"Communication and Energy Wire and Cable Manufacturing",33593:"Wiring Device Manufacturing",33599:"All Other Electrical Equipment and Component Manufacturing",33611:"Automobile and Light Duty Motor Vehicle Manufacturing",33612:"Heavy Duty Truck Manufacturing",33621:"Motor Vehicle Body and Trailer Manufacturing",33631:"Motor Vehicle Gasoline Engine and Engine Parts Manufacturing",33632:"Motor Vehicle Electrical and Electronic Equipment Manufacturing",33633:"Motor Vehicle Steering and Suspension Components (except Spring) Manufacturing",33634:"Motor Vehicle Brake System Manufacturing",33635:"Motor Vehicle Transmission and Power Train Parts Manufacturing",33636:"Motor Vehicle Seating and Interior Trim Manufacturing",33637:"Motor Vehicle Metal Stamping",33639:"Other Motor Vehicle Parts Manufacturing",33641:"Aerospace Product and Parts Manufacturing",33651:"Railroad Rolling Stock Manufacturing",33661:"Ship and Boat Building",33699:"Other Transportation Equipment Manufacturing",33711:"Wood Kitchen Cabinet and Countertop Manufacturing",33712:"Household and Institutional Furniture Manufacturing",33721:"Office Furniture (including Fixtures) Manufacturing",33791:"Mattress Manufacturing",33792:"Blind and Shade Manufacturing",33911:"Medical Equipment and Supplies Manufacturing",33991:"Jewelry and Silverware Manufacturing",33992:"Sporting and Athletic Goods Manufacturing",33993:"Doll, Toy, and Game Manufacturing",33994:"Office Supplies (except Paper) Manufacturing",33995:"Sign Manufacturing",33999:"All Other Miscellaneous Manufacturing",42111:"Automobile and Other Motor Vehicle Wholesalers",42112:"Motor Vehicle Supplies and New Parts Wholesalers",42113:"Tire and Tube Wholesalers",42114:"Motor Vehicle Parts (used) Wholesalers",42121:"Furniture Wholesalers",42122:"Home Furnishing Wholesalers",42131:"Lumber, Plywood, Millwork, and Wood Panel Wholesalers",42132:"Brick, Stone, and Related Construction Material Wholesalers",42133:"Roofing, Siding, and Insulation Material Wholesalers",42139:"Other Construction Material Wholesalers",42141:"Photographic Equipment and Supplies Wholesalers",42142:"Office Equipment Wholesalers",42143:"Computer and Computer Peripheral Equipment and Software Wholesalers",42144:"Other Commercial Equipment Wholesalers",42145:"Medical, Dental, and Hospital Equipment and Supplies Wholesalers",42146:"Ophthalmic Goods Wholesalers",42149:"Other Professional Equipment and Supplies Wholesalers",42151:"Metal Service Centers and Offices",42152:"Coal and Other Mineral and Ore Wholesalers",42161:"Electrical Apparatus and Equipment, Wiring Supplies, and Construction Material Wholesalers",42162:"Electrical Appliance, Television, and Radio Set Wholesalers",42169:"Other Electronic Parts and Equipment Wholesalers",42171:"Hardware Wholesalers",42172:"Plumbing and Heating Equipment and Supplies (hydronics) Wholesalers",42173:"Warm Air Heating and Air-conditioning Equipment and Supplies Wholesalers",42174:"Refrigeration Equipment and Supplies Wholesalers",42181:"Construction and Mining (Except Oil Well) Machinery and Equipment Wholesalers",42182:"Farm and Garden Machinery and Equipment Wholesalers",42183:"Industrial Machinery and Equipment Wholesalers",42184:"Industrial Supplies Wholesalers",42185:"Service Establishment Equipment and Supplies Wholesalers",42186:"Transportation Equipment and Supplies (Except Motor Vehicle) Wholesalers",42191:"Sporting and Recreational Goods and Supplies Wholesalers",42192:"Toy and Hobby Goods and Supplies Wholesalers",42193:"Recyclable Material Wholesalers",42194:"Jewelry, Watch, Precious Stone, and Precious Metal Wholesalers",42199:"Other Miscellaneous Durable Goods Wholesalers",42211:"Printing and Writing Paper Wholesalers",42212:"Stationery and Office Supplies Wholesalers",42213:"Industrial and Personal Service Paper Wholesalers",42221:"Drugs and Druggists' Sundries Wholesalers",42231:"Piece Goods, Notions, and Other Dry Goods Wholesalers",42232:"Men's and Boys' Clothing and Furnishings Wholesalers",42233:"Women's, Children's, and Infants' Clothing and Accessories Wholesalers",42234:"Footwear Wholesalers",42241:"General Line Grocery Wholesalers",42242:"Packaged Frozen Food Wholesalers",42243:"Dairy Product (Except Dried or Canned) Wholesalers",42244:"Poultry and Poultry Product Wholesalers",42245:"Confectionery Wholesalers",42246:"Fish and Seafood Wholesalers",42247:"Meat and Meat Product Wholesalers",42248:"Fresh Fruit and Vegetable Wholesalers",42249:"Other Grocery and Related Products Wholesalers",42251:"Grain and Field Bean Wholesalers",42252:"Livestock Wholesalers",42259:"Other Farm Product Raw Material Wholesalers",42261:"Plastics Materials and Basic Forms and Shapes Wholesalers",42269:"Other Chemical and Allied Products Wholesalers",42271:"Petroleum Bulk Stations and Terminals",42272:"Petroleum and Petroleum Products Wholesalers (Except Bulk Stations and Terminals)",42281:"Beer and Ale Wholesalers",42282:"Wine and Distilled Alcoholic Beverage Wholesalers",42291:"Farm Supplies Wholesalers",42292:"Book, Periodical, and Newspaper Wholesalers",42293:"Flower, Nursery Stock, and Florists' Supplies Wholesalers",42294:"Tobacco and Tobacco Product Wholesalers",42295:"Paint, Varnish, and Supplies Wholesalers",42299:"Other Miscellaneous Nondurable Goods Wholesalers",42311:"Automobile and Other Motor Vehicle Merchant Wholesalers",42312:"Motor Vehicle Supplies and New Parts Merchant Wholesalers",42313:"Tire and Tube Merchant Wholesalers",42314:"Motor Vehicle Parts (Used) Merchant Wholesalers",42321:"Furniture Merchant Wholesalers",42322:"Home Furnishing Merchant Wholesalers",42331:"Lumber, Plywood, Millwork, and Wood Panel Merchant Wholesalers",42332:"Brick, Stone, and Related Construction Material Merchant Wholesalers",42333:"Roofing, Siding, and Insulation Material Merchant Wholesalers",42339:"Other Construction Material Merchant Wholesalers",42341:"Photographic Equipment and Supplies Merchant Wholesalers",42342:"Office Equipment Merchant Wholesalers",42343:"Computer and Computer Peripheral Equipment and Software Merchant Wholesalers",42344:"Other Commercial Equipment Merchant Wholesalers",42345:"Medical, Dental, and Hospital Equipment and Supplies Merchant Wholesalers",42346:"Ophthalmic Goods Merchant Wholesalers",42349:"Other Professional Equipment and Supplies Merchant Wholesalers",42351:"Metal Service Centers and Other Metal Merchant Wholesalers",42352:"Coal and Other Mineral and Ore Merchant Wholesalers",42361:"Electrical Apparatus and Equipment, Wiring Supplies, and Related Equipment Merchant Wholesalers",42362:"Household Appliances, Electric Housewares, and Consumer Electronics Merchant Wholesalers",42369:"Other Electronic Parts and Equipment Merchant Wholesalers",42371:"Hardware Merchant Wholesalers",42372:"Plumbing and Heating Equipment and Supplies (Hydronics) Merchant Wholesalers",42373:"Warm Air Heating and Air-Conditioning Equipment and Supplies Merchant Wholesalers",42374:"Refrigeration Equipment and Supplies Merchant Wholesalers",42381:"Construction and Mining (except Oil Well) Machinery and Equipment Merchant Wholesalers",42382:"Farm and Garden Machinery and Equipment Merchant Wholesalers",42383:"Industrial Machinery and Equipment Merchant Wholesalers",42384:"Industrial Supplies Merchant Wholesalers",42385:"Service Establishment Equipment and Supplies Merchant Wholesalers",42386:"Transportation Equipment and Supplies (except Motor Vehicle) Merchant Wholesalers",42391:"Sporting and Recreational Goods and Supplies Merchant Wholesalers",42392:"Toy and Hobby Goods and Supplies Merchant Wholesalers",42393:"Recyclable Material Merchant Wholesalers",42394:"Jewelry, Watch, Precious Stone, and Precious Metal Merchant Wholesalers",42399:"Other Miscellaneous Durable Goods Merchant Wholesalers",42411:"Printing and Writing Paper Merchant Wholesalers",42412:"Stationery and Office Supplies Merchant Wholesalers",42413:"Industrial and Personal Service Paper Merchant Wholesalers",42421:"Drugs and Druggists' Sundries Merchant Wholesalers",42431:"Piece Goods, Notions, and Other Dry Goods Merchant Wholesalers",42432:"Men's and Boys' Clothing and Furnishings Merchant Wholesalers",42433:"Women's, Children's, and Infants' Clothing and Accessories Merchant Wholesalers",42434:"Footwear Merchant Wholesalers",42441:"General Line Grocery Merchant Wholesalers",42442:"Packaged Frozen Food Merchant Wholesalers",42443:"Dairy Product (except Dried or Canned) Merchant Wholesalers",42444:"Poultry and Poultry Product Merchant Wholesalers",42445:"Confectionery Merchant Wholesalers",42446:"Fish and Seafood Merchant Wholesalers",42447:"Meat and Meat Product Merchant Wholesalers",42448:"Fresh Fruit and Vegetable Merchant Wholesalers",42449:"Other Grocery and Related Products Merchant Wholesalers",42451:"Grain and Field Bean Merchant Wholesalers",42452:"Livestock Merchant Wholesalers",42459:"Other Farm Product Raw Material Merchant Wholesalers",42461:"Plastics Materials and Basic Forms and Shapes Merchant Wholesalers",42469:"Other Chemical and Allied Products Merchant Wholesalers",42471:"Petroleum Bulk Stations and Terminals",42472:"Petroleum and Petroleum Products Merchant Wholesalers (except Bulk Stations and Terminals)",42481:"Beer and Ale Merchant Wholesalers",42482:"Wine and Distilled Alcoholic Beverage Merchant Wholesalers",42491:"Farm Supplies Merchant Wholesalers",42492:"Book, Periodical, and Newspaper Merchant Wholesalers",42493:"Flower, Nursery Stock, and Florists' Supplies Merchant Wholesalers",42494:"Tobacco and Tobacco Product Merchant Wholesalers",42495:"Paint, Varnish, and Supplies Merchant Wholesalers",42499:"Other Miscellaneous Nondurable Goods Merchant Wholesalers",42511:"Business to Business Electronic Markets",42512:"Wholesale Trade Agents and Brokers",44111:"New Car Dealers",44112:"Used Car Dealers",44121:"Recreational Vehicle Dealers",44122:"Motorcycle, Boat, and Other Motor Vehicle Dealers",44131:"Automotive Parts and Accessories Stores",44132:"Tire Dealers",44211:"Furniture Stores",44221:"Floor Covering Stores",44229:"Other Home Furnishings Stores",44311:"Appliance, Television, and Other Electronics Stores",44312:"Computer and Software Stores",44313:"Camera and Photographic Supplies Stores",44314:"Electronics and Appliance Stores",44411:"Home Centers",44412:"Paint and Wallpaper Stores",44413:"Hardware Stores",44419:"Other Building Material Dealers",44421:"Outdoor Power Equipment Stores",44422:"Nursery, Garden Center, and Farm Supply Stores",44511:"Supermarkets and Other Grocery (except Convenience) Stores",44512:"Convenience Stores",44521:"Meat Markets",44522:"Fish and Seafood Markets",44523:"Fruit and Vegetable Markets",44529:"Other Specialty Food Stores",44531:"Beer, Wine, and Liquor Stores",44611:"Pharmacies and Drug Stores",44612:"Cosmetics, Beauty Supplies, and Perfume Stores",44613:"Optical Goods Stores",44619:"Other Health and Personal Care Stores",44711:"Gasoline Stations with Convenience Stores",44719:"Other Gasoline Stations",44811:"Men's Clothing Stores",44812:"Women's Clothing Stores",44813:"Children's and Infants' Clothing Stores",44814:"Family Clothing Stores",44815:"Clothing Accessories Stores",44819:"Other Clothing Stores",44821:"Shoe Stores",44831:"Jewelry Stores",44832:"Luggage and Leather Goods Stores",45111:"Sporting Goods Stores",45112:"Hobby, Toy, and Game Stores",45113:"Sewing, Needlework, and Piece Goods Stores",45114:"Musical Instrument and Supplies Stores",45121:"Book Stores and News Dealers",45122:"Prerecorded Tape, Compact Disc, and Record Stores",45211:"Department Stores",45221:"Department Stores",45231:"General Merchandise Stores, including Warehouse Clubs and Supercenters",45291:"Warehouse Clubs and Supercenters",45299:"All Other General Merchandise Stores",45311:"Florists",45321:"Office Supplies and Stationery Stores",45322:"Gift, Novelty, and Souvenir Stores",45331:"Used Merchandise Stores",45391:"Pet and Pet Supplies Stores",45392:"Art Dealers",45393:"Manufactured (Mobile) Home Dealers",45399:"All Other Miscellaneous Store Retailers",45411:"Electronic Shopping and Mail-Order Houses",45421:"Vending Machine Operators",45431:"Fuel Dealers",45439:"Other Direct Selling Establishments",48111:"Scheduled Air Transportation",48121:"Nonscheduled Air Transportation",48211:"Rail Transportation",48311:"Deep Sea, Coastal, and Great Lakes Water Transportation",48321:"Inland Water Transportation",48411:"General Freight Trucking, Local",48412:"General Freight Trucking, Long-Distance",48421:"Used Household and Office Goods Moving",48422:"Specialized Freight (except Used Goods) Trucking, Local",48423:"Specialized Freight (except Used Goods) Trucking, Long-Distance",48511:"Urban Transit Systems",48521:"Interurban and Rural Bus Transportation",48531:"Taxi Service",48532:"Limousine Service",48541:"School and Employee Bus Transportation",48551:"Charter Bus Industry",48599:"Other Transit and Ground Passenger Transportation",48611:"Pipeline Transportation of Crude Oil",48621:"Pipeline Transportation of Natural Gas",48691:"Pipeline Transportation of Refined Petroleum Products",48699:"All Other Pipeline Transportation",48711:"Scenic and Sightseeing Transportation, Land",48721:"Scenic and Sightseeing Transportation, Water",48799:"Scenic and Sightseeing Transportation, Other",48811:"Airport Operations",48819:"Other Support Activities for Air Transportation",48821:"Support Activities for Rail Transportation",48831:"Port and Harbor Operations",48832:"Marine Cargo Handling",48833:"Navigational Services to Shipping",48839:"Other Support Activities for Water Transportation",48841:"Motor Vehicle Towing",48849:"Other Support Activities for Road Transportation",48851:"Freight Transportation Arrangement",48899:"Other Support Activities for Transportation",49111:"Postal Service",49211:"Couriers and Express Delivery Services",49221:"Local Messengers and Local Delivery",49311:"General Warehousing and Storage",49312:"Refrigerated Warehousing and Storage",49313:"Farm Product Warehousing and Storage",49319:"Other Warehousing and Storage",51111:"Newspaper Publishers",51112:"Periodical Publishers",51113:"Book Publishers",51114:"Directory and Mailing List Publishers",51119:"Other Publishers",51121:"Software Publishers",51211:"Motion Picture and Video Production",51212:"Motion Picture and Video Distribution",51213:"Motion Picture and Video Exhibition",51219:"Postproduction Services and Other Motion Picture and Video Industries",51221:"Record Production",51222:"Integrated Record Production/Distribution",51223:"Music Publishers",51224:"Sound Recording Studios",51225:"Record Production and Distribution",51229:"Other Sound Recording Industries",51311:"Radio Broadcasting",51312:"Television Broadcasting",51321:"Cable Networks",51322:"Cable and Other Program Distribution",51331:"Wired Telecommunications Carriers",51332:"Wireless Telecommunications Carriers (except Satellite)",51333:"Telecommunications Resellers",51334:"Satellite Telecommunications",51339:"Other Telecommunications",51411:"News Syndicates",51412:"Libraries and Archives",51419:"Other Information Services",51421:"Data Processing Services",51511:"Radio Broadcasting",51512:"Television Broadcasting",51521:"Cable and Other Subscription Programming",51611:"Internet Publishing and Broadcasting",51711:"Wired Telecommunications Carriers",51721:"Wireless Telecommunications Carriers (except Satellite)",51731:"Wired and Wireless Telecommunications Carriers",51741:"Satellite Telecommunications",51751:"Cable and Other Program Distribution",51791:"Other Telecommunications",51811:"Internet Service Providers and Web Search Portals",51821:"Data Processing, Hosting, and Related Services",51911:"News Syndicates",51912:"Libraries and Archives",51913:"Internet Publishing and Broadcasting and Web Search Portals",51919:"All Other Information Services",52111:"Monetary Authorities - Central Bank",52211:"Commercial Banking",52212:"Savings Institutions",52213:"Credit Unions",52219:"Other Depository Credit Intermediation",52221:"Credit Card Issuing",52222:"Sales Financing",52229:"Other Nondepository Credit Intermediation",52231:"Mortgage and Nonmortgage Loan Brokers",52232:"Financial Transactions Processing, Reserve, and Clearinghouse Activities",52239:"Other Activities Related to Credit Intermediation",52311:"Investment Banking and Securities Dealing",52312:"Securities Brokerage",52313:"Commodity Contracts Dealing",52314:"Commodity Contracts Brokerage",52321:"Securities and Commodity Exchanges",52391:"Miscellaneous Intermediation",52392:"Portfolio Management",52393:"Investment Advice",52399:"All Other Financial Investment Activities",52411:"Direct Life, Health, and Medical Insurance Carriers",52412:"Direct Insurance (except Life, Health, and Medical) Carriers",52413:"Reinsurance Carriers",52421:"Insurance Agencies and Brokerages",52429:"Other Insurance Related Activities",52511:"Pension Funds",52512:"Health and Welfare Funds",52519:"Other Insurance Funds",52591:"Open-End Investment Funds",52592:"Trusts, Estates, and Agency Accounts",52593:"Real Estate Investment Trusts",52599:"Other Financial Vehicles",53111:"Lessors of Residential Buildings and Dwellings",53112:"Lessors of Nonresidential Buildings (except Miniwarehouses)",53113:"Lessors of Miniwarehouses and Self-Storage Units",53119:"Lessors of Other Real Estate Property",53121:"Offices of Real Estate Agents and Brokers",53131:"Real Estate Property Managers",53132:"Offices of Real Estate Appraisers",53139:"Other Activities Related to Real Estate",53211:"Passenger Car Rental and Leasing",53212:"Truck, Utility Trailer, and RV (Recreational Vehicle) Rental and Leasing",53221:"Consumer Electronics and Appliances Rental",53222:"Formal Wear and Costume Rental",53223:"Video Tape and Disc Rental",53228:"Other Consummer Goods Rental",53229:"Other Consumer Goods Rental",53231:"General Rental Centers",53241:"Construction, Transportation, Mining, and Forestry Machinery and Equipment Rental and Leasing",53242:"Office Machinery and Equipment Rental and Leasing",53249:"Other Commercial and Industrial Machinery and Equipment Rental and Leasing",53311:"Lessors of Nonfinancial Intangible Assets (except Copyrighted Works)",54111:"Offices of Lawyers",54112:"Offices of Notaries",54119:"Other Legal Services",54121:"Accounting, Tax Preparation, Bookkeeping, and Payroll Services",54131:"Architectural Services",54132:"Landscape Architectural Services",54133:"Engineering Services",54134:"Drafting Services",54135:"Building Inspection Services",54136:"Geophysical Surveying and Mapping Services",54137:"Surveying and Mapping (except Geophysical) Services",54138:"Testing Laboratories",54141:"Interior Design Services",54142:"Industrial Design Services",54143:"Graphic Design Services",54149:"Other Specialized Design Services",54151:"Computer Systems Design and Related Services",54161:"Management Consulting Services",54162:"Environmental Consulting Services",54169:"Other Scientific and Technical Consulting Services",54171:"Research and Development in the Physical, Engineering, and Life Sciences",54172:"Research and Development in the Social Sciences and Humanities",54173:"Research and Development in the Social Sciences and Humanities",54181:"Advertising Agencies",54182:"Public Relations Agencies",54183:"Media Buying Agencies",54184:"Media Representatives",54185:"Outdoor Advertising",54186:"Direct Mail Advertising",54187:"Advertising Material Distribution Services",54189:"Other Services Related to Advertising",54191:"Marketing Research and Public Opinion Polling",54192:"Photographic Services",54193:"Translation and Interpretation Services",54194:"Veterinary Services",54199:"All Other Professional, Scientific, and Technical Services",55111:"Management of Companies and Enterprises",56111:"Office Administrative Services",56121:"Facilities Support Services",56131:"Employment Placement Agencies and Executive Search Services",56132:"Temporary Help Services",56133:"Professional Employer Organizations",56141:"Document Preparation Services",56142:"Telephone Call Centers",56143:"Business Service Centers",56144:"Collection Agencies",56145:"Credit Bureaus",56149:"Other Business Support Services",56151:"Travel Agencies",56152:"Tour Operators",56159:"Other Travel Arrangement and Reservation Services",56161:"Investigation, Guard, and Armored Car Services",56162:"Security Systems Services",56171:"Exterminating and Pest Control Services",56172:"Janitorial Services",56173:"Landscaping Services",56174:"Carpet and Upholstery Cleaning Services",56179:"Other Services to Buildings and Dwellings",56191:"Packaging and Labeling Services",56192:"Convention and Trade Show Organizers",56199:"All Other Support Services",56211:"Waste Collection",56221:"Waste Treatment and Disposal",56291:"Remediation Services",56292:"Materials Recovery Facilities",56299:"All Other Waste Management Services",61111:"Elementary and Secondary Schools",61121:"Junior Colleges",61131:"Colleges, Universities, and Professional Schools",61141:"Business and Secretarial Schools",61142:"Computer Training",61143:"Professional and Management Development Training",61151:"Technical and Trade Schools",61161:"Fine Arts Schools",61162:"Sports and Recreation Instruction",61163:"Language Schools",61169:"All Other Schools and Instruction",61171:"Educational Support Services",62111:"Offices of Physicians",62121:"Offices of Dentists",62131:"Offices of Chiropractors",62132:"Offices of Optometrists",62133:"Offices of Mental Health Practitioners (except Physicians)",62134:"Offices of Physical, Occupational and Speech Therapists, and Audiologists",62139:"Offices of All Other Health Practitioners",62141:"Family Planning Centers",62142:"Outpatient Mental Health and Substance Abuse Centers",62149:"Other Outpatient Care Centers",62151:"Medical and Diagnostic Laboratories",62161:"Home Health Care Services",62191:"Ambulance Services",62199:"All Other Ambulatory Health Care Services",62211:"General Medical and Surgical Hospitals",62221:"Psychiatric and Substance Abuse Hospitals",62231:"Specialty (except Psychiatric and Substance Abuse) Hospitals",62311:"Nursing Care Facilities (Skilled Nursing Facilities)",62321:"Residential Intellectual and Developmental Disability Facilities",62322:"Residential Mental Health and Substance Abuse Facilities",62331:"Continuing Care Retirement Communities and Assisted Living Facilities for the Elderly",62399:"Other Residential Care Facilities",62411:"Child and Youth Services",62412:"Services for the Elderly and Persons with Disabilities",62419:"Other Individual and Family Services",62421:"Community Food Services",62422:"Community Housing Services",62423:"Emergency and Other Relief Services",62431:"Vocational Rehabilitation Services",62441:"Child Day Care Services",71111:"Theater Companies and Dinner Theaters",71112:"Dance Companies",71113:"Musical Groups and Artists",71119:"Other Performing Arts Companies",71121:"Spectator Sports",71131:"Promoters of Performing Arts, Sports, and Similar Events with Facilities",71132:"Promoters of Performing Arts, Sports, and Similar Events without Facilities",71141:"Agents and Managers for Artists, Athletes, Entertainers, and Other Public Figures",71151:"Independent Artists, Writers, and Performers",71211:"Museums",71212:"Historical Sites",71213:"Zoos and Botanical Gardens",71219:"Nature Parks and Other Similar Institutions",71311:"Amusement and Theme Parks",71312:"Amusement Arcades",71321:"Casinos (except Casino Hotels)",71329:"Other Gambling Industries",71391:"Golf Courses and Country Clubs",71392:"Skiing Facilities",71393:"Marinas",71394:"Fitness and Recreational Sports Centers",71395:"Bowling Centers",71399:"All Other Amusement and Recreation Industries",72111:"Hotels (except Casino Hotels) and Motels",72112:"Casino Hotels",72119:"Other Traveler Accommodation",72121:"RV (Recreational Vehicle) Parks and Recreational Camps",72131:"Rooming and Boarding Houses, Dormitories, and Workers' Camps",72211:"Full-Service Restaurants",72221:"Limited-Service Eating Places",72231:"Food Service Contractors",72232:"Caterers",72233:"Mobile Food Services",72241:"Drinking Places (Alcoholic Beverages)",72251:"Restaurants and Other Eating Places",81111:"Automotive Mechanical and Electrical Repair and Maintenance",81112:"Automotive Body, Paint, Interior, and Glass Repair",81119:"Other Automotive Repair and Maintenance",81121:"Electronic and Precision Equipment Repair and Maintenance",81131:"Commercial and Industrial Machinery and Equipment (except Automotive and Electronic) Repair and Maintenance",81141:"Home and Garden Equipment and Appliance Repair and Maintenance",81142:"Reupholstery and Furniture Repair",81143:"Footwear and Leather Goods Repair",81149:"Other Personal and Household Goods Repair and Maintenance",81211:"Hair, Nail, and Skin Care Services",81219:"Other Personal Care Services",81221:"Funeral Homes and Funeral Services",81222:"Cemeteries and Crematories",81231:"Coin-Operated Laundries and Drycleaners",81232:"Drycleaning and Laundry Services (except Coin-Operated)",81233:"Linen and Uniform Supply",81239:"Other Laundry Services",81291:"Pet Care (except Veterinary) Services",81292:"Photofinishing",81293:"Parking Lots and Garages",81299:"All Other Personal Services",81311:"Religious Organizations",81321:"Grantmaking and Giving Services",81331:"Social Advocacy Organizations",81341:"Civic and Social Organizations",81391:"Business Associations",81392:"Professional Organizations",81393:"Labor Unions and Similar Labor Organizations",81394:"Political Organizations",81399:"Other Similar Organizations (except Business, Professional, Labor, and Political Organizations)",81411:"Private Households",92111:"Executive Offices",92112:"Legislative Bodies",92113:"Public Finance Activities",92114:"Executive and Legislative Offices, Combined",92115:"American Indian and Alaska Native Tribal Governments",92119:"Other General Government Support",92211:"Courts",92212:"Police Protection",92213:"Legal Counsel and Prosecution",92214:"Correctional Institutions",92215:"Parole Offices and Probation Offices",92216:"Fire Protection",92219:"Other Justice, Public Order, and Safety Activities",92311:"Administration of Education Programs",92312:"Administration of Public Health Programs",92313:"Administration of Human Resource Programs (except Education, Public Health, and Veterans' Affairs Programs)",92314:"Administration of Veterans' Affairs",92411:"Administration of Air and Water Resource and Solid Waste Management Programs",92412:"Administration of Conservation Programs",92511:"Administration of Housing Programs",92512:"Administration of Urban Planning and Community and Rural Development",92611:"Administration of General Economic Programs",92612:"Regulation and Administration of Transportation Programs",92613:"Regulation and Administration of Communications, Electric, Gas, and Other Utilities",92614:"Regulation of Agricultural Marketing and Commodities",92615:"Regulation, Licensing, and Inspection of Miscellaneous Commercial Sectors",92711:"Space Research and Technology",92811:"National Security",92812:"International Affairs",99999:"Unclassified Establishment",111191:"Oilseed and Grain Combination Farming",111199:"All Other Grain Farming",111211:"Potato Farming",111219:"Other Vegetable (except Potato) and Melon Farming",111331:"Apple Orchards",111332:"Grape Vineyards",111333:"Strawberry Farming",111334:"Berry (except Strawberry) Farming",111335:"Tree Nut Farming",111336:"Fruit and Tree Nut Combination Farming",111339:"Other Noncitrus Fruit Farming",111411:"Mushroom Production",111419:"Other Food Crops Grown Under Cover",111421:"Nursery and Tree Production",111422:"Floriculture Production",111991:"Sugar Beet Farming",111992:"Peanut Farming",111998:"All Other Miscellaneous Crop Farming",112111:"Beef Cattle Ranching and Farming",112112:"Cattle Feedlots",112511:"Finfish Farming and Fish Hatcheries",112512:"Shellfish Farming",112519:"Other Aquaculture",114111:"Finfish Fishing",114112:"Shellfish Fishing",114119:"Other Marine Fishing",115111:"Cotton Ginning",115112:"Soil Preparation, Planting, and Cultivating",115113:"Crop Harvesting, Primarily by Machine",115114:"Postharvest Crop Activities (except Cotton Ginning)",115115:"Farm Labor Contractors and Crew Leaders",115116:"Farm Management Services",211111:"Crude Petroleum and Natural Gas Extraction",211112:"Natural Gas Liquid Extraction",212111:"Bituminous Coal and Lignite Surface Mining",212112:"Bituminous Coal Underground Mining",212113:"Anthracite Mining",212221:"Gold Ore Mining",212222:"Silver Ore Mining",212231:"Lead Ore and Zinc Ore Mining",212234:"Copper Ore and Nickel Ore Mining",212291:"Uranium-Radium-Vanadium Ore Mining",212299:"All Other Metal Ore Mining",212311:"Dimension Stone Mining and Quarrying",212312:"Crushed and Broken Limestone Mining and Quarrying",212313:"Crushed and Broken Granite Mining and Quarrying",212319:"Other Crushed and Broken Stone Mining and Quarrying",212321:"Construction Sand and Gravel Mining",212322:"Industrial Sand Mining",212324:"Kaolin and Ball Clay Mining",212325:"Clay and Ceramic and Refractory Minerals Mining",212391:"Potash, Soda, and Borate Mineral Mining",212392:"Phosphate Rock Mining",212393:"Other Chemical and Fertilizer Mineral Mining",212399:"All Other Nonmetallic Mineral Mining",213111:"Drilling Oil and Gas Wells",213112:"Support Activities for Oil and Gas Operations",213113:"Support Activities for Coal Mining",213114:"Support Activities for Metal Mining",213115:"Support Activities for Nonmetallic Minerals (except Fuels) Mining",221111:"Hydroelectric Power Generation",221112:"Fossil Fuel Electric Power Generation",221113:"Nuclear Electric Power Generation",221114:"Solar Electric Power Generation",221115:"Wind Electric Power Generation",221116:"Geothermal Electric Power Generation",221117:"Biomass Electric Power Generation",221118:"Other Electric Power Generation",221119:"Other Electric Power Generation",221121:"Electric Bulk Power Transmission and Control",221122:"Electric Power Distribution",236115:"New Single-Family Housing Construction (except For-Sale Builders)",236116:"New Multifamily Housing Construction (except For-Sale Builders)",236117:"New Housing For-Sale Builders",236118:"Residential Remodelers",311111:"Dog and Cat Food Manufacturing",311119:"Other Animal Food Manufacturing",311211:"Flour Milling",311212:"Rice Milling",311213:"Malt Manufacturing",311221:"Wet Corn Milling",311222:"Soybean Processing",311223:"Other Oilseed Processing",311224:"Soybean and Other Oilseed Processing",311225:"Fats and Oils Refining and Blending",311311:"Sugarcane Mills",311312:"Cane Sugar Refining",311313:"Beet Sugar Manufacturing",311314:"Cane Sugar Manufacturing",311351:"Chocolate and Confectionery Manufacturing from Cacao Beans",311352:"Confectionery Manufacturing from Purchased Chocolate",311411:"Frozen Fruit, Juice, and Vegetable Manufacturing",311412:"Frozen Specialty Food Manufacturing",311421:"Fruit and Vegetable Canning",311422:"Specialty Canning",311423:"Dried and Dehydrated Food Manufacturing",311511:"Fluid Milk Manufacturing",311512:"Creamery Butter Manufacturing",311513:"Cheese Manufacturing",311514:"Dry, Condensed, and Evaporated Dairy Product Manufacturing",311611:"Animal (except Poultry) Slaughtering",311612:"Meat Processed from Carcasses",311613:"Rendering and Meat Byproduct Processing",311615:"Poultry Processing",311711:"Seafood Canning",311712:"Fresh and Frozen Seafood Processing",311811:"Retail Bakeries",311812:"Commercial Bakeries",311813:"Frozen Cakes, Pies, and Other Pastries Manufacturing",311821:"Cookie and Cracker Manufacturing",311822:"Flour Mixes and Dough Manufacturing from Purchased Flour",311823:"Dry Pasta Manufacturing",311824:"Dry Pasta, Dough, and Flour Mixes Manufacturing from Purchased Flour",311911:"Roasted Nuts and Peanut Butter Manufacturing",311919:"Other Snack Food Manufacturing",311941:"Mayonnaise, Dressing, and Other Prepared Sauce Manufacturing",311942:"Spice and Extract Manufacturing",311991:"Perishable Prepared Food Manufacturing",311999:"All Other Miscellaneous Food Manufacturing",312111:"Soft Drink Manufacturing",312112:"Bottled Water Manufacturing",312113:"Ice Manufacturing",312221:"Cigarette Manufacturing",312229:"Other Tobacco Product Manufacturing",313111:"Yarn Spinning Mills",313112:"Yarn Texturizing, Throwing, and Twisting Mills",313113:"Thread Mills",313221:"Narrow Fabric Mills",313222:"Schiffli Machine Embroidery",313241:"Weft Knit Fabric Mills",313249:"Other Knit Fabric and Lace Mills",313311:"Broadwoven Fabric Finishing Mills",313312:"Textile and Fabric Finishing (except Broadwoven Fabric) Mills",314121:"Curtain and Drapery Mills",314129:"Other Household Textile Product Mills",314911:"Textile Bag Mills",314912:"Canvas and Related Product Mills",314991:"Rope, Cordage, and Twine Mills",314992:"Tire Cord and Tire Fabric Mills",314994:"Rope, Cordage, Twine, Tire Cord, and Tire Fabric Mills",314999:"All Other Miscellaneous Textile Product Mills",315111:"Sheer Hosiery Mills",315119:"Other Hosiery and Sock Mills",315191:"Outerwear Knitting Mills",315192:"Underwear and Nightwear Knitting Mills",315211:"Men's and Boys' Cut and Sew Apparel Contractors",315212:"Women's, Girls', and Infants' Cut and Sew Apparel Contractors",315221:"Men's and Boys' Cut and Sew Underwear and Nightwear Manufacturing",315222:"Men's and Boys' Cut and Sew Suit, Coat, and Overcoat Manufacturing",315223:"Men's and Boys' Cut and Sew Shirt (except Work Shirt) Manufacturing",315224:"Men's and Boys' Cut and Sew Trouser, Slack, and Jean Manufacturing",315225:"Men's and Boys' Cut and Sew Work Clothing Manufacturing",315228:"Men's and Boys' Cut and Sew Other Outerwear Manufacturing",315231:"Women's and Girls' Cut and Sew Lingerie, Loungewear, and Nightwear Manufacturing",315232:"Women's and Girls' Cut and Sew Blouse and Shirt Manufacturing",315233:"Women's and Girls' Cut and Sew Dress Manufacturing",315234:"Women's and Girls' Cut and Sew Suit, Coat, Tailored Jacket, and Skirt Manufacturing",315238:"Women's and Girls' Cut and Sew Other Outerwear Manufacturing",315239:"Women's and Girls' Cut and Sew Other Outerwear Manufacturing",315291:"Infants' Cut and Sew Apparel Manufacturing",315292:"Fur and Leather Apparel Manufacturing",315299:"All Other Cut and Sew Apparel Manufacturing",315991:"Hat, Cap, and Millinery Manufacturing",315992:"Glove and Mitten Manufacturing",315993:"Men's and Boys' Neckwear Manufacturing",315999:"Other Apparel Accessories and Other Apparel Manufacturing",316211:"Rubber and Plastics Footwear Manufacturing",316212:"House Slipper Manufacturing",316213:"Men's Footwear (except Athletic) Manufacturing",316214:"Women's Footwear (except Athletic) Manufacturing",316219:"Other Footwear Manufacturing",316991:"Luggage Manufacturing",316992:"Women's Handbag and Purse Manufacturing",316993:"Personal Leather Good (except Women's Handbag and Purse) Manufacturing",316998:"All Other Leather Good and Allied Product Manufacturing",316999:"All Other Leather Good Manufacturing",321113:"Sawmills",321114:"Wood Preservation",321211:"Hardwood Veneer and Plywood Manufacturing",321212:"Softwood Veneer and Plywood Manufacturing",321213:"Engineered Wood Member (except Truss) Manufacturing",321214:"Truss Manufacturing",321219:"Reconstituted Wood Product Manufacturing",321911:"Wood Window and Door Manufacturing",321912:"Cut Stock, Resawing Lumber, and Planing",321918:"Other Millwork (including Flooring)",321991:"Manufactured Home (Mobile Home) Manufacturing",321992:"Prefabricated Wood Building Manufacturing",321999:"All Other Miscellaneous Wood Product Manufacturing",322121:"Paper (except Newsprint) Mills",322122:"Newsprint Mills",322211:"Corrugated and Solid Fiber Box Manufacturing",322212:"Folding Paperboard Box Manufacturing",322213:"Setup Paperboard Box Manufacturing",322214:"Fiber Can, Tube, Drum, and Similar Products Manufacturing",322215:"Nonfolding Sanitary Food Container Manufacturing",322219:"Other Paperboard Container Manufacturing",322221:"Coated and Laminated Packaging Paper and Plastics Film Manufacturing",322222:"Coated and Laminated Paper Manufacturing",322223:"Plastics, Foil, and Coated Paper Bag Manufacturing",322224:"Uncoated Paper and Multiwall Bag Manufacturing",322225:"Laminated Aluminum Foil Manufacturing for Flexible Packaging Uses",322226:"Surface-Coated Paperboard Manufacturing",322231:"Die-Cut Paper and Paperboard Office Supplies Manufacturing",322232:"Envelope Manufacturing",322233:"Stationery, Tablet, and Related Product Manufacturing",322291:"Sanitary Paper Product Manufacturing",322292:"Surface-Coated Paperboard Manufacturing",322298:"All Other Converted Paper Product Manufacturing",322299:"All Other Converted Paper Product Manufacturing",323110:"Commercial Lithographic Printing",323111:"Commercial Printing (except Screen and Books)",323112:"Commercial Flexographic Printing",323113:"Commercial Screen Printing",323114:"Quick Printing",323115:"Digital Printing",323116:"Manifold Business Forms Printing",323117:"Books Printing",323118:"Blankbook, Looseleaf Binders, and Devices Manufacturing",323119:"Other Commercial Printing",323121:"Tradebinding and Related Work",323122:"Prepress Services",324121:"Asphalt Paving Mixture and Block Manufacturing",324122:"Asphalt Shingle and Coating Materials Manufacturing",324191:"Petroleum Lubricating Oil and Grease Manufacturing",324199:"All Other Petroleum and Coal Products Manufacturing",325131:"Inorganic Dye and Pigment Manufacturing",325132:"Synthetic Organic Dye and Pigment Manufacturing",325181:"Alkalies and Chlorine Manufacturing",325182:"Carbon Black Manufacturing",325188:"All Other Basic Inorganic Chemical Manufacturing",325191:"Gum and Wood Chemical Manufacturing",325192:"Cyclic Crude and Intermediate Manufacturing",325193:"Ethyl Alcohol Manufacturing",325194:"Cyclic Crude, Intermediate, and Gum and Wood Chemical Manufacturing",325199:"All Other Basic Organic Chemical Manufacturing",325211:"Plastics Material and Resin Manufacturing",325212:"Synthetic Rubber Manufacturing",325221:"Cellulosic Organic Fiber Manufacturing",325222:"Noncellulosic Organic Fiber Manufacturing",325311:"Nitrogenous Fertilizer Manufacturing",325312:"Phosphatic Fertilizer Manufacturing",325314:"Fertilizer (Mixing Only) Manufacturing",325411:"Medicinal and Botanical Manufacturing",325412:"Pharmaceutical Preparation Manufacturing",325413:"In-Vitro Diagnostic Substance Manufacturing",325414:"Biological Product (except Diagnostic) Manufacturing",325611:"Soap and Other Detergent Manufacturing",325612:"Polish and Other Sanitation Good Manufacturing",325613:"Surface Active Agent Manufacturing",325991:"Custom Compounding of Purchased Resins",325992:"Photographic Film, Paper, Plate, and Chemical Manufacturing",325998:"All Other Miscellaneous Chemical Product and Preparation Manufacturing",326111:"Plastics Bag and Pouch Manufacturing",326112:"Plastics Packaging Film and Sheet (including Laminated) Manufacturing",326113:"Unlaminated Plastics Film and Sheet (except Packaging) Manufacturing",326121:"Unlaminated Plastics Profile Shape Manufacturing",326122:"Plastics Pipe and Pipe Fitting Manufacturing",326191:"Plastics Plumbing Fixture Manufacturing",326192:"Resilient Floor Covering Manufacturing",326199:"All Other Plastics Product Manufacturing",326211:"Tire Manufacturing (except Retreading)",326212:"Tire Retreading",326291:"Rubber Product Manufacturing for Mechanical Use",326299:"All Other Rubber Product Manufacturing",327111:"Vitreous China Plumbing Fixture and China and Earthenware Bathroom Accessories Manufacturing",327112:"Vitreous China, Fine Earthenware, and Other Pottery Product Manufacturing",327113:"Porcelain Electrical Supply Manufacturing",327121:"Brick and Structural Clay Tile Manufacturing",327122:"Ceramic Wall and Floor Tile Manufacturing",327123:"Other Structural Clay Product Manufacturing",327124:"Clay Refractory Manufacturing",327125:"Nonclay Refractory Manufacturing",327211:"Flat Glass Manufacturing",327212:"Other Pressed and Blown Glass and Glassware Manufacturing",327213:"Glass Container Manufacturing",327215:"Glass Product Manufacturing Made of Purchased Glass",327331:"Concrete Block and Brick Manufacturing",327332:"Concrete Pipe Manufacturing",327991:"Cut Stone and Stone Product Manufacturing",327992:"Ground or Treated Mineral and Earth Manufacturing",327993:"Mineral Wool Manufacturing",327999:"All Other Miscellaneous Nonmetallic Mineral Product Manufacturing",331111:"Iron and Steel Mills",331112:"Electrometallurgical Ferroalloy Product Manufacturing",331221:"Rolled Steel Shape Manufacturing",331222:"Steel Wire Drawing",331311:"Alumina Refining",331312:"Primary Aluminum Production",331313:"Alumina Refining and Primary Aluminum Production",331314:"Secondary Smelting and Alloying of Aluminum",331315:"Aluminum Sheet, Plate, and Foil Manufacturing",331316:"Aluminum Extruded Product Manufacturing",331318:"Other Aluminum Rolling, Drawing, and Extruding",331319:"Other Aluminum Rolling and Drawing",331411:"Primary Smelting and Refining of Copper",331419:"Primary Smelting and Refining of Nonferrous Metal (except Copper and Aluminum)",331421:"Copper Rolling, Drawing, and Extruding",331422:"Copper Wire (except Mechanical) Drawing",331423:"Secondary Smelting, Refining, and Alloying of Copper",331491:"Nonferrous Metal (except Copper and Aluminum) Rolling, Drawing, and Extruding",331492:"Secondary Smelting, Refining, and Alloying of Nonferrous Metal (except Copper and Aluminum)",331511:"Iron Foundries",331512:"Steel Investment Foundries",331513:"Steel Foundries (except Investment)",331521:"Aluminum Die-Casting Foundries",331522:"Nonferrous (except Aluminum) Die-Casting Foundries",331523:"Nonferrous Metal Die-Casting Foundries",331524:"Aluminum Foundries (except Die-Casting)",331525:"Copper Foundries (except Die-Casting)",331528:"Other Nonferrous Foundries (except Die-Casting)",331529:"Other Nonferrous Metal Foundries (except Die-Casting)",332111:"Iron and Steel Forging",332112:"Nonferrous Forging",332114:"Custom Roll Forming",332115:"Crown and Closure Manufacturing",332116:"Metal Stamping",332117:"Powder Metallurgy Part Manufacturing",332119:"Metal Crown, Closure, and Other Metal Stamping (except Automotive)",332211:"Cutlery and Flatware (except Precious) Manufacturing",332212:"Hand and Edge Tool Manufacturing",332213:"Saw Blade and Handsaw Manufacturing",332214:"Kitchen Utensil, Pot, and Pan Manufacturing",332215:"Metal Kitchen Cookware, Utensil, Cutlery, and Flatware (except Precious) Manufacturing",332216:"Saw Blade and Handtool Manufacturing",332311:"Prefabricated Metal Building and Component Manufacturing",332312:"Fabricated Structural Metal Manufacturing",332313:"Plate Work Manufacturing",332321:"Metal Window and Door Manufacturing",332322:"Sheet Metal Work Manufacturing",332323:"Ornamental and Architectural Metal Work Manufacturing",332431:"Metal Can Manufacturing",332439:"Other Metal Container Manufacturing",332611:"Spring (Heavy Gauge) Manufacturing",332612:"Spring (Light Gauge) Manufacturing",332613:"Spring Manufacturing",332618:"Other Fabricated Wire Product Manufacturing",332721:"Precision Turned Product Manufacturing",332722:"Bolt, Nut, Screw, Rivet, and Washer Manufacturing",332811:"Metal Heat Treating",332812:"Metal Coating, Engraving (except Jewelry and Silverware), and Allied Services to Manufacturers",332813:"Electroplating, Plating, Polishing, Anodizing, and Coloring",332911:"Industrial Valve Manufacturing",332912:"Fluid Power Valve and Hose Fitting Manufacturing",332913:"Plumbing Fixture Fitting and Trim Manufacturing",332919:"Other Metal Valve and Pipe Fitting Manufacturing",332991:"Ball and Roller Bearing Manufacturing",332992:"Small Arms Ammunition Manufacturing",332993:"Ammunition (except Small Arms) Manufacturing",332994:"Small Arms, Ordnance, and Ordnance Accessories Manufacturing",332995:"Other Ordnance and Accessories Manufacturing",332996:"Fabricated Pipe and Pipe Fitting Manufacturing",332997:"Industrial Pattern Manufacturing",332998:"Enameled Iron and Metal Sanitary Ware Manufacturing",332999:"All Other Miscellaneous Fabricated Metal Product Manufacturing",333111:"Farm Machinery and Equipment Manufacturing",333112:"Lawn and Garden Tractor and Home Lawn and Garden Equipment Manufacturing",333131:"Mining Machinery and Equipment Manufacturing",333132:"Oil and Gas Field Machinery and Equipment Manufacturing",333241:"Food Product Machinery Manufacturing",333242:"Semiconductor Machinery Manufacturing",333243:"Sawmill, Woodworking, and Paper Machinery Manufacturing",333244:"Printing Machinery and Equipment Manufacturing",333249:"Other Industrial Machinery Manufacturing",333291:"Paper Industry Machinery Manufacturing",333292:"Textile Machinery Manufacturing",333293:"Printing Machinery and Equipment Manufacturing",333294:"Food Product Machinery Manufacturing",333295:"Semiconductor Machinery Manufacturing",333298:"All Other Industrial Machinery Manufacturing",333311:"Automatic Vending Machine Manufacturing",333312:"Commercial Laundry, Drycleaning, and Pressing Machine Manufacturing",333313:"Office Machinery Manufacturing",333314:"Optical Instrument and Lens Manufacturing",333315:"Photographic and Photocopying Equipment Manufacturing",333316:"Photographic and Photocopying Equipment Manufacturing",333318:"Other Commercial and Service Industry Machinery Manufacturing",333319:"Other Commercial and Service Industry Machinery Manufacturing",333411:"Air Purification Equipment Manufacturing",333412:"Industrial and Commercial Fan and Blower Manufacturing",333413:"Industrial and Commercial Fan and Blower and Air Purification Equipment Manufacturing",333414:"Heating Equipment (except Warm Air Furnaces) Manufacturing",333415:"Air-Conditioning and Warm Air Heating Equipment and Commercial and Industrial Refrigeration Equipment Manufacturing",333511:"Industrial Mold Manufacturing",333512:"Machine Tool (Metal Cutting Types) Manufacturing",333513:"Machine Tool (Metal Forming Types) Manufacturing",333514:"Special Die and Tool, Die Set, Jig, and Fixture Manufacturing",333515:"Cutting Tool and Machine Tool Accessory Manufacturing",333516:"Rolling Mill Machinery and Equipment Manufacturing",333517:"Machine Tool Manufacturing",333518:"Other Metalworking Machinery Manufacturing",333519:"Rolling Mill and Other Metalworking Machinery Manufacturing",333611:"Turbine and Turbine Generator Set Units Manufacturing",333612:"Speed Changer, Industrial High-Speed Drive, and Gear Manufacturing",333613:"Mechanical Power Transmission Equipment Manufacturing",333618:"Other Engine Equipment Manufacturing",333911:"Pump and Pumping Equipment Manufacturing",333912:"Air and Gas Compressor Manufacturing",333913:"Measuring and Dispensing Pump Manufacturing",333914:"Measuring, Dispensing, and Other Pumping Equipment Manufacturing",333921:"Elevator and Moving Stairway Manufacturing",333922:"Conveyor and Conveying Equipment Manufacturing",333923:"Overhead Traveling Crane, Hoist, and Monorail System Manufacturing",333924:"Industrial Truck, Tractor, Trailer, and Stacker Machinery Manufacturing",333991:"Power-Driven Handtool Manufacturing",333992:"Welding and Soldering Equipment Manufacturing",333993:"Packaging Machinery Manufacturing",333994:"Industrial Process Furnace and Oven Manufacturing",333995:"Fluid Power Cylinder and Actuator Manufacturing",333996:"Fluid Power Pump and Motor Manufacturing",333997:"Scale and Balance Manufacturing",333999:"All Other Miscellaneous General Purpose Machinery Manufacturing",334111:"Electronic Computer Manufacturing",334112:"Computer Storage Device Manufacturing",334113:"Computer Terminal Manufacturing",334118:"Computer Terminal and Other Computer Peripheral Equipment Manufacturing",334119:"Other Computer Peripheral Equipment Manufacturing",334411:"Electron Tube Manufacturing",334412:"Bare Printed Circuit Board Manufacturing",334413:"Semiconductor and Related Device Manufacturing",334414:"Electronic Capacitor Manufacturing",334415:"Electronic Resistor Manufacturing",334416:"Capacitor, Resistor, Coil, Transformer, and Other Inductor Manufacturing",334417:"Electronic Connector Manufacturing",334418:"Printed Circuit Assembly (Electronic Assembly) Manufacturing",334419:"Other Electronic Component Manufacturing",334510:"Electromedical and Electrotherapeutic Apparatus Manufacturing",334511:"Search, Detection, Navigation, Guidance, Aeronautical, and Nautical System and Instrument Manufacturing",334512:"Automatic Environmental Control Manufacturing for Residential, Commercial, and Appliance Use",334513:"Instruments and Related Products Manufacturing for Measuring, Displaying, and Controlling Industrial Process Variables",334514:"Totalizing Fluid Meter and Counting Device Manufacturing",334515:"Instrument Manufacturing for Measuring and Testing Electricity and Electrical Signals",334516:"Analytical Laboratory Instrument Manufacturing",334517:"Irradiation Apparatus Manufacturing",334518:"Watch, Clock, and Part Manufacturing",334519:"Other Measuring and Controlling Device Manufacturing",334611:"Software Reproducing",334612:"Prerecorded Compact Disc (except Software), Tape, and Record Reproducing",334613:"Blank Magnetic and Optical Recording Media Manufacturing",334614:"Software and Other Prerecorded Compact Disc, Tape, and Record Reproducing",335121:"Residential Electric Lighting Fixture Manufacturing",335122:"Commercial, Industrial, and Institutional Electric Lighting Fixture Manufacturing",335129:"Other Lighting Equipment Manufacturing",335211:"Electric Housewares and Household Fan Manufacturing",335212:"Household Vacuum Cleaner Manufacturing",335221:"Household Cooking Appliance Manufacturing",335222:"Household Refrigerator and Home Freezer Manufacturing",335224:"Household Laundry Equipment Manufacturing",335228:"Other Major Household Appliance Manufacturing",335311:"Power, Distribution, and Specialty Transformer Manufacturing",335312:"Motor and Generator Manufacturing",335313:"Switchgear and Switchboard Apparatus Manufacturing",335314:"Relay and Industrial Control Manufacturing",335911:"Storage Battery Manufacturing",335912:"Primary Battery Manufacturing",335921:"Fiber Optic Cable Manufacturing",335929:"Other Communication and Energy Wire Manufacturing",335931:"Current-Carrying Wiring Device Manufacturing",335932:"Noncurrent-Carrying Wiring Device Manufacturing",335991:"Carbon and Graphite Product Manufacturing",335999:"All Other Miscellaneous Electrical Equipment and Component Manufacturing",336111:"Automobile Manufacturing",336112:"Light Truck and Utility Vehicle Manufacturing",336211:"Motor Vehicle Body Manufacturing",336212:"Truck Trailer Manufacturing",336213:"Motor Home Manufacturing",336214:"Travel Trailer and Camper Manufacturing",336311:"Carburetor, Piston, Piston Ring, and Valve Manufacturing",336312:"Gasoline Engine and Engine Parts Manufacturing",336321:"Vehicular Lighting Equipment Manufacturing",336322:"Other Motor Vehicle Electrical and Electronic Equipment Manufacturing",336391:"Motor Vehicle Air-Conditioning Manufacturing",336399:"All Other Motor Vehicle Parts Manufacturing",336411:"Aircraft Manufacturing",336412:"Aircraft Engine and Engine Parts Manufacturing",336413:"Other Aircraft Parts and Auxiliary Equipment Manufacturing",336414:"Guided Missile and Space Vehicle Manufacturing",336415:"Guided Missile and Space Vehicle Propulsion Unit and Propulsion Unit Parts Manufacturing",336419:"Other Guided Missile and Space Vehicle Parts and Auxiliary Equipment Manufacturing",336611:"Ship Building and Repairing",336612:"Boat Building",336991:"Motorcycle, Bicycle, and Parts Manufacturing",336992:"Military Armored Vehicle, Tank, and Tank Component Manufacturing",336999:"All Other Transportation Equipment Manufacturing",337121:"Upholstered Household Furniture Manufacturing",337122:"Nonupholstered Wood Household Furniture Manufacturing",337124:"Metal Household Furniture Manufacturing",337125:"Household Furniture (except Wood and Metal) Manufacturing",337127:"Institutional Furniture Manufacturing",337129:"Wood Television, Radio, and Sewing Machine Cabinet Manufacturing",337211:"Wood Office Furniture Manufacturing",337212:"Custom Architectural Woodwork and Millwork Manufacturing",337214:"Office Furniture (except Wood) Manufacturing",337215:"Showcase, Partition, Shelving, and Locker Manufacturing",339111:"Laboratory Apparatus and Furniture Manufacturing",339112:"Surgical and Medical Instrument Manufacturing",339113:"Surgical Appliance and Supplies Manufacturing",339114:"Dental Equipment and Supplies Manufacturing",339115:"Ophthalmic Goods Manufacturing",339116:"Dental Laboratories",339911:"Jewelry (except Costume) Manufacturing",339912:"Silverware and Hollowware Manufacturing",339913:"Jewelers' Material and Lapidary Work Manufacturing",339914:"Costume Jewelry and Novelty Manufacturing",339931:"Doll and Stuffed Toy Manufacturing",339932:"Game, Toy, and Children's Vehicle Manufacturing",339941:"Pen and Mechanical Pencil Manufacturing",339942:"Lead Pencil and Art Good Manufacturing",339943:"Marking Device Manufacturing",339944:"Carbon Paper and Inked Ribbon Manufacturing",339991:"Gasket, Packing, and Sealing Device Manufacturing",339992:"Musical Instrument Manufacturing",339993:"Fastener, Button, Needle, and Pin Manufacturing",339994:"Broom, Brush, and Mop Manufacturing",339995:"Burial Casket Manufacturing",339999:"All Other Miscellaneous Manufacturing",441221:"Motorcycle Dealers",441222:"Boat Dealers",441228:"Motorcycle, ATV, and All Other Motor Vehicle Dealers",441229:"All Other Motor Vehicle Dealers",442291:"Window Treatment Stores",442299:"All Other Home Furnishings Stores",443111:"Household Appliance Stores",443112:"Radio, Television, and Other Electronics Stores",443141:"Household Appliance Stores",443142:"Electronics Stores",445291:"Baked Goods Stores",445292:"Confectionery and Nut Stores",445299:"All Other Specialty Food Stores",446191:"Food (Health) Supplement Stores",446199:"All Other Health and Personal Care Stores",451211:"Book Stores",451212:"News Dealers and Newsstands",452111:"Department Stores (except Discount Department Stores)",452112:"Discount Department Stores",452311:"Warehouse Clubs and Supercenters",452319:"All Other General Merchandise Stores",453991:"Tobacco Stores",453998:"All Other Miscellaneous Store Retailers (except Tobacco Stores)",454111:"Electronic Shopping",454112:"Electronic Auctions",454113:"Mail-Order Houses",454311:"Heating Oil Dealers",454312:"Liquefied Petroleum Gas (Bottled Gas) Dealers",454319:"Other Fuel Dealers",481111:"Scheduled Passenger Air Transportation",481112:"Scheduled Freight Air Transportation",481211:"Nonscheduled Chartered Passenger Air Transportation",481212:"Nonscheduled Chartered Freight Air Transportation",481219:"Other Nonscheduled Air Transportation",482111:"Line-Haul Railroads",482112:"Short Line Railroads",483111:"Deep Sea Freight Transportation",483112:"Deep Sea Passenger Transportation",483113:"Coastal and Great Lakes Freight Transportation",483114:"Coastal and Great Lakes Passenger Transportation",483211:"Inland Water Freight Transportation",483212:"Inland Water Passenger Transportation",484121:"General Freight Trucking, Long-Distance, Truckload",484122:"General Freight Trucking, Long-Distance, Less Than Truckload",485111:"Mixed Mode Transit Systems",485112:"Commuter Rail Systems",485113:"Bus and Other Motor Vehicle Transit Systems",485119:"Other Urban Transit Systems",485991:"Special Needs Transportation",485999:"All Other Transit and Ground Passenger Transportation",488111:"Air Traffic Control",488119:"Other Airport Operations",488991:"Packing and Crating",488999:"All Other Support Activities for Transportation",511191:"Greeting Card Publishers",511199:"All Other Publishers",512131:"Motion Picture Theaters (except Drive-Ins)",512132:"Drive-In Motion Picture Theaters",512191:"Teleproduction and Other Postproduction Services",512199:"Other Motion Picture and Video Industries",513111:"Radio Networks",513112:"Radio Stations",513321:"Paging",513322:"Cellular and Other Wireless Telecommunications",514191:"On-line Information Services",514199:"All Other Information Services",515111:"Radio Networks",515112:"Radio Stations",517211:"Paging",517212:"Cellular and Other Wireless Telecommunications",517311:"Wired Telecommunications Carriers",517312:"Wireless Telecommunications Carriers (except Satellite)",517911:"Telecommunications Resellers",517919:"All Other Telecommunications",518111:"Internet Service Providers",518112:"Web Search Portals",522291:"Consumer Lending",522292:"Real Estate Credit",522293:"International Trade Financing",522294:"Secondary Market Financing",522298:"All Other Nondepository Credit Intermediation",523991:"Trust, Fiduciary, and Custody Activities",523999:"Miscellaneous Financial Investment Activities",524113:"Direct Life Insurance Carriers",524114:"Direct Health and Medical Insurance Carriers",524126:"Direct Property and Casualty Insurance Carriers",524127:"Direct Title Insurance Carriers",524128:"Other Direct Insurance (except Life, Health, and Medical) Carriers",524291:"Claims Adjusting",524292:"Third Party Administration of Insurance and Pension Funds",524298:"All Other Insurance Related Activities",531311:"Residential Property Managers",531312:"Nonresidential Property Managers",532111:"Passenger Car Rental",532112:"Passenger Car Leasing",532281:"Formal Wear and Costume Rental",532282:"Video Tape and Disc Rental",532283:"Home Health Equipment Rental",532284:"Recreational Goods Rental",532289:"All Other Consumer Goods Rental",532291:"Home Health Equipment Rental",532292:"Recreational Goods Rental",532299:"All Other Consumer Goods Rental",532411:"Commercial Air, Rail, and Water Transportation Equipment Rental and Leasing",532412:"Construction, Mining, and Forestry Machinery and Equipment Rental and Leasing",541191:"Title Abstract and Settlement Offices",541199:"All Other Legal Services",541211:"Offices of Certified Public Accountants",541213:"Tax Preparation Services",541214:"Payroll Services",541219:"Other Accounting Services",541511:"Custom Computer Programming Services",541512:"Computer Systems Design Services",541513:"Computer Facilities Management Services",541519:"Other Computer Related Services",541611:"Administrative Management and General Management Consulting Services",541612:"Human Resources Consulting Services",541613:"Marketing Consulting Services",541614:"Process, Physical Distribution, and Logistics Consulting Services",541618:"Other Management Consulting Services",541711:"Research and Development in Biotechnology",541712:"Research and Development in the Physical, Engineering, and Life Sciences (except Biotechnology)",541713:"Research and Development in Nanotechnology",541714:"Research and Development in Biotechnology (except Nanobiotechnology)",541715:"Research and Development in the Physical, Engineering, and Life Sciences (except Nanotechnology and Biotechnology)",541921:"Photography Studios, Portrait",541922:"Commercial Photography",551111:"Offices of Bank Holding Companies",551112:"Offices of Other Holding Companies",551114:"Corporate, Subsidiary, and Regional Managing Offices",561311:"Employment Placement Agencies",561312:"Executive Search Services",561421:"Telephone Answering Services",561422:"Telemarketing Bureaus and Other Contact Centers",561431:"Private Mail Centers",561439:"Other Business Service Centers (including Copy Shops)",561491:"Repossession Services",561492:"Court Reporting and Stenotype Services",561499:"All Other Business Support Services",561591:"Convention and Visitors Bureaus",561599:"All Other Travel Arrangement and Reservation Services",561611:"Investigation Services",561612:"Security Guards and Patrol Services",561613:"Armored Car Services",561621:"Security Systems Services (except Locksmiths)",561622:"Locksmiths",562111:"Solid Waste Collection",562112:"Hazardous Waste Collection",562119:"Other Waste Collection",562211:"Hazardous Waste Treatment and Disposal",562212:"Solid Waste Landfill",562213:"Solid Waste Combustors and Incinerators",562219:"Other Nonhazardous Waste Treatment and Disposal",562991:"Septic Tank and Related Services",562998:"All Other Miscellaneous Waste Management Services",611511:"Cosmetology and Barber Schools",611512:"Flight Training",611513:"Apprenticeship Training",611519:"Other Technical and Trade Schools",611691:"Exam Preparation and Tutoring",611692:"Automobile Driving Schools",611699:"All Other Miscellaneous Schools and Instruction",621111:"Offices of Physicians (except Mental Health Specialists)",621112:"Offices of Physicians, Mental Health Specialists",621391:"Offices of Podiatrists",621399:"Offices of All Other Miscellaneous Health Practitioners",621491:"HMO Medical Centers",621492:"Kidney Dialysis Centers",621493:"Freestanding Ambulatory Surgical and Emergency Centers",621498:"All Other Outpatient Care Centers",621511:"Medical Laboratories",621512:"Diagnostic Imaging Centers",621991:"Blood and Organ Banks",621999:"All Other Miscellaneous Ambulatory Health Care Services",623311:"Continuing Care Retirement Communities",623312:"Assisted Living Facilities for the Elderly",624221:"Temporary Shelters",624229:"Other Community Housing Services",711211:"Sports Teams and Clubs",711212:"Racetracks",711219:"Other Spectator Sports",721191:"Bed-and-Breakfast Inns",721199:"All Other Traveler Accommodation",721211:"RV (Recreational Vehicle) Parks and Campgrounds",721214:"Recreational and Vacation Camps (except Campgrounds)",722211:"Limited-Service Restaurants",722212:"Cafeterias",722213:"Snack and Nonalcoholic Beverage Bars",722511:"Full-Service Restaurants",722513:"Limited-Service Restaurants",722514:"Cafeterias, Grill Buffets, and Buffets",722515:"Snack and Nonalcoholic Beverage Bars",811111:"General Automotive Repair",811112:"Automotive Exhaust System Repair",811113:"Automotive Transmission Repair",811118:"Other Automotive Mechanical and Electrical Repair and Maintenance",811121:"Automotive Body, Paint, and Interior Repair and Maintenance",811122:"Automotive Glass Replacement Shops",811191:"Automotive Oil Change and Lubrication Shops",811192:"Car Washes",811198:"All Other Automotive Repair and Maintenance",811211:"Consumer Electronics Repair and Maintenance",811212:"Computer and Office Machine Repair and Maintenance",811213:"Communication Equipment Repair and Maintenance",811219:"Other Electronic and Precision Equipment Repair and Maintenance",811411:"Home and Garden Equipment Repair and Maintenance",811412:"Appliance Repair and Maintenance",812111:"Barber Shops",812112:"Beauty Salons",812113:"Nail Salons",812191:"Diet and Weight Reducing Centers",812199:"Other Personal Care Services",812321:"Laundries, Family and Commercial",812322:"Drycleaning Plants",812331:"Linen Supply",812332:"Industrial Launderers",812391:"Garment Pressing, and Agents for Laundries",812399:"All Other Laundry Services",812921:"Photofinishing Laboratories (except One-Hour)",812922:"One-Hour Photofinishing",813211:"Grantmaking Foundations",813212:"Voluntary Health Organizations",813219:"Other Grantmaking and Giving Services",813311:"Human Rights Organizations",813312:"Environment, Conservation and Wildlife Organizations",813319:"Other Social Advocacy Organizations","31-33":"Manufacturing","44-45":"Retail Trade","48-49":"Transportation"},DeregistrationReasonCode:{"01":"Source reduced inventory of all regulated substances below TQs","02":"Source no longer uses any regulated substance","03":"Source terminated operations","04":"Other"},RMPSubmissionReasonCode:{C01:"Clerical error corrected",C02:"Additional information supplied",C03:"Minor administrative change",C04:"Notification of facility ownership change",C05:"New accident history information",C06:"Change in emergency contact information",C07:"New data element required by EPA",C08:"Optional data element requested by EPA",C09:"Removed OCA description from executive summary",R01:"Newly regulated substance listed by EPA (40 CFR 68.190(b)(2))",R02:"Newly regulated substance above TQ in already covered process (40 CFR 68.190(b)(3))",R03:"Regulated substance present above TQ in new (or previously not covered) process (40 CFR 68.190(b)(4))",R04:"Revised PHA / Hazard Review due to process change (40 CFR 68.190(b)(5))",R05:"Revised OCA due to change (40 CFR 68.190(b)(6))",R06:"Change in program level of covered process (40 CFR 68.190(b)(7))",R07:"5-year update (40 CFR 68.190(b)(1))",R08:"Process no longer covered (source has other processes that remain covered) (40 CFR 68.190(b)(7))",R09:"Voluntary update (not described by any of the above reasons)"},LatLongMethod:{A1:"Address Matching - House Number",A2:"Address Matching - Block Face",A3:"Address Matching - Street Centerline",A4:"Address Matching - Nearest Intersection",A5:"Address Matching - Primary Name",A6:"Address Matching - Digitized",AO:"Address Matching - Other",C1:"Census Block - 1990 - Centroid",C2:"Census Block/Group - 1990 - Centroid",C3:"Census Block Tract - 1990 - Centroid",CO:"Census - Other",G1:"Global Positioning System (GPS) Carrier Phase Static Relative Positioning Technique",G2:"GPS Carrier Phase Kinematic Relative Positioning Technique",G3:"GPS Code Measurements (Psuedo Range) Differential (DGPS)",G4:"GPS Code Measurements (Psuedo Range) Precise Positioning Service",G5:"GPS Code Measurements (Psuedo Range) Standard Positioning Service SA OFF",G6:"GPS Code Measurements (Psuedo Range) Standard Positioning Service SA ON",G7:"GPS Code Measurements (Psuedo Range) Standard Positioning Service Corrected using CACS",GO:"GPS - Unspecified",I1:"Interpolation - Map",I2:"Interpolation - Photo",I3:"Interpolation - Satellite",I4:"Interpolation - Digital map source (TIGER)",I5:"Interpolation - SPOT",I6:"Interpolation - MSS (Multi-spectral Scanner)",I7:"Interpolation - TM (Thermatic Mapper)",IO:"Interpolation - Other",L1:"Loran C",P1:"Public Land Survey - Section",P2:"Public Land Survey - Quarter Section",P3:"Public Land Survey - Eighth Section",P4:"Public Land Survey - Sixteenth Section",P5:"Public Land Survey - Footing",S1:"Classical Surveying Techniques",UN:"Unknown",Z1:"ZIP Code - Centroid",Z2:"ZIP+2 Code - Centroid",Z4:"ZIP+4 Code - Centroid"},LatLongDescription:{AB:"Administrative Building",AE:"Atmospheric Emissions Treatment Unit",AM:"Air Monitoring Station",AS:"Air Release Stack",AV:"Air Release Vent",CE:"Center of Facility",FC:"Facility Centroid",IP:"Intake Pipe",LC:"Loading Area Centroid",LF:"Loading Facility",LW:"Liquid Waste Treatment Unit",NE:"NE Corner of Land Parcel",NW:"NW Corner of Land Parcel",OT:"Other",PC:"Process Unit Area Centroid",PF:"Plant Entrance (Freight)",PG:"Plant Entrance (General)",PP:"Plant Entrance (Personnel)",PU:"Process Unit",SD:"Solid Waste Treatment/Disposal Unit",SE:"SE Corner of Land Parcel",SP:"Lagoon or Settling Pond",SS:"Solid Waste Storage Area",ST:"Storage Tank",SW:"SW Corner of Land Parcel",UN:"Unknown",WA:"Wellhead Protection Area",WL:"Well",WM:"Water Monitoring Station",WR:"Water Release Pipe"},InitiatingEvent:{a:"Equipment Failure",b:"Human Error",c:"Natural (weather conditions, earthquake)",d:"Unknown"}};function at(e,t,i){const n=e.slice();n[19]=t[i];const r=n[0][n[19]];return n[20]=r,n}function st(e,t,i){const n=e.slice();return n[23]=t[i],n[2]=i,n}function lt(e,t,i){const n=e.slice();n[19]=t[i];const r=n[0][n[19]];return n[20]=r,n}function ct(e,t,i){const n=e.slice();return n[16]=t[i],n}function ut(e,t,i){const n=e.slice();return n[27]=t[i],n}function ht(e){let t;return{c(){t=S("  ")},m(e,i){b(e,t,i)},d(e){e&&w(t)}}}function dt(e){let t;return{c(){t=S("Collapse")},m(e,i){b(e,t,i)},d(e){e&&w(t)}}}function pt(e){let t;return{c(){t=S("Expand")},m(e,i){b(e,t,i)},d(e){e&&w(t)}}}function ft(t){let i,n;return{c(){i=T("div"),n=S("Missing"),P(i,"class","missing svelte-11d8ija"),i.hidden=t[3]},m(e,t){b(e,i,t),y(i,n)},p(e,t){8&t&&(i.hidden=e[3])},i:e,o:e,d(e){e&&w(i)}}}function mt(e){let t,i,n,r;const o=[_t,gt],a=[];function s(e,t){return"submission:_exec_summary"===e[1]?0:1}return t=s(e),i=a[t]=o[t](e),{c(){i.c(),n=C()},m(e,i){a[t].m(e,i),b(e,n,i),r=!0},p(e,r){let l=t;t=s(e),t===l?a[t].p(e,r):(ne(),ae(a[l],1,1,(()=>{a[l]=null})),re(),i=a[t],i?i.p(e,r):(i=a[t]=o[t](e),i.c()),oe(i,1),i.m(n.parentNode,n))},i(e){r||(oe(i),r=!0)},o(e){ae(i),r=!1},d(e){a[t].d(e),e&&w(n)}}}function gt(e){let t,i,n,r,o=Object.keys(e[0]),a=[];for(let t=0;t<o.length;t+=1)a[t]=bt(lt(e,o,t));let s=Object.keys(e[0]),l=[];for(let t=0;t<s.length;t+=1)l[t]=Ct(at(e,s,t));const c=e=>ae(l[e],1,1,(()=>{l[e]=null}));return{c(){t=T("table");for(let e=0;e<a.length;e+=1)a[e].c();i=E();for(let e=0;e<l.length;e+=1)l[e].c();n=C(),t.hidden=e[3],P(t,"class","svelte-11d8ija")},m(e,o){b(e,t,o);for(let e=0;e<a.length;e+=1)a[e].m(t,null);b(e,i,o);for(let t=0;t<l.length;t+=1)l[t].m(e,o);b(e,n,o),r=!0},p(e,i){if(227&i){let n;for(o=Object.keys(e[0]),n=0;n<o.length;n+=1){const r=lt(e,o,n);a[n]?a[n].p(r,i):(a[n]=bt(r),a[n].c(),a[n].m(t,null))}for(;n<a.length;n+=1)a[n].d(1);a.length=o.length}if((!r||8&i)&&(t.hidden=e[3]),11&i){let t;for(s=Object.keys(e[0]),t=0;t<s.length;t+=1){const r=at(e,s,t);l[t]?(l[t].p(r,i),oe(l[t],1)):(l[t]=Ct(r),l[t].c(),oe(l[t],1),l[t].m(n.parentNode,n))}for(ne(),t=s.length;t<l.length;t+=1)c(t);re()}},i(e){if(!r){for(let e=0;e<s.length;e+=1)oe(l[e]);r=!0}},o(e){l=l.filter(Boolean);for(let e=0;e<l.length;e+=1)ae(l[e]);r=!1},d(e){e&&w(t),M(a,e),e&&w(i),M(l,e),e&&w(n)}}}function _t(t){let i,n=t[0].sort(It),r=[];for(let e=0;e<n.length;e+=1)r[e]=At(ct(t,n,e));return{c(){i=T("div");for(let e=0;e<r.length;e+=1)r[e].c();P(i,"class","exec-summary svelte-11d8ija"),i.hidden=t[3]},m(e,t){b(e,i,t);for(let e=0;e<r.length;e+=1)r[e].m(i,null)},p(e,t){if(1&t){let o;for(n=e[0].sort(It),o=0;o<n.length;o+=1){const a=ct(e,n,o);r[o]?r[o].p(a,t):(r[o]=At(a),r[o].c(),r[o].m(i,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}8&t&&(i.hidden=e[3])},i:e,o:e,d(e){e&&w(i),M(r,e)}}}function yt(e){let t,i="_"!==e[19].slice(0,1),n=i&&xt(e);return{c(){n&&n.c(),t=C()},m(e,i){n&&n.m(e,i),b(e,t,i)},p(e,r){1&r&&(i="_"!==e[19].slice(0,1)),i?n?n.p(e,r):(n=xt(e),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){n&&n.d(e),e&&w(t)}}}function xt(e){let t,i,n,r,o,a,s,l,c,u,h=e[19]+"",d=e[7](e[1],e[19],e[20])+"",p=ot[e[19]]&&ot[e[19]][e[20]]&&vt(e);return{c(){t=T("tr"),i=T("td"),n=S(h),o=E(),a=T("td"),s=new D(!1),l=E(),p&&p.c(),u=E(),P(i,"class","left svelte-11d8ija"),P(i,"data-key",r=e[19]),s.a=l,P(a,"class","right svelte-11d8ija"),P(a,"data-key",c=e[19]),P(t,"class","svelte-11d8ija")},m(e,r){b(e,t,r),y(t,i),y(i,n),y(t,o),y(t,a),s.m(d,a),y(a,l),p&&p.m(a,null),y(t,u)},p(e,t){1&t&&h!==(h=e[19]+"")&&I(n,h),1&t&&r!==(r=e[19])&&P(i,"data-key",r),3&t&&d!==(d=e[7](e[1],e[19],e[20])+"")&&s.p(d),ot[e[19]]&&ot[e[19]][e[20]]?p?p.p(e,t):(p=vt(e),p.c(),p.m(a,null)):p&&(p.d(1),p=null),1&t&&c!==(c=e[19])&&P(a,"data-key",c)},d(e){e&&w(t),p&&p.d()}}}function vt(e){let t,i,n=ot[e[19]][e[20]]+"";return{c(){t=T("span"),i=S(n),P(t,"class","lookup svelte-11d8ija")},m(e,n){b(e,t,n),y(t,i)},p(e,t){1&t&&n!==(n=ot[e[19]][e[20]]+"")&&I(i,n)},d(e){e&&w(t)}}}function bt(e){let t,i=!(e[5].indexOf(e[1])>-1||e[6].indexOf(e[19])>-1),n=i&&yt(e);return{c(){n&&n.c(),t=C()},m(e,i){n&&n.m(e,i),b(e,t,i)},p(e,r){3&r&&(i=!(e[5].indexOf(e[1])>-1||e[6].indexOf(e[19])>-1)),i?n?n.p(e,r):(n=yt(e),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){n&&n.d(e),e&&w(t)}}}function wt(e){let t,i,n,r,o,a;const s=[St,Tt,Mt],l=[];function c(e,t){return 1&t&&(i=null),"_exec_summary"==e[19]?0:(null==i&&(i=!!Array.isArray(e[20])),i?1:2)}return n=c(e,-1),r=l[n]=s[n](e),{c(){t=T("div"),r.c(),o=E(),t.hidden=e[3],P(t,"class","svelte-11d8ija")},m(e,i){b(e,t,i),l[n].m(t,null),y(t,o),a=!0},p(e,i){let u=n;n=c(e,i),n===u?l[n].p(e,i):(ne(),ae(l[u],1,1,(()=>{l[u]=null})),re(),r=l[n],r?r.p(e,i):(r=l[n]=s[n](e),r.c()),oe(r,1),r.m(t,o)),(!a||8&i)&&(t.hidden=e[3])},i(e){a||(oe(r),a=!0)},o(e){ae(r),a=!1},d(e){e&&w(t),l[n].d()}}}function Mt(e){let t,i;return t=new zt({props:{table:e[20],key:e[1]+":"+e[19],i:-1}}),{c(){ce(t.$$.fragment)},m(e,n){ue(t,e,n),i=!0},p(e,i){const n={};1&i&&(n.table=e[20]),3&i&&(n.key=e[1]+":"+e[19]),t.$set(n)},i(e){i||(oe(t.$$.fragment,e),i=!0)},o(e){ae(t.$$.fragment,e),i=!1},d(e){he(t,e)}}}function Tt(e){let t,i,n=e[20],r=[];for(let t=0;t<n.length;t+=1)r[t]=Et(st(e,n,t));const o=e=>ae(r[e],1,1,(()=>{r[e]=null}));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=C()},m(e,n){for(let t=0;t<r.length;t+=1)r[t].m(e,n);b(e,t,n),i=!0},p(e,i){if(3&i){let a;for(n=e[20],a=0;a<n.length;a+=1){const o=st(e,n,a);r[a]?(r[a].p(o,i),oe(r[a],1)):(r[a]=Et(o),r[a].c(),oe(r[a],1),r[a].m(t.parentNode,t))}for(ne(),a=n.length;a<r.length;a+=1)o(a);re()}},i(e){if(!i){for(let e=0;e<n.length;e+=1)oe(r[e]);i=!0}},o(e){r=r.filter(Boolean);for(let e=0;e<r.length;e+=1)ae(r[e]);i=!1},d(e){M(r,e),e&&w(t)}}}function St(e){let t,i;return t=new zt({props:{table:e[20],key:e[1]+":"+e[19],i:-1}}),{c(){ce(t.$$.fragment)},m(e,n){ue(t,e,n),i=!0},p(e,i){const n={};1&i&&(n.table=e[20]),3&i&&(n.key=e[1]+":"+e[19]),t.$set(n)},i(e){i||(oe(t.$$.fragment,e),i=!0)},o(e){ae(t.$$.fragment,e),i=!1},d(e){he(t,e)}}}function Et(e){let t,i;return t=new zt({props:{table:e[23],key:e[1]+":"+e[19],i:e[2]}}),{c(){ce(t.$$.fragment)},m(e,n){ue(t,e,n),i=!0},p(e,i){const n={};1&i&&(n.table=e[23]),3&i&&(n.key=e[1]+":"+e[19]),t.$set(n)},i(e){i||(oe(t.$$.fragment,e),i=!0)},o(e){ae(t.$$.fragment,e),i=!1},d(e){he(t,e)}}}function Ct(e){let t,i,n="_"===e[19].slice(0,1),r=n&&wt(e);return{c(){r&&r.c(),t=C()},m(e,n){r&&r.m(e,n),b(e,t,n),i=!0},p(e,i){1&i&&(n="_"===e[19].slice(0,1)),n?r?(r.p(e,i),1&i&&oe(r,1)):(r=wt(e),r.c(),oe(r,1),r.m(t.parentNode,t)):r&&(ne(),ae(r,1,1,(()=>{r=null})),re())},i(e){i||(oe(r),i=!0)},o(e){ae(r),i=!1},d(e){r&&r.d(e),e&&w(t)}}}function At(e){let t,i=e[16].SummaryText+"";return{c(){t=S(i)},m(e,i){b(e,t,i)},p(e,n){1&n&&i!==(i=e[16].SummaryText+"")&&I(t,i)},d(e){e&&w(t)}}}function Pt(t){let i,n,r,o,a,s,l,c,u,h,d,p,f,m=t[8].length<2&&function(t){let i,n,r,o,a=t[8],s=[];for(let e=0;e<a.length;e+=1)s[e]=ht(ut(t,a,e));return{c(){i=T("button");for(let e=0;e<s.length;e+=1)s[e].c();n=S(t[9]),P(i,"class","toc-item svelte-11d8ija")},m(e,a){b(e,i,a);for(let e=0;e<s.length;e+=1)s[e].m(i,null);y(i,n),r||(o=A(i,"click",t[10]),r=!0)},p:e,d(e){e&&w(i),M(s,e),r=!1,o()}}}(t);function g(e,t){return e[3]?pt:dt}let _=g(t),x=_(t);const v=[mt,ft],C=[];function I(e,t){return 1&t&&(c=null),null==c&&(c=!!(Array.isArray(e[0])?e[0].length:e[0])),c?0:1}return u=I(t,-1),h=C[u]=v[u](t),{c(){i=T("div"),m&&m.c(),n=E(),r=T("h4"),o=S(t[9]),a=E(),s=T("button"),x.c(),l=E(),h.c(),P(s,"class","toggle svelte-11d8ija"),P(r,"class","svelte-11d8ija"),P(i,"class","tablewrapper svelte-11d8ija")},m(e,c){b(e,i,c),m&&m.m(i,null),y(i,n),y(i,r),y(r,o),y(r,a),y(r,s),x.m(s,null),t[12](r),y(i,l),C[u].m(i,null),d=!0,p||(f=A(s,"click",t[11]),p=!0)},p(e,[t]){e[8].length<2&&m.p(e,t),_!==(_=g(e))&&(x.d(1),x=_(e),x&&(x.c(),x.m(s,null)));let n=u;u=I(e,t),u===n?C[u].p(e,t):(ne(),ae(C[n],1,1,(()=>{C[n]=null})),re(),h=C[u],h?h.p(e,t):(h=C[u]=v[u](e),h.c()),oe(h,1),h.m(i,null))},i(e){d||(oe(h),d=!0)},o(e){ae(h),d=!1},d(e){e&&w(i),m&&m.d(),x.d(),t[12](null),C[u].d(),p=!1,f()}}}const It=(e,t)=>e.ESSeqNum-t.ESSeqNum;function kt(e,t,i){let{table:n,key:r,i:o}=t;r.split(":");const a={EPAFacilityID:e=>`#/facility:${e}`,FacilityState:e=>`#/state:${e}`};let s,l=r.split(":").slice(1),c=!1,u={submission:"Submission","submission:_processes":"Process","submission:_emerg_resp":"Emergency Response","submission:_exec_summary":"Executive Summary","submission:_processes:_naics":"Prevention Programs by Industry Code","submission:_processes:_naics:_desc":"NAICS Code Description","submission:_processes:_naics:_prev_prog_3":"Prevention Program (for Program Level 3)","submission:_processes:_naics:_prev_prog_3:_chemicals":"Program Chemical","submission:_processes:_naics:_prev_prog_2":"Prevention Program (for Program Level 2)","submission:_processes:_naics:_prev_prog_2:_chemicals":"Program Chemical","submission:_processes:_chemicals":"Process Chemical","submission:_processes:_chemicals:_chemical":"Chemical Information","submission:_processes:_chemicals:_flam_mix_chemicals":"Flammable Mixture Chemical","submission:_accidents":"Accident","submission:_accidents:_chemicals":"Accident Chemical","submission:_accidents:_chemicals:_flam_mix_chemicals":"Flammable Mixture Accident Chemical"}[r]+(o>-1?` #${parseInt(o)+1}`:"");return e.$$set=e=>{"table"in e&&i(0,n=e.table),"key"in e&&i(1,r=e.key),"i"in e&&i(2,o=e.i)},[n,r,o,c,s,[],["FacilityID"],(e,t,i)=>{if(null===i)return"";if(a[t]){return`<a href='${a[t](i)}'>${i}</a>`}return i},l,u,e=>{s.scrollIntoView()},()=>i(3,c=!c),function(e){j[e?"unshift":"push"]((()=>{s=e,i(4,s)}))}]}class zt extends fe{constructor(e){super(),pe(this,e,kt,Pt,a,{table:0,key:1,i:2})}}function Dt(e){let t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,g,_,x=e[0].FacilityID+"";return f=new zt({props:{table:e[0],key:"submission",i:"-1"}}),{c(){t=T("section"),i=T("h2"),n=S("Submission #"),r=S(x),o=E(),a=T("div"),s=S("⭠ "),l=T("a"),c=S("View all submissions from this facility"),h=E(),d=T("div"),p=E(),ce(f.$$.fragment),m=E(),g=T("script"),g.textContent='(() => {\n      let container = document.querySelector(".toc-container");\n      [].map.call(document.querySelectorAll(".toc-item"), (x) => {\n        container.appendChild(x);\n      });\n    })();',P(l,"href",u="#/facility:"+e[0].EPAFacilityID),P(d,"class","toc-container svelte-6u7zzx"),P(t,"id","submission")},m(e,u){b(e,t,u),y(t,i),y(i,n),y(i,r),y(t,o),y(t,a),y(a,s),y(a,l),y(l,c),y(t,h),y(t,d),y(t,p),ue(f,t,null),y(t,m),y(t,g),_=!0},p(e,[t]){(!_||1&t)&&x!==(x=e[0].FacilityID+"")&&I(r,x),(!_||1&t&&u!==(u="#/facility:"+e[0].EPAFacilityID))&&P(l,"href",u);const i={};1&t&&(i.table=e[0]),f.$set(i)},i(e){_||(oe(f.$$.fragment,e),_=!0)},o(e){ae(f.$$.fragment,e),_=!1},d(e){e&&w(t),he(f)}}}function Lt(e,t,i){let{item:n}=t;return e.$$set=e=>{"item"in e&&i(0,n=e.item)},[n]}class Rt extends fe{constructor(e){super(),pe(this,e,Lt,Dt,a,{item:0})}}function Ot(t){let i;return{c(){i=T("section"),i.innerHTML='<h2>Introduction and Instructions</h2> \n  <p>This online, <a href="https://github.com/data-liberation-project/epa-rmp-viewer">open-source</a> tool provides access to key information <a href="https://github.com/data-liberation-project/epa-rmp-viewer">extracted</a> from <a href="https://docs.google.com/document/d/1jrLXtv0knnACiPXJ1ZRFXR1GaPWCHJWWjin4rsthFbQ/edit">the EPA&#39;s Risk Management Program (RMP) database</a>, <a href="https://www.data-liberation-project.org/requests/epa-risk-management-program/">obtained</a> and <a href="https://github.com/data-liberation-project/epa-rmp-viewer">extracted</a> by the <a href="https://www.data-liberation-project.org/">Data Liberation Project</a>.</p> \n  <p>The RMP database is somewhat complex, and many of the fields in it aren&#39;t self-explanatory. Please read <a href="https://docs.google.com/document/d/1jrLXtv0knnACiPXJ1ZRFXR1GaPWCHJWWjin4rsthFbQ/edit"><b>this guide</b></a> before continuing.</p> \n  <p>Here, you can find several views on the data:</p> \n  <ul><li class="svelte-wz9vls">A <a href="#/list:states"><b>listing of all states</b></a> represented in the database.</li> \n    <li class="svelte-wz9vls">For <b>each state</b> (e.g., <a href="#/state:TX">Texas</a>) — county-by-county listing of all facilities that have, at any point, filed an RMP submission.</li> \n    <li class="svelte-wz9vls">For <b>each facility</b> (e.g., <a href="#/facility:100000070987">this facility</a>) — overview information and a table linking to all the facility&#39;s submissions</li> \n    <li class="svelte-wz9vls">For <b>each submission</b> (e.g., <a href="#/submission:43946">#43946</a>) — raw data from the core database tables, covering information on the submission and facility, processes, process chemicals, prevention programs, accident history, and executive summary. <i>Note: Although this represents a large chunk of the data, it is not exhaustive of all tables and fields in the database, for which you should consult the raw data, available through the documentation linked above.</i></li></ul>'},m(e,t){b(e,i,t)},p:e,i:e,o:e,d(e){e&&w(i)}}}class Bt extends fe{constructor(e){super(),pe(this,e,null,Ot,a,{})}}function Ft(t){let i;return{c(){i=T("div"),i.innerHTML='<h1><a href="#/">RMP Submission Viewer</a></h1> \n  <div class="warning">❗This resource is a work in progress; please consult \n    <b><a href="https://docs.google.com/document/d/1jrLXtv0knnACiPXJ1ZRFXR1GaPWCHJWWjin4rsthFbQ/edit">the documentation</a></b>.</div>',P(i,"class","header svelte-1lxcdva")},m(e,t){b(e,i,t)},p:e,i:e,o:e,d(e){e&&w(i)}}}class Nt extends fe{constructor(e){super(),pe(this,e,null,Ft,a,{})}}function Ut(e,t,i){const n=e.slice();return n[11]=t[i],n}function Vt(e){let t,i;return t=new Rt({props:{item:e[0].view_data}}),{c(){ce(t.$$.fragment)},m(e,n){ue(t,e,n),i=!0},p(e,i){const n={};1&i&&(n.item=e[0].view_data),t.$set(n)},i(e){i||(oe(t.$$.fragment,e),i=!0)},o(e){ae(t.$$.fragment,e),i=!1},d(e){he(t,e)}}}function Gt(e){let t,i;return t=new rt({props:{item:e[0].view_data}}),{c(){ce(t.$$.fragment)},m(e,n){ue(t,e,n),i=!0},p(e,i){const n={};1&i&&(n.item=e[0].view_data),t.$set(n)},i(e){i||(oe(t.$$.fragment,e),i=!0)},o(e){ae(t.$$.fragment,e),i=!1},d(e){he(t,e)}}}function jt(e){let t,i;return t=new Ze({props:{item:e[0].view_data}}),{c(){ce(t.$$.fragment)},m(e,n){ue(t,e,n),i=!0},p(e,i){const n={};1&i&&(n.item=e[0].view_data),t.$set(n)},i(e){i||(oe(t.$$.fragment,e),i=!0)},o(e){ae(t.$$.fragment,e),i=!1},d(e){he(t,e)}}}function Wt(t){let i,n,r,o,a=t[0].view_data.sort(Xt),s=[];for(let e=0;e<a.length;e+=1)s[e]=Zt(Ut(t,a,e));return{c(){i=T("section"),n=T("h2"),n.textContent="Facilities by State",r=E(),o=T("ul");for(let e=0;e<s.length;e+=1)s[e].c();P(o,"id","states-list"),P(i,"id","states")},m(e,t){b(e,i,t),y(i,n),y(i,r),y(i,o);for(let e=0;e<s.length;e+=1)s[e].m(o,null)},p(e,t){if(1&t){let i;for(a=e[0].view_data.sort(Xt),i=0;i<a.length;i+=1){const n=Ut(e,a,i);s[i]?s[i].p(n,t):(s[i]=Zt(n),s[i].c(),s[i].m(o,null))}for(;i<s.length;i+=1)s[i].d(1);s.length=a.length}},i:e,o:e,d(e){e&&w(i),M(s,e)}}}function $t(t){let i,n,o,a,s,l;return{c(){i=T("section"),n=T("h2"),n.innerHTML='<label for="avatar">Load a submission JSON file</label>',o=E(),a=T("input"),P(a,"accept","application/json"),P(a,"id","sub_file"),P(a,"name","sub_file"),P(a,"type","file"),P(i,"id","chooser")},m(e,r){b(e,i,r),y(i,n),y(i,o),y(i,a),s||(l=[A(a,"change",t[5]),A(a,"change",t[3])],s=!0)},p:e,i:e,o:e,d(e){e&&w(i),s=!1,r(l)}}}function qt(e){let t,i,n;var r=e[2][e[0].view_arg];return r&&(t=L(r,{})),{c(){t&&ce(t.$$.fragment),i=C()},m(e,r){t&&ue(t,e,r),b(e,i,r),n=!0},p(e,n){if(r!==(r=e[2][e[0].view_arg])){if(t){ne();const e=t;ae(e.$$.fragment,1,0,(()=>{he(e,1)})),re()}r?(t=L(r,{}),ce(t.$$.fragment),oe(t.$$.fragment,1),ue(t,i.parentNode,i)):t=null}},i(e){n||(t&&oe(t.$$.fragment,e),n=!0)},o(e){t&&ae(t.$$.fragment,e),n=!1},d(e){e&&w(i),t&&he(t,e)}}}function Zt(e){let t,i,n,r,o,a,s,l,c=e[11].name+"",u=e[11].count+"";return{c(){t=T("li"),i=T("a"),n=S(c),r=S(" ("),o=S(u),a=S(")"),l=E(),P(i,"href",s="#/state:"+e[11].abbr)},m(e,s){b(e,t,s),y(t,i),y(i,n),y(i,r),y(i,o),y(i,a),y(t,l)},p(e,t){1&t&&c!==(c=e[11].name+"")&&I(n,c),1&t&&u!==(u=e[11].count+"")&&I(o,u),1&t&&s!==(s="#/state:"+e[11].abbr)&&P(i,"href",s)},d(e){e&&w(t)}}}function Ht(e){let t,i,n,r,o,a,s,l,c;t=new Nt({});const u=[qt,$t,Wt,jt,Gt,Vt],h=[];function d(e,t){return"page"==e[0].view?0:"file"===e[0].view&&"chooser"==e[0].view_arg?1:"list"==e[0].view&&"states"==e[0].view_arg&&e[0].view_data?2:"state"==e[0].view&&e[0].view_data?3:"facility"==e[0].view&&e[0].view_data?4:"submission"==e[0].view&&e[0].view_data?5:-1}return~(n=d(e))&&(r=h[n]=u[n](e)),{c(){ce(t.$$.fragment),i=E(),r&&r.c(),o=E(),a=T("hr")},m(r,u){ue(t,r,u),b(r,i,u),~n&&h[n].m(r,u),b(r,o,u),b(r,a,u),s=!0,l||(c=A(window,"hashchange",e[4]),l=!0)},p(e,[t]){let i=n;n=d(e),n===i?~n&&h[n].p(e,t):(r&&(ne(),ae(h[i],1,1,(()=>{h[i]=null})),re()),~n?(r=h[n],r?r.p(e,t):(r=h[n]=u[n](e),r.c()),oe(r,1),r.m(o.parentNode,o)):r=null)},i(e){s||(oe(t.$$.fragment,e),oe(r),s=!0)},o(e){ae(t.$$.fragment,e),ae(r),s=!1},d(e){he(t,e),e&&w(i),~n&&h[n].d(e),e&&w(o),e&&w(a),l=!1,c()}}}const Xt=(e,t)=>e.name<t.name?-1:1;function Yt(e,t,i){const n={landing:Bt};let r={view:null,view_arg:null,view_data:null};let o;const a={list:e=>"./data/facilities/states.json",state:e=>`./data/facilities/by-state/${e}.json`,facility:e=>`./data/facilities/detail/${e}.json`,submission:e=>`./data/submissions/${e}.json`},s=()=>{if(i(0,r.view=null,r),i(0,r.view_arg=null,r),i(0,r.view_data=null,r),""===location.hash)i(0,r.view="page",r),i(0,r.view_arg="landing",r);else if(location.hash.indexOf(":")<0)location.hash="";else{const e=location.hash.match(/^#\/([^:]+):([^:+]+)/);e?(i(0,r.view=e[1],r),i(0,r.view_arg=e[2],r),l()):console.log("Could not parse location.hash: "+location.hash)}},l=()=>{((e,t)=>{if(a[e]){const n=a[e](t);fetch(n).then((e=>e.json())).then((e=>{i(0,r.view_data=e,r)})).catch((e=>{console.log(e)}))}})(r.view,r.view_arg)};return s(),[r,o,n,()=>{if(o)for(const e of o){const t=new FileReader;t.onload=function(e){i(0,r.view_data=JSON.parse(t.result),r),i(0,r.view="submission",r)},t.readAsText(e)}},s,function(){o=this.files,i(1,o)}]}return new class extends fe{constructor(e){super(),pe(this,e,Yt,Ht,a,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
